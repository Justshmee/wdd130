define(["require","exports","./c_init_data_runtime","./e_folder_viewer_src_main","./c_react_query_helpers_helpers","./c_core_i18n","./c_files_view_data_store","./c_core_uri","./c_base64","./e_core_exception","./c_browse_models","./c_api_v2_client_base","./c_hooks_use_stabilized_callback","./c_stormcrow_gating_factory","./c_api_v2_noauth_client","metaserver/static/js/modules/constants/pdf_editing","react","./c_ui-icon_line_restore","./c_lodash-es_lodash","./c_growth_ui_teams_web_actions_logger_events","metaserver/static/js/modules/constants/search","./c_toolkit_dist_redux-toolkit","./c_home_store","metaserver/static/js/modules/constants/web_experience_constants","./c_src_sink_index","./c_plugin_utils_getImageDefaultSizes","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/unity","./c_core_notify"],(function(e,t,s,i,r,n,a,o,_,c,l,d,u,h,E,S,g,p,f,y,T,I,m,R,O,A,v,N,C){"use strict";function w(e){return e&&e.__esModule?e:{default:e}}function P(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(s){if("default"!==s){var i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return e[s]}})}})),t.default=e,Object.freeze(t)}var D,b=w(g),L=P(N);function U(e){const{sharedLinkUrl:t,rlkey:s,origin:n,userId:a}=e,o=a||r.getActiveUserId();return i.defaultEmitter.select(i.ON_FETCH_DOWNLOAD_URL_API_START).emit(null),i.SilentBackgroundRequest$2({url:"/sharing/fetch_user_content_link",data:{url:t,rlkey:s,origin:n},subject_user:o}).then((e=>(i.defaultEmitter.select(i.ON_FETCH_DOWNLOAD_URL_API_SUCCESS).emit(null),e)),(e=>{throw i.defaultEmitter.select(i.ON_FETCH_DOWNLOAD_URL_API_FAILED).emit(null),e}))}function M(e){if("aes_256_gcm"===e[".tag"])return"AES256_GCM_EXTRAS";throw new Error("Could not convert EncryptionScheme to Algorithm")}function k(e){if(!e)throw new Error("Missing symmetric crypto extras");return{authTag:s.protoBase64.dec(e.auth_tag),nonce:s.protoBase64.dec(e.nonce)}}function F(e){if("blockwise"!==e[".tag"])throw new Error("Currently only blockwise encryption is supported");if(!e.block_encryption_extras)throw new Error("Missing block encryption extras");return{schemeType:{case:"blockwise",value:{setAuthTag:s.protoBase64.dec(e.set_auth_tag),blockEncryptionExtras:e.block_encryption_extras.map((e=>k(e))),encryptedHmacKey:s.protoBase64.dec(e.encrypted_hmac_key),hmacKeyEncryptionExtras:k(e.hmac_key_encryption_extras)}}}}!function(e){e.ClientNotEnrolled="client_not_enrolled",e.MissingFileEncryptionInfo="missing_file_encryption_info",e.CouldNotLoadClientKey="could_not_load_client_key",e.CouldNotLoadFileKey="could_not_load_file_key",e.KeyVerificationRequired="key_verification_required"}(D||(D={}));class H extends Error{constructor(e,t){super(),this.type=e,this.filesCount=t}}const j=e=>`/encrypted_folder_download/proxy?${new URLSearchParams({downloadUrl:e})}`,G=e=>s.__awaiter(void 0,void 0,void 0,(function*(){var t;_.encryptedFolderMetrics.downloadHandleSingleFile();const{href:i,user:r,fileEncryptionInfo:n}=e;if(!l.isClientEnrolled(r)){if("key_verification_enabled"===l.getClientNotEnrolledReason(r))throw new H(D.KeyVerificationRequired,1);throw new H(D.ClientNotEnrolled,1)}const a=yield s.__awaiter(void 0,void 0,void 0,(function*(){const e=yield navigator.serviceWorker.register("/encrypted_folder_download/service_worker.js",{scope:"/encrypted_folder_download/proxy"});return e.active?(_.encryptedFolderMetrics.serviceWorkerState(_.ServiceWorkerState.active),e.active):new Promise(((t,s)=>{const i=e.installing||e.waiting;if(!i){_.encryptedFolderMetrics.serviceWorkerState(_.ServiceWorkerState.hanging);const e=new Error("Service Worker: Failed to activate Encrypted Folder service worker");return c.reportException({err:e,tags:["encrypted_folder_web_service_worker"],severity:c.SEVERITY.CRITICAL}),void s(e)}const r=()=>{"activated"===i.state&&(_.encryptedFolderMetrics.serviceWorkerState(_.ServiceWorkerState.activated),i.removeEventListener("statechange",r),t(i))};i.addEventListener("statechange",r)}))}));if(!(n.keyid&&n.encryption_scheme&&n.content_encryption_extras&&n.per_revision_key_info))throw new H(D.MissingFileEncryptionInfo,1);let u,h;try{u=l.loadClientKey(r)}catch(e){throw _.encryptedFolderMetrics.ekmsLoadClientKeyFail(),new H(D.CouldNotLoadClientKey,1)}try{h=(yield _.loadFileKeys(r,[n.keyid],u))[0]}catch(e){const s=d.filterApiError(e);throw"no_chain_to_key"===(null===(t=null==s?void 0:s.error)||void 0===t?void 0:t[".tag"])&&l.removeClientKey(r),new H(D.CouldNotLoadFileKey,1)}var E;return((e,t)=>{e.postMessage(t),_.encryptedFolderMetrics.serviceWorkerMetadataPosted()})(a,[new URL(o.URI.parse(i).toString()).pathname,{fileKey:h,algorithm:M(n.encryption_scheme),contentEncryptionExtras:F(n.content_encryption_extras),perRevisionKeyInfo:(E=n.per_revision_key_info,{encryptedKeyData:s.protoBase64.dec(E.encrypted_key_data),encryptionExtras:s.protoBase64.dec(E.encryption_extras)}),encryptedPlaintextBlocklist:s.protoBase64.dec(n.encrypted_plaintext_blocklist),plaintextBlocklistEncryptionExtras:s.protoBase64.dec(n.plaintext_blocklist_encryption_extras)}]),j}));const q="info_blade",x="pdf_edit_plugin",Q="file_activity",W=[q,Q];function V(e){return e.ns("hellosign")}const Y=e=>{let t,s;e.header&&(t=b.default.createElement(i.Modal.Title,null,n.intl.formatMessage(e.header))),e.body&&(s=n.intl.formatMessage(e.body));const r=e.confirmationString||i.defineMessage({id:"4aLDLg",defaultMessage:"OK"});return b.default.createElement(i.Modal,{open:e.isOpen,isCentered:!0,withCloseButton:"Close",onRequestClose:e.close},b.default.createElement(i.Modal.Header,{hasBottomSpacing:"title-standard"},t),b.default.createElement(i.Modal.Body,{hasVerticalSpacing:!1},s),b.default.createElement(i.Modal.Footer,null,e.additionalCloseButton&&b.default.createElement(i.Button,{variant:"opacity",onClick:e.close},n.intl.formatMessage(e.additionalCloseButton)),b.default.createElement(i.Button,{variant:"primary",onClick:()=>{e.confirmRedirect?window.open(e.confirmRedirect):e.onConfirm?e.onConfirm():e.close()},withIconLeft:e.confirmRedirect?b.default.createElement(i.UIIcon,{src:p.OpenLine}):null},n.intl.formatMessage(r))))};Y.displayName="ConfirmationModal";const B=i.defineMessages({overFileLimitError:{id:"+2TtIJ",defaultMessage:"The page count and file size are too large for signatures in PDF. Try reducing the file to less than 40MB or 500 pages."}});var K,z;t.EntryPointType=void 0,(K=t.EntryPointType||(t.EntryPointType={})).SELF_SIGN="SELF_SIGN",K.SEND_FOR_SIGNATURE="SEND_FOR_SIGNATURE",K.TEMPLATE="TEMPLATE",t.EntryPointSurface=void 0,(t.EntryPointSurface||(t.EntryPointSurface={})).SIGNATURES="SIGNATURES",t.SignEditorType=void 0,(z=t.SignEditorType||(t.SignEditorType={})).PDF_EDITOR="PDF_EDITOR",z.DEEP_INTEGRATION="DEEP_INTEGRATION";const $=()=>{i.mountModal(b.default.createElement(Y,{isOpen:!0,close:()=>i.unmountModal(),header:i.defineMessage({id:"dyerh1",defaultMessage:"Canâ€™t add signature."}),body:B.overFileLimitError}))};function X(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=new r.UserApiV2Client;e||(e=r.mustGetActiveUser());try{return(yield V(t).rpc("get_pdf_editor_eligibility",void 0,{subjectUserId:e.id})).is_eligible}catch(e){}return!0}))}const J=(e,i,r,n,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(e!==t.EntryPointType.SELF_SIGN&&e!==t.EntryPointType.SEND_FOR_SIGNATURE&&e!==t.EntryPointType.TEMPLATE)throw new Error("entry_point_not_supported");if(!(yield te(n)))return!1;if(!i.ext||!u.HELLOSIGN_SUPPORTED_EXTENSIONS.includes(`.${i.ext}`))throw new Error("file_extension_not_supported");let s=t.SignEditorType.DEEP_INTEGRATION;if("ON"!==S.STORMCROW_FORM_BUILDING_VARIANT)s=t.SignEditorType.DEEP_INTEGRATION;else if("pdf"===i.ext){let i=r?r.pdfVariant:void 0;i||(i=yield ee("sign_pdf_in_pdf_editor",n)),("ON"===i||e===t.EntryPointType.SELF_SIGN&&a!==t.EntryPointSurface.SIGNATURES)&&(s=t.SignEditorType.PDF_EDITOR)}else{let e=r?r.nonPdfVariant:void 0;e||(e=yield ee("sign_non_pdf_in_pdf_editor",n));se(i.ext,e)&&(s=t.SignEditorType.PDF_EDITOR)}if(s===t.SignEditorType.PDF_EDITOR){if(i.bytes>u.HELLO_SIGN_MAX_FILE_SIZE)throw new Error("size_over_limit");if(i.pageCount&&i.pageCount>u.HELLO_SIGN_MAX_PAGES)throw new Error("page_count_over_limit")}return s===t.SignEditorType.PDF_EDITOR})),Z=(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=yield new h.StormcrowGatingClient(new r.UserApiV2Client,new E.NoAuthApiV2Client).getVariant({features:[e]},t?t.id:void 0);let i="OFF";return s&&s.variantInfos.forEach((t=>{t.feature===e&&(i=t.variant||"OFF")})),i})),ee=f.memoize(Z),te=f.memoize(X),se=(e,t)=>!!e&&(!(!t||"OFF"===t)&&(u.SIGN_NON_PDF_IN_PDF_EDITOR_SUPPORTED_EXTENSIONS.includes(e)?"M1"===t||"M2"===t:!!u.SIGN_NON_PDF_IN_PDF_EDITOR_SUPPORTED_EXTENSIONS_M2.includes(e)&&"M2"===t));class ie{constructor(e){this.category="search-web_search_activity",this.active_user_id=null,this.anon_ip=null,this.authed_user_ids=null,this.country=null,this.identity_gid=null,this.locale_browser_header=null,this.locale_user_selected=null,this.referrer=null,this.session_id=null,this.team_id=null,this.team_type=null,this.ua_browser_name=null,this.ua_browser_version=null,this.ua_dist_name=null,this.ua_dist_version=null,this.ua_os_name=null,this.ua_os_version=null,this.user_agent=null,this.user_id=null,e.hasOwnProperty("action_type")&&void 0!==e.action_type&&(this.action_type=e.action_type),e.hasOwnProperty("active_user_id")&&void 0!==e.active_user_id&&(this.active_user_id=e.active_user_id),e.hasOwnProperty("anon_ip")&&void 0!==e.anon_ip&&(this.anon_ip=e.anon_ip),e.hasOwnProperty("authed_user_ids")&&void 0!==e.authed_user_ids&&(this.authed_user_ids=e.authed_user_ids),e.hasOwnProperty("country")&&void 0!==e.country&&(this.country=e.country),e.hasOwnProperty("deleted_filter")&&void 0!==e.deleted_filter&&(this.deleted_filter=e.deleted_filter),e.hasOwnProperty("deleted")&&void 0!==e.deleted&&(this.deleted=e.deleted),e.hasOwnProperty("event_name")&&void 0!==e.event_name&&(this.event_name=e.event_name),e.hasOwnProperty("extra")&&void 0!==e.extra&&(this.extra=e.extra),e.hasOwnProperty("failure_type")&&void 0!==e.failure_type&&(this.failure_type=e.failure_type),e.hasOwnProperty("file_extension")&&void 0!==e.file_extension&&(this.file_extension=e.file_extension),e.hasOwnProperty("file_is_shared")&&void 0!==e.file_is_shared&&(this.file_is_shared=e.file_is_shared),e.hasOwnProperty("file_last_edited")&&void 0!==e.file_last_edited&&(this.file_last_edited=e.file_last_edited),e.hasOwnProperty("file_name")&&void 0!==e.file_name&&(this.file_name=e.file_name),e.hasOwnProperty("file_nsid")&&void 0!==e.file_nsid&&(this.file_nsid=e.file_nsid),e.hasOwnProperty("file_path")&&void 0!==e.file_path&&(this.file_path=e.file_path),e.hasOwnProperty("file_size")&&void 0!==e.file_size&&(this.file_size=e.file_size),e.hasOwnProperty("file_sjid")&&void 0!==e.file_sjid&&(this.file_sjid=e.file_sjid),e.hasOwnProperty("file_type_filters")&&void 0!==e.file_type_filters&&(this.file_type_filters=e.file_type_filters),e.hasOwnProperty("identity_gid")&&void 0!==e.identity_gid&&(this.identity_gid=e.identity_gid),e.hasOwnProperty("latency")&&void 0!==e.latency&&(this.latency=null!==e.latency?e.latency.toString():null),e.hasOwnProperty("locale_browser_header")&&void 0!==e.locale_browser_header&&(this.locale_browser_header=e.locale_browser_header),e.hasOwnProperty("locale_user_selected")&&void 0!==e.locale_user_selected&&(this.locale_user_selected=e.locale_user_selected),e.hasOwnProperty("match_type")&&void 0!==e.match_type&&(this.match_type=e.match_type),e.hasOwnProperty("paper_folder_id")&&void 0!==e.paper_folder_id&&(this.paper_folder_id=e.paper_folder_id),e.hasOwnProperty("paper_pad_id")&&void 0!==e.paper_pad_id&&(this.paper_pad_id=e.paper_pad_id),e.hasOwnProperty("path_scoped")&&void 0!==e.path_scoped&&(this.path_scoped=null!==e.path_scoped?e.path_scoped.toString():null),e.hasOwnProperty("position")&&void 0!==e.position&&(this.position=null===e.position?null:e.position.toString()),e.hasOwnProperty("preview_request_id")&&void 0!==e.preview_request_id&&(this.preview_request_id=e.preview_request_id),e.hasOwnProperty("query_string")&&void 0!==e.query_string&&(this.query_string=e.query_string),e.hasOwnProperty("query_suggestion_count")&&void 0!==e.query_suggestion_count&&(this.query_suggestion_count=e.query_suggestion_count),e.hasOwnProperty("query_suggestion_strings")&&void 0!==e.query_suggestion_strings&&(this.query_suggestion_strings=e.query_suggestion_strings),e.hasOwnProperty("recent_history_map")&&void 0!==e.recent_history_map&&(this.recent_history_map=e.recent_history_map),e.hasOwnProperty("referrer")&&void 0!==e.referrer&&(this.referrer=e.referrer),e.hasOwnProperty("request_id")&&void 0!==e.request_id&&(this.request_id=e.request_id),e.hasOwnProperty("result_count")&&void 0!==e.result_count&&(this.result_count=null!==e.result_count?e.result_count.toString():null),e.hasOwnProperty("result_id")&&void 0!==e.result_id&&(this.result_id=e.result_id),e.hasOwnProperty("session_id")&&void 0!==e.session_id&&(this.session_id=e.session_id),e.hasOwnProperty("search_session_id")&&void 0!==e.search_session_id&&(this.search_session_id=e.search_session_id),e.hasOwnProperty("search_session_query_id")&&void 0!==e.search_session_query_id&&(this.search_session_query_id=e.search_session_query_id),e.hasOwnProperty("source")&&void 0!==e.source&&(this.source=e.source),e.hasOwnProperty("start")&&void 0!==e.start&&(this.start=null!==e.start?e.start.toString():null),e.hasOwnProperty("team_id")&&void 0!==e.team_id&&(this.team_id=e.team_id),e.hasOwnProperty("team_type")&&void 0!==e.team_type&&(this.team_type=e.team_type),e.hasOwnProperty("timestamp")&&void 0!==e.timestamp&&(this.timestamp=e.timestamp),e.hasOwnProperty("timezone_offset")&&void 0!==e.timezone_offset&&(this.timezone_offset=e.timezone_offset),e.hasOwnProperty("type")&&void 0!==e.type&&(this.type=e.type),e.hasOwnProperty("typeahead_session_id")&&void 0!==e.typeahead_session_id&&(this.typeahead_session_id=e.typeahead_session_id),e.hasOwnProperty("ua_browser_name")&&void 0!==e.ua_browser_name&&(this.ua_browser_name=e.ua_browser_name),e.hasOwnProperty("ua_browser_version")&&void 0!==e.ua_browser_version&&(this.ua_browser_version=e.ua_browser_version),e.hasOwnProperty("ua_dist_name")&&void 0!==e.ua_dist_name&&(this.ua_dist_name=e.ua_dist_name),e.hasOwnProperty("ua_dist_version")&&void 0!==e.ua_dist_version&&(this.ua_dist_version=e.ua_dist_version),e.hasOwnProperty("ua_os_name")&&void 0!==e.ua_os_name&&(this.ua_os_name=e.ua_os_name),e.hasOwnProperty("ua_os_version")&&void 0!==e.ua_os_version&&(this.ua_os_version=e.ua_os_version),e.hasOwnProperty("user_agent")&&void 0!==e.user_agent&&(this.user_agent=e.user_agent),e.hasOwnProperty("user_id")&&void 0!==e.user_id&&(this.user_id=e.user_id),e.hasOwnProperty("view_type")&&void 0!==e.view_type&&(this.view_type=e.view_type),e.hasOwnProperty("viewport")&&void 0!==e.viewport&&(this.viewport=e.viewport),e.hasOwnProperty("search_scoped_to_account_id")&&void 0!==e.search_scoped_to_account_id&&(this.search_scoped_to_account_id=e.search_scoped_to_account_id),e.hasOwnProperty("action_source")&&void 0!==e.action_source&&(this.action_source=e.action_source),e.hasOwnProperty("tag_suggestions_strings")&&void 0!==e.tag_suggestions_strings&&(this.tag_suggestions_strings=e.tag_suggestions_strings),e.hasOwnProperty("tag_suggestions_count")&&void 0!==e.tag_suggestions_count&&(this.tag_suggestions_count=e.tag_suggestions_count),e.hasOwnProperty("dimension_filter")&&void 0!==e.dimension_filter&&(this.dimension_filter=e.dimension_filter),e.hasOwnProperty("timestamp_ms")&&void 0!==e.timestamp_ms&&(this.timestamp_ms=e.timestamp_ms),Object.seal(this)}}var re;t.ActionTypes=void 0,(re=t.ActionTypes||(t.ActionTypes={})).SET_VARIANT="SEARCH/SET_VARIANT",re.SET_USER="SEARCH/SET_USER",re.SET_PATH="SEARCH/SET_PATH",re.SET_QUERY="SEARCH/SET_QUERY",re.SET_RESULT_QUERY="SEARCH/SET_RESULT_QUERY",re.SET_PEOPLE_QUERY="SEARCH/SET_PEOPLE_QUERY",re.SET_FILE_CATEGORIES="SEARCH/SET_FILE_CATEGORIES",re.SET_TYPEAHEAD_SESSION_ID="SEARCH/SET_TYPEAHEAD_SESSION_ID",re.SET_SELECTION="SEARCH/SET_SELECTION",re.SET_PREVIEW_FILE_ID="SEARCH/SET_PREVIEW_FILE",re.SET_SORT_ORDER="SEARCH/SET_SORT_ORDER",re.SET_IMAGE_SUGGESTION="SEARCH/SET_IMAGE_SUGGESTION",re.RENAME_FILE="SEARCH/RENAME_FILE",re.DELETE_FILES="SEARCH/DELETE_FILES",re.PURGE_FILES="SEARCH/PURGE_FILES",re.RESTORE_FILES="SEARCH/RESTORE_FILES",re.SET_QUERY_HISTORY="SEARCH/SET_QUERY_HISTORY",re.SET_HIGHLIGHTED_ROW="SEARCH/SET_HIGHLIGHTED_ROW",re.UPDATE_QUERY_SUGGESTIONS_CACHE="SEARCH/UPDATE_QUERY_SUGGESTIONS_CACHE",re.SET_FILTERED_ACCOUNT_ID="SEARCH/SET_FILTERED_ACCOUNT_ID",re.UPDATE_PEOPLE_SUGGESTIONS_CACHE="SEARCH/UPDATE_PEOPLE_SUGGESTIONS_CACHE",re.SET_DWELL_TIME="SEARCH/SET_DWELL_TIME",re.SET_IS_CREATING_SHARED_LINK="SEARCH/SET_IS_CREATING_SHARED_LINK",re.UPDATE_TAGS_SUGGESTIONS_CACHE="SEARCH/UPDATE_TAGS_SUGGESTIONS_CACHE",re.SET_LAST_MODIFIED_DATE="SEARCH/SET_LAST_MODIFIED_DATE",re.SET_DATE_TAKEN="SEARCH/SET_DATE_TAKEN_VALUE",re.SET_SELECTED_DIMENSIONS="SEARCH/SET_SELECTED_DIMENSIONS",re.UPDATE_RESULT_SUGGESTIONS_CACHE="SEARCH/UPDATE_RESULT_SUGGESTIONS_CACHE",re.SET_IS_SEARCH_QUERY_UP_TO_DATE_WITH_FILTERS="SEARCH/SET_IS_SEARCH_QUERY_UP_TO_DATE_WITH_FILTERS",re.SET_IS_FILTERS_UP_TO_DATE_WITH_SEARCH_QUERY="SEARCH/SET_IS_FILTERS_UP_TO_DATE_WITH_SEARCH_QUERY",re.SET_FLEXIBLE_QUERY="SEARCH/SET_FLEXIBLE_QUERY",re.SET_SHOULD_SEARCH_BY_FQL="SEARCH/SET_SHOULD_SEARCH_BY_FQL",re.SET_QUESTION="SEARCH/SET_QUESTION",re.SET_IS_QUESTION_ANSWER_LOADING="SEARCH/SET_IS_QUESTION_ANSWER_LOADING",re.SET_QUESTION_QUERY_OVERRIDE="SEARCH/SET_QUESTION_QUERY_OVERRIDE",re.SET_QUESTION_NLS_OVERRIDE="SEARCH/SET_QUESTION_NLS_OVERRIDE",re.SET_RECENT_ITEM_SUGGESTIONS_LOADING_STATE="SEARCH/SET_RECENT_ITEM_SUGGESTIONS_LOADING_STATE",re.UPDATE_REACT_QUERY_SEARCH_RESULTS="SEARCH/UPDATE_REACT_QUERY_SEARCH_RESULTS",re.CLEAR_FILE_ACTIONS_DATA="SEARCH/CLEAR_FILE_ACTIONS_DATA",re.SET_SERP_SEARCH_REQUEST_ARGS="SEARCH/SET_SERP_SEARCH_REQUEST_ARGS",re.SET_RIGHT_SIDEBAR="SEARCH/SET_RIGHT_SIDEBAR",re.SET_QUICK_VIEW_FILE="SEARCH/SET_QUICK_VIEW_FILE";const ne=/^\/search\//,ae=/^\/(home|personal|work)/,oe=/^\/starred/,_e=/^\/recents/,ce=/^\/share/,le=/^\/photos/,de=/^\/requests/,ue=/^\/automations/,he=/^\/backups/,Ee=/^\/backup\/all/,Se=/^\/h([^\w]|$)/,ge=/^\/collections/,pe=/^\/deleted_files/,fe=/^\/account/;[{category:a.FileCategory.IMAGE,label:n.intl.formatMessage({id:"ZnS57e",defaultMessage:"Images"})},{category:a.FileCategory.FOLDER,label:n.intl.formatMessage({id:"U6qGE8",defaultMessage:"Folders"})},{category:a.FileCategory.VIDEO,label:n.intl.formatMessage({id:"AF+/tL",defaultMessage:"Video"})},{category:a.FileCategory.PDF,label:n.intl.formatMessage({id:"lKbROR",defaultMessage:"PDFs"})},{category:a.FileCategory.DOCUMENT,label:n.intl.formatMessage({id:"EYw1Cy",defaultMessage:"Documents"})},{category:a.FileCategory.SPREADSHEET,label:n.intl.formatMessage({id:"GRyN3w",defaultMessage:"Spreadsheets"})},{category:a.FileCategory.PRESENTATION,label:n.intl.formatMessage({id:"noyhQI",defaultMessage:"Presentations"})},{category:a.FileCategory.AUDIO,label:n.intl.formatMessage({id:"UYx/2r",defaultMessage:"Audio"})},{category:a.FileCategory.PAPER,label:n.intl.formatMessage({id:"+rsEJ/",defaultMessage:"Paper docs"})},{category:a.FileCategory.OTHER,label:n.intl.formatMessage({id:"MYByNv",defaultMessage:"Other"})}].filter((e=>e.category!==a.FileCategory.PAPER));const ye=e=>e instanceof l.File?e.file_id||e.fq_path:e instanceof l.FileSharedWithMe?e.file_id:e instanceof l.Paper?e.pad_id:e instanceof l.PaperFolder?e.folder_id:e.fq_path,Te=e=>{const t=(null!=e?e:"").trim().toLowerCase();if(t.split(" ").length<2)return!1;return-1!==t.split(" ")[0].search(/\b(who|what|when|why|where|how)'?(s|re|d|ll)?\b/)||["summarize","is there","are there"].some((e=>t.startsWith(e)))||t.endsWith("?")},Ie={variant:"full-page",query:"",resultQuery:"",peopleQuery:"",path:"/",typeaheadSessionId:"",selection:a.createSelection(),queryHistory:[],previewFileId:void 0,sortOrder:{sortField:i.SortField.RELEVANCE,sortDirection:i.SortDirection.DESCENDING},fileCategories:a.FILE_CATEGORIES_UNCHECKED,imageSuggestionCount:0,imageSuggestionQuery:"",imageSuggestionRequestId:void 0,imageSuggestionResults:i.immutableExports.OrderedMap(),filteredAccountId:void 0,peopleSuggestionsCache:{},querySuggestionsCache:{},isCreatingSharedLinkMap:i.immutableExports.Map(),tagsSuggestionsCache:{},lastModifiedDate:a.DateRange.Any,selectedDimensions:[],dateTaken:a.DateRange.Any,suggestionSectionOrder:a.defaultSuggestionSectionOrder,resultSuggestionsCache:{},isSearchQueryUpToDateWithFilters:!0,isFiltersUpToDateWithSearchQuery:!0,refreshCount:0,question:null,isQuestionAnswerLoading:!1,questionAnsweringOverrideQuery:void 0,recentItemSuggestionsLoadingState:a.RecentItemSuggestionsLoadingState.DISMISSED,serpSearchRequestArgs:{query:""}};function me(e=Ie,s){switch(s.type){case t.ActionTypes.SET_VARIANT:return((e,t)=>Object.assign(Object.assign({},e),{variant:t.variant}))(e,s.payload);case t.ActionTypes.SET_USER:return((e,t)=>{var s;const i=null!==(s=t.options)&&void 0!==s?s:e.userOptions;return Object.assign(Object.assign({},e),{user:t.user,userOptions:i})})(e,s.payload);case t.ActionTypes.SET_PATH:return((e,t)=>Object.assign(Object.assign({},e),{path:t.path}))(e,s.payload);case t.ActionTypes.SET_FILE_CATEGORIES:return((e,t)=>Object.assign(Object.assign({},e),{fileCategories:t.fileCategories}))(e,s.payload);case t.ActionTypes.SET_QUERY:return((e,t)=>Object.assign(Object.assign({},e),{query:t.query,highlightedRow:void 0,questionAnsweringNlsTrigger:!1}))(e,s.payload);case t.ActionTypes.SET_RESULT_QUERY:return((e,t)=>Object.assign(Object.assign({},e),{resultQuery:t.resultQuery,questionAnsweringOverrideQuery:void 0,questionAnsweringNlsTrigger:!1}))(e,s.payload);case t.ActionTypes.SET_PEOPLE_QUERY:return((e,t)=>Object.assign(Object.assign({},e),{peopleQuery:t.peopleQuery}))(e,s.payload);case t.ActionTypes.SET_TYPEAHEAD_SESSION_ID:return((e,t)=>Object.assign(Object.assign({},e),{typeaheadSessionId:t.typeaheadSessionId}))(e,s.payload);case t.ActionTypes.SET_SELECTION:return((e,t)=>Object.assign(Object.assign({},e),{selection:t.selection}))(e,s.payload);case t.ActionTypes.SET_PREVIEW_FILE_ID:return((e,t)=>Object.assign(Object.assign({},e),{previewFileId:t.previewFileId}))(e,s.payload);case t.ActionTypes.SET_SORT_ORDER:return((e,t)=>Object.assign(Object.assign({},e),{sortOrder:t.sortOrder}))(e,s.payload);case t.ActionTypes.SET_IMAGE_SUGGESTION:return((e,t)=>{const s=e.imageSuggestionResults.clear();return Object.assign(Object.assign({},e),{imageSuggestionResults:s.concat(t.results.map((e=>[ye(e),e]))),imageSuggestionCount:t.results.length,imageSuggestionQuery:t.query,imageSuggestionRequestId:t.requestId})})(e,s.payload);case t.ActionTypes.SET_DWELL_TIME:return((e,t)=>Object.assign(Object.assign({},e),{dwellStartTime:t.dwellStartTime}))(e,s.payload);case t.ActionTypes.SET_QUERY_HISTORY:return((e,t)=>{const{queryHistory:s}=t;return Object.assign(Object.assign({},e),{queryHistory:s})})(e,s.payload);case t.ActionTypes.SET_HIGHLIGHTED_ROW:return((e,t)=>Object.assign(Object.assign({},e),{highlightedRow:t.index}))(e,s.payload);case t.ActionTypes.UPDATE_QUERY_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,querySuggestionsData:i}=t;return Object.assign(Object.assign({},e),{querySuggestionsCache:Object.assign(Object.assign({},e.querySuggestionsCache),{[s]:Object.assign(Object.assign({},e.querySuggestionsCache[s]),i)})})})(e,s.payload);case t.ActionTypes.SET_FILTERED_ACCOUNT_ID:return((e,t)=>Object.assign(Object.assign({},e),{filteredAccountId:t.filteredAccountId}))(e,s.payload);case t.ActionTypes.UPDATE_PEOPLE_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,peopleSuggestionsData:i}=t;return Object.assign(Object.assign({},e),{peopleSuggestionsCache:Object.assign(Object.assign({},e.peopleSuggestionsCache),{[s]:Object.assign(Object.assign({},e.peopleSuggestionsCache[s]),i)})})})(e,s.payload);case t.ActionTypes.SET_IS_CREATING_SHARED_LINK:return function(e,t){return Object.assign(Object.assign({},e),{isCreatingSharedLinkMap:e.isCreatingSharedLinkMap.set(t.payload.fileIdOrPath,t.payload.isCreatingSharedLink)})}(e,s);case t.ActionTypes.UPDATE_TAGS_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,tagsSuggestionsData:i}=t;return Object.assign(Object.assign({},e),{tagsSuggestionsCache:Object.assign(Object.assign({},e.tagsSuggestionsCache),{[s]:Object.assign(Object.assign({},e.tagsSuggestionsCache[s]),i)})})})(e,s.payload);case t.ActionTypes.SET_LAST_MODIFIED_DATE:return((e,t)=>{const{lastModifiedDate:s,customLastModifiedDateRange:i}=t;return Object.assign(Object.assign({},e),{lastModifiedDate:s,customLastModifiedDateRange:i})})(e,s.payload);case t.ActionTypes.SET_DATE_TAKEN:return((e,t)=>{const{dateTaken:s,customDateTakenRange:i}=t;return Object.assign(Object.assign({},e),{dateTaken:s,customDateTakenRange:i})})(e,s.payload);case t.ActionTypes.SET_SELECTED_DIMENSIONS:return((e,t)=>{const{selectedDimensions:s}=t;return Object.assign(Object.assign({},e),{selectedDimensions:s})})(e,s.payload);case t.ActionTypes.UPDATE_RESULT_SUGGESTIONS_CACHE:return((e,t)=>{const{searchArgsString:s,resultSuggestionsData:i}=t;return Object.assign(Object.assign({},e),{resultSuggestionsCache:Object.assign(Object.assign({},e.resultSuggestionsCache),{[s]:Object.assign(Object.assign({},e.resultSuggestionsCache[s]),i)})})})(e,s.payload);case t.ActionTypes.SET_IS_SEARCH_QUERY_UP_TO_DATE_WITH_FILTERS:return function(e,t){return Object.assign(Object.assign({},e),{isSearchQueryUpToDateWithFilters:t.isSearchQueryUpToDateWithFilters})}(e,s.payload);case t.ActionTypes.SET_IS_FILTERS_UP_TO_DATE_WITH_SEARCH_QUERY:return function(e,t){return Object.assign(Object.assign({},e),{isFiltersUpToDateWithSearchQuery:t.isFiltersUpToDateWithSearchQuery})}(e,s.payload);case t.ActionTypes.SET_FLEXIBLE_QUERY:return function(e,t){return Object.assign(Object.assign({},e),{flexibleQuery:t.flexibleQuery})}(e,s.payload);case t.ActionTypes.SET_SHOULD_SEARCH_BY_FQL:return function(e,t){return Object.assign(Object.assign({},e),{shouldSearchByFql:t.shouldSearchByFql})}(e,s.payload);case t.ActionTypes.SET_QUESTION:return function(e,t){if(!Te(t.query))return Object.assign(Object.assign({},e),{question:null});const s=e.refreshCount+("user-submitted"===t.changeReason&&e.question===t.query?1:0);return Object.assign(Object.assign({},e),{refreshCount:s,question:t.query})}(e,s.payload);case t.ActionTypes.SET_IS_QUESTION_ANSWER_LOADING:return function(e,t){return Object.assign(Object.assign({},e),{isQuestionAnswerLoading:t.isQuestionAnswerLoading})}(e,s.payload);case t.ActionTypes.SET_QUESTION_QUERY_OVERRIDE:return function(e,t){return Object.assign(Object.assign({},e),{questionAnsweringOverrideQuery:t.questionAnsweringOverrideQuery})}(e,s.payload);case t.ActionTypes.SET_QUESTION_NLS_OVERRIDE:return function(e,t){return Object.assign(Object.assign({},e),{questionAnsweringNlsTrigger:t.questionAnsweringNlsTrigger})}(e,s.payload);case t.ActionTypes.SET_RECENT_ITEM_SUGGESTIONS_LOADING_STATE:return function(e,t){return Object.assign(Object.assign({},e),{recentItemSuggestionsLoadingState:t.recentItemSuggestionsLoadingState})}(e,s.payload);case t.ActionTypes.UPDATE_REACT_QUERY_SEARCH_RESULTS:return function(e,t){var s,i,r,n,a,o;const _=null!==(s=e.fileActionsData)&&void 0!==s?s:{};if(T.SEARCH_WEB_MAIN_KIEV_ENABLED){const s=null!==(i=_.filesSizeMap)&&void 0!==i?i:{};t.filesSizeMap&&Object.entries(t.filesSizeMap).forEach((([e,t])=>{s[e]=t}));const a=null!==(r=_.restoredDeletedFilePaths)&&void 0!==r?r:new Set;t.deletedFilePaths&&t.deletedFilePaths.forEach((e=>{a.delete(e)})),t.restoredDeletedFilePaths&&t.restoredDeletedFilePaths.forEach((e=>a.add(e)));const o=null!==(n=_.purgedFileIds)&&void 0!==n?n:new Set;return t.purgedFileIds&&t.purgedFileIds.forEach((e=>o.add(e))),Object.assign(Object.assign({},e),{fileActionsData:{filesSizeMap:s,purgedFileIds:o,restoredDeletedFilePaths:a}})}{const s=null!==(a=_.idToIsDeletedFileMap)&&void 0!==a?a:new Map;t.deletedFilePaths&&t.deletedFilePaths.forEach((e=>{s.set(e,!0)})),t.restoredDeletedFilePaths&&t.restoredDeletedFilePaths.forEach((e=>{s.set(e,!1)}));const i=null!==(o=_.purgedFileIds)&&void 0!==o?o:new Set;return t.purgedFileIds&&t.purgedFileIds.forEach((e=>i.add(e))),Object.assign(Object.assign({},e),{fileActionsData:{idToIsDeletedFileMap:s,purgedFileIds:i}})}}(e,s.payload);case t.ActionTypes.CLEAR_FILE_ACTIONS_DATA:return function(e){return Object.assign(Object.assign({},e),{fileActionsData:void 0})}(e);case t.ActionTypes.SET_SERP_SEARCH_REQUEST_ARGS:return function(e,t){return Object.assign(Object.assign({},e),{serpSearchRequestArgs:t.serpSearchRequestArgs})}(e,s.payload);case t.ActionTypes.SET_RIGHT_SIDEBAR:return function(e,t){return Object.assign(Object.assign({},e),{rightSidebar:t.sidebar})}(e,s.payload);case t.ActionTypes.SET_QUICK_VIEW_FILE:return function(e,t){return Object.assign(Object.assign({},e),{quickViewFile:t.file})}(e,s.payload);default:return e}}const Re=(e,t,s)=>new Promise(((n,a)=>{(s?i.SilentBackgroundRequest:i.WebRequest)({url:e,type:"POST",dataType:"json",data:t,subject_user:r.mustGetActiveUserId(),success:n,error:(e,t,s)=>a(Error(`error: ${s}, status: ${t}`))})}));function Oe(e,t){const s=[];for(let i=0;i<e.length;i+=t){const r=e.slice(i,i+t);s.push(r)}return s}var Ae;t.StarredLoadingStateEnum=void 0,(Ae=t.StarredLoadingStateEnum||(t.StarredLoadingStateEnum={})).NOT_STARTED="NOT_STARTED",Ae.LOADING="LOADING",Ae.LOAD_SUCCESS="LOAD_SUCCESS",Ae.LOAD_FAILED="LOAD_FAILED";const ve={starredStates:{},starredFilesMetadata:{loadingState:t.StarredLoadingStateEnum.NOT_STARTED,items:[],hasMore:!0,hasLoadedInitial:!1}},Ne=e=>i.getStateAtNamespace(e,i.STARRED_NAMESPACE_KEY)||ve,Ce=e=>Ne(e).starredStates,we=(e,t)=>Ce(e)[t],Pe=l.createSelector(Ce,(e=>e),((e,t)=>Object.keys(e).reduce(((e,s)=>(e[s]=De(t,s),e)),{})));l.createSelector(Pe,(e=>Object.keys(e).filter((t=>e[t]))));const De=(e,s)=>{const i=we(e,s);return(null==i?void 0:i.loadingState)!==t.StarredLoadingStateEnum.LOAD_FAILED&&((null==i?void 0:i.isStarred)||!1)},be=e=>Ne(e).starredFilesMetadata;l.createSelector(be,Ce,((e,t)=>e.items.filter((({resourceId:e})=>void 0!==t[e]&&Le(t[e])))));const Le=e=>{var s;return(e.loadingState===t.StarredLoadingStateEnum.LOAD_SUCCESS||e.loadingState===t.StarredLoadingStateEnum.LOADING)&&(null!==(s=e.isStarred)&&void 0!==s&&s)},Ue=({itemName:e,isStarred:t,success:s})=>{if(s){let s;s=e?t?n.intl.formatMessage({id:"m96IvY",defaultMessage:"Starred {itemName}."},{itemName:e}):n.intl.formatMessage({id:"Yn2gx1",defaultMessage:"Unstarred {itemName}."},{itemName:e}):t?n.intl.formatMessage({id:"IxGSEU",defaultMessage:"Starred."},{itemName:e}):n.intl.formatMessage({id:"RZWOu0",defaultMessage:"Unstarred."},{itemName:e}),i.Snackbar$1.complete(s,"star-action")}else{let s;s=e?t?n.intl.formatMessage({id:"5O9Xva",defaultMessage:"There was a problem starring {item_name}"},{item_name:e}):n.intl.formatMessage({id:"CvW0nU",defaultMessage:"There was a problem unstarring {item_name}"},{item_name:e}):t?n.intl.formatMessage({id:"jouX9E",defaultMessage:"There was a problem starring your selection"}):n.intl.formatMessage({id:"TkdYlT",defaultMessage:"There was a problem unstarring your selection"}),i.Snackbar$1.fail(s,"star-action")}};const Me=()=>Date.now();let ke=0,Fe=0,He=Me();const je=function(e,{delayRequest:t,isBackground:r,shouldAssertResponse:n}={}){ke++;const a=new Promise(((n,a)=>s.__awaiter(this,void 0,void 0,(function*(){const o=yield function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=He;if(He=Me(),e||He-t<40){Fe++;const e=10+~~(90*Math.random());return yield new Promise((t=>setTimeout(t,e))),Fe--,e}return 0}))}(!!t),_=Me();(r?i.SilentBackgroundRequest:i.WebRequest)(Object.assign({dataType:"json",success:n,error:(s,i,n)=>{if("abort"===i)return;const l=e&&e.url||"no url",d=`makeRequest to '${l}' failed - ${i}${n?`: '${n}'`:""}`;c.reportStack(d,{severity:c.SEVERITY.NONCRITICAL,exc_extra:{errorThrown:n,textStatus:i,requestParams:e,delayRequest:t,isBackground:r,requestDelay:o,openRequests:ke,delayedRequests:Fe,requestDuration:Me()-_,status:s.status,"exclog.exc_group":`homeapi:${i}:${n}:${l}`}}),a()}},e))}))));return a.finally((()=>ke--)),a};let Ge={};const qe=f.throttle((()=>{f.size(Ge)>1&&c.reportStack("Multiple role activities",{severity:c.SEVERITY.NONCRITICAL,exc_extra:Ge}),Object.keys(Ge).forEach((e=>{const t=Ge[e];je({url:"/home_feed/log_activities",type:"POST",subject_user:r.mustGetActiveUserId(),data:{role:e,activities_json:JSON.stringify(f.map(t,"json")),send_ts:Me(),page_start_ts:window.performance&&window.performance.timing?window.performance.timing.navigationStart||window.performance.timing.fetchStart:void 0}},{isBackground:!0,delayRequest:!0,shouldAssertResponse:!0}).then((()=>t.forEach((e=>e.resolve()))),(()=>t.forEach((e=>e.reject()))))})),Ge={}}),1e3,{leading:!0,trailing:!0});function xe(e){return{isError:!0,error:e}}const Qe={".tag":"undefined_error"};function We(e){var t;return s.__awaiter(this,void 0,void 0,(function*(){try{return function(e){return{isError:!1,result:e}}(yield new i.DefaultUserApiV2Client(r.mustGetActiveUser()).ns("starring").rpc("get_starred_items_v2",{limit:e},{}))}catch(e){const s=d.filterApiError(e);return void 0!==(null===(t=null==s?void 0:s.error)||void 0===t?void 0:t[".tag"])?xe(s.error):xe(Qe)}}))}var Ve;function Ye(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=e.map((e=>e.idTypePair));if(0===t.length)return;const s=yield function(e,t){return je({url:"/home_feed/get_file_metadata",type:"POST",subject_user:e.id,data:{resources_json:JSON.stringify(t)}},{isBackground:!0})}(m.getUser(),t),r={};s.forEach((e=>{return r[(t=e,t.type+":"+t.id)]=e.file_metadata;var t})),i.dispatcherSingleton.dispatch({type:m.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE,resourceIdToFile:r})}))}function Be({details:e,title:s,url:i,display_type:r,id_type:n,resource_id:a,is_mounted:o,per_node_metadata:_,icon:c,is_encrypted:l}){if(void 0===n)return;const d=function(e){switch(e){case t.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID:case t.HOME_RESOURCE_ID_TYPE.FQ_PATH:case t.HOME_RESOURCE_ID_TYPE.PAPER_DOCUMENT_ID:case t.HOME_RESOURCE_ID_TYPE.PAPER_FOLDER_ID:case t.HOME_RESOURCE_ID_TYPE.PAPER_DOCUMENT_ID_PATH:case t.HOME_RESOURCE_ID_TYPE.PAPER_FOLDER_ID_PATH:case t.HOME_RESOURCE_ID_TYPE.EXTERNAL_RESOURCE_ID:return e;default:return}}(n);return void 0!==d&&void 0!==e?{details:Ke(e.fq_path||"",e.target_ns_id,e.is_team_member_folder),title:s||"",url:i||"",display_type:r||"",id_type:d||"",resource_id:a||"",is_mounted:o,per_node_metadata:_,icon:c,is_encrypted:l}:void 0}function Ke(e,t,s){return void 0===t||void 0===s?{fq_path:e}:{fq_path:e,target_ns_id:t,is_team_member_folder:s}}t.HOME_RESOURCE_ID_TYPE=void 0,(Ve=t.HOME_RESOURCE_ID_TYPE||(t.HOME_RESOURCE_ID_TYPE={})).ENCODED_FILE_OBJ_ID="ENCODED_FILE_OBJ_ID",Ve.FQ_PATH="FQ_PATH",Ve.PAPER_DOCUMENT_ID="PAPER_DOCUMENT_ID",Ve.PAPER_FOLDER_ID="PAPER_FOLDER_ID",Ve.PAPER_DOCUMENT_ID_PATH="PAPER_DOCUMENT_ID_PATH",Ve.PAPER_FOLDER_ID_PATH="PAPER_FOLDER_ID_PATH",Ve.EXTERNAL_RESOURCE_ID="EXTERNAL_RESOURCE_ID",Ve.UNKNOWN="UNKNOWN";const ze=I.createAsyncThunk(`${i.STARRED_NAMESPACE_KEY}/getStarredStatus`,((e,{getState:i,dispatch:r})=>s.__awaiter(void 0,void 0,void 0,(function*(){const n=m.getRole(),a=Ne(i());if(!a)return[];const o=e.filter((({id:e})=>{var s;return(null===(s=a.starredStates[e])||void 0===s?void 0:s.loadingState)!==t.StarredLoadingStateEnum.LOADING}));if(0===o.length)return[];r(st.setLoadingStates(o));const _=yield((e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=Oe(Oe(t,250),8),i=[];for(const t of s){const s=t.map((t=>Re("/starred/get_status",{role:e,resources_json:JSON.stringify(t)},!0))),r=yield Promise.all(s);i.push(...r.flat())}return i})))(n,o);return r({type:"UPDATE_FAVORITES_ACTION",payload:{}}),_})))),$e=I.createAsyncThunk(`${i.STARRED_NAMESPACE_KEY}/updateStarredStatus`,(({id:e,newStatus:i,idType:r=t.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID},{getState:n,dispatch:a})=>s.__awaiter(void 0,void 0,void 0,(function*(){const t=(s=n(),be(s).hasLoadedInitial);var s;const o=yield((e,t,s,i)=>Re("/starred/update",{role:e,resource_id:t,id_type:s,is_starred:i},!0))(m.getRole(),e,r,i);return t&&!0===i&&a(Xe()),o})))),Xe=I.createAsyncThunk(`${i.STARRED_NAMESPACE_KEY}/getAllStarred`,(()=>s.__awaiter(void 0,void 0,void 0,(function*(){if(R.HOME_REDUX_USE_STARRING){const e=yield We(1e3);if(e.isError){const t=r.getActiveUser()?c.SEVERITY.CRITICAL:c.SEVERITY.USER_ERROR;return c.reportStack("Failed to fetch starred files with GetStarredItems",{severity:t,exc_extra:e.error,silent:!0}),Promise.reject(new Error(e.error[".tag"]))}const t=e.result;if("success"===t.status&&t.items){const e=function(e){if(void 0===e.items)return{status:e.status||"failure",items:[],has_more:e.has_more||!1};const t=[];for(const s of e.items){const e=Be(s);if(void 0===e)return;t.push(e)}return{status:e.status||"failure",items:t,has_more:e.has_more||!1}}(t);return void 0===e||void 0===e.items?(c.reportStack("GetStarredItems returned items without required fields.",{severity:c.SEVERITY.CRITICAL,exc_extra:t,silent:!0}),Promise.reject(new Error("GetStarredItems returned items without required fields."))):(Ye(e.items.map((e=>({idTypePair:{id:e.resource_id,type:e.id_type},starred:!0})))),e)}return c.reportStack("Failed to fetch starred files with GetStarredItems",{severity:c.SEVERITY.CRITICAL,exc_extra:t,silent:!0}),Promise.reject(new Error("Failed to fetch starred files with GetStarredItems"))}{const e=yield function(e){return s.__awaiter(this,void 0,void 0,(function*(){return yield je({url:"/home_feed/retrieve_starred",type:"POST",subject_user:r.mustGetActiveUserId(),data:{role:m.getRole(),limit:e}})}))}(1e3);return"success"===e.status&&e.items?(Ye(e.items.map((e=>({idTypePair:{id:e.resource_id,type:e.id_type},starred:!0})))),e):(c.reportStack("Failed to fetch starred files",{severity:c.SEVERITY.CRITICAL,exc_extra:e,silent:!0}),Promise.reject(new Error("Failed to fetch starred files with RetrieveStarred")))}})))),Je=e=>{var{resource_id:t,id_type:i,display_type:r}=e,n=e.details,{fq_path:a}=n,o=s.__rest(n,["fq_path"]),_=s.__rest(e,["resource_id","id_type","display_type","details"]);return Object.assign({resourceId:t,idType:i,displayType:r,isMounted:_.is_mounted,perNodeMetadata:_.per_node_metadata,isEncrypted:_.is_encrypted,details:Object.assign({fqPath:a},o)},_)},Ze=e=>{e.starredFilesMetadata.items.forEach((({resourceId:s})=>{e.starredStates[s]={isStarred:!0,loadingState:t.StarredLoadingStateEnum.LOAD_SUCCESS}}))},et=I.createSlice({name:i.STARRED_NAMESPACE_KEY,initialState:ve,reducers:{clear:()=>ve,setStarredStatus:(e,s)=>{e.starredStates[s.payload.id]={loadingState:t.StarredLoadingStateEnum.LOAD_SUCCESS,isStarred:s.payload.isStarred}},deleteStarredItem:(e,t)=>{e.starredFilesMetadata.items=e.starredFilesMetadata.items.filter((e=>e.resourceId!==t.payload.id))},deleteStarredItems:(e,t)=>{e.starredFilesMetadata.items=e.starredFilesMetadata.items.filter((e=>!t.payload.ids.includes(e.resourceId)))},setLoadingStates:(e,s)=>{s.payload.forEach((({id:s})=>{void 0===e.starredStates[s]&&(e.starredStates[s]={loadingState:t.StarredLoadingStateEnum.LOADING})}))},setStarredMetadata:(e,s)=>{const i=s.payload;"success"===i.status?(e.starredFilesMetadata={items:i.items.map(Je),loadingState:t.StarredLoadingStateEnum.LOAD_SUCCESS,hasMore:i.hasMore,hasLoadedInitial:!0},Ze(e)):e.starredFilesMetadata.loadingState=t.StarredLoadingStateEnum.LOAD_FAILED}},extraReducers:e=>{e.addCase(ze.fulfilled,((e,s)=>{s.payload.forEach((({id:s,is_starred:i})=>{e.starredStates[s]={loadingState:t.StarredLoadingStateEnum.LOAD_SUCCESS,isStarred:i}}))})).addCase(ze.rejected,((e,s)=>{s.meta.arg.forEach((({id:i})=>{var r,n;e.starredStates[i]={loadingState:t.StarredLoadingStateEnum.LOAD_FAILED,error:null!==(n=null===(r=null==s?void 0:s.error)||void 0===r?void 0:r.message)&&void 0!==n?n:"error fetching starred starred data"}}))})).addCase($e.fulfilled,((e,s)=>{const{id:i}=s.meta.arg,r=e.starredStates[i];if(r&&r.loadingState===t.StarredLoadingStateEnum.LOAD_SUCCESS&&(r.isStarred=s.meta.arg.newStatus,s.meta.arg.showSnackbar)){const{itemName:e,newStatus:t}=s.meta.arg;Ue({itemName:e,isStarred:t,success:!0})}})).addCase($e.rejected,((e,t)=>{if(t.meta.arg.showSnackbar){const{itemName:e,newStatus:s}=t.meta.arg;Ue({itemName:e,isStarred:s,success:!1})}})).addCase(Xe.pending,(e=>{e.starredFilesMetadata.loadingState=t.StarredLoadingStateEnum.LOADING})).addCase(Xe.fulfilled,((e,s)=>{e.starredFilesMetadata.loadingState=t.StarredLoadingStateEnum.LOAD_SUCCESS,s.payload.items&&(e.starredFilesMetadata.items=s.payload.items.map(Je),Ze(e),e.starredFilesMetadata.hasLoadedInitial=!0,e.starredFilesMetadata.hasMore=!!s.payload.has_more)})).addCase(Xe.rejected,(e=>{e.starredFilesMetadata.loadingState=t.StarredLoadingStateEnum.LOAD_FAILED}))}}),{reducer:tt}=et,st=et.actions;let it;const rt=()=>(it||(it=i.getStoreAndRegisterReducers({[i.STARRED_NAMESPACE_KEY]:tt})),it);let nt;const at=()=>(nt||(nt=i.getStoreAndRegisterReducers({[i.FOLDER_OVERVIEW_NAMESPACE_KEY]:a.folderOverviewReducer})),nt);let ot;const _t=()=>(ot||(ot=i.getStoreAndRegisterReducers({[i.SEARCH_NAMESPACE_KEY]:me})),a.getStoreForFilesView(),i.getStore(),a.getStoreForTagging(),rt(),at(),a.getStoreForBackup(),ot);a.DateRange.Today,a.DateRange.Last7Days,a.DateRange.Last30Days,a.DateRange.Last90Days,a.DateRange.LastYear,a.Dimensions.Small,a.Dimensions.Medium,a.Dimensions.Large,a.Dimensions.XLarge;const ct=n.intl.formatMessage({id:"dcywUW",defaultMessage:"Search results - Dropbox"}),lt=["assistant","collab_browse"];class dt extends O.EventEmitter{constructor(e,t){super(),this.lastHistoryMs=0,this.initialPath="",this.setSearchUrl=(e,t)=>{e!==this.document.location.pathname+this.document.location.search&&(i.shouldUseReactRouter()?i.CompatNavigate.navigateReplace(e):(this.returnTo||ne.test(this.document.location.pathname)||(this.returnTo=this.document.location.pathname+this.document.location.search),t||this.shouldPushHistory()?this.window.history.pushState({},ct,e):this.window.history.replaceState({},ct,e),this.lastHistoryMs=(new Date).getTime(),this.previousTitle||(this.previousTitle=this.document.title,this.document.title=ct)))},this.setNonSearchUrl=e=>{this.shouldRedirect(e)?i.redirect(e):i.shouldUseReactRouter()?i.CompatNavigate.navigate(e):(this.window.history.pushState({},this.previousTitle||"",e),this.emit("exit"),this.previousTitle&&(this.document.title=this.previousTitle,this.previousTitle=void 0))},this.handlePopState=()=>{i.shouldUseReactRouter()||(ne.test(this.document.location.pathname)?(this.lastHistoryMs=(new Date).getTime(),this.emit("update",i.parseQueryString(this.document.location.search))):this.shouldRedirect(this.document.location.pathname)?i.reload():this.emit("exit"))},this.shouldPushHistory=()=>(new Date).getTime()-this.lastHistoryMs>=500,this.shouldRedirect=e=>(!i.shouldUseReactRouter(this.initialPath)||!i.shouldUseReactRouter(e))&&((!Se.test(this.initialPath)||!Se.test(e))&&((!ae.test(this.initialPath)||!ae.test(e))&&((!oe.test(this.initialPath)||!oe.test(e))&&((!_e.test(this.initialPath)||!_e.test(e))&&((!ce.test(this.initialPath)||!ce.test(e))&&((!le.test(this.initialPath)||!le.test(e))&&((!de.test(this.initialPath)||!de.test(e))&&((!ue.test(this.initialPath)||!ue.test(e))&&((!he.test(this.initialPath)||!he.test(e))&&((!Ee.test(this.initialPath)||!Ee.test(e))&&((!ge.test(this.initialPath)||!ge.test(e))&&((!fe.test(this.initialPath)||!fe.test(e))&&(!pe.test(this.initialPath)||!pe.test(e)))))))))))))),this.document=e,this.window=t}get source(){return Se.test(this.initialPath)?"home":ae.test(this.initialPath)?"browse":oe.test(this.initialPath)?"starred":_e.test(this.initialPath)?"recents":ce.test(this.initialPath)?"share":le.test(this.initialPath)?"photos":de.test(this.initialPath)?"requests":ue.test(this.initialPath)?"automations":ne.test(this.initialPath)?"search":Ee.test(this.initialPath)||he.test(this.initialPath)?"backup":ge.test(this.initialPath)?"collections":pe.test(this.initialPath)?"deleted_files":fe.test(this.initialPath)?"account":null}init(e,t){this.user=e,this.initialPath||(this.initialPath=this.document.location.pathname),"full-page"===t&&this.window.addEventListener("popstate",this.handlePopState)}load(){if(ne.test(this.document.location.pathname)){this.emit("update",i.parseQueryString(this.document.location.search));const e=i.parseQueryString(this.document.location.search);e.search_from&&!ne.test(e.search_from)&&-1===lt.indexOf(e.search_from)&&(this.returnTo=e.search_from)}}setOnEnter(e){i.shouldUseReactRouter()||ne.test(this.document.location.pathname)||this.set(e)}set(e,t){e&&(ne.test(e)?this.setSearchUrl(e,t):this.setNonSearchUrl(e))}exit(){i.shouldUseReactRouter()||ne.test(this.document.location.pathname)&&(this.returnTo&&!ne.test(this.returnTo)||(this.returnTo=i.get_browse_root(this.user)),this.set(this.returnTo),this.returnTo=void 0)}}const ut=new dt(document,window),ht=e=>i.getStateAtNamespace(e,i.SEARCH_NAMESPACE_KEY),Et=e=>ht(e).user,St=e=>ht(e).userOptions,gt=e=>ht(e).query,pt=e=>ht(e).resultQuery,ft=e=>A.normalize(ht(e).query),yt=e=>ht(e).path,Tt=e=>ht(e).typeaheadSessionId,It=e=>ht(e).sortOrder,mt=e=>ht(e).fileCategories,Rt=e=>ht(e).filteredAccountId,Ot=e=>ht(e).flexibleQuery,At=e=>ht(e).lastModifiedDate,vt=a.createSelector(At,(e=>ht(e).customLastModifiedDateRange),((e,t)=>({lastModifiedDate:e,customLastModifiedDateRange:t}))),Nt=e=>ht(e).dateTaken,Ct=a.createSelector(Nt,(e=>ht(e).customDateTakenRange),((e,t)=>({dateTaken:e,customDateTakenRange:t}))),wt=e=>ht(e).selectedDimensions,Pt=()=>a.getSearchCsrfToken();a.createSelector(St,(e=>e&&e.nautilus_enabled));const Dt=a.createSelector(St,(e=>e&&e.paper_enabled)),bt=a.createSelector(Et,St,((e,t)=>e?t&&t.preferred_editors?{[e.id]:t.preferred_editors}:{[e.id]:{}}:{})),Lt=a.createSelector(mt,(e=>a.fileCategoriesToString(e))),Ut=a.createSelector(mt,(e=>Object.keys(e).filter((t=>"checked"===e[t])))),Mt=a.createSelector(mt,Dt,((e,t)=>{if(a.allCategoriesUnchecked(e,t))return["all_unchecked"];if(a.allCategoriesChecked(e,t))return["all_checked"];const s=[];return Object.keys(e).forEach((t=>{"checked"===e[t]&&s.push(t)})),s})),kt=a.createSelector(Et,yt,gt,Tt,Mt,Rt,((e,t,s,r,n,a)=>e?{user_id:e.id,active_user_id:e.id,path_scoped:!i.paths_are_equal(t),type:"single-page",query_string:s,typeahead_session_id:r,timezone_offset:(new Date).getTimezoneOffset(),file_type_filters:n,search_scoped_to_account_id:a,source:ut.source}:{})),Ft=a.createSelector(ft,yt,Rt,Lt,vt,Ct,wt,Ot,((e,t,s,i,r,n,a,o)=>{const{lastModifiedDate:_,customLastModifiedDateRange:c}=r,{dateTaken:l,customDateTakenRange:d}=n;return{query:e,path:t,filteredAccountId:s,fileCategoriesString:i,lastModifiedDate:_,lastModifiedDateStart:null==c?void 0:c.startDate,lastModifiedDateEnd:null==c?void 0:c.endDate,dateTaken:l,dateTakenStart:null==d?void 0:d.startDate,dateTakenEnd:null==d?void 0:d.endDate,dimensions:a,flexibleQuery:o}})),Ht=a.createSelector(Et,Pt,Ft,Tt,(e=>ht(e).previewFileId),It,vt,Ct,((e,t,s,r,n,o,_,c)=>{if(!e)return;const{query:l,path:d,filteredAccountId:u,fileCategoriesString:h,dimensions:E}=s,S=i.getQueryArgs().search_from,{lastModifiedDate:g,customLastModifiedDateRange:p}=_,{dateTaken:f,customDateTakenRange:y}=c;return a.buildSearchURL({user:e,searchPath:d,typeaheadSessionId:r,searchToken:t,normalizedQuery:l,qargs:Object.assign(Object.assign(Object.assign(Object.assign({search_from:S&&-1===lt.indexOf(S)?S:void 0,preview:n,file_categories:h||void 0,search_account_id:u||void 0},a.sortOrderToURLParam(o)),a.lastModifiedDateToURLParam(g,p)),a.dateTakenToURLParam(f,y)),{search_dimensions:E.length>0?a.dimensionsToURLParam(E):void 0})}).toString()})),jt=a.createSelector(Ft,Tt,It,vt,Ct,((e,t,s,i,r)=>{const{query:n,path:o,filteredAccountId:_,fileCategoriesString:c,dimensions:l}=e,{lastModifiedDate:d,customLastModifiedDateRange:u}=i,{dateTaken:h,customDateTakenRange:E}=r;return Object.assign(Object.assign(Object.assign(Object.assign({query:n,path:o,typeahead_session_id:t,file_categories:c||void 0,search_account_id:_||void 0},a.sortOrderToURLParam(s)),a.lastModifiedDateToURLParam(d,u)),a.dateTakenToURLParam(h,E)),{search_dimensions:l.length>0?a.dimensionsToURLParam(l):void 0})}));a.createSelector(Et,Pt,ft,Tt,((e,t,s,r)=>{if(e)return a.buildSearchURL({user:e,searchPath:"/",typeaheadSessionId:r,searchToken:t,normalizedQuery:s,qargs:{search_from:i.getQueryArgs().search_from||void 0}}).toString()}));const Gt=a.createSelector(Ft,(e=>Object.values(e).toString())),qt=a.createSelector((e=>ht(e).resultSuggestionsCache),Gt,((e,t)=>e[t]));a.createSelector(qt,(e=>{var t;return null!==(t=null==e?void 0:e.loadingState)&&void 0!==t?t:void 0})),a.createSelector(yt,Rt,Ut,At,Nt,wt,((e,t,s,r,n,o)=>!(i.paths_are_equal(e,"/")&&void 0===t&&0===s.length&&r===a.DateRange.Any&&n===a.DateRange.Any&&0===o.length)));a.createSelector((e=>ht(e).querySuggestionsCache),ft,((e,t)=>xt(e,t)));const xt=(e,t)=>{const s=e[t];return s?s.loadingState:void 0};a.createSelector((e=>ht(e).peopleSuggestionsCache),ft,((e,t)=>{const s=e[t];return s?s.loadingState:void 0}));a.createSelector((e=>ht(e).tagsSuggestionsCache),ft,((e,t)=>Qt(e,t)));const Qt=(e,t)=>{const s=e[t];return s?s.loadingState:void 0},Wt=a.createSelector(Ot,(e=>ht(e).shouldSearchByFql),((e,t)=>({flexibleQuery:e,shouldSearchByFql:t}))),Vt=a.createSelector(yt,mt,Rt,vt,Ct,wt,((e,t,s,i,r,n)=>({path:e,fileCategories:t,filteredAccountId:s,lastModifiedDateWithCustomRange:i,dateTakenWithCustomRange:r,selectedDimensions:n})));a.createSelector(Et,gt,Vt,Tt,Dt,It,Wt,(e=>ht(e).questionAnsweringOverrideQuery),(e=>ht(e).questionAnsweringNlsTrigger),((e,t,s,i,r,n,a,o,_)=>Object.assign(Object.assign({},a),{user:e,path:s.path,query:t,typeaheadSessionId:i,fileCategories:s.fileCategories,isPaperEnabled:r,sortOrder:n,filteredAccountId:s.filteredAccountId,lastModifiedDate:s.lastModifiedDateWithCustomRange.lastModifiedDate,customLastModifiedDateRange:s.lastModifiedDateWithCustomRange.customLastModifiedDateRange,dateTaken:s.dateTakenWithCustomRange.dateTaken,customDateTakenRange:s.dateTakenWithCustomRange.customDateTakenRange,selectedDimensions:s.selectedDimensions,questionAnsweringOverrideQuery:o,shouldTriggerNlsFromQuestionAnswering:_})));class Yt{constructor(){this.searchSessionId=null,this.lastLoggedSessionTimeMs=null,this.searchSessionQueryId=null,this.queryPhase="RESULT_INTERACT",this._getSearchSessionIdIfExists=e=>{switch(e){case"PASSIVE":return this.searchSessionId;case"ACTIVE_QUERY_FORMING":const t=null===this.lastLoggedSessionTimeMs?null:Date.now()-this.lastLoggedSessionTimeMs;return(null===t||t>18e4)&&this.startNewSearchIds(),this.markSessionActive(),this.searchSessionId;case"ACTIVE_RESULT_INTERACTING":return this.markSessionActive(),this.searchSessionId;default:return i.enforceExhaustive(e)}},this.generateRandomId=e=>`${e}:${i.UUID.v4()}`}setCallbackStartNewQueryId(e){this.onStartNewQueryId=e}notifyEvent(e){if("CRAFT_AND_SUBMIT_QUERY"===e)return this.notifyEvent("CRAFT_QUERY"),void this.notifyEvent("SUBMIT_QUERY");"RESULT_INTERACT"===this.queryPhase&&"CRAFT_QUERY"===e?(this.startNewSearchSessionQueryId(),this.queryPhase="CRAFTING"):"CRAFTING"===this.queryPhase&&"SUBMIT_QUERY"===e&&(this.queryPhase="RESULT_INTERACT")}getSearchIds({searchSessionExtensionType:e}){const t=this._getSearchSessionIdIfExists(e);return t?{searchSessionId:t,searchSessionQueryId:this.searchSessionQueryId}:this.startNewSearchIds()}markExitSearch(){this.searchSessionId=null,this.searchSessionQueryId=null,this.queryPhase="RESULT_INTERACT"}markSessionActive(){this.lastLoggedSessionTimeMs=Date.now()}startNewSearchIds(){return{searchSessionId:this._startNewSearchSessionId(),searchSessionQueryId:this.startNewSearchSessionQueryId()}}_startNewSearchSessionId(){return this.searchSessionId=this.generateRandomId("SearchSessionId"),this.searchSessionId}startNewSearchSessionQueryId(){var e;return this.searchSessionQueryId=this.generateRandomId("SearchSessionQueryId"),null===(e=this.onStartNewQueryId)||void 0===e||e.call(this,this.searchSessionId,this.searchSessionQueryId),this.searchSessionQueryId}}let Bt=new Yt;const Kt=new i.HiveLogger;var zt,$t,Xt,Jt,Zt;!function(e){e.SHARED_DOC="shared_doc",e.SHARED_CLOUD_DOC="shared_cloud_doc"}(zt||(zt={})),function(e){e.DATE_TAKEN="date_taken",e.DIMENSIONS="dimensions",e.IMAGE_PROPERTIES="image_properties"}($t||($t={})),function(e){e.PEOPLE="people",e.QUERY="query",e.RESULT="result",e.TAGS="tags",e.RECENT_ITEM="recent_item"}(Xt||(Xt={})),function(e){e.DATE_TAKEN="date_taken",e.DIMENSION="dimension",e.FILE_TYPE="file_type",e.FOLDER="folder",e.LAST_MODIFIED="last_modified",e.PEOPLE="people",e.SORT="sort"}(Jt||(Jt={})),function(e){e.SEARCH_DROPDOWN="search_dropdown",e.SEARCH_ZERO_STATE="search_zero_state",e.SEARCH_RESULT_PAGE="search_result_page"}(Zt||(Zt={}));const es=({searchSessionExtensionType:e})=>Object.assign(Object.assign({search_session_id:Bt.getSearchIds({searchSessionExtensionType:e}).searchSessionId},kt(_t().getState())),{timestamp_ms:Date.now()});function ts(){return{is_edison_enabled:String(s.isServedByEdisonWebServer()),edison_page_name:s.getPageName(),is_edison_spa_enabled:String(i.shouldUseReactRouter())}}const ss=(e,t)=>t?e.size+1:e.size,is=(e,t,s,r,n,o,_,c)=>{var d,u,h,E,S,g,p,f;const T="ACTIVE_RESULT_INTERACTING",I=rs(s),m=a.selectViewType(_t().getState(),{instanceId:a.SEARCH_FILES_VIEW_ID}),R=s instanceof l.PaperFolder||s instanceof l.File&&s.is_dir,O=Number(null==c?void 0:c.num_files_selected)>0&&Number(null==c?void 0:c.num_folders_selected)>0?"mixed":R?"folder":"file",A=t.map((e=>ye(e))).indexOf(ye(s)),v=Object.assign(Object.assign(Object.assign({event_name:"result_action"},es({searchSessionExtensionType:T})),I),{action_type:e,position:A,request_id:r,result_count:ss(t,n),action_source:_,view_type:m});v.extra=Object.assign(Object.assign(Object.assign({},c),v.extra),ts()),o&&(v.extra=Object.assign(Object.assign({},v.extra),{action_surface:o})),_!==i.ActionSourceValue.SEARCH_SUGGESTIONS_DROPDOWN&&i.ActionSurfaceLogValue.TOP_NAVIGATION,Kt.log(new ie(v));{if(e===i.WebUserActionLogEvent.STAR)i.logEvent({class:"filesystem_item_actions",action:"star",object:"file",properties:{actionSurface:o,queryId:Number(v.request_id),typeaheadSessionId:null!==(d=v.typeahead_session_id)&&void 0!==d?d:void 0,searchResultId:null!==(u=v.result_id)&&void 0!==u?u:void 0}});i.logEvent(function(e){return{class:"search",action:"log",object:"result_action",properties:e}}({actionType:e,actionSource:_,position:A.toString(),deleted:null!==(h=I.deleted)&&void 0!==h?h:void 0,lastEdited:null!==(E=I.file_last_edited)&&void 0!==E?E:void 0,nsId:Number(I.file_nsid),sjId:Number(I.file_sjid),fileSize:null!==(S=I.file_size)&&void 0!==S?S:void 0,matchType:null!==(g=I.match_type)&&void 0!==g?g:void 0,searchResultId:null!==(p=v.result_id)&&void 0!==p?p:void 0,typeaheadSessionId:null!==(f=v.typeahead_session_id)&&void 0!==f?f:void 0,queryId:Number(v.request_id)}));const{searchSessionId:r,searchSessionQueryId:a}=Bt.getSearchIds({searchSessionExtensionType:T});if(_===i.ActionSourceValue.SEARCH_SUGGESTIONS_DROPDOWN){const e=s instanceof l.Paper||s instanceof l.PaperFolder?"open_paper":s instanceof l.File&&s.is_dir?"open_folder":(s instanceof l.File||s instanceof l.FileSharedWithMe)&&!s.is_cloud_doc?"preview_file":"open_file";i.logEvent(function(e){return{class:"search",action:"select",object:"suggestion",properties:e}}({actionSurface:Zt.SEARCH_DROPDOWN,position:A.toString(),resultCount:ss(t,n),suggestionTypeEnum:"result",contentAction:e,searchSessionId:r,searchSessionQueryId:null!=a?a:void 0}))}else i.logEvent(y.PAP_Select_ContentAction({actionSurface:Zt.SEARCH_RESULT_PAGE,actionType:e,contentType:O,isDir:"mixed"===O?void 0:R,nsId:Number(I.file_nsid),searchSessionId:r,searchSessionQueryId:null!=a?a:void 0}))}},rs=e=>{const t=ye(e);return e instanceof l.File?{deleted:e.isDeleted,file_extension:i.file_extension_for_logging(e.fq_path),file_last_edited:e.ts,file_name:i.filename(e.fq_path),file_nsid:`${e.ns_id}`,file_size:e.bytes,file_sjid:`${e.sjid}`,match_type:e.match_type,result_id:`${e.ns_id}:${e.sjid}`,extra:{file_id:t}}:e instanceof l.Paper?{paper_pad_id:e.pad_id,result_id:t}:e instanceof l.PaperFolder?{paper_folder_id:e.folder_id,result_id:t}:e instanceof l.FileSharedWithMe?{deleted:!1,file_extension:i.file_extension_for_logging(e.filename),file_last_edited:e.ts,file_name:i.filename(e.filename),file_size:e.bytes,match_type:e.match_type,result_id:t,extra:{result_type:e.is_cloud_doc?zt.SHARED_CLOUD_DOC:zt.SHARED_DOC}}:{}},ns=(e,t)=>{Kt.log(new ie(Object.assign(Object.assign({event_name:"start_search_session"},es({searchSessionExtensionType:"PASSIVE"})),{search_session_id:e,search_session_query_id:t})))};var as,os;Bt=new Yt,Bt.setCallbackStartNewQueryId(ns),function(e){e.CONNECTION_TIMEOUT="connection_timeout",e.CONNECTION_CLOSED="connection_closed",e.COULD_NOT_SEND="could_not_send",e.UNEXPECTED_ERROR="unexpected_error"}(as||(as={})),function(e){e[e.LATEST=16]="LATEST",e[e.INITIAL_UNITY=1]="INITIAL_UNITY",e[e.UNITY_HANDSHAKE=2]="UNITY_HANDSHAKE",e[e.REUNITY=3]="REUNITY",e[e.OPEN_IN_FILE_BROWSER=4]="OPEN_IN_FILE_BROWSER",e[e.CHECK_FILE_RETURNS_OBJ=5]="CHECK_FILE_RETURNS_OBJ",e[e.PERMISSION_LEVELS=6]="PERMISSION_LEVELS",e[e.WEB_DESTINY=7]="WEB_DESTINY",e[e.WEB_DESTINY_V2=8]="WEB_DESTINY_V2",e[e.PORT_CHECK=9]="PORT_CHECK",e[e.CHIME_OPEN=10]="CHIME_OPEN",e[e.GROWTH_DEEP_LINK=15]="GROWTH_DEEP_LINK",e[e.OPEN_COLLAB_BROWSE=16]="OPEN_COLLAB_BROWSE"}(os||(os={}));var _s=os;class cs{constructor(){this._data={logging_source:"web",web_unity_version:_s.LATEST}}update(e){return this._data=Object.assign(Object.assign({},this._data),e),this._data}report_event(e,t={}){if(this._data.event_name=e,this._data.local_ts=(new Date).getTime()/1e3,this._data.extra=JSON.stringify(Object.assign(Object.assign({},t),{user_id:t.user_id||r.getActiveUserId()})),i.SilentBackgroundRequest({url:new o.URI({path:"/unity_connection_log"}),data:this._data}),L.UNITY_WEB_DEBUG)return console.log(this._data)}get_log_data_for_client(){return{web_unity_version:this._data.web_unity_version,user_agent:window.navigator.userAgent}}unity_session_id(){return this._data.unity_session_id}}const ls={canUnityConnect:()=>ls.canBrowserSupportNonSecureWebsocket(),canBrowserSupportNonSecureWebsocket(){const e=parseInt(v.version,10);return!!(v.safari&&e<9)||(!!(v.mozilla&&e>=55)||(!!(v.chrome&&e>=53)||!!v.edgeChromium()))}},ds={create(e){const t=new cs;return ls.canUnityConnect()&&t.report_event("using_default_web_socket"),new WebSocket(e)},web_sockets_supported:()=>ls.canUnityConnect()};var us,hs,Es;!function(e){e.CONNECTION_OPENED="CONNECTION_OPENED",e.VERSION_CHECK="VERSION_CHECK",e.FETCHING_NONCE="FETCHING_NONCE",e.NONCE_RETURNED_TO_CLIENT="NONCE_RETURNED_TO_CLIENT",e.HANDSHAKE_COMPLETED="HANDSHAKE_COMPLETED"}(us||(us={})),function(e){e.PENDING="PENDING",e.ESTABLISHED="ESTABLISHED",e.CLOSED="CLOSED",e.RETRYING="RETRYING"}(hs||(hs={})),function(e){e.SECURE_PERMISSION="secure",e.INSECURE_WEB_PERMISSION="insecure_web",e.INSECURE_CLIENT_PERMISSION="insecure_client",e.INSECURE_PERMISSION="insecure"}(Es||(Es={}));class Ss{constructor(){this.client_version=null,this.logger=new cs,this._on_open_callbacks=[],this._on_open_failed_callbacks=[],this._on_close_callbacks=[],this._pending_callbacks=[],this._response_callbacks={},this._webSocket=null,this._port=null,this._active_ports={},this._connection_state=hs.PENDING,this._current_message_id=1,this._permission_level=null,this._on_close=e=>t=>{[1e3,1001,1005,1006].includes(t.code)||this.logger.report_event("unity_failure",{message:`WebSocket closed. Code: ${t.code}. Reason: ${t.reason}`,port:e}),this._close_port(e)},this._on_error=e=>t=>{this.logger.report_event("unity_failure",{message:"WebSocket unknown error",port:e}),this._close_port(e)},this._set_connection_state=e=>{if(e===this._connection_state)return;const t=this._connection_state;if(o.assert(t!==hs.CLOSED,"Shouldn't unclose a closed connection."),this._connection_state=e,e===hs.ESTABLISHED){o.assert(this._is_connection_in_progress(t),"Can only establish from pending or retrying."),this.logger.report_event("handshake_complete"),t===hs.PENDING&&this._on_open_callbacks.forEach((e=>e()));const e=[];for(;this._pending_callbacks.length;){const{callback:t,error_callback:s}=this._pending_callbacks.pop();this.is_ready()?e.push(t()):e.push("function"==typeof s?s(as.UNEXPECTED_ERROR):void 0)}return e}if(e!==hs.RETRYING){if(e===hs.CLOSED){t===hs.PENDING?(this.logger.report_event("connection_not_established"),this._on_open_failed_callbacks.forEach((e=>e()))):t===hs.RETRYING?(this.logger.report_event("connection_terminated"),this._on_close_callbacks.forEach((e=>e()))):o.assert(!1,"CONNECTION_CLOSED can only be set from PENDING or RETRYING");const e=[];for(;this._pending_callbacks.length;){const{error_callback:t}=this._pending_callbacks.pop();e.push("function"==typeof t?t(as.CONNECTION_CLOSED):void 0)}return e}return o.assert(!1,"Changing connection_state to CONNECTION_PENDING not supported.")}},this._on_message=e=>t=>{const s=JSON.parse(t.data);if(s.func&&s.header&&s.header.message_id&&void 0!==s.header.should_respond)if(s.header.log_data&&this.logger.update(s.header.log_data),this.logger.update({port:e.port}),"response"===s.func)this._on_response(s.header.message_id,s.data);else{const t=this._routes[s.func];if(null==t)return void this._terminate_handshake(e.ws,"Unknown function.",{function:s.func});const i=this.is_ready()?t(s.data):t(e,s.data);s.header&&s.header.should_respond&&this.send("response",i,null,null,s.header.message_id)}else this._terminate_handshake(e.ws,"Malformed message from client.",{message:t.data})},this._on_response_timeout=e=>()=>{const{error_callback:t}=this._response_callbacks[e];delete this._response_callbacks[e],t&&t(as.CONNECTION_TIMEOUT)},this._check_unity_version=(e,t)=>{if(e.state!==us.CONNECTION_OPENED)return void this._terminate_handshake(e.ws,"Handshake version check at wrong time of protocol.");if(e.state=us.VERSION_CHECK,e.client_version=t.client_version,t.client_version<_s.UNITY_HANDSHAKE)return void this._terminate_handshake(e.ws,"Client version is too old.");const s=this._web_has_auth();if(!(t.client_version<_s.PERMISSION_LEVELS)||s)return this.logger.report_event("handshake_version_check"),t.client_version>=_s.PERMISSION_LEVELS?this._send_with_ws(e.ws,"initiate_handshake",{secure_web:s}):this._send_with_ws(e.ws,"initiate_handshake");this._terminate_handshake(e.ws,"Client version is too old to support insecure web connections.")},this._fetch_unity_nonce=(e,t)=>{e.state===us.VERSION_CHECK?(e.state=us.FETCHING_NONCE,this.logger.report_event("handshake_fetch_nonce"),this._retrieve_unity_nonce(e,t.nonce_key)):this._terminate_handshake(e.ws,"Fetch Unity nonce at wrong time of protocol.")},this._complete_handshake=(e,t)=>{if(e.state===us.NONCE_RETURNED_TO_CLIENT&&t.is_success)if(e.state=us.HANDSHAKE_COMPLETED,this._connection_state===hs.CLOSED)this._terminate_handshake(e.ws,"No more handshakes are allowed to complete.");else if(null!=this._webSocket){const t="Only one Unity handshake can succeed! There's likely a MITM attack, so close all connections.";this._terminate_handshake(e.ws,t),this._terminate_handshake(this._webSocket,t),this.client_version=null,this._webSocket=null,this._port=null,this._set_connection_state(hs.CLOSED)}else this.client_version=e.client_version,this._webSocket=e.ws,this._port=e.port,this._set_connection_state(hs.ESTABLISHED);else this._terminate_handshake(e.ws,"Unable to complete handshake.")},this._routes={check_unity_version:this._check_unity_version,fetch_unity_nonce:this._fetch_unity_nonce,complete_handshake:this._complete_handshake}}start(){ls.canUnityConnect()?this._attempt_handshake():(this._set_connection_state(hs.CLOSED),this.logger.report_event("unity_failure",{message:"WebSocket creation failed. Not able to create web socket."}))}_getWebSocketURI(e){const t={scheme:"ws",authority:`127.0.0.1:${e.toString()}`,path:"/ws"};return new o.URI(t).toString()}_attempt_handshake(){for(let e=17600;e<=17602;e++)try{this._active_ports[e]=!0;const t=ds.create(this._getWebSocketURI(e));t.onmessage=this._on_message({ws:t,port:e,state:us.CONNECTION_OPENED,client_version:null,client_has_auth:null}),t.onclose=this._on_close(e),t.onerror=this._on_error(e)}catch(t){const s=t instanceof Error?t:void 0,i=(null==s?void 0:s.message)||"Unknown error";this.logger.report_event("unity_failure",{message:`WebSocket creation failed. Message: ${i}`,error_name:null==s?void 0:s.name,port:e}),this._set_connection_state(hs.CLOSED)}this.logger.report_event("handshake_started")}_close_port(e){if(e in this._active_ports&&(delete this._active_ports[e],f.isEmpty(this._active_ports)))return this._connection_state===hs.ESTABLISHED?this._retry_connection():this._set_connection_state(hs.CLOSED)}_retry_connection(){return this.logger.report_event("connection_retrying"),this._set_connection_state(hs.RETRYING),this.client_version=this._webSocket=this._port=null,this._attempt_handshake()}send(e,t=null,s=null,i=null,r=null){if(this._webSocket)return this._send_with_ws(this._webSocket,e,t,s,i,r)}_send_with_ws(e,t,s=null,i=null,r=null,n=null){if(null==n&&(n=this._current_message_id,o.assert(this._current_message_id%2==1,"Web-initiated message_ids should remain odd"),this._current_message_id+=2),null!==i){const e=window.setTimeout(this._on_response_timeout(n),5e3);this._response_callbacks[n]={response_callback:i,error_callback:r,timeout_id:e}}const a={func:t,header:{message_id:n,should_respond:null!==i,log_data:this.logger.get_log_data_for_client()}};null!=s&&(a.data=s);try{return e.send(JSON.stringify(a))}catch(e){const t=e instanceof Error?e:void 0,s=(null==t?void 0:t.message)||"Unknown error";this.logger.report_event("unity_failure",{message:`WebSocket send failed. Message: ${s}`,error_name:null==t?void 0:t.name}),r&&r(as.COULD_NOT_SEND)}}_on_response(e,t){if(e in this._response_callbacks){const{response_callback:s,timeout_id:i}=this._response_callbacks[e];delete this._response_callbacks[e],window.clearTimeout(i),s&&s(t)}}_web_has_auth(){return r.Viewer.get_viewer().is_signed_in}_retrieve_unity_nonce(e,t){return i.WebRequest({url:new o.URI({path:"/retrieve_unity_nonce"}),dataType:"json",data:{nonce_key:t},success:t=>{switch(t.status){case"OK":if(e.state=us.NONCE_RETURNED_TO_CLIENT,(null===e.client_version||e.client_version>=_s.PORT_CHECK)&&(o.assert(t.message.client_port,`Port check must happen in version ${e.client_version}`),t.message.client_port!==e.port))return void this._terminate_handshake(e.ws,"Mismatched ports.",{client_port:t.message.client_port,web_port:e.port});e.client_has_auth=t.message.client_has_auth;const s=this._web_has_auth();return e.client_has_auth&&s?this._permission_level=Ss.SECURE_PERMISSION:(o.assert(null===e.client_version||e.client_version>=_s.PERMISSION_LEVELS,`Insecure connections only supported by client_version >= ${_s.PERMISSION_LEVELS}.`),this._permission_level=e.client_has_auth?Ss.INSECURE_WEB_PERMISSION:s?Ss.INSECURE_CLIENT_PERMISSION:Ss.INSECURE_PERMISSION),this.logger.update({unity_permission_level:this._permission_level}),this.logger.report_event("handshake_nonce_sent_to_unity_server"),this._send_with_ws(e.ws,"verify_unity_nonce",{nonce:t.message.nonce});case"MISMATCHED_USER_IDS":return this._terminate_handshake(e.ws,"Mismatched user_ids.",{client_user_ids:t.message.client_user_ids,web_user_ids:t.message.web_user_ids});case"INVALID":return this._terminate_handshake(e.ws,"Could not find nonce with given nonce_key.");case"AUTH_REQUIRED":return this._terminate_handshake(e.ws,"Did not have the necessary authentication to retrieve nonce.");case"LOCAL_INFORMATION_PERMISSION_REQUIRED":return this._terminate_handshake(e.ws,"Did not have permission to start a local-information-allowed connection.")}},error:(t,s,i)=>{this._terminate_handshake(e.ws,"Unable to retrieve nonce from server",{status:s,error_string:i})}})}_terminate_handshake(e,t,s={}){const i=Object.assign({message:t},s);L.UNITY_WEB_DEBUG&&console.error(i),this.logger.report_event("unity_failure",i),e&&e.close()}_is_connection_in_progress(e){return e===hs.PENDING||e===hs.RETRYING}add_on_open_callback(e){this._on_open_callbacks.push(e)}add_on_open_failed_callback(e){this._on_open_failed_callbacks.push(e)}add_on_close_callback(e){this._on_close_callbacks.push(e)}call_when_ready(e,t=null){return this.is_ready()?e():this._is_connection_in_progress(this._connection_state)?this._pending_callbacks.push({callback:e,error_callback:t}):t?t(as.CONNECTION_CLOSED):void 0}is_ready(){return this._webSocket&&this._webSocket.readyState===WebSocket.OPEN&&this._connection_state===hs.ESTABLISHED}feature_supported(e,t=[]){return o.assert(null!==this._permission_level,"Connection is not ready."),!(null!==this.client_version&&this.client_version<e)&&t.includes(this._permission_level)}isUnityServerRunning(e){return new Promise((t=>{setTimeout((()=>t(!1)),e);for(let e=17600;e<=17602;e++){const s=new WebSocket(this._getWebSocketURI(e));s.onopen=function(){s.close(),t(!0)}}}))}}Ss.SECURE_PERMISSION=Es.SECURE_PERMISSION,Ss.INSECURE_WEB_PERMISSION=Es.INSECURE_WEB_PERMISSION,Ss.INSECURE_CLIENT_PERMISSION=Es.INSECURE_CLIENT_PERMISSION,Ss.INSECURE_PERMISSION=Es.INSECURE_PERMISSION;const gs=()=>ds.web_sockets_supported(),ps={_uc:new Ss,_has_handshake_started:!1,_cached_file_browser_display_name:null,_start_handshake_if_needed(){this._has_handshake_started||(this._uc.start(),this._has_handshake_started=!0)},continue_as_user(e,t,s,i=null){return this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.WEB_DESTINY,[Ss.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("continue_as_user",{browser:e,refresh_token:t}),this._uc.send("continue_as_user",{browser:e,refresh_token:t},s,i)}),i)},continue_as_user_direct(e,t=null){return this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.WEB_DESTINY_V2,[Ss.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("continue_as_user_direct"),this._uc.send("continue_as_user_direct",null,e,t)}),t)},web_destiny_info(e,t=null){return this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.WEB_DESTINY_V2,[Ss.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("web_destiny_info"),this._uc.send("web_destiny_info",null,e,t)}),t)},client_supports_open_in_file_browser(){return this._uc.feature_supported(_s.OPEN_IN_FILE_BROWSER,[Ss.SECURE_PERMISSION])},ensure_unity_ready(){return this._start_handshake_if_needed(),new Promise((e=>this._uc.call_when_ready((()=>{e(!0)}),(()=>{this._uc=new Ss,this._has_handshake_started=!1,e(!1)}))))},open_file(e,t,s,r,n=null,a=!1){this._start_handshake_if_needed();const _=this.server_path(e,t);return this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.UNITY_HANDSHAKE,[Ss.SECURE_PERMISSION])){this._uc.logger.report_event("open_file",{user_id:s,path_id:_,file_extension:i.file_extension(_),in_file_browser:a}),i.SilentBackgroundRequest({url:new o.URI({path:"/unity_open_log"}),data:{user_id:s,server_path:_,file_extension:i.file_extension(_),in_file_browser:a,unity_session_id:this._uc.logger.unity_session_id(),buildno:this._uc.logger._data.buildno,host_id:this._uc.logger._data.host_id}});const e={server_path:_,user_id:s};this._uc.client_version>=_s.OPEN_IN_FILE_BROWSER?e.in_file_browser=a:o.assert(!a,"The connected client doesn't support opening in file browser."),this._uc.send("open_file",e,r,n)}}),n)},standard_open_file_handler(e){if(!e)return C.Notify.error(n.intl.formatMessage({id:"9HWjA9",defaultMessage:"Error opening file"}))},check_file(e,t,s,r,n=null){this._start_handshake_if_needed();const a=this.server_path(e,t),o=e=>{this._check_file_deprecated_on_client()&&(e={is_locally_available:e}),r(e)};this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.UNITY_HANDSHAKE,[Ss.SECURE_PERMISSION]))return this._uc.logger.report_event("check_file",{user_id:s,path_id:a,file_extension:i.file_extension(a)}),this._uc.send("check_file",{server_path:a,user_id:s},o,n)}),n)},add_on_ready_callback(e){return this._uc.call_when_ready(e)},check_file_batch(e,t,s,r=null){return new Promise(((n,a)=>{this._start_handshake_if_needed();const o=e.map((e=>this.server_path(e.ns_id,e.ns_path))),_=e=>{if(this._check_file_deprecated_on_client())for(const t in e){const s=e[t];e[t]={is_locally_available:s}}s&&s(e),n(e)},c=function(e){r&&r(e),a(e)};this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.UNITY_HANDSHAKE,[Ss.SECURE_PERMISSION]))return this._uc.logger.report_event("check_file_batch",{user_id:t,path_ids:o,file_extensions:o.map(i.file_extension)}),this._uc.send("check_file_batch",{server_paths:o,user_id:t},_,c)}),c)}))},file_browser_display_name(e,t=null){if(null!=this._cached_file_browser_display_name)return void e(this._cached_file_browser_display_name);const s=t=>(this._cached_file_browser_display_name=t,e(t));this._start_handshake_if_needed();return this._uc.call_when_ready((()=>this._uc.feature_supported(_s.CHECK_FILE_RETURNS_OBJ,[Ss.SECURE_PERMISSION])?(this._uc.logger.report_event("file_browser_display_name"),this._uc.send("file_browser_display_name",null,s,t)):e(null)),t)},_check_file_deprecated_on_client(){return _s.UNITY_HANDSHAKE<=this._uc.client_version&&this._uc.client_version<_s.CHECK_FILE_RETURNS_OBJ},server_path:(e,t)=>`${e}:${t}`,has_chime(e,t=null){this._start_handshake_if_needed();return this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.CHIME_OPEN,[Ss.SECURE_PERMISSION]))return this._uc.logger.report_event("has_chime"),this._uc.send("has_chime",null,e,t)}),t)},open_chime(e,t,s=null){this._start_handshake_if_needed();return this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.CHIME_OPEN,[Ss.SECURE_PERMISSION]))return this._uc.logger.report_event("open_chime",{parameters:e}),this._uc.send("open_chime",e,t,s)}),s)},growth_deep_link(e,t={}){return new Promise(((s,i)=>{this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{if(this._uc.feature_supported(_s.GROWTH_DEEP_LINK,[Ss.SECURE_PERMISSION]))return this._uc.logger.report_event("growth_deep_link"),this._uc.send("growth_deep_link",{resource:e,data:t},s,i);i("featured_unsupported")}),i)}))},can_open_apollo(){return new Promise(((e,t)=>(this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{this._uc.feature_supported(_s.OPEN_COLLAB_BROWSE,[Ss.SECURE_PERMISSION,Ss.INSECURE_WEB_PERMISSION])&&this._uc.send("can_open_apollo",{},e,t)}),t))))},open_apollo_main_window(){return new Promise(((e,t)=>(this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{this._uc.feature_supported(_s.OPEN_COLLAB_BROWSE,[Ss.SECURE_PERMISSION,Ss.INSECURE_WEB_PERMISSION])&&this._uc.send("open_apollo_main_window",{},e,t)}),t))))},isUnityServerRunning(){return this._uc.isUnityServerRunning(200)},isUnitySupported:()=>gs()};gs(),t.AI_PLUGIN_ID="previews_ai_plugin",t.COMMENTS_PLUGIN_ID="comments",t.FILE_ACTIVITY_PLUGIN_ID=Q,t.GetHellosignRoutes=V,t.INFO_BLADE_PLUGIN_ID=q,t.PAP_NavigateTo_Replay=function(e){return{class:"navigation",action:"navigate_to",object:"replay",properties:e}},t.PAP_NavigateTo_Sign=function(e){return{class:"navigation",action:"navigate_to",object:"sign",properties:e}},t.PDF_EDITOR_PLUGIN_ID=x,t.PHOTO_EDITOR_PLUGIN_ID="photo_edit_plugin",t.StarredLoggingTypes={CLICK_STAR:"click_star",CLICK_UNSTAR:"click_unstar"},t.TRANSCRIPT_BLADE_PLUGIN_ID="transcript_blade",t.TRANSLATION_PLUGIN_ID="translation_plugin",t.UnityFeatures=ps,t.VIDEO_EDITOR_PLUGIN_ID="video_editor_overlay_plugin",t.convertResultListToOrderedMap=e=>i.immutableExports.OrderedMap(e.map((e=>[ye(e),e]))),t.displayStarSnackbar=Ue,t.downloadSingleFile=({href:e,source:t,isFswm:r=!1,user:o,fileEncryptionInfo:_},{onAttempt:l,onSuccess:d,onError:u}={})=>s.__awaiter(void 0,void 0,void 0,(function*(){null==l||l();const s=r?yield U({sharedLinkUrl:e,origin:i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,userId:null==o?void 0:o.id}):e;let h;try{o&&_&&(h=yield G({href:e,source:t,user:o,fileEncryptionInfo:_}))}catch(e){return e instanceof H?(c.reportException({err:e,tags:["encrypted_folder_web_download"],severity:c.SEVERITY.USER_ERROR}),yield function(e){let t,s,i;switch(e.type){case D.KeyVerificationRequired:t=n.intl.formatMessage({id:"B9f72o",defaultMessage:"Canâ€™t download encrypted files from dropbox.com"}),s=n.intl.formatMessage({id:"l7E3wZ",defaultMessage:"Instead, drag this file onto your desktop from the Dropbox desktop app to save a copy."}),i="https://help.dropbox.com/security/encrypted-team-folders";break;case D.ClientNotEnrolled:t=n.intl.formatMessage({id:"4VG05R",defaultMessage:"Canâ€™t download {count, plural, one{file} other{files}} until your device is enrolled."},{count:e.filesCount}),s=n.intl.formatMessage({id:"mU5ADz",defaultMessage:"{count, plural, one{This file is} other{These files are}} encrypted but your client is not yet enrolled. Refresh the page and try to download again later."},{count:e.filesCount}),i="https://help.dropbox.com/security/encrypted-team-folders";break;default:t=n.intl.formatMessage({id:"jvEL5d",defaultMessage:"Unable to download encrypted {count, plural, one{file} other{files}}"},{count:e.filesCount}),s=n.intl.formatMessage({id:"m9vbqW",defaultMessage:"{count, plural, one{This file is} other{These files are}} encrypted but there was an error during decryption preparation. Refresh the page and try to download again later."},{count:e.filesCount}),i=""}return new Promise(((e,r)=>{a.showFileSystemWarningsModal({confirmText:n.intl.formatMessage({id:"SOYcjX",defaultMessage:"Got it"}),fsws:[{id:"action_download_encrypted",blocking:!0,title:t,text:s,learn_more:i}],onFinalAccept:e,onAbortAction:r})}))}(e)):c.reportException({err:e,tags:["encrypted_folder_web_download"],severity:c.SEVERITY.CRITICAL}),void(null==u||u())}i.get({url:s,source:`${t}_direct`,error:u,getProxyUrl:h}),null==d||d()})),t.downloadSingleFileAsZip=({fqPath:e,rootNsId:t,source:r,blockHash:n,user:a},{onAttempt:o,onSuccess:_}={})=>s.__awaiter(void 0,void 0,void 0,(function*(){null==o||o(),i.get_zip({fq_paths:[e],subject_uid:a.id,block_hash:n,parent_path:i.parent_dir(e),source:r,root_ns_id:t}),null==_||_()})),t.dwellStartTime=e=>ht(e).dwellStartTime,t.fetchDownloadUrl=U,t.fetchMissingStarredStatuses=ze,t.findFilesForSelection=(e,t)=>i.immutableExports.OrderedMap(t.selected.toArray().filter((e=>!!e)).map((t=>[t,e.find((e=>"fq_path"in e?i.paths_are_equal(e.fq_path,t):e.file_id===t))])).filter((([e,t])=>!!t))),t.getActionElementForPAP=function(e){if(void 0!==e)switch(e){case i.ActionSurfaceLogValue.OVERFLOW_MENU:return"action_bar_overflow_menu";case i.ActionSurfaceLogValue.RIGHT_SIDEBAR:return"right_rail_share_menu";case i.ActionSurfaceLogValue.CENTER_PANE:return"center_pane";case i.ActionSurfaceLogValue.TOP_NAVIGATION:return"top_navigation";case i.ActionSurfaceLogValue.ACTION_BAR:return"action_bar";case i.ActionSurfaceLogValue.INLINE_ACTION_BAR:return"content_overflow_menu";case i.ActionSurfaceLogValue.FEATURE_GROWTH:return"feature_growth";case i.ActionSurfaceLogValue.RIGHT_CLICK_MENU:return"content_right_click";case i.ActionSurfaceLogValue.IN_FOLDER_ACTIVATION:return"in_folder_activation";case i.ActionSurfaceLogValue.CONTENT_TILE_ACTION_MENU:return"content_tile_action_menu";case i.ActionSurfaceLogValue.CONTENT_TILE:return"content_tile";case i.ActionSurfaceLogValue.CONTENT_SUGGESTIONS:return"content_suggestions_menu";case i.ActionSurfaceLogValue.PREVIEW_TITLEBAR:return"preview_titlebar";case i.ActionSurfaceLogValue.GLOBAL_CREATE:return"global_create";case i.ActionSurfaceLogValue.FILE_UPLOADER_ACTIONS:return"file_uploader_actions";case i.ActionSurfaceLogValue.CONTEXTUAL_RIBBON:return"contextual_ribbon";case i.ActionSurfaceLogValue.FOLDER_SETTINGS_MENU:return"folder_settings_menu";case i.ActionSurfaceLogValue.FLEXIBLE_SHARING_ENTRYPOINT:return"flexible_sharing_entrypoint";case i.ActionSurfaceLogValue.CONTENT_OVERFLOW_MENU:return"content_overflow_menu";case i.ActionSurfaceLogValue.QUICK_VIEW:return"quick_view";case i.ActionSurfaceLogValue.QUICK_VIEW_CONTENT_TILE:return"quick_view_content_tile";default:!function(e){throw new Error(`Unexpected value: ${e}`)}(e)}},t.getEditorEligibility=X,t.getFileStarredData=we,t.getIsStarred=De,t.getStoreForFolderOverview=at,t.getStoreForSearch=_t,t.getStoreForStarred=rt,t.getVariant=Z,t.handleFileOverLimitError=$,t.isFullPage=e=>"full-page"===ht(e).variant,t.isNonPdfEnabledInPdfEditor=se,t.itemNameFromStarrableItem=function(e){return function(e){return!!e.file_id}(e)||function(e){return!!e.fq_path}(e)?i.filename(e.fq_path):function(e){return!!e.pad_id}(e)?e.title:function(e){return!!e.folder_id}(e)?e.name:function(e){return!!e.filename}(e)?e.filename:e},t.leftSidebarPluginIds=W,t.logDwellTime=(e,t,s)=>{const r=pt(_t().getState());Kt.log(new ie(Object.assign(Object.assign({event_name:"dwell_time"},es({searchSessionExtensionType:"PASSIVE"})),{query_string:r,view_type:t,extra:Object.assign({dwell_time:e.toString(),dwell_time_end_event:s},ts())}))),i.logEvent({class:"search",action:"log",object:"dwell_time",properties:{actionSurface:"search",viewType:t,dwellTime:e.toString()}})},t.logHistoryAdded=e=>{Kt.log(new ie(Object.assign(Object.assign({event_name:"recent_query_stored"},es({searchSessionExtensionType:"PASSIVE"})),{position:e}))),i.logEvent({class:"search",action:"create",object:"search_query_history",properties:{actionSurface:"search",recentHistoryQueryPostion:e}})},t.logHomeActivity=function({role:e,eventName:t,extra:r}){return new Promise(((n,a)=>s.__awaiter(this,void 0,void 0,(function*(){Ge[e]=Ge[e]||[],Ge[e].push({json:{event_name:t,event_time:Me(),extra:f.mapValues(r||{},(e=>String(e)))},resolve:n,reject:a}),yield i.waitForTTI(),qe()}))))},t.logRedirectToResult=(e,t,s,r,n,a)=>{const o=t instanceof l.Paper||t instanceof l.PaperFolder?i.WebUserActionLogEvent.PAPER_OPEN:t instanceof l.File&&t.is_dir?i.WebUserActionLogEvent.FOLDER_OPEN:i.WebUserActionLogEvent.FILE_VIEW;is(o,e,t,s,r,n,a)},t.logResultAction=is,t.logResultPreviewStarted=function(e){Kt.log(new ie(Object.assign(Object.assign({event_name:"result_preview_started"},es({searchSessionExtensionType:"ACTIVE_RESULT_INTERACTING"})),{extra:{file_extension:e,entry_point:a.LoggingEntryPoint.SEARCH_RESULTS_PAGE}})))},t.logUserEventOnFile=function({args:e,action_type:t,action_source:s,action_surface:r,extra:n}){var o;const{user:_,files:c,isSearchMode:d,source:u,viewType:h,isSidebar:E,resultList:S,requestId:g,hasMoreResults:p}=e,{num_files_selected:f,num_folders_selected:y}=a.countFilesAndFolders(c),T=e.actionSurface?e.actionSurface:r||(E?i.ActionSurfaceLogValue.RIGHT_SIDEBAR:i.ActionSurfaceLogValue.OVERFLOW_MENU),I=e.actionSource?e.actionSource:s,m=c.first();d?is(t,null!=S?S:i.immutableExports.List(),m,g,null!=p&&p,T,I,Object.assign(Object.assign({},n),{num_files_selected:f.toString(),num_folders_selected:y.toString(),right_sidebar_state:null!==(o=e.rightRailState)&&void 0!==o?o:null})):m instanceof l.FileSharedWithMe||a.logBrowseAction({uid:_.id,source:u,action:t,num_files_selected:f,num_folders_selected:y,view_type:h,result:m,action_surface:T,action_source:I,right_sidebar_state:e.rightRailState,extra:n})},t.memoizedGetEditorEligibility=te,t.memoizedGetVariant=ee,t.normalizedQuery=ft,t.openSendForSignatureOnPreviews=(r,n,a,o,_,c)=>s.__awaiter(void 0,void 0,void 0,(function*(){var s;const l=i.getExtension$1({fq_path:null!==(s=r.fq_path)&&void 0!==s?s:""});try{if(yield J(t.EntryPointType.SEND_FOR_SIGNATURE,{ext:l,bytes:r.bytes,pageCount:o},{pdfVariant:i.fileViewerFeatureExperiments.signPdfInPdfEditorVariant,nonPdfVariant:i.fileViewerFeatureExperiments.signNonPdfInPdfEditorVariant},a))n(x,i.UserActionContext.Toolbar,{source:"preview_share_dropdown_send_for_signature",highlight:"send_for_signature"});else{const{getLauncher:t}=yield new Promise((function(t,s){e(["./c_integrations_hellosign_deep_integration_launcher"],t,s)})),s=t();s.init({entryPoint:c||"share_menu",file:r,user:a,source:_}),s.launch()}}catch(e){e instanceof Error&&("size_over_limit"===e.message||"page_count_over_limit"===e.message)&&$()}})),t.preferredEditors=bt,t.queryHistory=e=>ht(e).queryHistory,t.resultQuery=pt,t.searchNavigationManager=ut,t.searchUrl=Ht,t.searchUrlParamsForPreviewsCarousel=jt,t.selection=e=>ht(e).selection,t.shouldUsePdfEditor=J,t.updateStarredStatus=$e,t.user=Et,t.videoEditorInitialActionStrings=["rotateLeft","rotateRight","flipHorizontal","flipVertical","crop","trim","enhanceSpeech"]}));
//# sourceMappingURL=c_pap-events_navigation_navigate_to_replay.js-vfljamo_y.map
