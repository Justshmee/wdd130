define(["exports"],(function(t){"use strict";const a=t=>t/180*Math.PI,e=({image:t,scale:e,opacity:i,angle:n})=>{const o=a(n),s=document.createElement("canvas"),h=s.getContext("2d");if(!h)throw new Error("Cannot draw on canvas");const c=t.width*e,r=t.height*e;s.width=Math.round(Math.abs(c*Math.cos(o))+Math.abs(r*Math.sin(o))),s.height=Math.round(Math.abs(c*Math.sin(o))+Math.abs(r*Math.cos(o)));let l=0,d=0;return n<90?d=c*Math.sin(o):n<180?(l=-c*Math.cos(o),d=c*Math.sin(o)-r*Math.cos(o)):n<270?(l=-c*Math.cos(o)-r*Math.sin(o),d=-r*Math.cos(o)):l=-r*Math.sin(o),h.globalAlpha=i,h.translate(l,d),h.rotate(-o),h.drawImage(t,0,0,c,r),{canvas:s,actualUnrotatedHeight:r,actualUnrotatedWidth:c}},i=(t,a,e,i,n=!1)=>{t.save(),t.font=`${e}px ${i}`;const o=t.measureText(a);return t.restore(),n?{width:o.width,height:o.actualBoundingBoxAscent+o.actualBoundingBoxDescent||e}:{width:o.width,height:o.fontBoundingBoxAscent+o.fontBoundingBoxDescent||e}},n=({text:t,size:e,fontFamily:n,color:o,opacity:s,angle:h})=>{const c=a(h),r=document.createElement("canvas"),l=r.getContext("2d");if(!l)throw new Error("Cannot draw on canvas");const{width:d,height:g}=i(l,t,e,n);r.width=Math.abs(d*Math.cos(c))+Math.abs(g*Math.sin(c)),r.height=Math.abs(d*Math.sin(c))+Math.abs(g*Math.cos(c));let M="#000";"light"===o&&(M="#fff"),l.font=`${e}px ${n}`,l.globalAlpha=s,l.fillStyle=M,l.textBaseline="bottom";let m=0,w=r.height;h<90?m=g*Math.sin(c):h<180?(m=g*Math.sin(c)-d*Math.cos(c),w+=g*Math.cos(c)):h<270?(m=-d*Math.cos(c),w=0):w+=d*Math.sin(c),l.translate(m,w),l.rotate(-c),l.fillText(t,0,0);const{width:f,height:u}=i(l,t,e,n,!0);return{canvas:r,actualUnrotatedHeight:u,actualUnrotatedWidth:f}},o=({scale:t,mode:i,imageWatermarkOptions:o,textWatermarkOptions:s})=>{let h=s;"image"===i&&(h=o);const{angle:c}=h,r=a(c)%(Math.PI/2);let l,d,g;if("text"===i){const{text:a,size:e,fontFamily:i,color:o,opacity:h}=s,r=n({text:a,size:e*t,fontFamily:i,color:o,opacity:h,angle:c});l=r.canvas,d=r.actualUnrotatedHeight,g=r.actualUnrotatedWidth}else{const{image:a,size:i,opacity:n}=o;if(!a)throw new Error("NO_TILE_INPUT");const s=e({image:a,scale:i*t,opacity:n,angle:c});l=s.canvas,d=s.actualUnrotatedHeight,g=s.actualUnrotatedWidth}const M=Math.max(d,g);let m=M/2,w=M/2;"text"===i&&(m=2*d,w=s.lineHeight*d);const f=g+m,u=d+w;let x=0,p=0,y=0;return c%180==0?(x=f,p=u,y=m/-1.2):c%180==90?(x=u,p=f):c>0&&c<90||c>180&&c<270?(x=u/Math.sin(r),p=f*Math.sin(r),y=-f*Math.cos(r)):(c>90&&c<180||c>270&&c<360)&&(x=u/Math.cos(r),p=f*Math.cos(r),y=f*Math.sin(r)),{canvas:l,width:l.width,height:l.height,distanceX:x,distanceY:p,startX:-l.width/2,startY:-l.height/2,offsetXPerRow:y,offsetYPerCol:0}};t.drawImageTile=e,t.drawTextTile=n,t.drawWatermarkOnCanvas=({canvas:t,scale:a,mode:i,watermarkOptions:s,textWatermarkOptions:h,imageWatermarkOptions:c})=>{const r=t.getContext("2d");if(null!==r){r.clearRect(0,0,t.width,t.height);const{position:l,marginX:d,marginY:g}=s;if("REPEAT"===l){let e;try{e=o({scale:a,mode:i,textWatermarkOptions:h,imageWatermarkOptions:c})}catch(t){if("NO_TILE_INPUT"===t.message)return;throw t}let n=0,s=0;for(let a=(e.startY+s)%e.distanceY-e.height;a<t.height;a+=e.distanceY){for(let i=(e.startX+n)%e.distanceX-e.width;i<t.width;i+=e.distanceX)r.drawImage(e.canvas,i,a);n+=e.offsetXPerRow,s+=e.offsetYPerCol}}else{let o;if("text"===i){const{text:t,fontFamily:e,color:i,size:s,opacity:c,angle:r}=h;o=n({text:t,size:s*a,fontFamily:e,color:i,opacity:c,angle:r}).canvas}else{const{image:t,size:i,opacity:n,angle:s}=c;if(!t)return;o=e({image:t,scale:i*a,opacity:n,angle:s}).canvas}const s=d*a,M=g*a;let m=s,w=M;"CENTER"===l?(m=(t.width-o.width)/2,w=(t.height-o.height)/2):"NORTHEAST"===l?m=t.width-o.width-s:"SOUTHWEST"===l?w=t.height-o.height-M:"SOUTHEAST"===l&&(m=t.width-o.width-s,w=t.height-o.height-M),r.drawImage(o,m,w)}}},t.tilingFunc=o}));
//# sourceMappingURL=c_plugin_utils_drawWatermarkOnCanvas.js-vfll1rb72.map
