define(["exports","./c_user_centric_perf_metrics_component_visually_complete_ajax","./c_init_data_runtime","./c_core_uri","./c_core_attribution_header","./c_csrf"],(function(e,s,t,o,n,r){"use strict";class a extends Error{static parseResponse(e,s,t,o=null){let n="";null==o&&(o=e in p?p[e]:e>=500?i:a);const r={raw:{status:e,responseBody:t},summary:null,error:{},headers:s};try{const e=JSON.parse(t)||{};r.error=e.error,r.summary=e.error_summary,n=null!=e.user_message?e.user_message.text:""}catch(e){}return Object.assign(new o(n||void 0),r)}}class i extends a{}const p={400:class extends a{},401:class extends a{},409:class extends a{},429:class extends a{}};class d extends Error{constructor(e,s){super(s),this.name="FetchAbortError",this.response=e}}class c extends Error{constructor(e,s){super(s),this.name="FetchFailError",this.response=e}}class l extends Error{constructor(e,s){super(s),this.name="FetchResponseError",this.response=e}}function u(e){return"FetchResponseError"===e.name}function h(e){const s={};return e.forEach(((e,t)=>{s[t]=e})),s}class _{executeRpc(e,t,n,r,i){return new Promise(((p,d)=>{o.incrementAjaxCount(),s.incrementAjaxCount();const c=()=>{o.decrementAjaxCount(),s.decrementAjaxCount()};return fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:Object.assign(Object.assign({},t),{"Content-Type":r}),body:n,signal:i}).then((e=>e.text().then((s=>({response:e,responseText:s}))))).then((({response:e,responseText:s})=>{if(e.ok)return{response:e,responseText:s};throw new l(e,s)})).then((({response:e,responseText:s})=>(c(),p({headers:h(e.headers),result:JSON.parse(s)})))).catch((e=>(c(),u(e)?d(a.parseResponse(e.response.status,h(e.response.headers),e.message)):d(a.parseResponse(0,{},"")))))}))}executeBinaryRpc(e,t,n,r,i){return new Promise(((p,d)=>(o.incrementAjaxCount(),s.incrementAjaxCount(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:Object.assign(Object.assign({},t),{"Content-Type":r}),body:n,signal:i}).then((e=>e.ok?e.arrayBuffer().then((s=>({response:e,responseData:s}))):e.text().then((s=>{throw new l(e,s)})))).then((({response:e,responseData:s})=>p({headers:h(e.headers),result:s}))).catch((e=>u(e)?d(a.parseResponse(e.response.status,h(e.response.headers),e.message)):d(a.parseResponse(0,{},"")))).finally((()=>{o.decrementAjaxCount(),s.decrementAjaxCount()})))))}}class f extends _{}class w{constructor(e){this.uploadEndpoints=new Set(["backups/upload_session/append","files/alpha/upload","files/paper/create","files/paper/update","files/upload","files/upload_v2","files/upload_session/append_v2","files/upload_session/append_batch","files/upload_session/finish","files/upload_session/finish_v2","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","support_attachments/upload","hellosign/self_sign","hellosign/send_signature_request","hellosign/create_template","ungated_file_conv_block/convert_to_pdf"]),this.downloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/download_zip","files/export","files/get_preview","files/get_thumbnail_v2","paper/docs/download","sharing/get_shared_link_file","sharing/export_shared_link","hellosign/convert_to_pdf_download"]),this.supportedUploadEndpoints=new Set(["backups/upload_session/append","files/paper/create","files/paper/update","files/upload","files/upload_v2","files/upload_session/append_v2","files/upload_session/append_batch","files/upload_session/finish","files/upload_session/finish_v2","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","support_attachments/upload","hellosign/self_sign","hellosign/send_signature_request","hellosign/create_template","ungated_file_conv_block/convert_to_pdf"]),this.supportedDownloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/get_thumbnail_v2","sharing/get_shared_link_file","sharing/export_shared_link","hellosign/convert_to_pdf_download"]),this.transport=e||new f,this.ns=m.bind(this)}_upload(e,s,t,o){return this._uploadWithResponseHeaders(e,s,t,o).then((e=>e.result))}_uploadWithResponseHeaders(e,o,n,r){if(!this.uploadEndpoints.has(e))throw new Error(e+" does not use the content-upload endpoint format");if(!this.supportedUploadEndpoints.has(e))throw new Error(e+" is not in the supported list of content-upload endpoints");const a=Object.assign({[s.ApiV2HeaderNames.CsrfToken]:this.csrfToken(),[s.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(o)},this._headers(r));if(Boolean(t.isHTTP3SupportEnabled())&&(a[s.ApiV2HeaderNames.DropboxForceQuic]="true"),"string"==typeof n||void 0===n)return this.executeRpc(e,a,n||"","application/octet-stream",r.signal);{const s=new Blob([n],{type:"application/octet-stream"});return this.executeRpc(e,a,s,"application/octet-stream",r.signal)}}_download(e,s,t,o){return this._downloadWithResponseHeaders(e,s,t,o).then((e=>e.result))}_downloadWithResponseHeaders(e,o,n,r){if(void 0===r||!r.hasOwnProperty("dangerouslyFetchUserContent")||!r.dangerouslyFetchUserContent)throw new Error("download requires explicit acknowledgement of the risk");if(!this.downloadEndpoints.has(e))throw new Error(e+" does not use the content-download endpoint format");if(!this.supportedDownloadEndpoints.has(e))throw new Error(e+" is not in the supported list of content-download endpoints");const a=Object.assign({[s.ApiV2HeaderNames.CsrfToken]:this.csrfToken(),[s.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(o)},this._headers(n));return Boolean(t.isHTTP3SupportEnabled())&&(a[s.ApiV2HeaderNames.DropboxForceQuic]="true"),this.executeBinaryRpc(e,a,"","application/octet-stream",n.signal)}_rpc(e,s,t){return this._rpcWithResponseHeaders(e,s,t).then((e=>e.result))}_rpcWithResponseHeaders(e,o,n){const r=Object.assign({[s.ApiV2HeaderNames.CsrfToken]:this.csrfToken()},this._headers(n));if(Boolean(t.isHTTP3SupportEnabled())&&(r[s.ApiV2HeaderNames.DropboxForceQuic]="true"),this.downloadEndpoints.has(e))throw new Error(e+' does not use the rpc endpoint format. Use "download" instead');if(this.uploadEndpoints.has(e))throw new Error(e+' does not use the rpc endpoint format. Use "upload" instead');const a=JSON.stringify(o||null);return this.executeRpc(e,r,a,"application/json",n.signal)}csrfToken(){return r.Cookies.read("__Host-js_csrf")||""}executeRpc(e,s,r,a,i){return t.__awaiter(this,void 0,void 0,(function*(){const t="client-web.dropbox.com"===window.location.hostname?"client-web.dropbox.com":"www.dropbox.com";const p=n.getAttributionHeader();p&&(s["x-dropbox-client-yaps-attribution"]=p);const d=new o.URI({scheme:"https",authority:t,path:"/2/"+e,query:undefined});return yield this.transport.executeRpc(d,s,r,a,i)}))}executeBinaryRpc(e,s,n,r,a){return t.__awaiter(this,void 0,void 0,(function*(){const t="client-web.dropbox.com"===window.location.hostname?"client-web.dropbox.com":"www.dropbox.com";const i=new o.URI({scheme:"https",authority:t,path:"/2/"+e,query:undefined});return yield this.transport.executeBinaryRpc(i,s,n,r,a)}))}http_header_safe_json(e){return JSON.stringify(e).replace(/[\u007f-\uffff]/g,(function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)}))}}function m(e){const s=this;return{rpc:function(t,o,n){return s._rpc(e+"/"+t,o,n)},rpcWithResponseHeaders:function(t,o,n){return s._rpcWithResponseHeaders(e+"/"+t,o,n)},upload:function(t,o,n,r){return s._upload(e+"/"+t,o,n,r)},uploadWithResponseHeaders:function(t,o,n,r){return s._uploadWithResponseHeaders(e+"/"+t,o,n,r)},download:function(t,o,n,r){return s._download(e+"/"+t,o,n,r)},downloadWithResponseHeaders:function(t,o,n,r){return s._downloadWithResponseHeaders(e+"/"+t,o,n,r)}}}class g extends w{constructor(e){super(e)}_headers(e){return Object.assign({[s.ApiV2HeaderNames.DropboxUid]:String(-1)},e.headers)}}var x=Object.freeze({__proto__:null,NoAuthApiV2Client:g});e.ApiV2ClientBase=w,e.FetchAbortError=d,e.FetchAsyncTransport=_,e.FetchFailError=c,e.FetchResponseError=l,e.NoAuthApiV2Client=g,e.errorIsFetchAbortError=function(e){return"FetchAbortError"===e.name},e.errorIsFetchFailError=function(e){return"FetchFailError"===e.name},e.errorIsFetchResponseError=u,e.filterApiError=e=>e instanceof a?e:void 0,e.noauth_client_esnext=x}));
//# sourceMappingURL=c_api_v2_noauth_client.js-vflmphWBn.map
