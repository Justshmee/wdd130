define(["exports","./e_folder_viewer_src_main","./c_plugin_utils_getImageDefaultSizes","./c_react_query_helpers_helpers","./c_core_uri","./e_core_exception","./c_lodash-es_lodash"],(function(e,t,i,n,o,s,E){"use strict";var r,a,T;!function(e){e.AGGREGATION="AGGREGATION",e.DOC="DOC",e.MSDOC="DOC",e.MSDOC_DEPRECATED="MSDOC",e.PDF="PDF",e.SPREADSHEET="SPREADSHEET",e.FILE="FILE",e.FOLDER="FOLDER",e.SHARED_FOLDER="SHARED_FOLDER",e.TEAM_FOLDER="TEAM_FOLDER",e.PAPER_DOCUMENT="PAPER_DOCUMENT",e.PAPER_FOLDER="PAPER_FOLDER",e.PAPER_PUBLIC_FOLDER="PAPER_PUBLIC_FOLDER",e.PAPER_PROJECT="PAPER_PROJECT",e.EXTERNAL="EXTERNAL",e.CDM_TEAM_MEMBER_FOLDER="CDM_TEAM_MEMBER_FOLDER",e.TEAM_READ_ONLY="TEAM_READ_ONLY",e.SHARED_FOLDER_READ_ONLY="SHARED_FOLDER_READ_ONLY",e.RESTRICTED_FOLDER="RESTRICTED_FOLDER",e.CAMERA_UPLOADS="CAMERA_UPLOADS"}(r||(r={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.DO_NOT_LOAD=1]="DO_NOT_LOAD",e[e.IMMEDIATE=2]="IMMEDIATE",e[e.POST_TTI=3]="POST_TTI"}(a||(a={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SYNCHRONOUS=1]="SYNCHRONOUS",e[e.ASYNCHRONOUS_PRE_TTI=2]="ASYNCHRONOUS_PRE_TTI",e[e.POST_TTI=3]="POST_TTI"}(T||(T={}));const c="HOME_INITIALIZE_STORE",_="HOME_SET_POST_TTI_PROPS_PROMISE",d="HOME_SET_SECTION_VISIBILITY",R="HOME_STORE_LOADED_ASYNC_CONDITIONAL_SECTION",S="HOME_STORE_DECLARE_CONDITIONAL_SECTION",h="HOME_PREFETCH_RECEIVED_DATA",l="HOME_SET_TAB_ID";var O;!function(e){e.STARRED="Starred",e.TASKS="To-do"}(O||(O={}));const D={STARRED:"starred",RECENTS:"recents",SUGGEST:"suggest",TEAMS:"teams",PROMPT:"prompt",RECOMMENDED_MEMBERS:"recommended_members"},P={isPaperEnabledForUser:!1,activeVariants:{},homeStarredActionBar:"OFF",starredTableRedesign:"OFF",homeRetrievalVariant:"OFF"},I={RETRIEVE_STARRED:"retrieve_starred",RECENTS_JSON:"recents_json",RETRIEVE_PAPER_RECENTS:"retrieve_paper_recents",GET_SUGGESTED:"get_suggested"};a.IMMEDIATE,a.POST_TTI;const A={[I.RETRIEVE_STARRED]:{fragment:"retrieve_starred",handle:"__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER",section:D.STARRED,conditionalSection:D.STARRED},[I.RECENTS_JSON]:{fragment:"recents/json",handle:"__REGISTER_RECENTS_PRELOAD_HANDLER",section:D.RECENTS,conditionalSection:D.RECENTS},[I.RETRIEVE_PAPER_RECENTS]:{fragment:"retrieve_paper_recents",handle:"__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER",section:D.RECENTS,conditionalSection:"paper_recents"},[I.GET_SUGGESTED]:{fragment:"get_suggested",handle:"__REGISTER_SUGGEST_GRID_PRELOAD_HANDLER",section:D.SUGGEST,conditionalSection:D.SUGGEST,isOptional:!0}};class C extends i.FluxStore{constructor(){super(t.dispatcherSingleton),this.handledPrefetches=[],this.activeTabId=O.STARRED,this.canRenderItems=()=>!!this.pendingPreTTIPrefetches&&!this.pendingPreTTIPrefetches.length,this.thumbStore=new t.GenericThumbStore,this.sectionToDidLoadSynchronously={},this.sectionToPendingCallbacks={},this.preTTIProps=P}getRole(){var e;return this.role||(null===(e=this.getUser())||void 0===e?void 0:e.role)}getUser(){return this.user||n.getActiveUser()}getThumbStore(){return this.thumbStore}getSectionVisibility(){return this.sectionVisibility}getPreTTIProps(){return this.preTTIProps}getPostTTIPropsPromise(){return this.postTTIPropsPromise}getActiveTabId(){return this.activeTabId}getActiveVariants(){return this.preTTIProps.activeVariants}getActiveVariant(e){const t=this.getActiveVariants();return t&&t[e]}getPageType(e){switch(e){case"/recents":case"/edison_test/recents":return"RECENTS";case"/starred":return"STARRED";default:return"HOME"}}executeWhenSectionIsReady(e,t,i){const n=this.getSectionLoadingPreference(e);return n===a.DO_NOT_LOAD?null:n===a.IMMEDIATE||this.getSectionLoadingMode(e)!==T.UNKNOWN?i(!0):(t&&(this.sectionToPendingCallbacks[e]?this.sectionToPendingCallbacks[e].push(i):this.sectionToPendingCallbacks[e]=[i]),null)}getSectionLoadingPreference(e){if(this.sectionToExtendedConditionalData){const t=this.sectionToExtendedConditionalData[e];return t?t.isPostTti?a.POST_TTI:a.IMMEDIATE:a.DO_NOT_LOAD}return a.UNKNOWN}getSectionLoadingMode(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]?this.sectionToExtendedConditionalData[e].loadingMode:T.UNKNOWN}canRenderAllHomeSections(){return this.sectionToExtendedConditionalData?E.values(this.sectionToExtendedConditionalData).every((e=>!e.isBlocking||(!!e.isPostTti||e.loadingMode!==T.UNKNOWN))):(this.role||s.reportStack("Called canRenderAllHomeSections before initialization",{severity:s.SEVERITY.NONCRITICAL}),!0)}setSectionVisibility({section:e,visible:t}){this.sectionVisibility[e]!==t&&(this.sectionVisibility=Object.assign(Object.assign({},this.sectionVisibility),{[e]:t}))}setSectionLoadingMode(e,t){const i=this.getExtendedConditionalData(e);i&&(this.sectionToExtendedConditionalData[e]=Object.assign(Object.assign({},i),{loadingMode:t}))}getExtendedConditionalData(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]}onPrefetchReceivedData({homePrefetchType:e}){this.handledPrefetches.push(e),this.pendingPreTTIPrefetches&&(this.pendingPreTTIPrefetches=E.without(this.pendingPreTTIPrefetches,e),this.pendingPreTTIPrefetches.length||this.__emitChange())}onInitializeStore({role:e,sectionVisibility:t,preTTIProps:i,sectionToConditionalData:s}){this.role=e,this.sectionVisibility=t,this.user=n.Viewer.get_viewer().get_user_by_role(e),o.assert(!!this.user,`Could not find user for role ${e}`),this.preTTIProps=i||this.preTTIProps,this.pendingPreTTIPrefetches=E.without([I.RECENTS_JSON].concat(E.compact(E.map(A,(({section:e},t)=>{if(s){const i=s[e];if(i&&!i.isPostTti)return t}return null})))),...this.handledPrefetches),this.sectionToExtendedConditionalData=E.mapValues(s,((e,t)=>{return Object.assign(Object.assign({},e),{loadingMode:T.UNKNOWN,isBlocking:(i=t,p(i))});var i})),Object.keys(this.sectionToDidLoadSynchronously).forEach((e=>{(0,this.sectionToDidLoadSynchronously[e])(this.getSectionLoadingPreference(e))&&this.setSectionLoadingMode(e,T.SYNCHRONOUS)})),this.sectionToDidLoadSynchronously={}}onDeclareConditionalSection({section:e,didInitializeSynchronously:t}){this.sectionToExtendedConditionalData?s.reportStack("declared conditional section too late",{severity:s.SEVERITY.CRITICAL,exc_extra:{section:e}}):this.sectionToDidLoadSynchronously[e]?s.reportStack("Re-declared a conditional section",{severity:s.SEVERITY.CRITICAL,exc_extra:{section:e}}):this.sectionToDidLoadSynchronously[e]=t}onLoadedAsyncConditionalSection({section:e}){const t=this.getExtendedConditionalData(e);t&&this.setSectionLoadingMode(e,t.isPostTti?T.POST_TTI:T.ASYNCHRONOUS_PRE_TTI),(this.sectionToPendingCallbacks[e]||[]).forEach((e=>e(!1))),this.sectionToPendingCallbacks[e]=[]}onSetTabId({activeTabId:e}){this.activeTabId=e}onSetPostTTIPropsPromise({postTTIPropsPromise:e}){this.postTTIPropsPromise=e}__onDispatch(e){const t=e.action;switch(t.type){case c:this.onInitializeStore(t.payload),this.__emitChange();break;case l:this.onSetTabId(t.payload),this.__emitChange();break;case _:this.onSetPostTTIPropsPromise(t.payload),this.__emitChange();break;case h:this.onPrefetchReceivedData(t.payload);break;case d:this.setSectionVisibility(t.payload),this.__emitChange();break;case S:this.onDeclareConditionalSection(t.payload),this.__emitChange();break;case R:this.onLoadedAsyncConditionalSection(t.payload),this.__emitChange()}}}let g=null;function N(){return(null===g&&(g=new C),g).getUser()}const u=function(e){const t={};for(const i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}(D);function p(e){return!!u[e]}e.HomeResourceStoreActionTypes={RECEIVED_RESOURCE_ID_TO_FILE:"HOME_RESOURCE_STORE_RECEIVED_RESOURCE_ID_TO_FILE",REQUEST_PREVIEW:"HOME_RESOURCE_STORE_REQUEST_PREVIEW"},e.getRole=function(){return N().role},e.getUser=N}));
//# sourceMappingURL=c_home_store.js-vfl7cbIFu.map
