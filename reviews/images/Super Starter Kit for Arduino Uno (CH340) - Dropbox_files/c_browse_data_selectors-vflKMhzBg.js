define(["exports","./e_folder_viewer_src_main","./c_files_view_data_store","./c_browse_models","./e_core_exception","./c_core_i18n","metaserver/static/js/modules/constants/web_experience_constants","./c_core_uri","./c_sync_everything_redux_selectors"],(function(e,t,r,o,i,s,l,n,a){"use strict";const c=e=>t.getStateAtNamespace(e,t.TAGGING_NAMESPACE_KEY),d=e=>c(e).tagsByFile;function u(e,{sortField:r,sortDirection:l},n){const a=function(e,r){switch(e){case t.SortField.FILENAME:case t.SortField.SHARED_WITH:return e=>_(e,o.File.getFilename(e));case t.SortField.MODIFIED:return e=>_(e,e.ts);case t.SortField.CATEGORY:return e=>_(e,o.File.getCategoryDescription(e));case t.SortField.EXTENSION:return e=>_(e,o.File.getExtension(e));case t.SortField.SIZE:return e=>_(e,e.is_dir&&(null==r?void 0:r.has(e.fq_path))?r.get(e.fq_path).size:e.bytes);case t.SortField.PARENT_FOLDER:return e=>_(e,o.File.getParentDirName(e));case t.SortField.RECENT_ACTIVITY:return e=>{var t;return _(e,null===(t=e.recentsInfo)||void 0===t?void 0:t.activity_timestamp_ms)};default:return}}(r,n),c=function(e,r){const o=s.case_insensitive_comparator(!0),i=r===t.SortDirection.ASCENDING?1:-1;switch(e){case t.SortField.FILENAME:case t.SortField.SHARED_WITH:case t.SortField.SIZE:case t.SortField.PARENT_FOLDER:case t.SortField.RECENT_ACTIVITY:return function(e,r){return function({isFolder:o,value:i,isAlwaysFirst:s},{isFolder:l,value:n,isAlwaysFirst:a}){const c=F(s,a);return 0!==c?c:(i||(i=1/0*e),n||(n=1/0*e),o&&l?t.compare(i,n,e,r):o?-e:l?e:t.compare(i,n,e,r))}}(i,o);case t.SortField.MODIFIED:case t.SortField.CATEGORY:case t.SortField.EXTENSION:return function(e,r){return function({isFolder:o,value:i,isAlwaysFirst:s},{isFolder:l,value:n,isAlwaysFirst:a}){const c=F(s,a);return 0!==c?c:o&&l?t.compare(i,n,e,r):o?1:l?-1:""===i?1:""===n?-1:t.compare(i,n,e,r)}}(i,o);default:return}}(r,l);return a&&c?e.sortBy(a,c):(i.reportException({err:new Error("sortFiles was called with an unsupported sort field"),tags:["browse_sort_invalid_field"],severity:i.SEVERITY.CRITICAL,exc_extra:{sort_field:r}}),e)}function _(e,t){return{isFolder:e.is_dir,value:t,isAlwaysFirst:S(e)}}function S(e){return o.File.isTeamMemberFolder(e)||o.File.isFamilySharedFolder(e)}function F(e,t){return e&&t?0:e?-1:t?1:0}const E=e=>t.getStateAtNamespace(e,t.BROWSE_NAMESPACE_KEY)||r.defaultBrowseState,p=e=>E(e).context,m=e=>E(e).experiments,f=e=>{var r;return null===(r=e[t.BROWSE_NAMESPACE_KEY])||void 0===r?void 0:r.experiments},T=e=>E(e).browsePostTTIExperiments,v=e=>{var r;return null===(r=e[t.BROWSE_NAMESPACE_KEY])||void 0===r?void 0:r.browsePostTTIExperiments},I=e=>E(e).folderSizes,h=e=>E(e).loadingState;r.createSelector(h,(e=>e===t.LoadingState.LOADING_FIRST_PAGE));const g=e=>E(e).path,O=e=>E(e).selection,w=e=>E(e).browsePostTTIData,A=e=>{const t=E(e).user;return n.assert(null!=t,"Browse store `user` accessed before APP_INIT action"),t},y=r.createSelector((e=>E(e).filterTypes||t.immutableExports.Set([])),(e=>e.isEmpty()?r.BrowseFilterType.NONE:e.first())),N=e=>E(e).browsePostTTIExperiments||{};r.createSelector(w,(e=>Object.assign({},e.uploaderPostTTIExperiments)));const b=e=>E(e).unsortedFiles;r.createSelector(b,(e=>e.keySeq().toArray().map((e=>({filename:t.filename(e).toLowerCase(),fqPath:e}))).sort(((e,t)=>e.filename<t.filename?-1:e.filename>t.filename?1:0))));const P=r.createSelector(b,(e=>{const o=r.selectScopedSort(e,{instanceId:t.BROWSE_FILES_VIEW_ID});return o||t.BROWSE_DEFAULT_SORT_ORDER}),I,p,m,((e,t,r,o,i)=>u(e.toList(),t,r))),R=r.createSelector(b,O,((e,t)=>x(e,t))),M=r.createSelector(R,r.previewThumbnails,((e,t)=>e.count()>0?e.withMutations((e=>{e.forEach(((r,i)=>{var s;if(!r.thumbnail_url_tmpl&&(null===(s=t[r.file_id])||void 0===s?void 0:s.preview_url)){const s=t[r.file_id].preview_url;e.set(i,new o.File(Object.assign(Object.assign({},r),{thumbnail_url_tmpl:s})))}}))})):e));r.createSelector(R,b,((e,t)=>e.size===t.size));const x=(e,r)=>r.selected.isEmpty()||e.isEmpty()?t.immutableExports.OrderedMap():t.immutableExports.OrderedMap(r.selected.map((t=>{const r=e.find((e=>e.fq_path===t));return r?[r.fq_path,r]:void 0}))),B=r.createSelector(A,(e=>{const t=E(e).viewer;return n.assert(null!=t,"Browse store `viewer` accessed before APP_INIT action"),t}),g,((e,r,o)=>t.browse_root(r,e))),C=r.createSelector(P,I,((e,t)=>e.map((e=>{const r=t.get(e.fq_path);return r?e.updateSize(r.size,r.state):e}))));r.createSelector(b,I,((e,t)=>e.withMutations((r=>{t.forEach(((t,o)=>{const i=e.get(o);if(i&&t){const e=i.updateSize(t.size,t.state);r.set(o,e)}}))})))),r.createSelector(R,(e=>e&&1===e.size&&e.first().is_dir&&!o.File.isNoAccessSharedFolder(e.first()))),r.createSelector(A,p,((e,t)=>e.is_cdm_member&&e.is_team_admin&&t.isCurrentlyInRoot||!!t.isCurrentPathWriteable()));r.createSelector(p,m,w,h,((e,r,o,i)=>Boolean(!o.mobileWebInvites&&e.isCurrentlyInRoot&&e.isInsideMyTeamFolderTree&&i===t.LoadingState.LOADED))),r.createSelector(p,(e=>e.isInsideMyTeamFolderTree&&e.isCurrentlyInRoot)),r.createSelector(w,(e=>{var t;return Boolean(null===(t=e.userHasSharedFileOrFolderInfo)||void 0===t?void 0:t.has_shared_file_or_folder)})),r.createSelector(w,(e=>Boolean(e.isProTrialUser))),r.createSelector(w,(e=>e.teamTopLevelContentPolicy)),r.createSelector(R,(e=>e.count()>0?"selected":"unselected")),r.createSelector(R,(e=>0===e.count()));const D=e=>E(e).currentFolderInfo,V=r.createSelector(p,D,((e,r)=>null!=r&&r.type!==t.FileTypes.TEAM_MEMBER_FOLDER&&e.isInFolderMode&&!e.isCurrentlyInRoot)),L=r.createSelector(V,p,D,((e,t,r)=>r&&e&&!t.isInsideVaultFolder&&!t.isInsideTeamFolderRoot&&!t.isEncrypted&&!o.File.isReadOnlySharedFolder(r)));r.createSelector(R,N,((e,t)=>!!t.expEnableBackupWeb&&a.isBackupFolderIcon(e.first()))),r.createSelector(a.backupFolderPathByFile,g,((e,t)=>e({fq_path:t})));const W=r.createSelector(D,a.isInsideBackupFolderByFile,((e,r)=>!!t.isBackupBrowse()||!!e&&r(e)));r.createSelector(g,a.folderBackupInfoByPath,((e,t)=>t(e)));const H=r.createSelector(f,(e=>{var t;return null!==(t=null==e?void 0:e.manualTagging)&&void 0!==t?t:"OFF"}));r.createSelector(f,(e=>{var t;return null!==(t=null==e?void 0:e.flowsAutomatedFolderUi)&&void 0!==t&&t})),r.createSelector(f,(e=>{var t;return null!==(t=null==e?void 0:e.flowsAutoTagUi)&&void 0!==t&&t})),r.createSelector(f,(e=>{var t;return null!==(t=null==e?void 0:e.autoTaggingAwarenessVariant)&&void 0!==t?t:"OFF"}));const U=r.createSelector(f,(e=>{var t;return null!==(t=null==e?void 0:e.manualClassification)&&void 0!==t?t:"OFF"}));r.createSelector(H,(function(e){return!!e&&["V1","V1_WITH_BULK","V1_WITH_BULK_FOR_OPTED_IN_TEAMS","V1_WITH_COLUMN","V2","V2_FOR_OPTED_IN_TEAMS"].includes(e)})),r.createSelector(H,(function(e){return!!e&&["V1_WITH_COLUMN","V2_FOR_OPTED_IN_TEAMS"].includes(e)}));const k=(e,t)=>{const i=t[r.getFileMapKey(e)];let s=e;return void 0!==i&&(s=new o.File(Object.assign(Object.assign({},e),{tags:i.map((e=>({value:e,highlighted:!1})))}))),s};r.createSelector(C,d,((e,t)=>e.map((e=>k(e,t)))));const G=r.createSelector(b,d,((e,t)=>e.withMutations((e=>{e.forEach(((r,o)=>{e.set(o,k(r,t))}))}))));r.createSelector(G,O,((e,t)=>x(e,t))),r.createSelector(D,d,((e,t)=>{if(void 0!==e)return k(e,t)}));r.createSelector(v,(e=>"ON"===(null==e?void 0:e.expBackupNewLocationHint)));const q=r.createSelector(v,(e=>{var t;return null!==(t=null==e?void 0:e.expGgToCdmMigrationVariant)&&void 0!==t?t:"OFF"}));r.createSelector(q,(e=>["CONTROL","V1"].includes(e))),r.createSelector(v,(e=>{var t;return null!==(t=null==e?void 0:e.expGgToTmrMigrationVariant)&&void 0!==t?t:"OFF"}));const z=r.createSelector(M,(e=>!0==!!(null==e?void 0:e.size))),Y=r.createSelector(M,z,((e,t)=>t?e.first():void 0)),j=r.createSelector(p,Y,((e,t)=>((e,t)=>t?o.File.canViewFileMembers(t,e):e.canViewContainingNSMembers)(e,t)));r.createSelector(j,Y,((e,t)=>((e,t)=>{var r;return!e&&t?null===(r=t._mount_access_perms)||void 0===r?void 0:r.includes("can_view"):e})(e,t))),r.createSelector(T,(e=>{var t;return null!==(t=e.expSuggestedWorkflowsM1)&&void 0!==t?t:"OFF"})),r.createSelector(f,(e=>{var t;return null!==(t=null==e?void 0:e.folderHistoryRollbacks)&&void 0!==t&&t})),r.createSelector(p,A,((e,r)=>{const o=t.GoldenGate.hasContentManagerAndSuperAdmin(r.id);return e.isCurrentlyInRoot&&!r.is_cdm_member&&o&&!e.isInsideVaultFolder&&!e.isEncrypted&&!(r.is_tmr_member&&e.currentFQPath===r.cdm_tmf_path)})),r.createSelector(G,(e=>E(e).quickViewFileId),((e,t)=>e.find((e=>e.file_id===t)))),r.createSelector(G,(e=>E(e).uploadQuickViewFilePath),((e,t)=>e.find((e=>e.fq_path===t)))),r.createSelector(T,(e=>{var t;return null!==(t=e.flexibleSharingEntrypointM1)&&void 0!==t?t:"OFF"})),r.createSelector(T,(e=>{var t;return null!==(t=e.expConsolidatedSharingEntrypoints)&&void 0!==t?t:"OFF"})),e.browseLoadingState=h,e.browsePostTTIData=w,e.browsePostTTIExperiments=N,e.context=p,e.experiments=m,e.filePathsToSelectOnNextUpdate=e=>E(e).filePathsToSelectOnNextUpdate,e.getBrowseState=E,e.getCurrentFolderInfo=D,e.getIndexOfFile=(e,t)=>P(t).findIndex((t=>t.sjid===e.sjid&&t.ns_id===e.ns_id)),e.isFetchTagsOnBrowseEnabled=function(e){return!!e&&["V1_WITH_BULK_FOR_OPTED_IN_TEAMS","V1_WITH_COLUMN","V2_FOR_OPTED_IN_TEAMS","FETCH_TAGS_DRY_RUN"].includes(e)},e.isInsideBackupFolder=W,e.isInsideFlowsEligibleFolder=L,e.manualTaggingVariant=H,e.mountPoints=e=>E(e).mountPoints,e.path=g,e.rawUser=e=>E(e).user,e.selectAllTagsSuggestions=e=>c(e).tags,e.selectFileByFullPath=(e,t)=>C(e).find((e=>e.fq_path===t.path)),e.selectFilesByFullPaths=(e,t)=>C(e).filter((e=>t.paths.has(e.fq_path)&&(!t.excludeNoAccessSharedFolders||!o.File.isNoAccessSharedFolder(e)))).toArray(),e.selectFilesForSelection=(e,t)=>x(b(e),t.selection),e.selectedFiles=R,e.selectedFilter=y,e.selection=O,e.shouldShowDeletedFiles=e=>E(e).shouldShowDeletedFiles,e.sortedFiles=P,e.sortedFilesWithFolderSizes=C,e.structuredTaggingVariant=U,e.unsortedFiles=b,e.urlPrefix=B,e.user=A}));
//# sourceMappingURL=c_browse_data_selectors.js-vflCeSdIu.map
