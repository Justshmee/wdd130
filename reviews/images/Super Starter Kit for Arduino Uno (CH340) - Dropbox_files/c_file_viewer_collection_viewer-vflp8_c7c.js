define(["require","exports","react","./e_folder_viewer_src_main","./c_init_data_runtime","./c_core_uri","./c_react_query_helpers_helpers","./c_api_v2_noauth_client","./c_core_i18n","./c_apex-metrics_src_types","./c_growth_ui_api","./c_files_view_data_store","./c_api_v2_client_base","./c_pap-events_navigation_navigate_to_replay","./c_referrer_cleansing_redirect","./c_cloud_docs_types","./c_hooks_use_stabilized_callback","./e_core_exception","./c_src_sink_index","./c_growth_ui_teams_web_actions_logger_events","./c_keymaster","./c_lodash-es_lodash","./c_es_hooks_useDispatch","./c_core_utils_browser_detection","./c_ui-icon_line_zoom-out","./c_campaigns_campaign_enums","./c_bolt_metaserver_clients","./c_skeleton_index","./c_ui-icon_line_restore","./c_toolkit_dist_redux-toolkit","./c_flux_store_listener","./c_ui-icon_line_team","./c_ui-icon_line_zip","./c_stormcrow_explicit_exposure_logging","./c_csrf","./c_flows_logging_flows_loggers","./c_spectrum_util_raf_throttle","./c_browse_models","./c_flux_base_store","./c_cloud_docs_constants","./c_core_notify","./c_chips_index","metaserver/static/js/modules/constants/contacts","./c_spectrum_colorized_icon","./c_spectrum_svg_icon_bundle","./c_spectrum_positioned_portal","./c_user_centric_perf_metrics_component_visually_complete_component_visually_complete_calculator","metaserver/static/js/modules/constants/web_experience_constants","./c_stormcrow_gating_factory","./c_plugin_utils_drawWatermarkOnCanvas","metaserver/static/js/modules/constants/locales","./c_resize-observer-polyfill_dist_ResizeObserver","./c_badges_index","./c_react-error-boundary"],(function(e,t,i,a,n,r,o,s,l,c,d,u,_,p,g,f,m,h,v,S,E,w,b,y,T,I,C,A,M,O,P,x,D,R,N,k,L,F,U,V,j,B,H,K,z,W,G,q,Q,Y,$,Z,X,J){"use strict";function ee(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var te=ee(i),ie=ee(H),ae=ee($);const{createRouteObjects:ne}=a.Route;const re=a.defineMessage({id:"3xAi9D",defaultMessage:"Download"}),oe=a.defineMessage({id:"BFkYUA",defaultMessage:"Disabled for this file"}),se=a.defineMessage({id:"Wakc3q",defaultMessage:"Copy to Dropbox"}),le=a.defineMessage({id:"A9yx17",defaultMessage:"You do not have permission to save a copy of this file"}),ce=a.defineMessage({id:"MysX8v",defaultMessage:"Open in"}),de=a.defineMessage({id:"GtD4wV",defaultMessage:"Move"}),ue=a.defineMessage({id:"DyrBQI",defaultMessage:"Rename"}),_e=a.defineMessage({id:"nOBhEP",defaultMessage:"Delete"}),pe=a.defineMessage({id:"6MJeaA",defaultMessage:"Copy"}),ge=a.defineMessage({id:"T/KgJj",defaultMessage:"Version history"}),fe=a.defineMessage({id:"GQqYaL",defaultMessage:"Restore"}),me=a.defineMessage({id:"0BUrj7",defaultMessage:"Star"}),he=a.defineMessage({id:"5e94v2",defaultMessage:"Unstar"}),ve=a.defineMessage({id:"Wi4w+P",defaultMessage:"Share"}),Se=a.defineMessage({id:"Yof/lp",defaultMessage:"Share folder"}),Ee=a.defineMessage({id:"Jtd/YY",defaultMessage:"Share selected"}),we=a.defineMessage({id:"a6eG+z",defaultMessage:"Save as…"}),be=a.defineMessage({id:"L7z983",defaultMessage:"Send for signature"}),ye=a.defineMessage({id:"0IftsN",defaultMessage:"You don't have permission to make changes to this file"}),Te=a.defineMessage({id:"5b2GuK",defaultMessage:"Self-sign"}),Ie=a.defineMessage({id:"7hZE74",defaultMessage:"Edit"}),Ce=a.defineMessage({id:"m3owb1",defaultMessage:"Print"}),Ae=a.defineMessage({id:"rfS9Yz",defaultMessage:"Info"}),Me=a.defineMessage({id:"IW4Dbb",defaultMessage:"Info, opens sidebar"}),Oe=a.defineMessage({id:"ltiq22",defaultMessage:"Comments"}),Pe=a.defineMessage({id:"4yb/Nc",defaultMessage:"Show comments"}),xe=a.defineMessage({id:"tiamiE",defaultMessage:"Show comments, opens sidebar"}),De=a.defineMessage({id:"Fs6ekI",defaultMessage:"Hide comments"}),Re=a.defineMessage({id:"ThPItB",defaultMessage:"Hide comments, closes sidebar"}),Ne=a.defineMessage({id:"fhTafx",defaultMessage:"Activity"}),ke=a.defineMessage({id:"LqcgzK",defaultMessage:"Activity, opens sidebar"}),Le=a.defineMessage({id:"tf3HTb",defaultMessage:"Full screen"}),Fe=a.defineMessage({id:"L5Ob4q",defaultMessage:"Fit to width"}),Ue=a.defineMessage({id:"RKopg2",defaultMessage:"Fit to page"}),Ve=a.defineMessage({id:"arleRn",defaultMessage:"Hide tools"}),je=a.defineMessage({id:"vx36Hs",defaultMessage:"Show transcript"}),Be=a.defineMessage({id:"L341Hp",defaultMessage:"Show transcript, opens sidebar"}),He=a.defineMessage({id:"rhUSQ+",defaultMessage:"Hide transcript"}),Ke=a.defineMessage({id:"IC2p3F",defaultMessage:"Hide transcript, closes sidebar"}),ze=a.defineMessage({id:"maKpMM",defaultMessage:"Transcript"}),We=a.defineMessage({id:"wjO1ac",defaultMessage:"To get the audio transcript, log in or sign up"}),Ge=a.defineMessage({id:"XGJW7e",defaultMessage:"Track analytics"}),qe=a.defineMessage({id:"uI4EPd",defaultMessage:"Are you sure you want to delete this from your Dropbox <u>and</u> your computer?"}),Qe=a.defineMessage({id:"GDyzdI",defaultMessage:"If not, go to your file or folder in Finder, make sure it’s locally available, and right click it and click <b>Don’t sync to dropbox.com</b>."}),Ye=a.defineMessage({id:"3y4uyY",defaultMessage:"If not, go to your file or folder in File Explorer, make sure it’s locally available, and right click it and click <b>Don’t sync to dropbox.com</b>."}),$e=a.defineMessage({id:"yCm9Ew",defaultMessage:"Delete {folderName} from your backup and computer?"}),Ze=a.defineMessage({id:"Tay+m0",defaultMessage:"{folderName} will be deleted from Dropbox Backup and the files and folders will no longer live on your computer.<br></br>If you change your mind, you can click <b>Show deleted files</b> to restore it to your backup."}),Xe=a.defineMessage({id:"x4wzTK",defaultMessage:"Delete {count} items from your backup and computer?"}),Je=a.defineMessage({id:"6lG+1M",defaultMessage:"{count} items will be deleted from Dropbox Backup and the files and folders will no longer live on your computer.<br></br>If you change your mind, you can click <b>Show deleted files</b> to restore these files to your backup."}),et=({user:e,fq_path:t,totalFilesCount:i,onConfirm:n,onRequestClose:r,setDeleteFileModalOpen:o})=>{const[s,d]=te.default.useState(!0),u=()=>{d(!1),null==r||r()},_=e.is_cdm_member||e.is_tmr_member,p=l.intl.formatMessage({id:"FMtrmh",defaultMessage:"{fileCount, plural, one {# file} few {# files} many {# files} other {# files}}"},{fileCount:i}),g=1===i?a.filename(t):p,f=a.isBackupBrowse()&&!a.isInsideEDB(t),m={filename:g,b:e=>te.default.createElement(a.Text,{isBold:!0},e),u:e=>te.default.createElement("span",{style:{textDecoration:"underline"}},e)},h=l.intl.formatMessage({id:"yDuoGW",defaultMessage:"Cancel"}),v=l.intl.formatMessage(_e);return te.default.createElement(a.Modal,{open:s,isCentered:!0,onRequestClose:u,onAfterOpen:()=>null==o?void 0:o(!0),onAfterClose:()=>null==o?void 0:o(!1)},te.default.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard",className:"naming-conventions__header"},te.default.createElement(a.Title,null,f?l.intl.formatMessage(qe,m):l.intl.formatMessage(_e))),te.default.createElement(a.Modal.Body,{hasVerticalSpacing:!1,className:"uxa-modal",id:"delete-file-modal"},te.default.createElement(a.Text,null,f?c.mac?l.intl.formatMessage(Qe,m):l.intl.formatMessage(Ye,m):_?l.intl.formatMessage({id:"emsobI",defaultMessage:"Are you sure you want to delete <b>{filename}</b> from your team member folder?"},m):l.intl.formatMessage({id:"8TOnv7",defaultMessage:"Are you sure you want to delete <b>{filename}</b> from your Dropbox?"},m))),te.default.createElement(a.Modal.Footer,null,te.default.createElement(a.Button,{variant:"opacity",onClick:u},h),te.default.createElement(a.Button,{variant:"primary",autoFocus:!0,onClick:()=>{n(),d(!1)}},v)))};const tt=({user:e,filesPath:t,fq_path:i},{onSuccess:r,onError:o,onNetworkRequest:s,onRequestClose:l,setDeleteFileModalOpen:c,onSuccessResult:d})=>{var u;u={onConfirm:()=>n.__awaiter(void 0,void 0,void 0,(function*(){null==s||s();const i=yield a.deleteFiles(t,e.id,!0),n=i.isError?[]:i.result.entries.filter((e=>"success"===e[".tag"]));if(i.isError||0===n.length)return void(null==o||o(i.isError?i:a.createUndefinedRpcResult()));const l=new Set;n.forEach((e=>{e.metadata.path_lower&&l.add(e.metadata.path_lower)})),null==r||r(l),null==d||d(i)})),fq_path:i,totalFilesCount:t.length,user:e,onRequestClose:l,setDeleteFileModalOpen:c},a.Modal$1.showInstance(te.default.createElement(et,Object.assign({},u)))};var it=Object.freeze({__proto__:null,portableDelete:tt});const at=(e,t=1)=>a.Snackbar$1.sync(d.deleteInProgress(t),!1,e),nt=(e,t=1)=>a.Snackbar$1.complete(d.deleteCompleteSuccess(t,t),e),rt=(e,t,i=1)=>{e.error&&a.Snackbar$1.fail(d.deleteError(i,e.error),t)};var ot=Object.freeze({__proto__:null,deleteCompleteSnackBar:nt,deleteFailedSnackBar:rt,deleteSnackBarInProgress:at});const st=e=>!("isDeleted"in e)||!("is_unmounted"in e)||!e.isDeleted&&!e.is_unmounted,lt=e=>"is_in_vault_folder"in e&&e.is_in_vault_folder,ct=e=>{var t;return"per_node_metadata"in e&&!!(null===(t=e.per_node_metadata)||void 0===t?void 0:t.link_node)},dt=e=>"is_cloud_doc"in e&&e.is_cloud_doc;const ut=e=>a.Snackbar$1.sync(l.intl.formatMessage(u.renameSnackbarProgressMessage),!1,e),_t=e=>a.Snackbar$1.complete(l.intl.formatMessage(u.renameSnackbarSuccessMessage),e),pt=(e,t,i)=>a.Snackbar$1.fail(d.renameError(e.error),i);var gt=Object.freeze({__proto__:null,renameCompleteSnackBar:_t,renameFailedSnackBar:pt,renameSnackBarInProgress:ut});const ft=e=>{let t=e,i=!1;const a=e.split("_");a.length>1&&(t=a[0],i=!0);const n=parseInt(t,10);return isNaN(n)?null:{bandwidth:n,ignoreVideoPlayerSize:i}},mt=()=>({enable_fullscreen:!0,keyboard_shortcuts:!0,titlebar_logo_config:{show_logo:!0,base_url:"www.dropbox.com"},preview_types:{[a.PreviewType.SsrDoc]:Object.assign({},u.DEFAULT_CONFIG.preview_types[a.PreviewType.SsrDoc])},initial_video_bandwidth:ft(a.fileViewerFeatureExperiments.initialVideoBandwidth),previews_exp_video_buffer_more_before_play:a.fileViewerFeatureExperiments.previewsExpVideoBufferMoreBeforePlay,previews_exp_enable_mux_data:a.fileViewerFeatureExperiments.previewsExpEnableMuxData,previews_exp_audio_trimming_str:a.fileViewerFeatureExperiments.previewsExpAudioTrimmingStr,pdf_editing_unfurl_actions:a.fileViewerFeatureExperiments.pdfEditingUnfurlActions,previews_exp_visual_refresh:"ON",idx_ai_control_center:a.fileViewerFeatureExperiments.idxAiControlCenter,send_and_track_previews_exp:a.fileViewerFeatureExperiments.sendAndTrackPreviewsExp,previews_exp_logged_out_audio_video_editing:a.fileViewerFeatureExperiments.previewsExpLoggedOutAudioVideoEditing,previews_exp_slow_connection_banner_str:a.fileViewerFeatureExperiments.previewsExpSlowConnectionBannerStr,can_access_docsend_hub:a.fileViewerFeatureExperiments.canAccessDocsendHub,can_try_docsend_hub:a.fileViewerFeatureExperiments.canTryDocsendHub,docsend_hub_trial_implicit:a.fileViewerFeatureExperiments.docsendHubTrialImplicit,sharing_receiver_quick_react:a.fileViewerFeatureExperiments.sharingReceiverQuickReact,send_and_track_file_name_targeting:a.fileViewerFeatureExperiments.sendAndTrackFileNameTargeting,google_editor_deprecation_date:a.fileViewerFeatureExperiments.googleEditorDeprecationDate,google_editor_disabled_by_deprecation_date:a.fileViewerFeatureExperiments.googleEditorDisabledByDeprecationDate,file_viewer_translation_variant:a.fileViewerFeatureExperiments.fileViewerTranslationVariant,pass_transmitter_token_prefetch:a.fileViewerFeatureExperiments.passTransmitterTokenPrefetch,vish_oob_download_prompt_variant:a.fileViewerFeatureExperiments.vishOobDownloadPromptVariant,previews_exp_img_size_optimization_variant:a.fileViewerFeatureExperiments.previewsExpImgSizeOptimizationVariant,previews_pass_facepile_prefetch:a.fileViewerFeatureExperiments.previewsPassFacepilePrefetch,previews_exp_remove_skeleton:a.fileViewerFeatureExperiments.previewsExpRemoveSkeleton,vish_copy_link_file_preview:a.fileViewerFeatureExperiments.vishCopyLinkFilePreview,previews_image_enhancements_upscale:a.fileViewerFeatureExperiments.previewsImageEnhancementsUpscale,previews_image_enhancements_color_correct:a.fileViewerFeatureExperiments.previewsImageEnhancementsColorCorrect,previews_image_enhancements_auto_straighten:a.fileViewerFeatureExperiments.previewsImageEnhancementsAutoStraighten,previews_image_enhancements_filter:a.fileViewerFeatureExperiments.previewsImageEnhancementsFilter,intelligence_april_2024_holdout_control:a.fileViewerFeatureExperiments.intelligenceApril2024HoldoutControl,previews_exp_prefetch_full_img:a.fileViewerFeatureExperiments.previewsExpPrefetchFullImg,previews_exp_ungate_image_edit:a.fileViewerFeatureExperiments.previewsExpUngateImageEdit,previews_exp_ungate_pdf_edit:a.fileViewerFeatureExperiments.previewsExpUngatePdfEdit,previews_video_enhancements:a.fileViewerFeatureExperiments.previewsVideoEnhancements,previews_video_enhancements_upscale:a.fileViewerFeatureExperiments.previewsVideoEnhancementsUpscale,previews_video_enhancements_speech:a.fileViewerFeatureExperiments.previewsVideoEnhancementsSpeech,previews_mobile_web_redesign:a.fileViewerFeatureExperiments.previewsMobileWebRedesign,acq_vish_voyager_susi_variant:a.fileViewerFeatureExperiments.acqVishVoyagerSusiVariant,previews_link_warning_modal:a.fileViewerFeatureExperiments.previewsLinkWarningModal,file_viewer_remove_selection_clear:a.fileViewerFeatureExperiments.fileViewerRemoveSelectionClear,comments_2024_open_sidebar_if_unread:a.fileViewerFeatureExperiments.comments2024OpenSidebarIfUnread,comments_2024_q2_revamp:a.fileViewerFeatureExperiments.comments2024Q2Revamp}),ht=(t,i)=>r=>n.__awaiter(void 0,void 0,void 0,(function*(){const{Store:n,ungatedDBStore:o}=yield new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.idx_db_access_lib_esnext})),s=yield o.getLatestUngatedSessionKeyForStore(t===a.PreviewType.SsrDoc?n.PDF_EDIT_STORE:n.IMG_EDIT_STORE);if(s){const e=yield o.getFileMetadata(s);r===a.Mode.REGISTER&&(yield o.saveFileMetadata(s,Object.assign(Object.assign({},e),{user_registered:"true"})))}i?a.redirect(i):a.reload()})),vt={[a.AuthMode.LOGIN]:a.Mode.LOGIN,[a.AuthMode.REGISTER]:a.Mode.REGISTER},St={[a.LoginOrRegisterKind.COMMENT]:a.LoginOrRegisterKind$1.COMMENT,[a.LoginOrRegisterKind.DOWNLOAD]:a.LoginOrRegisterKind$1.DOWNLOAD,[a.LoginOrRegisterKind.IMMEDIATE]:a.LoginOrRegisterKind$1.IMMEDIATE,[a.LoginOrRegisterKind.POSTDOWNLOAD]:a.LoginOrRegisterKind$1.POSTDOWNLOAD,[a.LoginOrRegisterKind.POSTSAVEAS]:a.LoginOrRegisterKind$1.POSTSAVEAS,[a.LoginOrRegisterKind.SIDEBAR]:a.LoginOrRegisterKind$1.SIDEBAR,[a.LoginOrRegisterKind.UNGATED_AI]:a.LoginOrRegisterKind$1.UNGATED_AI,[a.LoginOrRegisterKind.LOGGED_OUT_EDIT]:a.LoginOrRegisterKind$1.LOGGED_OUT_EDIT,[a.LoginOrRegisterKind.SHARED_LINK_UNGATED_EDIT]:a.LoginOrRegisterKind$1.SHARED_LINK_UNGATED_EDIT,[a.LoginOrRegisterKind.TRANSCRIPT]:a.LoginOrRegisterKind$1.TRANSCRIPT,[a.LoginOrRegisterKind.LOGGED_OUT_PDF_EDIT]:a.LoginOrRegisterKind$1.LOGGED_OUT_PDF_EDIT,[a.LoginOrRegisterKind.LOGGED_OUT_PDF_SIGN]:a.LoginOrRegisterKind$1.LOGGED_OUT_PDF_SIGN,[a.LoginOrRegisterKind.SURFACE_LEVEL_PREVIEW]:a.LoginOrRegisterKind$1.SURFACE_LEVEL_PREVIEW,[a.LoginOrRegisterKind.LOGGED_OUT_PDF_EDIT_TEXT]:a.LoginOrRegisterKind$1.LOGGED_OUT_PDF_EDIT_TEXT},Et={[a.CommentTextVariant.DEFAULT]:a.CommentTextVariant$1.DEFAULT,[a.CommentTextVariant.POST]:a.CommentTextVariant$1.POST,[a.CommentTextVariant.SUBSCRIBE]:a.CommentTextVariant$1.SUBSCRIBE,[a.CommentTextVariant.QUICK_REACT]:a.CommentTextVariant$1.QUICK_REACT};function wt(t,i,r,o,s=!1,l){return n.__awaiter(this,void 0,void 0,(function*(){let n=!1;if(l[0].modalPositionValues){const[{GSIEventManager:t}]=yield Promise.all([new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.lib_esnext}))]);n=!t.getGSIState().isPromptClosed}t&&!i&&r&&o&&!a.isModalDisplayed()&&s&&!n&&bt(...l)}))}function bt({mode:t,kind:i,sharedLinkUrl:r,encryptionOptions:o,commentParams:s,loggingExtra:l,webSignInTag:c,signupTag:d,implicitTOSVariant:u,onCancel:_,authDialogPreviousElement:p,modalPositionValues:g,previewType:f,sharedLinkInfo:m}){return n.__awaiter(this,void 0,void 0,(function*(){const[{Modal:n},{LoginOrRegisterModal:h}]=yield Promise.all([new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.modal_esnext})),new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.modal_esnext$1}))]),v=r;let S=r;const E=St[i]===a.LoginOrRegisterKind$1.SHARED_LINK_UNGATED_EDIT&&f?ht(f,r):void 0;if(S){const e=new URL(S);e.searchParams.set("from_auth","register"),S=e.href}if(g){const[{GSIEventManager:t,GSIEvent:i}]=yield Promise.all([new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.lib_esnext}))]);if(!t.getGSIState().isPromptClosed)return;sessionStorage.setItem("has_seen_sls","true"),t.createGSIEventListener(i.PROMPT_OPEN,(()=>{a.logSurfaceLevelSusiAction("implicit_close"),n.close()}))}n.showInstance(te.default.createElement(h,{downloadAction:null,id:"shared-link-immediate-signup-modal",initialMode:vt[t],kind:St[i],onCancel:()=>{null==_||_(),n.close()},onAuthenticateSuccess:(e,t)=>{if(E)E(t);else if(t===a.Mode.REGISTER){const e=new URL(window.location.href);return e.searchParams.set("from_auth","register"),void window.location.assign(e.href)}window.location.reload()},commentParams:s?{stream:s.stream,variant:Et[s.variant]}:void 0,signup_tag:d||a.RegistrationSource.SHMODEL_MODAL_REGISTER,showGoogleRegistration:!0,loginContinuationUrl:v,registrationContinuationUrl:S,encryptionOptions:o,loggingExtra:l,implicitTOSVariant:u||"V1",isUnifiedSusi:!0,webSignInTag:c,authDialogPreviousElement:p,vishVoyagerSusiVariant:mt().acq_vish_voyager_susi_variant,sharedLinkInfo:m,modalPositionValues:g}),!g)}))}var yt=Object.freeze({__proto__:null,showAuthModal:bt,showSurfaceLevelAuthModalFilePreview:wt});const Tt=a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{SaveFileModal:t}=yield new Promise((function(t,i){e(["./c_portable_save_as_copy_save_modal"],t,i)}));return{default:t}})))),It=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(Tt,Object.assign({},e)));It.displayName="AsyncSaveFileModal";const Ct=({shareToken:e,user:t,file:i},{onSuccess:r,onError:o,onNetworkRequest:s,onModalClose:l},c,d,u)=>{const p=a.parseLink(i.href);let g={};if(t&&(g={is_email_verified:t.is_email_verified}),a.logEvent$2(a.TiburonEventName.SaveToDropbox,i.file_id,void 0,null==t?void 0:t.id,p,null!=d?d:a.SHARE_ACTION_ORIGIN_TYPE.SHARING_PREVIEW_PAGE,g),a.isSharedFile(i)&&!c)a.showCopyToDropboxSaveAsModal({shareToken:e,copyable:i,user:t,origin:d,acqVishOobFileAutoSaveOnSignupVariant:u});else{const c=()=>n.__awaiter(void 0,void 0,void 0,(function*(){var n;try{null==s||s();const n=yield a.copySharedFile(e,t.id);a.logEvent$2(a.TiburonEventName.SaveToDropboxConfirm,i.file_id,void 0,null==t?void 0:t.id,p,null!=d?d:a.SHARE_ACTION_ORIGIN_TYPE.SHARING_PREVIEW_PAGE),null==r||r(),a.redirect(n)}catch(e){a.logEvent$2(a.TiburonEventName.SaveToDropboxFailed,i.file_id,void 0,null==t?void 0:t.id,p,null!=d?d:a.SHARE_ACTION_ORIGIN_TYPE.SHARING_PREVIEW_PAGE);const r=e instanceof _.ApiError?{isError:!0,error:e.error,error_summary:null!==(n=e.summary)&&void 0!==n?n:"unknown"}:a.createUndefinedRpcResult();null==o||o(r)}}));f={user:t,onConfirm:c,onCancel:()=>{a.logEvent$2(a.TiburonEventName.SaveToDropboxCancel,i.file_id,void 0,null==t?void 0:t.id,p,null!=d?d:a.SHARE_ACTION_ORIGIN_TYPE.SHARING_PREVIEW_PAGE),null==l||l()},fileName:a.getFilename(i)},a.Modal$1.showInstance(te.default.createElement(It,Object.assign({},f)))}var f},At=e=>a.Snackbar$1.sync(l.intl.formatMessage({id:"Adz4fH",defaultMessage:"Saving to your personal Dropbox..."}),!1,e);function Mt(e,t,i,n,r,o,s,l,c){if(n)if(t("save_to_dropbox"),i)Ct({file:e,user:i,shareToken:n},{onNetworkRequest:()=>{At(a.PREVIEWS_SNACKBAR_ID),t("save_to_dropbox_approve")},onModalClose:()=>{t("save_to_dropbox_cancel")}},s);else{const e=new URL(window.location.href);e.searchParams.set("copy_to_dropbox","true"),window.history.replaceState(e.href,"",e.href),bt({mode:a.AuthMode.REGISTER,sharedLinkUrl:e.href,kind:a.LoginOrRegisterKind.DOWNLOAD,encryptionOptions:r,loggingExtra:{signup_source:"save_to_dropbox"},signupTag:o,webSignInTag:l,authDialogPreviousElement:a.AuthDialogPreviousElementTag.COPY_TO_DROPBOX,sharedLinkInfo:c})}}function Ot(t,i,n,r,o,s,l,c){if(Pt(a.TiburonEventName.ClickDownload,t,null==i?void 0:i.id),Dt()&&!i)return Rt(t,n);const d="has_seen_download_signup_modal";if(r===a.LoginOrRegisterKind$1.DOWNLOAD&&!a.LocalStorage.get(d)&&(i||!c)){const t=(e,t)=>{if(a.LocalStorage.set(d,!0),t===a.Mode.REGISTER){const e=new URL(window.location.href);return e.searchParams.set("from_auth","register"),void window.location.assign(e.href)}},i=()=>{a.LocalStorage.set(d,!0)};return void new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.modal_esnext$1})).then((({LoginOrRegisterModal:e})=>{a.Modal$1.showInstance(te.default.createElement(e,{downloadAction:a.DownloadAction.DIRECT_DOWNLOAD,id:"shared-link-download-signup-modal",initialMode:a.Mode.REGISTER,kind:r,onAuthenticateSuccess:t,onCancel:i,signup_tag:"shmodel_download_register",encryptionOptions:n,loggingExtra:{source:"download_button"},isUnifiedSusi:!0,webSignInTag:l,authDialogPreviousElement:a.AuthDialogPreviousElementTag.DOWNLOAD}))}))}xt(t,i);const u=(e,t,i,n,r,s,l,c)=>{bt({mode:t,kind:a.LoginOrRegisterKind.DOWNLOAD,encryptionOptions:r,loggingExtra:{signup_source:"post_download_modal"},webSignInTag:l,authDialogPreviousElement:c}),null==o||o(t===a.AuthMode.LOGIN?"post_download_signin_modal_login":"post_download_signin_modal_register","post_download_signin_modal")};i||a.showPostDownloadSignInModal({encryptionOptions:n,logUserAction:o,isFolder:!1,shareToken:s,linkUrl:t.href,handleClick:u})}const Pt=(e,t,i)=>{if(a.isSharedFile(t)){const n=a.parseLink(t.href);a.logEvent$2(e,t.file_id,void 0,i,n,a.SHARE_ACTION_ORIGIN_TYPE.SHARING_PREVIEW_PAGE)}},xt=(e,t,i)=>{const n={onAttempt:()=>{var n;Pt(a.TiburonEventName.DownloadAttempt,e,null==t?void 0:t.id),null===(n=null==i?void 0:i.onAttempt)||void 0===n||n.call(i)},onSuccess:()=>{var n;Pt(a.TiburonEventName.DownloadSuccess,e,null==t?void 0:t.id),null===(n=null==i?void 0:i.onSuccess)||void 0===n||n.call(i)},onError:()=>{var n;Pt(a.TiburonEventName.DownloadFail,e,null==t?void 0:t.id),null===(n=null==i?void 0:i.onError)||void 0===n||n.call(i)}};p.downloadSingleFile({href:e.href,source:"PREVIEWS",isFswm:a.isSharedFile(e),user:t,fileEncryptionInfo:a.getFileEncryptionInfo(e)},n)},Dt=()=>["V1","V2"].includes(a.fileViewerFeatureExperiments.vishOobDownloadPromptVariant)&&!c.is_mobile_or_tablet(),Rt=(t,i)=>{Promise.all([new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.modal_esnext$1})),new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.google_one_tap_platform_esnext})),new Promise((function(t,i){e(["./c_features_download_index"],t,i)}))]).then((([{LoginOrRegisterModal:e},{GoogleOneTapPlatform:n},{PreDownloadSUSIModalFooter:r}])=>{Pt(a.TiburonEventName.ViewSUSIDownloadModal,t);const o=window.location.href,s=new URL(o);s.searchParams.set("download","true");const l=new URL(s);l.searchParams.set("from_auth","register");const c=new URL(s);c.searchParams.set("from_auth","login"),n.updateLoginContUrl(c.href);a.Modal$1.showInstance(te.default.createElement(e,{downloadAction:a.DownloadAction.DIRECT_DOWNLOAD,isFolderAction:!1,id:"shared-link-download-signup-modal",initialMode:a.Mode.REGISTER,kind:a.LoginOrRegisterKind$1.DOWNLOAD_PROMPT,signup_tag:a.RegistrationSource.PREVIEW_DOWNLOAD_PROMPT,encryptionOptions:i,loggingExtra:{source:"download_button"},isUnifiedSusi:!0,webSignInTag:a.RegistrationSource.PREVIEW_DOWNLOAD_PROMPT,customFooterContent:()=>te.default.createElement(r,{onContinue:()=>{n.updateLoginContUrl(o),Pt(a.TiburonEventName.ContinueWithDownloadOnly,t),a.Modal$1.close();Nt(t,!1)}}),onCancel:()=>{n.updateLoginContUrl(o),Pt(a.TiburonEventName.CloseSUSIDownloadModal,t)},loginContinuationUrl:c.href,registrationContinuationUrl:l.href,postUpsellRedirectUrl:l.href,canRedirect:!0,authDialogPreviousElement:a.AuthDialogPreviousElementTag.DOWNLOAD}))}))},Nt=(e,t=!1,i)=>{t&&i?kt(e,i):Lt(),xt(e,i)},kt=(t,i)=>{new Promise((function(t,i){e(["./c_features_download_index"],t,i)})).then((({PostSignupDownloadModal:e})=>{Pt(a.TiburonEventName.ViewPostSignupDownloadModal,t,i.id);const n="post-signup-download-modal";a.Modal$1.showInstance(te.default.createElement(e,{open:!0,onClose:()=>{Pt(a.TiburonEventName.ClosePostSignupDownloadModal,t,i.id),a.Modal$1.close(void 0,n)}}),void 0,n)}))},Lt=()=>{a.Snackbar$1.show(te.default.createElement(a.Snackbar$1,{id:"post-download-snackbar",title:l.intl.formatMessage({id:"0EIDZ+",defaultMessage:"Your download should start soon. If it doesn’t, go back to try again."}),closeButtonText:l.intl.formatMessage({id:"RfGyPH",defaultMessage:"Close"})}))};var Ft=Object.freeze({__proto__:null,downloadActiveFile:Ot,initiateDownload:xt,logSharingTiburonEvent:Pt,postAuthSuccessAndDownload:Nt,saveToDropbox:Mt});function Ut(e,t,{allowCopyToDropbox:i,shareToken:n,encryptionOptions:r,sharePermission:o,authModalKind:s,webSignInTag:l}){return{copyToDropbox:!i||o&&!a.isDownloadAllowed(o)?()=>{}:({logModalConfirm:i,logModalCancel:a})=>{const{file:o}=t();Mt(o,(e=>{"save_to_dropbox_approve"===e?i():"save_to_dropbox_cancel"===e&&a()}),e,n,r,void 0,void 0,l)},downloadFile:()=>{const{file:i}=t();Ot(i,e,r,s,void 0,n)}}}let Vt;function jt(){(function(){const e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement})()||(null==Vt||Vt(),Kt())}function Bt(){null==Vt||Vt(),Wt()}function Ht(){var e;e=jt,document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e),function(e){window.addEventListener("popstate",e)}(Bt)}function Kt(){var e;e=jt,document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e),function(e){window.removeEventListener("popstate",e)}(Bt),Vt=()=>{}}function zt({onExitFunction:e}){!function(e){Vt=e}(e),function(){const e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}(),Ht()}function Wt(){Kt(),function(){const e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}()}function Gt(e){return{enterFullScreen:(t,i)=>{i||zt({onExitFunction:t}),e&&e(!0)},exitFullScreen:t=>{t||Wt(),null==e||e(!1)}}}function qt(){return{print:(e,t)=>{var i;t===a.PreviewType.SsrDoc?(i=e,g.safe_open_tab_and_redirect(i)):t===a.PreviewType.Image&&function(e){const t=window.open("about:blank");if(!t)throw new Error(l.intl.formatMessage({id:"X9xK6f",defaultMessage:"Could not open new window"}));window.setTimeout((()=>{const i=t.document.createElement("style");i.innerHTML="\n      @page { margin: 0;}\n      img { max-width: 100%; max-height: 100%}\n    ",t.document.head.appendChild(i);const a=t.document.createElement("img");a.src=e,a.onload=()=>{t.print()},a.onerror=()=>{t.close()},t.document.body.appendChild(a)}),50)}(e)}}}function Qt(e){return!(e&&e.canPrintRoles&&0===e.canPrintRoles.length)}function Yt(e,t,i,a,n){return{closeViewer:e?()=>{e()}:void 0,flipToNextFile:t,showAuthModal:a,flipToPreviousFile:i,openUrl:n}}function $t(e,t,i,a,n){return{closeViewer:e?()=>{e()}:void 0,flipToNextFile:t,flipToPreviousFile:i,updateFiles:a?()=>a():void 0,openUrl:n}}function Zt(e,t,i,a){return{closeViewer:e?()=>{e()}:void 0,flipToNextFile:t,flipToPreviousFile:i,openUrl:a}}function Xt(e,t,i,a){return{closeViewer:e?()=>{e()}:void 0,flipToNextFile:t,flipToPreviousFile:i,openUrl:a}}var Jt;function ei(e){return{getQueryStringParameter(e){const t=a.get_uri().getQuery();return e in t?t[e]:null},getAllQueryStringParameters:()=>a.DBHistory.get_uri().getQuery(),setQueryStringParameter(e,t){const i=a.DBHistory.get_uri();null!==t?i.updateQuery(e,t):i.removeQuery(e),a.DBHistory.push_state(i.getPath(),i.getQuery())},onQueryStringParameterChange(e,t){const i=`/${a.get_uri().getPath().split("/")[1]}`,n=(i,a)=>{let n=null;if(e in a){const t=a[e];n=t instanceof Array?t.length?t[0]:null:null!=t?t:null}t(e,n)};return a.DBHistory.add_callback(i,n,!0),()=>a.DBHistory.remove_callback(i,n)},openFile(t,i){if(i){const i=a.preview_uri_for_fq_path(e,t);a.replace_location(i)}else{const i=a.get_browse_root(e)+r.URI.encode_parts(t);a.replace_location(i)}},redirect(e,t){t?g.safe_open_tab_and_redirect(e):g.redirect(e)},reload(){a.reload()},replaceState(e){const t=a.DBHistory.get_uri();a.DBHistory.replace_state(t.getPath(),e)}}}t.VideoPreviewEvent=void 0,(Jt=t.VideoPreviewEvent||(t.VideoPreviewEvent={})).PlayerRendered="player_rendered",Jt.FirstClickPlay="first_click_play",Jt.MediaError="media_error",Jt.ChangePlaybackRate="change_playback_rate",Jt.ChangeVideoQuality="change_video_quality",Jt.ClosePreview="close_preview",Jt.TimeToBuffer="time_to_buffer",Jt.TimeToLoad="time_to_load",Jt.SeekVideo="seek_video",Jt.VideoStartsPlaying="video_starts_playing",Jt.VideoResumesPlaying="video_resumes_playing",Jt.VideoStalled="video_stalled",Jt.VideoStalledResume="video_stalled_resume",Jt.VideoPaused="video_paused",Jt.ScrubberThumbnailsLoaded="scrubber_thumbnails_loaded",Jt.ScrubberThumbnailsFailed="scrubber_thumbnails_failed",Jt.HoverScrubberThumbnailsSucceeded="hover_scrubber_thumbnails_succeeded",Jt.HoverScrubberThumbnailsFailed="hover_scrubber_thumbnails_failed",Jt.AudioWaveformLoaded="audio_waveform_loaded",Jt.AudioWaveformFailed="audio_waveform_failed",Jt.MediaEnded="media_ended",Jt.VideoPlaybackSmoothness="video_playback_smoothness",Jt.SlowConnectionBannerShown="slow_connection_banner_shown",Jt.VideoMetadataLoaded="video_metadata_loaded",Jt.TimeToFirstFrame="time_to_first_frame",Jt.StallsPerSecondOfPlayback="num_stalls_per_second_playback",Jt.TotalStallDurationOverTotalPlaybackDuration="total_stall_duration_over_total_playback_duration",Jt.DroppedVideoFrames="dropped_video_frames",Jt.VideoProgress2Percent="video_progress_2_percent",Jt.VideoProgress1Second="video_progress_1_second",Jt.DroppedVideoFramesOverTotalVideoFrames="dropped_video_frames_over_total_video_frames",Jt.NetworkBandwidthBytesPerSecond="network_bandwidth_bytes_per_second",Jt.PlayDurationMs="play_duration_ms",Jt.HasMultipleAudioTracks="has_multiple_audio_tracks";a.injectInternalStyle("/static/metaserver/static/js/cloud_docs/shared_components/radio_button_group.module.out-vflT9d06w.css",(e=>"._radioButtonGroupRow_1qd9u_1{align-items:flex-start;display:flex;margin-top:var(--spacing__unit--1)}._radioButtonGroupRow_1qd9u_1:first-child{margin-top:0}._rowLabelContainer_1qd9u_11{display:flex;flex-direction:column}._radioButtonGroupRow_1qd9u_1>*+*{margin-left:var(--spacing__base_unit)}"));const ti="_radioButtonGroupRow_1qd9u_1",ii="_rowLabelContainer_1qd9u_11",ai=({checked:e,disabled:t,id:i,labelText:n,helperText:r,onChange:o})=>te.default.createElement("span",{className:ti},te.default.createElement(a.RadioButton,{id:i,checked:e,onChange:o,disabled:t}),te.default.createElement("span",{className:ii},te.default.createElement(a.Text,{tagName:"label",htmlFor:i},n),r&&te.default.createElement(a.Text,{color:"faint"},r)));ai.displayName="RadioButtonGroup";const ni="https://help.dropbox.com/integrations/move-google-docs#FAQ";var ri,oi,si;!function(e){e.CUSTOMERS_NEW="customers_new",e.CUSTOMERS_LT_90="customers_lt_90",e.CUSTOMERS_GT_90="customers_gt_90",e.CUSTOMERS_LARGE="customers_large",e.UNKNOWN="unknown"}(ri||(ri={})),ri.CUSTOMERS_NEW,ri.CUSTOMERS_GT_90,ri.CUSTOMERS_LT_90,ri.CUSTOMERS_LARGE,function(e){e.SHORTCUT="shortcut",e.MS="ms"}(oi||(oi={})),function(e){e.INTRO="intro",e.LINK_GOOGLE="link_google",e.CONVERT_TO_MS="convert_to_ms",e.MOVE_TO_GDRIVE="move_to_gdrive"}(si||(si={}));const li="google-editor-debprecation-conversion-snackbar",ci=new o.UserApiV2Client,di=({filename:e,fileId:t,userId:i})=>n.__awaiter(void 0,void 0,void 0,(function*(){const n=l.intl.formatMessage({id:"yhOO6u",defaultMessage:"Converting {filename} to shortcut."},{filename:e});a.Snackbar$1.sync(n,!0,li);try{const e=yield f.GetCloudDocsRoutes(ci).rpc("convert_to_web_shortcut",{dest_service:{".tag":"gdrive"},src_files:[t],keep_original_file:!1,preserve_existing_shortcut:!0,copy_permissions:!0},{subjectUserId:i});a.Snackbar$1.close(li),a.unsafeRedirect(e.shortcuts[0].url)}catch(t){const i=l.intl.formatMessage({id:"mqKIea",defaultMessage:"{filename} couldn’t be converted to a shortcut."},{filename:e});a.Snackbar$1.failSticky(te.default.createElement(te.default.Fragment,null,i," ",te.default.createElement(a.Button,{variant:"transparent",onClick:()=>a.open_tab(ni)},m.Strings.LEARN_MORE)),li)}})),ui=({user:e,filename:t,fileId:r})=>{const[o,s]=i.useState(si.INTRO),[c,d]=i.useState(oi.SHORTCUT),u=i.useCallback((()=>n.__awaiter(void 0,void 0,void 0,(function*(){a.Modal$1.close(),(yield m.ensureUserHasLinkedAccountAndReport(e))&&di({filename:t,fileId:r,userId:e.id})}))),[r,t,e]),_=i.useCallback((()=>n.__awaiter(void 0,void 0,void 0,(function*(){a.Modal$1.close(),di({filename:t,fileId:r,userId:e.id})}))),[r,t,e]),p=i.useCallback((()=>n.__awaiter(void 0,void 0,void 0,(function*(){a.Modal$1.close(),(({filename:e,fileId:t,user:i})=>{n.__awaiter(void 0,void 0,void 0,(function*(){const n=l.intl.formatMessage({id:"a6cpRH",defaultMessage:"Converting {filename} to a Microsoft Office file."},{filename:e});a.Snackbar$1.sync(n,!0,li);try{const e=yield f.GetCloudDocsRoutes(ci).rpc("convert_gdd_to_ms_office_file",{src_files:[t],keep_original_file:!1,preserve_existing_ms_file:!0,copy_permissions:!0},{subjectUserId:i.id}),n=a.preview_uri_for_fq_path(i,e.converted_files[0].dest_file_path);a.Snackbar$1.close(li),a.redirect(n)}catch(t){const i=l.intl.formatMessage({id:"/vGAyz",defaultMessage:"{filename} couldn’t be converted to a Microsoft Office file."},{filename:e});a.Snackbar$1.failSticky(i,li)}}))})({filename:t,fileId:r,user:e})}))),[r,t,e]),g=()=>{a.open_tab(ni)},h=()=>{a.Modal$1.close()},v=i.useMemo((()=>{switch(o){case si.INTRO:return(({isMigrateToGoogle:e,isConvertToMS:t,onCancel:i,onNext:n,onLearnMore:r,onCheckMigrateToGoogle:o,onCheckConvertToMS:s})=>({title:l.intl.formatMessage({id:"nS9yEk",defaultMessage:"Google Files moved to Google Drive"}),bodyText:te.default.createElement(te.default.Fragment,null,te.default.createElement(a.Text,{tagName:"p"},l.intl.formatMessage({id:"Nisn5H",defaultMessage:"Google files can only be accessed through shortcuts now. You’ll need to take an action below in order to continue working with this Google file."})),te.default.createElement("br",null),te.default.createElement("div",{role:"group"},te.default.createElement(ai,{checked:e,id:"continue-google",labelText:l.intl.formatMessage({id:"g5tEWU",defaultMessage:"Move Google file to Google Drive"}),onChange:o,helperText:l.intl.formatMessage({id:"e+/SOB",defaultMessage:"Google files remain accessible in Dropbox with shortcuts. Link your Google account."})}),te.default.createElement(ai,{checked:t,id:"continue-microsoft",labelText:l.intl.formatMessage({id:"tGba49",defaultMessage:"Convert Google file to a Microsoft Office file"}),onChange:s,helperText:l.intl.formatMessage({id:"0x0shG",defaultMessage:"No action is needed from you - we’ll take care of it."})}))),tertiaryActions:te.default.createElement(te.default.Fragment,null,te.default.createElement(a.Button,{variant:"opacity",onClick:i},m.Strings.CANCEL),te.default.createElement(a.Button,{variant:"primary",onClick:n},m.Strings.NEXT)),actions:te.default.createElement(a.Button,{variant:"transparent",onClick:r},m.Strings.LEARN_MORE),withCloseButton:m.Strings.CLOSE,width:"standard"}))({isMigrateToGoogle:c===oi.SHORTCUT,isConvertToMS:c===oi.MS,onCheckMigrateToGoogle:()=>d(oi.SHORTCUT),onCheckConvertToMS:()=>d(oi.MS),onNext:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return c===oi.SHORTCUT?(yield(e=>n.__awaiter(void 0,void 0,void 0,(function*(){const t=e.email;return(yield m.fetchUserHasGddMigrationCompatibleLink(e,t))!==m.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK})))(e))?s(si.LINK_GOOGLE):s(si.MOVE_TO_GDRIVE):c===oi.MS?s(si.CONVERT_TO_MS):void a.Snackbar$1.warn(l.intl.formatMessage({id:"4mgrUH",defaultMessage:"Please choose a valid conversion option"}))})),onCancel:h,onLearnMore:g});case si.LINK_GOOGLE:return(({onLinkAccount:e,onBack:t})=>({title:l.intl.formatMessage({id:"2PB7hS",defaultMessage:"Link Google account"}),bodyText:te.default.createElement(a.Text,{tagName:"p"},l.intl.formatMessage({id:"/3eiFM",defaultMessage:"You’ll be asked to sign in and link your Google account to this Dropbox account. Select the Google profile for this Dropbox account, and we’ll convert this file to a shortcut."})),tertiaryActions:te.default.createElement(te.default.Fragment,null,te.default.createElement(a.Button,{variant:"opacity",onClick:t},m.Strings.BACK),te.default.createElement(a.Button,{variant:"primary",onClick:e},m.Strings.LINK_ACCOUNT)),withCloseButton:m.Strings.CLOSE,width:"standard"}))({onLinkAccount:u,onBack:()=>s(si.INTRO)});case si.MOVE_TO_GDRIVE:return(({onFinish:e,onBack:t})=>({title:l.intl.formatMessage({id:"1Umkwt",defaultMessage:"Move Google file to Google Drive with shortcut"}),bodyText:te.default.createElement(a.Text,{tagName:"p"},l.intl.formatMessage({id:"t+J+97",defaultMessage:"We’ll move this file to your linked Google Drive account and the shortcut to this file will be created in Dropbox."})),tertiaryActions:te.default.createElement(te.default.Fragment,null,te.default.createElement(a.Button,{variant:"opacity",onClick:t},m.Strings.BACK),te.default.createElement(a.Button,{variant:"primary",onClick:e},m.Strings.FINISH)),withCloseButton:m.Strings.CLOSE,width:"standard"}))({onFinish:_,onBack:()=>s(si.INTRO)});case si.CONVERT_TO_MS:return(({onFinish:e,onBack:t})=>({title:l.intl.formatMessage({id:"o/uBJm",defaultMessage:"Convert Google file to Microsoft Office file"}),bodyText:te.default.createElement(a.Text,{tagName:"p"},l.intl.formatMessage({id:"MnuG2v",defaultMessage:"We’ll convert this file to the most suitable Microsoft Office file."})),tertiaryActions:te.default.createElement(te.default.Fragment,null,te.default.createElement(a.Button,{variant:"opacity",onClick:t},m.Strings.BACK),te.default.createElement(a.Button,{variant:"primary",onClick:e},m.Strings.FINISH)),withCloseButton:m.Strings.CLOSE,width:"standard"}))({onFinish:p,onBack:()=>s(si.INTRO)})}}),[o,c,u,_,p,e]);return te.default.createElement(m.ModalTemplate,Object.assign({open:!0},v,{onRequestClose:h}))};ui.displayName="ConversionModalController";function _i(t,i,n,r){const o=i();return{triggerDynamicRoutingModalCheck:()=>{o.file.file_id&&!function(e){return(null==e?void 0:e.linkType)===a.SharedLinkType.Shmodel}(n)&&((...t)=>{new Promise((function(t,i){e(["./c_cloud_docs_shared_components_routing"],t,i)})).then((({maybeShowDynamicRoutingModal:e})=>e(...t)))})(t,o.file,a.getExtension$1(o.file),r)},openGdssFileConversionModal:()=>{const{file:e}=o;var i;i={user:t,fileId:o.file.file_id,filename:a.filename(a.isSharedFile(e)?e.filename:e.fq_path)},a.Modal$1.showInstance(te.default.createElement(ui,Object.assign({},i)))}}}function pi(e){return e?a.getFileTypeFromString(e):void 0}function gi(e){switch(e){case a.PreviewType.Image:case a.PreviewType.Doc:case a.PreviewType.Video:case a.PreviewType.Audio:case a.PreviewType.Archive:case a.PreviewType.CloudDoc:case a.PreviewType.Linkfile:case a.PreviewType.Error:case a.PreviewType.Excel:case a.PreviewType.HTML:return e;case a.PreviewType.SsrDoc:case a.PreviewType.Text:return"doc";case a.PreviewType.RawHTML:return"html";case a.PreviewType.Photo:return"image";default:return}}function fi(e){switch(e){case"added":case"viewed":case"moved":case"renamed":case"edited":case"shared":case"commented":return e;default:return}}function mi(e){switch(e){case"start":case"success":case"failed":case"canceled":case"rejected":return e;default:return}}const hi={[a.SDKPreviewSurface.INBAND_SHARE]:"shared_link_in_band",[a.SDKPreviewSurface.SHARED_CONTENT_LINK]:"shared_link_out_of_band",[a.SDKPreviewSurface.SHARED_LINK]:"shared_link_out_of_band",[a.SDKPreviewSurface.BROWSE]:"browse",[a.SDKPreviewSurface.SEARCH]:"search",[a.SDKPreviewSurface.SHARED_LINK_EMBED]:"shared_link_embed",[a.SDKPreviewSurface.VERSION_HISTORY]:"version_history",[a.SDKPreviewSurface.HOME]:"home",[a.SDKPreviewSurface.HELLOSIGN]:"hellosign",[a.SDKPreviewSurface.RECENTS]:"recents",[a.SDKPreviewSurface.STARRED]:"starred",[a.SDKPreviewSurface.STANDALONE_PREVIEW]:"standalone_preview",[a.SDKPreviewSurface.PHOTOS]:"photos",[a.SDKPreviewSurface.SHARED_COLLECTION]:"shared_collection",[a.SDKPreviewSurface.TRANSFER]:"transfer",[a.SDKPreviewSurface.FILE_LOCKING]:"file_locking",[a.SDKPreviewSurface.BACKUP]:"backup",[a.SDKPreviewSurface.UNKNOWN]:"unknown_surface",[a.SDKPreviewSurface.VIDEO_SYNTHESIS]:"video_synthesis",[a.SDKPreviewSurface.VIDEO_HOME]:"video_home",[a.SDKPreviewSurface.QUICK_VIEW_BROWSE]:"quick_view_browse",[a.SDKPreviewSurface.QUICK_VIEW_SEARCH]:"quick_view_search",[a.SDKPreviewSurface.DESKTOP_PREVIEW]:"desktop_preview",[a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW]:"fss_desktop_preview",[a.SDKPreviewSurface.POLLUX_DESKTOP_PREVIEW]:"pollux_desktop_preview"};function vi(e){return{class:"previews",action:"save",object:"edit_mode",properties:e}}var Si;function Ei(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_ask",properties:e}}function wi(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_summarize",properties:e}}t.WorkflowsEvent=void 0,(Si=t.WorkflowsEvent||(t.WorkflowsEvent={})).WatermarkApplySaveAsCopy="watermark_apply_save_as_copy",Si.WatermarkStart="watermark_start",Si.WatermarkSuccess="watermark_success",Si.WatermarkFailed="watermark_failed",Si.WatermarkCancel="watermark_cancel",Si.WatermarkAddImage="watermark_add_image",Si.WatermarkRotate="watermark_rotate",Si.WatermarkUpdatePosition="watermark_update_position",Si.WatermarkUpdateColor="watermark_update_color";const bi=["left","right","horizontal","vertical"];function yi(e){return bi.find((t=>t===(null==e?void 0:e.toLowerCase())))}const Ti=["save_copy_error","replace_original_error","file_load_error","too_large","too_long","too_short","over_4k","unsupported_extension","unsupported_codec"];function Ii(e){return Ti.find((t=>t===(null==e?void 0:e.toLowerCase())))}const Ci=["rotate","flip","crop","trim","adjust","draw","highlight","add_text"];function Ai(e){return Ci.find((t=>t===(null==e?void 0:e.toLowerCase())))}function Mi(e){return{class:"file_actions",action:"download",object:"file",properties:e}}function Oi(e){return{class:"navigation",action:"navigate_to",object:"docsend",properties:e}}function Pi(e){return{class:"previews",action:"cancel",object:"edit_mode",properties:e}}function xi(e){return{class:"previews",action:"edit",object:"watermark",properties:e}}function Di(e){return{class:"previews",action:"eng",object:"editing_error",properties:e}}function Ri(e){return{class:"previews",action:"next",object:"file",properties:e}}function Ni(e){return{class:"previews",action:"previous",object:"file",properties:e}}function ki(e){return{class:"previews",action:"rename",object:"file",properties:e}}function Li(e){return{class:"previews",action:"select",object:"preview_action",properties:e}}function Fi(e){return{class:"previews",action:"watermark",object:"file",properties:e}}function Ui(e){return{class:"navigation",action:"select",object:"edit_action",properties:e}}var Vi,ji;function Bi(e){return{class:"previews",action:"select",object:"logged_out_image_edit",properties:e}}t.OpenButtonAction=void 0,(Vi=t.OpenButtonAction||(t.OpenButtonAction={}))[Vi.DOWNLOAD=0]="DOWNLOAD",Vi[Vi.UNITY_FILE=1]="UNITY_FILE",Vi[Vi.UNITY_FOLDER=2]="UNITY_FOLDER",Vi[Vi.OPEN_WITH=3]="OPEN_WITH",Vi[Vi.APP_ACTION=5]="APP_ACTION",Vi[Vi.PREPARE_FOR_SIGNATURE=6]="PREPARE_FOR_SIGNATURE",Vi[Vi.SHARE_TO_SLACK=7]="SHARE_TO_SLACK",Vi[Vi.PRESENT_IN_ZOOM=8]="PRESENT_IN_ZOOM",Vi[Vi.SHARE_TO_TRELLO=9]="SHARE_TO_TRELLO",Vi[Vi.INVITE_VIA_EMAIL=10]="INVITE_VIA_EMAIL",Vi[Vi.OPEN_WITH_CLOUD_DOC=11]="OPEN_WITH_CLOUD_DOC",Vi[Vi.OPEN_MORE_APPS=12]="OPEN_MORE_APPS",Vi[Vi.OPEN_ADD_APPS=13]="OPEN_ADD_APPS",Vi[Vi.DECOMPRESS_FILE=14]="DECOMPRESS_FILE",Vi[Vi.PREVIEW_FILE=15]="PREVIEW_FILE",Vi[Vi.TRANSFER=16]="TRANSFER",Vi[Vi.OPEN_IN_DESKTOP=17]="OPEN_IN_DESKTOP",Vi[Vi.GO_TO_FOLDER=18]="GO_TO_FOLDER",Vi[Vi.OPEN_IN_REPLAY=19]="OPEN_IN_REPLAY",Vi[Vi.OPEN_IN_NEW_TAB=20]="OPEN_IN_NEW_TAB",Vi[Vi.CONVERT_AND_SHARE=24]="CONVERT_AND_SHARE",Vi[Vi.SELL_WITH_SHOP=25]="SELL_WITH_SHOP",Vi[Vi.SHARE_WITH_COLLECTION=26]="SHARE_WITH_COLLECTION",Vi[Vi.CREATE_CLIENT_PORTAL=21]="CREATE_CLIENT_PORTAL",Vi[Vi.EDIT_CLIENT_PORTAL=22]="EDIT_CLIENT_PORTAL",Vi[Vi.SHARE_WITH_ANALYTICS=23]="SHARE_WITH_ANALYTICS",Vi[Vi.PUBLISH_TO_SOCIAL=24]="PUBLISH_TO_SOCIAL",Vi[Vi.CREATE_QR_CODE=25]="CREATE_QR_CODE",Vi[Vi.SEND_FOR_REVIEW=26]="SEND_FOR_REVIEW",Vi[Vi.QUICK_VIEW=27]="QUICK_VIEW",t.OpenInUserAction=void 0,(ji=t.OpenInUserAction||(t.OpenInUserAction={})).OpenWithCloudDocEditor="open_with_cloud_doc_editor",ji.OpenInOfficeOnline="open_in_office_online",ji.OpenInReplay="open_in_replay",ji.ShareToAction="share_to_action",ji.SendForSignatureAction="send_for_signature",ji.ShareWithAnalytics="share_with_analytics",ji.OpenMoreApps="open_more_apps",ji.OpenAddApps="open_add_apps",ji.CreateQrCode="create_qr_code",ji.PublishToSocial="publish_to_social",ji.InviteViaEmail="invite_via_email",ji.ShareWithCollection="share_with_collection",ji.Transfer="transfer",ji.OpenInDesktop="open_in_desktop",ji.OpenInNewTab="open_in_new_tab",ji.PreviewFile="preview_file",ji.GoToFolder="go_to_folder",ji.OpenWithAppAction="open_with_app_action",ji.OpenInUnity="open_in_unity",ji.OpenInUnityFolder="open_in_unity_folder",ji.Download="download",ji.SendForReview="send_for_review",ji.QuickView="quick_view";const Hi=["zoom_in","zoom_out"];function Ki(e){return Hi.find((t=>t===(null==e?void 0:e.toLowerCase())))}function zi(e){return{class:"pdf_edit",action:"select",object:"save_a_copy",properties:e}}function Wi(e){return{class:"pdf_edit",action:"select",object:"replace_original",properties:e}}function Gi(e){return{class:"previews",action:"start",object:"edit_mode",properties:e}}const qi=["dropbox_sign_home_screen","dropbox_core_signature_screen","dropbox_sign_edit","dropbox_sign_recipient_email_input","docsend_content_screen","docsend_create_link_screen","capture_home_screen","screen_recording_modal","replay_home_screen","replay_preview","pdf_edit","video_edit","image_edit","pdf_edit_signature_box","ml_video_editor","watermark","dropbox_screen","backup_screen","transfer_screen","paper_screen","password_screen","dash_screen","app_center_screen","file_requests","gmail","outlook","whatsapp","facebook_workplace","line_works","dropbox_transfer","canvas","user_created_app","sign_deep_integration","browse_screen","shared_screen","deleted_files","photos_screen","third_party_app","transfer_modal","desktop_preview","web_preview","desktop_folder","text_edit","self_sign","quick_view","docsend_marketing_page","docsend_trial_start_modal","docsend_upload_modal","docsend_trial_modal","sign_home","sign_modal","sign_banner","sign_global","docsend_standalone","desktop_file","connect_more_apps","connect_apps"];function Qi(e){return qi.find((t=>t===(null==e?void 0:e.toLowerCase())))}const Yi=["start","success","failed","canceled","rejected"];function $i(e){return{class:"previews",action:"create",object:"folder",properties:e}}function Zi(e){return{class:"previews",action:"preview",object:"audio_video_scrubber_thumbnails",properties:e}}function Xi(e,t){if(!e||!e.content)return t?u.resolvePreviewTypeFromExtension(u.getFileExtension(t)):a.PreviewType.Error;switch(e.content[".tag"]){case"archive":return a.PreviewType.Archive;case"audio":return a.PreviewType.Audio;case"cloud_doc":return a.PreviewType.CloudDoc;case"excel":return a.PreviewType.Excel;case"html":return a.PreviewType.HTML;case"image":return a.PreviewType.Image;case"linkfile":return a.PreviewType.Linkfile;case"raw_html":return a.PreviewType.RawHTML;case"restricted":return a.PreviewType.Restricted;case"ssr_doc":return a.PreviewType.SsrDoc;case"video":return a.PreviewType.Video;default:return a.PreviewType.Other}}const Ji=(e,t,i,n)=>{var r,o;const s=Xi(e,t),l=u.getFileExtension(t);let c;return e&&"error"in e&&(null===(r=e.error)||void 0===r?void 0:r.type)===u.FVErrorCode.FileEncrypted?c=e.error:l?e&&("error"in e&&void 0!==e.error||"previewType"in e&&e.previewType===a.PreviewType.Error)?c=null!==(o=e.error)&&void 0!==o?o:new u.FVError(u.FVErrorCode.Unknown,u.ErrorLifecycle.Support,"Unknown error occurred"):(()=>{var e;if(navigator.onLine)return!0;const t=navigator;return(null===(e=t.connection)||void 0===e?void 0:e.rtt)&&t.connection.rtt>0})()?u.DEFAULT_SUPPORTED_PREVIEW_TYPES.includes(s)?n&&t&&i&&!u.fileSizeSupported(t,i,s,n)?c=new u.FVError(u.FVErrorCode.FileTooLarge,u.ErrorLifecycle.Support,"Unsupported file size"):e?void 0!==t&&void 0!==i||(c=new u.FVError(u.FVErrorCode.InvalidFileInfo,u.ErrorLifecycle.Support,"Missing data")):c=new u.FVError(u.FVErrorCode.MissingContentMetadata,u.ErrorLifecycle.Support,"Missing data"):c=new u.FVError(u.FVErrorCode.UnsupportedPreviewType,u.ErrorLifecycle.Support,"Unsupported preview type"):c=new u.FVError(u.FVErrorCode.UserOffline,u.ErrorLifecycle.Support,"There is a network connectivity issue"):c=new u.FVError(u.FVErrorCode.NoExtension,u.ErrorLifecycle.Support,"Missing file extension"),Object.assign(Object.assign({},e),{previewType:c?a.PreviewType.Error:s,error:c})},ea=(e,t)=>{var i;let a;const n=null!==(i=null==e?void 0:e.url)&&void 0!==i?i:null==t?void 0:t.url;return a=n?{url:n,file_id:null==e?void 0:e.file_id}:(null==e?void 0:e.ns_id)&&void 0!==e.sj_id?{ns_id:e.ns_id,sj_id:e.sj_id,file_id:e.file_id}:{file_id:null==e?void 0:e.file_id},a},ta=(e,t)=>({ns_id:null==e?void 0:e.ns_id,sj_id:null==e?void 0:e.sj_id,file_id:null==e?void 0:e.file_id,url:(null==e?void 0:e.url)||(null==t?void 0:t.url)}),ia=e=>["custom","previews:get_preview_data_batch",{files:[ea(e,void 0)],include_dimensions:!0}],aa=(e,t)=>["custom","previews:get_archive_files",{root_file_info:e,subpaths:t,subpath_sizes:void 0}];function na(e){return{class:"previews",action:"comment",object:"file",properties:e}}function ra(e){return{class:"previews",action:"comment",object:"comment",properties:e}}function oa(e){return{class:"previews",action:"select",object:"comments_sticker_pane",properties:e}}function sa(e){return{class:"previews",action:"select",object:"comments_mentions_pane",properties:e}}const la=["newest","oldest","unread","timestamp","page"];function ca(e){return{class:"previews",action:"select",object:"comment_action",properties:e}}var da;!function(e){e.ADD_COMMENT="add_comment",e.POST_COMMENT="post_comment",e.DELETE_COMMENT="delete_comment",e.REPLY_COMMENT="reply_comment",e.EDIT_COMMENT="edit_comment",e.START_EDIT_COMMENT="start_edit_comment",e.RESOLVE_COMMENT="resolve_comment",e.UNRESOLVE_COMMENT="unresolve_comment",e.SUBSCRIBE_COMMENTS="subscribe_comments",e.UNSUBSCRIBE_COMMENTS="unsubscribe_comments",e.DISABLE_COMMENTS="disable_comments",e.ENABLE_COMMENTS="enable_comments",e.SHOW_RESOLVED_COMMENTS="show_resolved_comments",e.HIDE_RESOLVED_COMMENTS="hide_resolved_comments",e.SORT_COMMENTS="sort_comments",e.ENABLE_CONTINUOUS_ANNOTATIONS="enable_continuous_annotations",e.DISABLE_CONTINUOUS_ANNOTATIONS="disable_continuous_annotations",e.ENABLE_CONTINUOUS_COMMENTING="enable_continuous_commenting",e.DISABLE_CONTINUOUS_COMMENTING="disable_continuous_commenting",e.ADD_COMMENT_START="add_comment_start",e.ADD_COMMENT_CANCEL="add_comment_cancel",e.REPLY_COMMENT_START="reply_comment_start",e.REPLY_COMMENT_CANCEL="reply_comment_cancel",e.MARK_THREAD_READ="mark_thread_read",e.MARK_THREAD_UNREAD="mark_thread_unread",e.START_ANNOTATION_RECT="start_annotation_rect",e.COMMENT_ON_A_SECTION="comment_on_a_section",e.START_ANNOTATION_TIMESTAMP="start_annotation_timestamp",e.START_ANNOTATION_HIGHLIGHT="start_annotation_highlight",e.STICKER_START="sticker_start",e.ADD_EMOJI="add_emoji",e.STICKER_SUCCESS="sticker_success",e.STICKER_CANCELED="sticker_canceled",e.TAG_SOMEONE="tag_someone",e.MENTION_START="mention_start",e.MENTION_SUCCESS="mention_success",e.MENTION_CANCELED="mention_canceled",e.SAVE_EDIT_COMMENT="save_edit_comment",e.CANCEL_COMMENT="cancel_comment",e.VIEW_COMMENTS="view_comments"}(da||(da={}));const ua="preview",_a=(e,i,r)=>n.__awaiter(void 0,void 0,void 0,(function*(){const o={previewType:Xi(r.file.preview,a.getFilename(r.file)),previousSurface:hi[r.previewSurface],file:r.file};"background"===e?((e,t)=>{n.__awaiter(void 0,void 0,void 0,(function*(){const{file:i,previewType:n}=t,{event:r,context:o}=e.extra,s={fileType:pi(i?a.getExtension$1(i):void 0),fileSize:null==i?void 0:i.bytes,actionElement:o,actionSurface:"video_edit",previewType:gi(n)};switch(r){case a.BackgroundEvent.EditVideoSaveSucceeded:a.UDCL.logEnd(vi(Object.assign(Object.assign({},s),{eventState:"success"})));break;case a.BackgroundEvent.EditVideoSaveFailed:a.UDCL.logEnd(vi(Object.assign(Object.assign({},s),{eventState:"failed"})))}}))})(i,o):"user_action"===e?(((e,i)=>{n.__awaiter(void 0,void 0,void 0,(function*(){var n,r,o;const{previousSurface:s,file:l,previewType:c}=i,u=e.action,_=e.context,g=a.getExtension$1(l),f={fileType:a.getFileTypeFromString(g),fileSize:l.bytes,previewType:c?gi(c):void 0,actionElement:null!==(n=e.context)&&void 0!==n?n:a.UserActionContext.PreviewTitlebar,actionSurface:null!==(r=e.actionSurface)&&void 0!==r?r:"previews",previousSurface:s,editorSessionId:null!==(o=e.editorSessionId)&&void 0!==o?o:""};switch(u){case a.UserAction.EditError:a.UDCL.logEvent(Di(Object.assign(Object.assign({},f),{editorErrorType:Ii(e.errorType)})));break;case a.UserAction.EditCancel:a.UDCL.logEvent(Pi(Object.assign(Object.assign({},f),{eventState:(h=e.eventState,Yi.find((e=>e===(null==h?void 0:h.toLowerCase())))),haveChanges:"true"===e.haveChanges||"false"!==e.haveChanges&&void 0})));break;case a.UserAction.EditFailure:a.UDCL.logEnd(vi(Object.assign({eventState:"failed"},f)));break;case a.UserAction.EditSuccess:a.UDCL.logEnd(vi(Object.assign({eventState:"success"},f)));break;case a.UserAction.EditSaveCopyCancel:a.UDCL.logEnd(vi(Object.assign(Object.assign({eventState:"canceled"},f),{actionElement:"save_a_copy"})));break;case a.UserAction.EditReplaceOriginalCancel:a.UDCL.logEnd(vi(Object.assign(Object.assign({eventState:"canceled"},f),{actionElement:"replace_original"})));break;case a.UserAction.EditReplaceOriginalClicked:a.UDCL.logStart(vi(Object.assign(Object.assign({eventState:"start"},f),{actionElement:"replace_original"})));break;case a.UserAction.EditSaveCopyClicked:a.UDCL.logStart(vi(Object.assign(Object.assign({eventState:"start"},f),{actionElement:"save_a_copy"})));break;case a.UserAction.EditImageAttempt:a.UDCL.logEvent(m.PAP_NavigateTo_Edit(Object.assign(Object.assign({},f),{direction:yi(e.direction),entryAction:Ai(e.entryAction),destinationSurface:"image_edit",actionElement:a.maybeMapToPreviewTitlebar(_)})));break;case a.UserAction.FlipNext:case a.UserAction.FlipPrevious:const i=a.UserAction.FlipNext?Ri:Ni;a.UDCL.logEvent(i({eventState:"start",actionScreen:"keyboard"===e.context?e.context:s,fileSize:null==l?void 0:l.bytes,fileType:pi(g)})),a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u})));break;case a.UserAction.EditPdf:case a.UserAction.Draw:case a.UserAction.Highlight:case a.UserAction.AddText:a.UDCL.logEvent(m.PAP_NavigateTo_Edit({destinationSurface:"pdf_edit",actionElement:a.maybeMapToPreviewTitlebar(_),previewType:gi(c),fileType:pi(g),fileSize:null==l?void 0:l.bytes,actionSurface:"previews",entryAction:(()=>{switch(u){case a.UserAction.Draw:case a.UserAction.Highlight:case a.UserAction.AddText:return u;default:return}})()})),a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u})));break;case a.UserAction.OpenIn:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u,destinationSurface:Qi(e.destination_surface)})));break;case a.UserAction.ShareToAction:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u,destinationSurface:"third_party_app",appId:e.appId})));break;case a.UserAction.SendForSignature:a.UDCL.logEvent(p.PAP_NavigateTo_Sign(Object.assign(Object.assign({},f),{destinationSurface:"dropbox_sign_edit",actionElement:a.maybeMapToPreviewTitlebar(_)}))),a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u})));break;case a.UserAction.ZoomIn:case a.UserAction.ZoomOut:a.UDCL.logEvent({class:"previews",action:"zoom",object:"file",properties:Object.assign(Object.assign({},f),{eventState:"success",actionSurface:s,actionScreen:e.context,zoomType:Ki(e.action)})}),a.UDCL.logEvent(Li(Object.assign(Object.assign({},f),{previewAction:u})));break;case a.UserAction.OpenDocSidebar:a.UDCL.logEvent({class:"previews",action:"open",object:"sidebar",properties:{eventState:"success",actionScreen:e.context,fileSize:null==l?void 0:l.bytes,fileType:pi(g)}});break;case a.UserAction.CloseDocSidebar:a.UDCL.logEvent(function(e){return{class:"previews",action:"close",object:"sidebar",properties:e}}({eventState:"success",actionScreen:e.context,fileSize:null==l?void 0:l.bytes,fileType:pi(g)}));break;case a.UserAction.FindInDocStart:a.UDCL.logEvent(function(e){return{class:"previews",action:"open",object:"search_box",properties:e}}({eventState:"start",actionScreen:e.context,fileSize:null==l?void 0:l.bytes,fileType:pi(g)}));break;case a.UserAction.DownloadStart:a.UDCL.logStart(Mi(Object.assign(Object.assign({},f),{eventState:"start",actionSurface:s,actionElement:_})));break;case a.UserAction.DownloadFailed:a.UDCL.logEnd(Mi(Object.assign(Object.assign({},f),{eventState:"failed",actionSurface:s})));break;case a.UserAction.DownloadSuccess:a.UDCL.logEnd(Mi(Object.assign(Object.assign({},f),{eventState:"success",actionSurface:s})));break;case a.UserAction.OpenInMenu:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:a.UserAction.OpenIn})));break;case a.UserAction.OpenSendForSignature:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"add_signatures_menu",properties:e}}(f));break;case a.UserAction.OpenActionBarOverflow:a.UDCL.logEvent(function(e){return{class:"navigation",action:"select",object:"action_bar_overflow_menu",properties:e}}({actionSurface:s}));break;case a.UserAction.DeleteStart:a.UDCL.logStart(d.PAP_Delete_File(Object.assign(Object.assign({},f),{eventState:"start",actionSurface:s})));break;case a.UserAction.DeleteSuccess:a.UDCL.logEnd(d.PAP_Delete_File(Object.assign(Object.assign({},f),{eventState:"success",actionSurface:s})));break;case a.UserAction.DeleteFailed:case a.UserAction.DeleteFailedNoPermission:a.UDCL.logEnd(d.PAP_Delete_File(Object.assign(Object.assign({},f),{eventState:"failed",actionSurface:s})));break;case a.UserAction.DeleteCancel:a.UDCL.logEnd(d.PAP_Delete_File(Object.assign(Object.assign({},f),{eventState:"canceled",actionSurface:s})));break;case a.UserAction.RenameStart:a.UDCL.logStart(ki(Object.assign(Object.assign({},f),{eventState:"start",actionSurface:s})));break;case a.UserAction.RenameFailed:a.UDCL.logEnd(ki(Object.assign(Object.assign({},f),{eventState:"failed",actionSurface:s})));break;case a.UserAction.RenameSuccess:a.UDCL.logEnd(ki(Object.assign(Object.assign({},f),{eventState:"success",actionSurface:s})));break;case a.UserAction.SelectSaveAs:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u,conversionType:e.conversion_type.toLowerCase()})));break;case a.UserAction.GoToFolder:a.UDCL.logEvent(function(e){return{class:"previews",action:"open",object:"folder",properties:e}}({actionScreen:s}));break;case t.WorkflowsEvent.WatermarkStart:a.UDCL.logStart(Fi({eventState:"start",actionScreen:_,fileSize:null==l?void 0:l.bytes,fileType:pi(g)}));break;case t.WorkflowsEvent.WatermarkSuccess:a.UDCL.logEnd(Fi({eventState:"success",fileSize:null==l?void 0:l.bytes,fileType:pi(g)}));break;case t.WorkflowsEvent.WatermarkFailed:a.UDCL.logEnd(Fi({eventState:"failed",fileSize:null==l?void 0:l.bytes,fileType:pi(g)}));break;case t.WorkflowsEvent.WatermarkCancel:a.UDCL.logEnd(Fi({eventState:"canceled",fileSize:null==l?void 0:l.bytes,fileType:pi(g)}));break;case t.WorkflowsEvent.WatermarkRotate:a.UDCL.logEvent(xi({actionElement:"rotate"}));break;case t.WorkflowsEvent.WatermarkAddImage:a.UDCL.logEvent(xi({actionElement:"add_image"}));break;case t.WorkflowsEvent.WatermarkUpdatePosition:a.UDCL.logEvent(xi({actionElement:"update_position"}));break;case t.WorkflowsEvent.WatermarkUpdateColor:a.UDCL.logEvent(xi({actionElement:"update_color"}));break;case a.UserAction.SelectSidebarPage:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"doc_page",properties:e}}({actionScreen:_,fileSize:null==l?void 0:l.bytes,fileType:pi(g)}));break;case a.UserAction.OpenFileMenu:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"file_menu",properties:e}}(Object.assign(Object.assign({},f),{actionSurface:"preview"})));break;case a.UserAction.OpenEditMenu:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"edit_menu",properties:e}}(Object.assign(Object.assign({},f),{actionSurface:"preview"})));break;case a.UserAction.OpenViewMenu:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"view_menu",properties:e}}(Object.assign(Object.assign({},f),{actionSurface:"preview"})));break;case a.UserAction.OpenHelpMenu:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"help_menu",properties:e}}(Object.assign(Object.assign({},f),{actionSurface:"preview"})));break;case a.UserAction.AddToCollection:a.UDCL.logEvent(function(e){return{class:"previews",action:"add",object:"file_new_collection",properties:e}}(Object.assign(Object.assign({},f),{eventState:"start",actionSurface:"preview"})));break;case a.UserAction.OpenWithImageEditor:a.UDCL.logEvent(m.PAP_NavigateTo_Edit({destinationSurface:"image_edit",actionElement:_,previewType:gi(c),fileType:pi(g),fileSize:null==l?void 0:l.bytes,actionSurface:"previews"}));break;case a.UserAction.AdjustTrim:case a.UserAction.AdjustCrop:a.UDCL.logEvent(Ui(Object.assign({editAction:u},f)));break;case a.UserAction.Move:case a.UserAction.Copy:case a.UserAction.Delete:case a.UserAction.Rename:case a.UserAction.Star:case a.UserAction.Unstar:case a.UserAction.Info:case a.UserAction.VersionHistory:case a.UserAction.FileActivity:case a.UserAction.Print:case a.UserAction.SaveToDropbox:case a.UserAction.OpenMoreApps:case a.UserAction.Comment:case a.UserAction.Download:case a.UserAction.CopyLink:case a.UserAction.Share:case a.UserAction.ShareMenu:case a.UserAction.SendACopy:case a.UserAction.ShareWithAnalytics:case a.UserAction.PrivacyLegal:case a.UserAction.CookieCCPA:case a.UserAction.ReportIssue:case a.UserAction.HelpAndResources:case a.UserAction.HelpCenter:case a.UserAction.AddTag:case a.UserAction.RemoveTag:case a.UserAction.InfoHide:case a.UserAction.InfoShowMoreMetadata:case a.UserAction.InfoHideMoreMetadata:case a.UserAction.ShowComments:case a.UserAction.HideComments:case a.UserAction.TranscriptHide:case a.UserAction.TranscriptShow:case a.UserAction.TranscriptCopyAllClick:case a.UserAction.TranscriptCopySegmentClick:case a.UserAction.TranscriptSearchAttempt:case a.UserAction.TranscriptJumpToTimestamp:case a.UserAction.ExtractAll:case a.UserAction.Crop:case a.UserAction.Adjust:case a.UserAction.Trim:case a.UserAction.Upscale:case a.UserAction.ColorCorrect:case a.UserAction.Search:case a.UserAction.Cancel:case a.UserAction.ReportToDropbox:case a.UserAction.ShowLinkWarningModal:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u})));break;case a.UserAction.SelfSign:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u}))),a.UDCL.logEvent(p.PAP_NavigateTo_Sign(Object.assign(Object.assign({},f),{actionElement:a.maybeMapToPreviewTitlebar(_),destinationSurface:"self_sign"})));break;case a.UserAction.Watermark:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u}))),a.UDCL.logEvent(m.PAP_NavigateTo_Edit(Object.assign(Object.assign({},f),{actionElement:a.maybeMapToPreviewTitlebar(_),destinationSurface:"watermark"})));break;case a.UserAction.SendAndTrack:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u}))),a.UDCL.logEvent(Oi(Object.assign(Object.assign({},f),{actionElement:a.maybeMapToPreviewTitlebar(_),destinationSurface:"docsend_create_link_screen"})));break;case a.UserAction.ZoomFitToWidth:case a.UserAction.ZoomFitToPage:case a.UserAction.ZoomChangePercentage:case a.UserAction.HideTools:case a.UserAction.ShowTools:case a.UserAction.ToggleFullscreenOn:case a.UserAction.ToggleFullscreenOff:case a.UserAction.HidePageSelector:case a.UserAction.PageSelector:case a.UserAction.ChangeSpeed:a.UDCL.logEvent(Li(Object.assign(Object.assign({},f),{actionSurface:"previews",previewAction:u})));break;case a.UserAction.OpenActivityFilterMenu:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"activity_filter_menu",properties:e}}(Object.assign(Object.assign({},f),{actionElement:a.UserActionContext.PreviewSidebar})));break;case a.UserAction.AddActivityFilter:a.UDCL.logEvent(function(e){return{class:"previews",action:"add",object:"activity_filter",properties:e}}(Object.assign(Object.assign({},f),{actionElement:a.UserActionContext.PreviewSidebar,filterElement:fi(_)})));break;case a.UserAction.Filter:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u,filterType:e.filterType})));break;case a.UserAction.FilterSelectAll:case a.UserAction.FilterClearAll:case a.UserAction.FileActivityHide:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u})));break;case t.OpenInUserAction.InviteViaEmail:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"share_with_dropbox",properties:e}}(Object.assign(Object.assign({},f),{actionSurface:"preview"})));break;case t.OpenInUserAction.Transfer:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"send_a_copy",properties:e}}(Object.assign(Object.assign({},f),{actionSurface:"preview"}))),a.UDCL.logEvent(function(e){return{class:"navigation",action:"navigate_to",object:"transfer",properties:e}}(Object.assign(Object.assign({},f),{destinationSurface:"transfer_modal"})));break;case t.OpenInUserAction.ShareWithAnalytics:a.UDCL.logEvent(Oi(Object.assign(Object.assign({},f),{destinationSurface:"docsend_create_link_screen"}))),a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u})));break;case t.OpenInUserAction.SendForSignatureAction:a.UDCL.logEvent(p.PAP_NavigateTo_Sign(Object.assign(Object.assign({},f),{actionSurface:"preview",destinationSurface:"dropbox_sign_recipient_email_input"})));break;case a.UserAction.RotateLeft:case a.UserAction.RotateRight:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:a.UserAction.Rotate,direction:u===a.UserAction.RotateLeft?"left":"right"})));break;case a.UserAction.FlipHorizontal:case a.UserAction.FlipVertical:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:a.UserAction.Flip,direction:u===a.UserAction.FlipHorizontal?"horizontal":"vertical"})));break;case a.UserAction.SaveACopy:a.UDCL.logEvent(zi(Object.assign({},f)));break;case a.UserAction.ReplaceOriginal:a.UDCL.logEvent(Wi(Object.assign({},f)));break;case a.UserAction.EditStart:a.UDCL.logEvent(Gi(Object.assign(Object.assign({},f),{eventState:mi(null==e?void 0:e.eventState),actionElement:void 0})));break;case a.UserAction.DropboxAI:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai",properties:e}}(Object.assign(Object.assign({},f),{isSharedLinkPage:"true"===e.is_shared_link_page,isLoggedIn:"true"===e.is_logged_in,isBrowsePage:"true"===e.is_browse_page}))),a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:u,actionSource:"true"===e.is_browse_page?"browse":"previews"})));break;case a.UserAction.ShownDropboxAI:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"shown",object:"dropbox_ai",properties:e}}(Object.assign(Object.assign({},f),{isSharedLinkPage:"true"===e.is_shared_link_page,isLoggedIn:"true"===e.is_logged_in,isBrowsePage:"true"===e.is_browse_page})));break;case a.UserAction.CreateDropboxAIQuery:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"create",object:"dropbox_ai_query",properties:e}}(Object.assign({},f)));break;case a.UserAction.SelectDropboxAIFeedback:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_feedback",properties:e}}(Object.assign(Object.assign({},f),{dropboxAiHelpful:"true"===e.is_helpful})));break;case a.UserAction.SelectDropboxAIShowSources:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_show_sources",properties:e}}(f));break;case a.UserAction.SelectDropboxAIConsentAllow:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_consent_modal_allow",properties:e}}(f));break;case a.UserAction.SelectDropboxAIConsentCancel:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_consent_modal_cancel",properties:e}}(f));break;case a.UserAction.ShownDropboxAIConsentModal:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"shown",object:"dropbox_ai_consent_modal",properties:e}}(f));break;case a.UserAction.SelectDropboxAIHideSources:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_hide_sources",properties:e}}(f));break;case a.UserAction.SelectDropboxAISummarizeStart:a.UDCL.logStart(wi(Object.assign(Object.assign({},f),{eventState:"start",isSharedLinkPage:"true"===e.is_shared_link_page,isLoggedIn:"true"===e.is_logged_in,isBrowsePage:"true"===e.is_browse_page})));break;case a.UserAction.SelectDropboxAISummarizeSuccess:a.UDCL.logEnd(wi(Object.assign(Object.assign({},f),{eventState:"success",isSharedLinkPage:"true"===e.is_shared_link_page,isLoggedIn:"true"===e.is_logged_in,isBrowsePage:"true"===e.is_browse_page})));break;case a.UserAction.SelectDropboxAIHelpCenter:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_help_center",properties:e}}(f));break;case a.UserAction.SelectDropboxAIGiveFeedback:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_give_feedback",properties:e}}(f));break;case a.UserAction.SelectDropboxAIAskStart:a.UDCL.logStart(Ei(Object.assign(Object.assign({},f),{eventState:"start",isSharedLinkPage:"true"===e.is_shared_link_page,isLoggedIn:"true"===e.is_logged_in,isBrowsePage:"true"===e.is_browse_page})));break;case a.UserAction.SelectDropboxAIAskSuccess:a.UDCL.logEnd(Ei(Object.assign(Object.assign({},f),{eventState:"success",isSharedLinkPage:"true"===e.is_shared_link_page,isLoggedIn:"true"===e.is_logged_in,isBrowsePage:"true"===e.is_browse_page})));break;case a.UserAction.SelectDropboxAIPageNavigation:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_page_navigation",properties:e}}(f));break;case a.UserAction.SelectDropboxAIVideoSeek:a.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_video_seek",properties:e}}(f));break;case a.UserAction.LoggedOutRotateLeft:case a.UserAction.LoggedOutRotateRight:a.UDCL.logEvent(Bi(Object.assign(Object.assign({},f),{entryAction:"rotate"})));break;case a.UserAction.LoggedOutFlipHorizontal:case a.UserAction.LoggedOutFlipVertical:a.UDCL.logEvent(Bi(Object.assign(Object.assign({},f),{entryAction:"flip"})));break;case a.UserAction.LoggedOutCrop:a.UDCL.logEvent(Bi(Object.assign(Object.assign({},f),{entryAction:"crop"})));break;case a.UserAction.LoggedOutAdjust:a.UDCL.logEvent(Bi(Object.assign(Object.assign({},f),{entryAction:"adjust"})));break;case a.UserAction.LoggedOutEditImageAttempt:a.UDCL.logEvent(Bi(f));break;case a.UserAction.LoggedOutEditPdfAttempt:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"logged_out_pdf_edit",properties:e}}(f));break;case a.UserAction.LoggedOutEditAudioVideoAttempt:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"logged_out_audio_video_edit",properties:e}}(Object.assign(Object.assign({},f),{entryAction:Ai(e.initialAction)})));break;case a.UserAction.Continue:a.UDCL.logEvent(S.PAP_Select_ContentAction(Object.assign(Object.assign({},f),{contentAction:a.UserAction.Continue,dontAskAgainChecked:"true"===e.dontAskAgainChecked})))}var h}))})(i.extra,o),((e,t)=>{n.__awaiter(void 0,void 0,void 0,(function*(){var i;const{previousSurface:n,file:r,previewType:o}=t,s=e.action,l=e.context,c=r?a.getExtension$1(r):void 0,d=null!=l?l:a.UserActionContext.PreviewToolbar,u={fileType:pi(c),fileSize:r.bytes,previewType:o?gi(o):void 0,actionSurface:null!==(i=e.actionSurface)&&void 0!==i?i:"video_edit",actionElement:d,previousSurface:n},_={actionElement:d,actionSurface:"previews",fileType:pi(c),fileSize:null==r?void 0:r.bytes,previewType:o?gi(o):void 0,previousSurface:n};function p(e){a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{eventState:e,previewAction:"closed_captioning_on"})))}function g(e){a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{eventState:e,previewAction:"closed_captioning_off"})))}switch(s){case a.UserAction.EditVideoAttempt:a.UDCL.logEvent(m.PAP_NavigateTo_Edit({actionElement:a.maybeMapToPreviewTitlebar(l),actionSurface:"previews",destinationSurface:"video_edit",direction:yi(e.direction),entryAction:Ai(e.entryAction),fileSize:null==r?void 0:r.bytes,fileType:pi(c),previewType:gi(o)}));break;case a.UserAction.EditVideoFailure:a.UDCL.logEvent(Di({fileType:pi(c),fileSize:r.bytes,previewType:o?gi(o):void 0,actionSurface:"video_edit",editorErrorType:Ii(e.reason),videoDuration:e.duration?Number.parseInt(e.duration,10):void 0}));break;case a.UserAction.EditVideoCancel:a.UDCL.logEvent(Pi({eventState:"canceled",actionSurface:"video_edit",fileSize:r.bytes,fileType:pi(c),haveChanges:"true"===e.have_changes}));break;case a.UserAction.EditVideoDiscardChangesCancel:a.UDCL.logEvent(Pi({eventState:"canceled",actionSurface:"video_edit",fileSize:r.bytes,fileType:pi(c)}));break;case a.UserAction.EditVideoDiscardChangesConfirmed:a.UDCL.logEvent(Pi({eventState:"success",actionSurface:"video_edit",fileSize:r.bytes,fileType:pi(c)}));break;case a.UserAction.EditVideoRedo:a.UDCL.logEvent({class:"previews",action:"redo",object:"edit_mode",properties:Object.assign(Object.assign({},u),{actionSurface:"video_edit"})});break;case a.UserAction.EditVideoUndo:a.UDCL.logEvent({class:"previews",action:"undo",object:"edit_mode",properties:Object.assign(Object.assign({},u),{actionSurface:"video_edit"})});break;case a.UserAction.EditVideoReplaceOriginalClicked:a.UDCL.logStart(vi({eventState:"start",fileSize:null==r?void 0:r.bytes,fileType:pi(c),actionElement:"replace_original",previewType:gi(o),actionSurface:"video_edit"}));break;case a.UserAction.EditVideoReplaceOriginalCancel:a.UDCL.logEnd(vi({eventState:"canceled",fileSize:null==r?void 0:r.bytes,fileType:pi(c),actionElement:"replace_original",previewType:gi(o),actionSurface:"video_edit"}));break;case a.UserAction.EditVideoSaveCopyClicked:a.UDCL.logStart(vi({eventState:"start",fileSize:null==r?void 0:r.bytes,fileType:pi(c),actionElement:"save_a_copy",previewType:gi(o),actionSurface:"video_edit"}));break;case a.UserAction.EditVideoSaveCopyCancel:a.UDCL.logEnd(vi({eventState:"canceled",fileSize:null==r?void 0:r.bytes,fileType:pi(c),actionElement:"save_a_copy",previewType:gi(o),actionSurface:"video_edit"}));break;case a.UserAction.EditVideoNewFolderAttempt:a.UDCL.logStart($i({eventState:"start",actionSurface:"video_edit",fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.EditVideoNewFolderCancel:a.UDCL.logEnd($i({eventState:"canceled",actionSurface:"video_edit",fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.EditVideoNewFolderSuccess:a.UDCL.logEnd($i({eventState:"success",actionSurface:"video_edit",fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.EditVideoNewFolderFailure:a.UDCL.logEnd($i({eventState:"failed",actionSurface:"video_edit",fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.ClosedCaptionsClick:"true"===e.cc_state_open?g("start"):p("start");break;case a.UserAction.ClosedCaptionsClickSuccess:"true"===e.new_cc_state_open?p("success"):g("success");break;case a.UserAction.AudioVideoSettingsMenuOpened:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_settings_menu",properties:e}}({actionScreen:l,fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.QualitySettingsSubmenuOpened:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_quality_menu",properties:e}}({actionScreen:l,fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.PlaybackRateSubmenuOpened:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_speed_menu",properties:e}}({actionScreen:l,fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.SetVolume:a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{previewAction:"volume_change"})));break;case a.UserAction.SetMuted:a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{previewAction:"mute"})));break;case a.UserAction.SetUnmuted:a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{previewAction:"unmute"})));break;case a.UserAction.AudioVideoSeeked:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_scrub",properties:e}}({eventState:"success",actionScreen:l,fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.AudioTrackChanged:a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{previewAction:"media_track_change"})));break;case a.UserAction.AudioTrackSubmenuOpened:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_track_menu",properties:e}}({actionScreen:n,fileSize:null==r?void 0:r.bytes,fileType:pi(c)}));break;case a.UserAction.ChangePlaybackPosition:switch(e.playback_control){case"forward":a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{previewAction:"skip_forward"})));break;case"backward":a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{previewAction:"skip_backward"})));break;case"select_next_frame":a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{previewAction:"skip_forward",skipDuration:0})));break;case"select_prev_frame":a.UDCL.logEvent(Li(Object.assign(Object.assign({},_),{previewAction:"skip_backward",skipDuration:0})))}}}))})(i.extra,o),(e=>{switch(e.action){case da.ADD_COMMENT_START:a.UDCL.logEvent(na({actionSurface:ua,eventState:"start"}));break;case da.ADD_COMMENT_CANCEL:a.UDCL.logEvent(na({actionSurface:ua,eventState:"canceled"}));break;case da.ADD_COMMENT:"true"===e.hasAnnotation?"true"===e.hasTimestampAnnotation?a.UDCL.logEvent({class:"previews",action:"comment",object:"file_timestamp",properties:{actionSurface:ua,eventState:"success",hasSticker:"true"===e.isSticker,hasTag:"true"===e.hasMention}}):a.UDCL.logEvent({class:"previews",action:"comment",object:"file_area",properties:{actionSurface:ua,eventState:"success",hasSticker:"true"===e.isSticker,hasTag:"true"===e.hasMention}}):(a.UDCL.logEvent(na({actionSurface:ua,eventState:"success",hasSticker:"true"===e.isSticker,hasTag:"true"===e.hasMention})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.POST_COMMENT,actionElement:"preview_sidebar"})));break;case da.REPLY_COMMENT_START:a.UDCL.logStart(ra({actionSurface:ua,eventState:"start",hasSticker:"true"===e.isSticker,hasTag:"true"===e.hasMention}));break;case da.REPLY_COMMENT_CANCEL:a.UDCL.logEnd(ra({actionSurface:ua,eventState:"canceled"}));break;case da.REPLY_COMMENT:a.UDCL.logEnd(ra({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.REPLY_COMMENT,actionElement:"preview_sidebar"}));break;case da.DELETE_COMMENT:a.UDCL.logEvent(function(e){return{class:"previews",action:"delete",object:"comment",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.DELETE_COMMENT,actionElement:"preview_sidebar"}));break;case da.EDIT_COMMENT:a.UDCL.logEvent(function(e){return{class:"previews",action:"edit",object:"comment",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.SAVE_EDIT_COMMENT,actionElement:"preview_sidebar"}));break;case da.START_EDIT_COMMENT:a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.EDIT_COMMENT,actionElement:"preview_sidebar"}));break;case da.RESOLVE_COMMENT:a.UDCL.logEvent(function(e){return{class:"previews",action:"resolve",object:"comment",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.RESOLVE_COMMENT,actionElement:"preview_sidebar"}));break;case da.ENABLE_COMMENTS:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_enable",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.ENABLE_COMMENTS,actionElement:"preview_sidebar"}));break;case da.DISABLE_COMMENTS:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_disable",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.DISABLE_COMMENTS,actionElement:"preview_sidebar"}));break;case da.ENABLE_CONTINUOUS_COMMENTING:a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.ENABLE_CONTINUOUS_COMMENTING,actionElement:"preview_sidebar"}));break;case da.DISABLE_CONTINUOUS_COMMENTING:a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.DISABLE_CONTINUOUS_COMMENTING,actionElement:"preview_sidebar"}));break;case da.SHOW_RESOLVED_COMMENTS:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_show_resolved",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.SHOW_RESOLVED_COMMENTS,actionElement:"preview_sidebar"}));break;case da.HIDE_RESOLVED_COMMENTS:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_hide_resolved",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.SHOW_RESOLVED_COMMENTS,actionElement:"preview_sidebar"}));break;case da.SUBSCRIBE_COMMENTS:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_subscribe",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.SUBSCRIBE_COMMENTS,actionElement:"preview_sidebar"}));break;case da.UNSUBSCRIBE_COMMENTS:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_unsubscribe",properties:e}}({actionSurface:ua,eventState:"success"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.UNSUBSCRIBE_COMMENTS,actionElement:"preview_sidebar"}));break;case da.SORT_COMMENTS:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_sort",properties:e}}({actionSurface:ua,commentsSortOrder:(t=e.sortType,la.find((e=>e===(null==t?void 0:t.toLowerCase()))))}));break;case da.MARK_THREAD_READ:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_mark_as_read",properties:e}}({actionSurface:ua}));break;case da.MARK_THREAD_UNREAD:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_mark_as_unread",properties:e}}({actionSurface:ua}));break;case da.START_ANNOTATION_RECT:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_annotation_rectangle",properties:e}}({actionSurface:ua})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.COMMENT_ON_A_SECTION,actionElement:"preview_sidebar"}));break;case da.START_ANNOTATION_TIMESTAMP:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_annotation_timestamp",properties:e}}({actionSurface:ua}));break;case da.START_ANNOTATION_HIGHLIGHT:a.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_annotation_highlight",properties:e}}({actionSurface:ua}));break;case da.STICKER_START:a.UDCL.logStart(oa({actionSurface:ua,eventState:"start"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.ADD_EMOJI,actionElement:"preview_sidebar"}));break;case da.ADD_EMOJI:a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.ADD_EMOJI,actionElement:"preview_sidebar"}));break;case da.STICKER_SUCCESS:a.UDCL.logEnd(oa({actionSurface:ua,eventState:"success"}));break;case da.STICKER_CANCELED:a.UDCL.logEnd(oa({actionSurface:ua,eventState:"canceled"}));break;case da.MENTION_START:a.UDCL.logStart(sa({actionSurface:ua,eventState:"start"})),a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.TAG_SOMEONE,actionElement:"preview_sidebar"}));break;case da.TAG_SOMEONE:a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.TAG_SOMEONE,actionElement:"preview_sidebar"}));break;case da.MENTION_SUCCESS:a.UDCL.logEnd(sa({actionSurface:ua,eventState:"success"}));break;case da.MENTION_CANCELED:a.UDCL.logEnd(sa({actionSurface:ua,eventState:"canceled"}));break;case da.CANCEL_COMMENT:a.UDCL.logEvent(ca({actionSurface:"previews",commentAction:da.CANCEL_COMMENT,actionElement:"preview_sidebar"}));break;case da.VIEW_COMMENTS:const i=a.getExtension$1({filename:e.filename,fq_path:e.fq_path});a.UDCL.logEvent(function(e){return{class:"previews",action:"view",object:"comments",properties:e}}({fileType:a.getFileTypeFromString(i),previewType:gi(e.previewType)}))}var t})(i.extra)):pa(e,o,i)})),pa=(e,t,i)=>n.__awaiter(void 0,void 0,void 0,(function*(){const{previousSurface:n,previewType:r,file:o}=t,s=a.getExtension$1(o);let l,c;switch(e){case a.SessionEventType.FilePreviewAttemptStarted:l="start";break;case a.SessionEventType.FilePreviewRenderSucceeded:l="success";break;case a.SessionEventType.FilePreviewSupportDenied:l="failed",c="unimplemented";break;case a.SessionEventType.FilePreviewDownloadFailed:l="failed",c="network_error";break;case a.SessionEventType.FilePreviewRenderFailed:l="failed",c="rendering_error";break;case a.SessionEventType.FilePreviewSessionEnded:switch(i.extra.last_event){case a.SessionEventType.FilePreviewSupportDenied:case a.SessionEventType.FilePreviewDownloadFailed:case a.SessionEventType.FilePreviewRenderFailed:case a.SessionEventType.FilePreviewRenderSucceeded:return;default:l="canceled"}break;default:return}const d=i.extra.page_start_ts?Date.now()-parseInt(i.extra.page_start_ts,10):void 0;("start"===l?a.UDCL.logStart:a.UDCL.logEnd)({class:"previews",action:"preview",object:"file",properties:{eventState:l,actionScreen:n,fileType:pi(s),fileSize:null==o?void 0:o.bytes,previewType:r?gi(r):void 0,startType:"initial",actionId:i.file_preview_session_id,contentIdentifier:o.file_id,previewFailureReason:c,timeSinceStartMs:d,validationTraceId:i.extra.validation_trace_id}})})),ga=(e,t)=>t||e;var fa,ma;t.SectionAnnotationMode=void 0,(fa=t.SectionAnnotationMode||(t.SectionAnnotationMode={})).continuous="continuous",fa.single="single",function(e){e.ADD_COMMENT="add_comment",e.POST_COMMENT="post_comment",e.DELETE_COMMENT="delete_comment",e.REPLY_COMMENT="reply_comment",e.EDIT_COMMENT="edit_comment",e.RESOLVE_COMMENT="resolve_comment",e.UNRESOLVE_COMMENT="unresolve_comment",e.SUBSCRIBE_COMMENTS="subscribe_comments",e.UNSUBSCRIBE_COMMENTS="unsubscribe_comments",e.DISABLE_COMMENTS="disable_comments",e.ENABLE_COMMENTS="enable_comments",e.SHOW_RESOLVED_COMMENTS="show_resolved_comments",e.HIDE_RESOLVED_COMMENTS="hide_resolved_comments",e.SORT_COMMENTS="sort_comments",e.ENABLE_CONTINUOUS_ANNOTATIONS="enable_continuous_annotations",e.DISABLE_CONTINUOUS_ANNOTATIONS="disable_continuous_annotations",e.ENABLE_CONTINUOUS_COMMENTING="enable_continuous_commenting",e.DISABLE_CONTINUOUS_COMMENTING="disable_continuous_commenting",e.ADD_COMMENT_START="add_comment_start",e.ADD_COMMENT_CANCEL="add_comment_cancel",e.REPLY_COMMENT_START="reply_comment_start",e.REPLY_COMMENT_CANCEL="reply_comment_cancel",e.MARK_THREAD_READ="mark_thread_read",e.MARK_THREAD_UNREAD="mark_thread_unread",e.START_ANNOTATION_RECT="start_annotation_rect",e.COMMENT_ON_A_SECTION="comment_on_a_section",e.START_ANNOTATION_TIMESTAMP="start_annotation_timestamp",e.START_ANNOTATION_HIGHLIGHT="start_annotation_highlight",e.STICKER_START="sticker_start",e.ADD_EMOJI="add_emoji",e.STICKER_SUCCESS="sticker_success",e.STICKER_CANCELED="sticker_canceled",e.TAG_SOMEONE="tag_someone",e.MENTION_START="mention_start",e.MENTION_SUCCESS="mention_success",e.MENTION_CANCELED="mention_canceled",e.SAVE_EDIT_COMMENT="save_edit_comment"}(ma||(ma={}));const ha=()=>n.getYapsDeployment(),va=[a.SessionEventType.FilePreviewSupportConfirmed,a.SessionEventType.FilePreviewSupportDenied,a.SessionEventType.FilePreviewDownloadAttempted,a.SessionEventType.FilePreviewDownloadSucceeded,a.SessionEventType.FilePreviewDownloadFailed,a.SessionEventType.FilePreviewRenderSucceeded,a.SessionEventType.FilePreviewRenderFailed,a.SessionEventType.FilePreviewSessionEnded],Sa=new Set([a.SessionEventType.FilePreviewAttemptStarted,a.SessionEventType.FilePreviewRenderSucceeded,a.SessionEventType.FilePreviewSupportDenied,a.SessionEventType.FilePreviewDownloadFailed,a.SessionEventType.FilePreviewRenderFailed,a.SessionEventType.FilePreviewSessionEnded]),Ea="core_tags",wa=e=>n.__awaiter(void 0,void 0,void 0,(function*(){a.SilentBackgroundBeaconRequest(e)})),ba=e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({device_type:e.device_type},e.extra.source_context&&{source_context:e.extra.source_context}),e.extra.preview_type&&{preview_type:e.extra.preview_type}),e.extra.action&&{action:e.extra.action}),e.extra.error_code&&{error_code:e.extra.error_code}),e.extra.last_session_event&&{last_event:e.extra.last_session_event}),ya=(e,t={})=>Object.assign(Object.assign(Object.assign({},t),e.source_context&&{source_context:e.source_context}),e.preview_type&&{preview_type:e.preview_type}),Ta=(e,t,i,r,o={},s={})=>{const l=Object.assign(Object.assign(Object.assign({},o),r&&ba(r)),{deployment:ha(),is_edison:String(n.isServedByEdisonWebServer())}),c=ya(l,o);a.ONLY_USE_UDCL||(v.getMetricsReporter().createStats({ns:i,name:e},l).record(t),v.getMetricsReporter().createStats({ns:i,name:`${Ea}/${e}`},c).record(t)),a.UDCL$1.track(`${i}/${e}`,{startTime:Date.now(),detail:Object.assign(Object.assign({},a.withUdclTags(l)),{quantity:t,hiveData:s})}),a.UDCL$1.track(`${i}/${Ea}/${e}`,{startTime:Date.now(),detail:Object.assign(Object.assign({},a.withUdclTags(c)),{quantity:t,hiveData:s})})},Ia=(e,t,i,r,o={},s=void 0)=>{const l=Object.assign(Object.assign(Object.assign({},o),r&&ba(r)),{deployment:ha(),is_edison:String(n.isServedByEdisonWebServer())}),d=ya(l,o);a.ONLY_USE_UDCL||(v.getMetricsReporter().createStats({ns:i,name:e},l).recordDuration(t,c.TimeUnit.MILLISECONDS),v.getMetricsReporter().createStats({ns:i,name:`${Ea}/${e}`},d).recordDuration(t,c.TimeUnit.MILLISECONDS));const u=Date.now();a.UDCL$1.measure(`${i}/${e}`,{start:u-t,end:u,detail:Object.assign(Object.assign({},a.withUdclTags(l)),{hiveData:s})}),a.UDCL$1.measure(`${i}/${Ea}/${e}`,{start:u-t,end:u,detail:Object.assign(Object.assign({},a.withUdclTags(d)),{hiveData:s})})},Ca=(e,t)=>{const i=t.extra.file_preview_timeline?JSON.stringify(Object.assign({},...Object.entries(JSON.parse(t.extra.file_preview_timeline)).map((([e,t])=>({[e+"_ts"]:t}))))):void 0,r={device_type:t.device_type,event_name:e,extra:JSON.stringify(Object.assign(Object.assign({},t.extra),{initial_request_id:n.getRequestId()})),file_viewer_session_id:t.file_viewer_session_id,file_preview_session_id:t.file_preview_session_id,file_ns_id:t.ns_id,file_sjid:t.sj_id,file_preview_timeline:i,file_preview_size:t.file_preview_size,file_id:t.file_id,file_extension:t.file_extension,request_id:n.getRequestId()};var o;a.ONLY_USE_UDCL||wa({url:"/log/file_preview",data:r}),Ta(e,1,"web_previews",t,void 0,r),va.includes(e)&&((e,t)=>{const i=t.extra.file_preview_timeline?JSON.parse(t.extra.file_preview_timeline):{};if(a.SessionEventType.FilePreviewAttemptStarted in i&&e in i){const n=i[e]-i[a.SessionEventType.FilePreviewAttemptStarted];n>0&&Ia("time_from_attempt_ms",n,"web_previews",t,{event_name:e})}})(e,t),(o=t.extra).event===a.BackgroundEvent.EditVideoSaveSucceeded?a.UserSurvey.trackEvent("save_video_edit","previews"):o.action===a.UserAction.EditVideoCancel&&"false"===o.have_changes||o.action===a.UserAction.EditVideoDiscardChangesConfirmed?a.UserSurvey.trackEvent("quit_video_edit","previews"):o.action!==ma.ADD_COMMENT&&o.action!==ma.REPLY_COMMENT||a.UserSurvey.trackEvent("comment_created","previews"),Aa(e,t),Pa(t),xa(e,t)},Aa=(e,t)=>{var i,n,r,o;const s=null===(i=t.extra)||void 0===i?void 0:i.event;if(e===a.EventType.Background&&s===a.BackgroundEvent.DocPageLoad){const e=null===(n=t.extra)||void 0===n?void 0:n.status,i=null===(r=t.extra)||void 0===r?void 0:r.durationMs,s=null===(o=t.extra)||void 0===o?void 0:o.error;e===a.DocPageLoadState.Loaded&&void 0!==i?(Ta("doc_preview/page_load_status",1,"web_previews",t,{status:a.DocPageLoadState.Loaded}),Ia("doc_preview/page_success_load_duration_ms",Number.parseInt(i,10),"web_previews",t)):e===a.DocPageLoadState.Error&&void 0!==s&&Ta("doc_preview/page_load_status",1,"web_previews",t,{status:a.DocPageLoadState.Error,error:s})}},Ma=(e,t)=>(i,n)=>{const r=t().file;Sa.has(i)&&(n.extra=Object.assign({validation_trace_id:a.UUID.v4()},n.extra)),Ca(i,n),_a(i,n,{previewSurface:e,file:r})},Oa=({eventName:e,durationInMs:t,session:i,tags:r={},shouldLogToHive:o})=>{let s;if(o&&i){const r={event_name:e,duration:t.toString()};s={event_name:"user_timing",device_type:i.device_type,client_timestamp_ms:a.WebTimingUtil.getNow(),file_preview_session_id:i.file_preview_session_id,file_viewer_session_id:i.file_viewer_session_id,file_preview_size:i.file_preview_size,file_ns_id:i.ns_id,file_sjid:i.sj_id,extra:JSON.stringify(Object.assign(Object.assign({},i.extra),r)),file_id:i.file_id,file_extension:i.file_extension,request_id:n.getRequestId()}}Ia(e,t,"web_previews",i,r,s),s&&!a.ONLY_USE_UDCL&&wa({url:"/log/file_preview",data:s})},Pa=e=>{if(e.extra.context===a.UserActionContext.QuickReact)if(e.extra.user_id){const t=parseInt(e.extra.user_id,10);a.ShareTibEventLogger.log(t,e.extra.action,a.SHARE_ACTION_ORIGIN_TYPE.QUICK_REACT,{file_id:e.file_id,reaction_type:e.extra.reaction_type,sticker_id:e.extra.sticker_id})}else a.ShareTibEventLogger.log_unauth(e.extra.action,a.SHARE_ACTION_ORIGIN_TYPE.QUICK_REACT,{file_id:e.file_id,reaction_type:e.extra.reaction_type,sticker_id:e.extra.sticker_id})},xa=(e,t)=>{var i,n;const r=null===(i=t.extra)||void 0===i?void 0:i.event;if(e===a.EventType.Background&&r===a.BackgroundEvent.PluginLoadFailure){const e=null===(n=t.extra)||void 0===n?void 0:n.plugin_name;Ta("plugin_load_failure",1,"web_previews",t,{plugin_name:e})}},Da=(e,t)=>({event_name:e,client_timestamp_ms:a.WebTimingUtil.getNow(),file_preview_session_id:t.file_preview_session_id,video_format:t.video_format,video_duration_seconds:t.video_duration_seconds,video_truncated:t.video_truncated,ns_id:t.ns_id,sj_id:t.sj_id,file_id:t.file_id,extra:JSON.stringify(Object.assign({},t.extra))}),Ra=e=>{wa({url:"/log/video_preview",data:e})},Na=e=>({file_preview_session_id:e.file_preview_session_id,file_viewer_session_id:e.file_viewer_session_id,device_type:e.device_type,extra:Object.assign(Object.assign({},e.extra),{video_format:`${e.video_format}`,video_duration_seconds:`${e.video_duration_seconds}`,video_truncated:`${e.video_truncated}`,source_context:e.source_context,preview_type:e.preview_type})}),ka=(e,t,i)=>{const n=Da(e,i);a.ONLY_USE_UDCL||Ra(n);const r=Na(i);Ta(e,t,"web_audiovideo_previews",r,void 0,n)},La=(e,i,r,o)=>{var s;const l=hi[i];ka(r,1,o),((e,i,n,r)=>{var o;const s=e?a.getExtension$1(e):void 0,l={actionSurface:"previews",fileType:pi(s),fileSize:null==e?void 0:e.bytes,previousSurface:i};switch(n){case t.VideoPreviewEvent.ChangeVideoQuality:"user_selected"===(null===(o=r.extra)||void 0===o?void 0:o.video_quality_changer)&&a.UDCL.logEvent(Li(Object.assign(Object.assign({},l),{previewAction:"quality_change"})));break;case t.VideoPreviewEvent.ChangePlaybackRate:a.UDCL.logEvent(Li(Object.assign(Object.assign({},l),{previewAction:"playback_speed_change"})));break;case t.VideoPreviewEvent.HoverScrubberThumbnailsSucceeded:a.UDCL.logEvent(Zi({eventState:"success",actionScreen:i,fileSize:null==e?void 0:e.bytes,fileType:pi(s)}));break;case t.VideoPreviewEvent.HoverScrubberThumbnailsFailed:a.UDCL.logEvent(Zi({eventState:"failed",actionScreen:i,fileSize:null==e?void 0:e.bytes,fileType:pi(s)}))}})(e,l,r,o),a.isVideoPreview(e)?((e,i,r)=>{n.__awaiter(void 0,void 0,void 0,(function*(){const{previousSurface:n,previewType:o,file:s}=i,l=s?a.getExtension$1(s):void 0,c={actionElement:r,actionSurface:"previews",fileType:pi(l),fileSize:null==s?void 0:s.bytes,previewType:o?gi(o):void 0,previousSurface:n},d=e=>{a.UDCL.logEvent(Li(Object.assign(Object.assign({},c),{eventState:e,previewAction:"play"})))};switch(e){case t.VideoPreviewEvent.VideoStartsPlaying:d("success");break;case t.VideoPreviewEvent.MediaError:d("failed");break;case t.VideoPreviewEvent.VideoPaused:a.UDCL.logEvent(Li(Object.assign(Object.assign({},c),{previewAction:"pause"})))}}))})(r,{previousSurface:l,file:e},null===(s=o.extra)||void 0===s?void 0:s.action_element):a.isAudioPreview(e)&&((e,i)=>{n.__awaiter(void 0,void 0,void 0,(function*(){const{previousSurface:n,previewType:r,file:o}=i,s={actionSurface:"previews",fileType:pi(o?a.getExtension$1(o):void 0),fileSize:null==o?void 0:o.bytes,previewType:r?gi(r):void 0,previousSurface:n},l=e=>{a.UDCL.logEvent(Li(Object.assign(Object.assign({},s),{eventState:e,previewAction:"play"})))};switch(e){case t.VideoPreviewEvent.VideoStartsPlaying:l("success");break;case t.VideoPreviewEvent.MediaError:l("failed")}}))})(r,{previousSurface:l,file:e})},Fa=(e,t,i)=>{const n=Da(e,i);a.ONLY_USE_UDCL||Ra(n);const r=Na(i);Ia(e,t,"web_audiovideo_previews",r,void 0,n)},Ua="file_viewer_left_sidebar_preference",Va="file_viewer_right_sidebar_preference",ja="file_viewer_doc_sidebar_collapsed_preference",Ba="file_viewer_video_volume_preference",Ha="file_viewer_video_muted_preference",Ka="file_viewer_ui_hidden_preference",za="file_viewer_ui_links_warning";function Wa(e,t){return t?function(e,t){return{docSidebar:{setCollapsedState:({isCollapsed:t})=>{!function(e,t){try{a.UserLocalStorage.set(e,ja,t)}catch(e){}}(e.id,t)},getCollapsedState:()=>function(e){var t;try{return null===(t=a.UserLocalStorage.get(e,ja))||void 0===t||t}catch(e){return!0}}(e.id)},video:{getVolumeState:()=>function(e){var t;try{return parseFloat(null!==(t=a.UserLocalStorage.get(e,Ba))&&void 0!==t?t:1)}catch(e){return 1}}(e.id),setVolumeState:t=>function(e,t){try{a.UserLocalStorage.set(e,Ba,t)}catch(e){}}(e.id,t),getMutedState:()=>function(e){var t;try{return null!==(t=a.UserLocalStorage.get(e,Ha))&&void 0!==t&&t}catch(e){return!1}}(e.id),setMuteState:t=>function(e,t){try{a.UserLocalStorage.set(e,Ha,t)}catch(e){}}(e.id,t)},sidebar:{setLeftSidebarState:t=>function(e,t){try{a.UserLocalStorage.set(e,Ua,t)}catch(e){}}(e.id,t),setRightSidebarState:t=>function(e,t){try{a.UserLocalStorage.set(e,Va,t)}catch(e){}}(e.id,t),getSidebarState:()=>function(e){var t,i;try{const n=null!==(t=a.UserLocalStorage.get(e,Ua))&&void 0!==t?t:void 0,r=null!==(i=a.UserLocalStorage.get(e,Va))&&void 0!==i?i:void 0;if(!n&&!r)return;return{left:n,right:r}}catch(e){return}}(e.id)},ui:{setHiddenState:({isHidden:t})=>{!function(e,t){try{a.UserLocalStorage.set(e,Ka,t)}catch(e){}}(e.id,t)},getHiddenState:()=>function(e){var t;try{return null!==(t=a.UserLocalStorage.get(e,Ka))&&void 0!==t&&t}catch(e){return!1}}(e.id)},link:{setWarningHiddenState:({isHidden:i})=>{!function(e,t,i){try{a.UserLocalStorage.set(e,za+t,i)}catch(e){}}(e.id,t,i)},getWarningHiddenState:()=>function(e,t){var i;try{return null!==(i=a.UserLocalStorage.get(e,za+t))&&void 0!==i&&i}catch(e){return!1}}(e.id,t)}}}(t,e):{docSidebar:{setCollapsedState:({})=>{},getCollapsedState:()=>!0}}}const Ga=["browse_file_action_send_for_signature","browse_overflow_menu_send_for_signature","browse_right_click_menu_send_for_signature","browse_chooser_modal_send_for_signature","browse_quick_view_send_for_signature","signature_hub_send_for_signature","signature_hub_send_for_signature_onboarding","preview_send_for_signature","preview_share_dropdown_send_for_signature","desktop_file_context_menu_mac_send_for_signature","desktop_file_context_menu_win_send_for_signature","desktop_file_context_menu_linux_send_for_signature","desktop_file_context_menu_unknown_send_for_signature","file_uploader_actions_send_for_signature","content_suggestions_menu_send_for_signature"].concat(["bt_add_signatures_self_sign","browse_file_action_self_sign","browse_overflow_menu_self_sign","browse_right_click_menu_self_sign","browse_chooser_modal_self_sign","browse_quick_view_self_sign","signature_hub_self_sign","file_uploader_actions_self_sign","content_suggestions_menu_self_sign","desktop_file_context_menu_mac_self_sign","desktop_file_context_menu_win_self_sign","desktop_file_context_menu_linux_self_sign"],["signature_hub_template"]);const qa=(e,t,i,n,r)=>{if(!e)return!1;if(a.isEncryptedFile(e))return!1;if(t&&0===t.canDownloadRoles.length)return!1;if(c.is_mobile_or_tablet(navigator.userAgent))return!1;const o=a.getExtension$1(e);return p.isNonPdfEnabledInPdfEditor(o,i)?!n||!!r&&Ga.includes(r):!e||"pdf"===o},Qa=new Set(["jpg","jpeg","png"]);function Ya(e,t){return!!e&&(!a.isEncryptedFile(e)&&((!t||0!==t.canDownloadRoles.length)&&(!!Qa.has(a.getExtension$1(e))&&!c.is_mobile_or_tablet(navigator.userAgent))))}const $a=[".maestro-chrome","#maestro-nav","#page-footer","#page-content","#page-header","#page-sidebar","#flash-upload-container","#maestro-header","#maestro-header-portal","#maestro-prompt",".snackbar-container","#onboarding-sidebar-pagelet",".maestro-portal"].join(),Za="data-preview-old-display";function Xa(){Array.from(document.querySelectorAll($a)).forEach((e=>{e.style.display=e.hasAttribute(Za)?e.getAttribute(Za):""}))}const Ja=a.Loadable({loader:()=>new Promise((function(t,i){e(["./c_file_viewer_replay_prompt_replay_dialog"],t,i)})).then((({ReplayDialog:e})=>e))});const en=e=>{const t=(i=e)&&i.previews_mobile_web_redesign?i.previews_mobile_web_redesign:"OFF";var i;return"OFF"!==t&&"CONTROL"!==t},tn=e=>{const{file:t,sharedLinkInfo:i,onDismiss:n,openInAppData:r,fileViewerSessionId:o,filePreviewSessionId:s,onAppDownload:l,logUserAction:c,fileViewOrigin:d,deviceId:u,vishMwebInterstitialRedesignVariant:_}=e,p=a.getFilename(t),g=te.default.useCallback((e=>{a.MobileFilePreviewLogger.log(e,o,s,t.ns_id,t.sjid,{context:a.UserActionContext.AppDownloadInterstitial,location:"file_viewer",origin:d}),null==c||c(e,a.UserActionContext.AppDownloadInterstitial)}),[t,s,o,c,d]);te.default.useEffect((()=>{a.mark_time_to_interactive(),g(a.UserAction.AppDownloadInterstitialView),a.SUSIUXAEventLogger.logDeviceIdWithSource("file_viewer",u)}),[]);const f=te.default.useCallback((()=>{n(),g(a.UserAction.AppDownloadInterstitialContinue)}),[n,g]),m=te.default.useCallback((()=>{n(),g(a.UserAction.AppDownloadInterstitialClose)}),[n]),h=te.default.useCallback((()=>{g(a.UserAction.AppDownloadInterstitialInstall),null==l||l()}),[n,l]);return te.default.createElement(a.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"File Preview"},te.default.createElement("div",{"aria-label":p},te.default.createElement(a.AppDownloadInterstitialWithCss,{fileOrFolderName:p,open_in_app_data:r,onContinue:f,onAppDownload:h,ownerName:i.ownerName,ownerTeamName:i.ownerTeamName,onClose:m,previewShareToken:e.previewShareToken,vishMwebInterstitialRedesignVariant:_})))};tn.displayName="FvsdkAppDownloadInterstitial";const an=e=>{const{onHide:t,user:i,activePreviewFile:n}=e,r=u.useFileViewerContext(),o=te.default.useCallback((()=>{r.pluginContext.logUserAction(a.UserAction.OpenInApp,a.UserActionContext.OpenInAppBanner)}),[]),s=te.default.useCallback((()=>{r.pluginContext.logUserAction(a.UserAction.OpenInAppBannerClose,a.UserActionContext.OpenInAppBanner),t()}),[r.pluginContext,t]);if(!c.is_mobile_or_tablet()&&(c.iOS||c.is_android())||en(r.featureConfig))return null;const{file:l,shareToken:d,sharePermission:_}=n,p=a.getOpenInAppUrls(l,d,_,i);if(p){const e=!(l&&d&&_);return te.default.createElement("div",{style:{width:"100%"}},te.default.createElement(a.OpenInAppBanner,{urls:p,onClick:o,onClose:s,isMountedFile:e}))}return null};function nn(){const e=/comment_id=(.*)/.exec(a.get_uri().getFragment());return e?e[1]:void 0}an.displayName="OpenInAppHeader",an.displayName="OpenInAppHeader";const rn=te.default.createContext({setFindInDocCallback:()=>{},setPrintCallback:()=>{},setSelectVideoQualityCallback:()=>{},setVideoPlayer:()=>{},setGetPageForSelection:()=>{}});function on(e){return t=>e((()=>t))}const sn=e=>{const[t,a]=i.useState(void 0),[n,r]=i.useState(void 0),[o,s]=i.useState(void 0),[l,c]=i.useState(void 0),[d,u]=i.useState(void 0),_=te.default.useMemo((()=>({videoPlayer:t,onFindInDoc:n,onPrint:o,onSelectVideoQuality:l,getPageForSelection:d,setFindInDocCallback:on(r),setPrintCallback:on(s),setSelectVideoQualityCallback:on(c),setVideoPlayer:a,setGetPageForSelection:on(u)})),[t,n,o,l,d]);return te.default.createElement(rn.Provider,{value:_},e.children)};sn.displayName="PreviewControlProvider";const ln=e=>{const{onFindInDoc:t,onPrint:a,onSelectVideoQuality:n,videoPlayer:r,getPageForSelection:o}=e,{setFindInDocCallback:s,setPrintCallback:l,setSelectVideoQualityCallback:c,setVideoPlayer:d,setGetPageForSelection:u}=i.useContext(rn);return te.default.useEffect((()=>(t&&s(t),a&&l(a),n&&c(n),r&&d(r),o&&u(o),()=>{t&&(null==s||s(void 0)),a&&(null==l||l(void 0)),n&&(null==c||c(void 0)),r&&(null==d||d(void 0)),o&&u(void 0)})),[o,t,a,n,s,u,l,c,d,r]),te.default.createElement(te.default.Fragment,null,e.children)};ln.displayName="PreviewControlWrapper";const cn=()=>i.useContext(rn);var dn;function un(e){return{payload:e,type:dn.SetDeleteFileModalOpen}}function _n(e){return{type:dn.UpdateDocCurrentPageIndex,payload:e}}function pn(e){return{type:dn.PageNavigation,payload:e}}function gn(e){return{type:dn.ZoomIn,payload:e}}function fn(e){return{type:dn.ZoomOut,payload:e}}function mn(e){return{type:dn.UpdateZoomScaleFactor,payload:e}}function hn(e){return{type:dn.OpenDocSidebar,payload:e}}function vn(e){return{type:dn.CloseDocSidebar,payload:e}}function Sn(e){return{type:dn.SetUiShown,payload:e}}function En(e){return{type:dn.SetUiHidden,payload:e}}function wn(e){return{type:dn.EnterFullScreen,payload:e}}function bn(e){return{type:dn.ExitFullScreen,payload:e}}function yn(e){return{type:dn.FlipToNextFile,payload:e}}function Tn(e){return{type:dn.FlipToPreviousFile,payload:e}}function In(e){return{type:dn.CloseViewer,payload:e}}function Cn(e){return{type:dn.SetActiveEditPlugin,payload:e}}function An(e){return{payload:e,type:dn.UpdateArchiveFileCurrentPath}}function Mn(e){return{type:dn.ReportException,payload:e}}function On(e){return{type:dn.SetPreviewLoadingAction,payload:e}}function Pn(e){const t="NestedArchiveFile"===e.type?e:null;return Boolean(t)}function xn(e,t){return{type:"NestedArchiveFile",rootFileId:e,subpath:t,serialized:`rootFileId:[${e}]subpath:[${t}]`}}function Dn(e){let t="";return e.length&&(t+=`/${e.join("/")}`),`${t}`}function Rn(e){return t=e.file_id,i=e.ns_id,a=e.sj_id,n=e.url,{type:"File",_fileId:t,_nsId:i,_sjId:a,_url:n,serialized:(t?`fileId:[${t}]`:"")+(i?`nsId:[${i}]`:"")+(a?`sjId:[${a}]`:"")+(n?`url:[${n}]`:"")};var t,i,a,n}function Nn(e){return e&&"currentPageIndex"in e?e:void 0}function kn(e){return e&&"currentTimestamp"in e?e:void 0}function Ln(e){return e&&"fitScaleFactor"in e?e:void 0}!function(e){e.CloseDocSidebar="@@previews/fileViewerUi/closeDocSidebar",e.CopyToDropbox="@@previews/fileSystem/copyToDropbox",e.DownloadFile="@@previews/fileSystem/downloadFile",e.FlipToNextFile="@@previews/navigation/flipToNextFile",e.FlipToPreviousFile="@@previews/navigation/flipToPreviousFile",e.OpenDocSidebar="@@previews/fileViewerUi/openDocSidebar",e.PageDown="@@previews/pageDown",e.PageUp="@@previews/pageUp",e.UpdateDocCurrentPageIndex="@@previews/updateDocCurrentPageIndex",e.IncrementDocPasswordAttempts="@@previews/incrementDocPasswordAttempts",e.PageNavigation="@@previews/pageNavigation",e.ResolvePageNavigation="@@previews/resolvePageNavigation",e.UpdateFitScaleFactor="@@previews/updateFitScaleFactor",e.UpdateFitToWidthScaleFactor="@@previews/updateFitToWidthScaleFactor",e.UpdateZoomScaleFactor="@@previews/updateZoomScaleFactor",e.ZoomIn="@@previews/zoomIn",e.ZoomToggleOriginalOrFit="@@previews/zoomToggleOriginalOrFit",e.ZoomOut="@@previews/zoomOut",e.UpdateDimensions="@@previews/updateDimensions",e.OpenWebPreview="@@previews/openWebPreview",e.OpenUrl="@@previews/openUrl",e.InitializeFilePreviewSession="@@previews/initializeFilePreviewSession",e.SetFileMetadata="@@previews/setFileMetadata",e.CloseViewer="@@previews/closeViewer",e.SetRootFileInfo="@@previews/setRootFileInfo",e.SetActiveEditPlugin="@@previews/plugins/setActiveEditPlugin",e.SetLeftSidebarPlugin="@@previews/plugins/setLeftSidebarPlugin",e.SetRightSidebarPlugin="@@previews/plugins/setRightSidebarPlugin",e.SetSharedLinkInfo="@@previews/setSharedLinkInfo",e.EnterFullScreen="@@previews/enterFullscreen",e.ExitFullScreen="@@previews/exitFullscreen",e.UpdateArchiveFileCurrentPath="@@previews/updateArchiveFileCurrentPath",e.UpdateArchiveFileCurrentSubpaths="@@previews/updateArchiveFileCurrentSubpaths",e.UpdateAudioVideoPlaybackState="@@previews/updateAudioVideoPlaybackState",e.UpdateFiles="@@previews/updateFiles",e.SetupGetPlayDurationSeconds="@@previews/setupGetPlayDurationSeconds",e.ShowAuthModal="@@previews/showAuthModal",e.Redirect="@@previews/redirect",e.TriggerDynamicRoutingModalCheck="@@previews/triggerDynamicRoutingModalCheck",e.OpenGdssFileConversionModal="@@previews/openGdssFileConversionModal",e.SetVolume="@@previews/setVolume",e.SetMuted="@@previews/setMuted",e.ReportException="@@previews/reportException",e.SetPreviewLoadingAction="@@previews/setPreviewLoadedAction",e.Rename="@@previews/rename",e.Delete="@@previews/delete",e.SetDeleteFileModalOpen="@@previews/setDeleteFileModalOpen",e.SaveVideoEdit="@@previews/saveVideoEdit",e.SetTitleBarRenameActive="@@previews/titleBarRenameActive",e.SetIsClosedCaptionShowing="@@previews/setIsClosedCaptionShowing",e.SetIsTranscriptShowing="@@previews/setIsTranscriptShowing",e.SetIsDefaultAudioTrackSelected="@@previews/fileViewerUi/setIsDefaultAudioTrackSelected",e.SetAreVideoControlsHidden="@@previews/fileViewerUi/setAreVideoControlsHidden",e.SetUiShown="@@previews/fileViewerUi/setUiShown",e.SetUiHidden="@@previews/fileViewerUi/setUiHidden",e.SetActiveTextHighlighterPlugin="@@previews/plugins/setactiveTextHighlighterPlugin",e.SetLinkWarningIsHidden="@@previews/setLinkWarningIsHidden"}(dn||(dn={}));function Fn(e,t){return e.rootFileInfo[t]}const Un=(e,t)=>{const i=jn(e,t),a=Fn(e,t);return i&&Pn(i)?void 0:a};function Vn(e,t){var i;return null===(i=Fn(e,t))||void 0===i?void 0:i.previewKey}function jn(e,t){return e.currentPreviewKey[t]}function Bn(e,t){return t&&e.fileMetadata[t.serialized]}function Hn(e,t){const i=Fn(e,t);return Bn(e,null==i?void 0:i.previewKey)}function Kn(e,t,i){var a;return i&&(null===(a=e.filePreviewUi[t])||void 0===a?void 0:a[i.serialized])}function zn(e,t){const i=Fn(e,t);return i&&Kn(e,t,i.previewKey)}function Wn(e,t){return Kn(e,t,jn(e,t))}function Gn(e,t){return e.fileViewerUi[t]}function qn(e){return e.zoomScaleFactor||e.fitScaleFactor}function Qn(e,t){const i=Wn(e,t);if(!i)return!1;const a=Ln(i);if(null==a)return!1;const{zoomScaleFactor:n,fitScaleFactor:r}=a;return!!n&&n>r}function Yn(e,t){const i=Gn(e,t);return!!(null==i?void 0:i.isFullScreen)}function $n(e,t){const i=Gn(e,t);return!!(null==i?void 0:i.isTitleBarRenameActive)}function Zn(e,t){var i,a;const n=Gn(e,t);return!!((null==n?void 0:n.isFullScreen)?null===(i=null==n?void 0:n.isUiHidden)||void 0===i?void 0:i.fullscreen:null===(a=null==n?void 0:n.isUiHidden)||void 0===a?void 0:a.nonFullscreen)}function Xn(e,t){const i=Gn(e,t);return!!(null==i?void 0:i.hasBeenFlipped)}function Jn(e,t){return t?e.loggingSessionId[t]:void 0}function er(e,t){return e.sharedLinkInfo[t]}function tr(e,t){var i;return!!(null===(i=e.fileViewerUi[t])||void 0===i?void 0:i.isPreviewLoading)}function ir(e,t){var i;return!!(null===(i=e.fileViewerUi[t])||void 0===i?void 0:i.isDeleteFileModalOpen)}function ar(e,t){const i=Kn(e,t,Vn(e,t));return(null==i?void 0:i.currentSubpaths)||[]}const nr="previews:get_archive_files",rr=e=>o.createGenericQuery({queryRouteFilter:["custom",nr],queryFn:({apiArg:t,pkgArg:i})=>({})=>n.__awaiter(void 0,void 0,void 0,(function*(){const n=yield i.isLoggedIn?a.GetPreviewsRoutes(e).rpc("get_archive_files",t,{}):a.GetPreviewsRoutes(e).rpc("logged_out/get_archive_files",t,{});return{apiData:Object.fromEntries(Object.entries(n.archive_files).map((([,e])=>[e.subpath,Ji(e.preview,e.filename,0,void 0)]))),pkgData:null}})),getQueryKey:o.getGenericQueryKey("custom",nr)}),or=e=>{const{fileViewerId:t,isLoggedIn:i}=u.useFileViewerContext(),n=a.useSelector((e=>e)),r=Fn(n,t),o=er(n,t),s=ta(r,o),l=ar(n,t),{data:c}=((e,t,i,a,n)=>{const r=u.useFileViewerContext();if(!r)throw new Error("useArchiveFilesQuery must be called within a FileViewerContext");const{apiV2Client:o}=r,s={root_file_info:e,subpaths:t,subpath_sizes:n};return te.default.useMemo((()=>rr(o)),[o]).useQuery({apiArg:s,pkgArg:{isLoggedIn:i}},{enabled:a})})(s,l||[],i,e),d=jn(n,t);if(c&&d&&Pn(d))return c.apiData[d.subpath]};function sr(e){return e instanceof u.FVError}function lr(e){switch(null==e?void 0:e[".tag"]){case"unsupported_file_error":return u.FVErrorCode.UnsupportedPreviewType;case"encrypted_file_error":return u.FVErrorCode.FileEncrypted;case"content_not_uploaded":return u.FVErrorCode.FileUploading;default:return u.FVErrorCode.PreviewsDataApiFailure}}const cr="previews:get_preview_data_batch",dr=e=>o.createGenericQuery({queryRouteFilter:["custom",cr],queryFn:({apiArg:t,pkgArg:i})=>({})=>n.__awaiter(void 0,void 0,void 0,(function*(){if(!t.files)return{apiData:void 0,pkgData:{previewType:a.PreviewType.Error,error:new u.FVError(u.FVErrorCode.FileNotProvided,u.ErrorLifecycle.Download)}};if(!i.fileName||void 0===i.fileSize)return{apiData:void 0,pkgData:{previewType:a.PreviewType.Error}};const n=yield a.GetPreviewsRoutes(e).rpc("get_preview_data_batch",t,{}),r=n.results[0];let o;return r.err?(o={previewType:a.PreviewType.Error,error:new u.FVError(lr(r.err),u.ErrorLifecycle.Support,r.err?`Got error from preview api: ${r.err[".tag"]}`:"Api did not return data")},o=Ji(o,i.fileName,i.fileSize,u.DEFAULT_CONFIG)):o=Ji(r.preview,i.fileName,i.fileSize,u.DEFAULT_CONFIG),{apiData:n,pkgData:o}})),getQueryKey:o.getGenericQueryKey("custom",cr)}),ur=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=a.useSelector((e=>e)),i=Hn(t,e),n=Fn(t,e),r=er(t,e),o=ea(n,r),{data:s,error:l}=((e,t,i,a)=>{const n=u.useFileViewerContext();if(!n)throw new Error("usePreviewMetadataQuery must be called within a FileViewerContext");const{apiV2Client:r}=n,o={files:e,include_dimensions:t};return te.default.useMemo((()=>dr(r)),[r]).useQuery({apiArg:o,pkgArg:{fileName:i,fileSize:a}})})([o],!0,null==i?void 0:i.file_name,null==i?void 0:i.size);if(l){const e=new u.FVError(l?lr(l):u.FVErrorCode.Unknown,u.ErrorLifecycle.Support,l?`Got error from preview api: ${l[".tag"]}`:"Api did not return data");return{previewType:a.PreviewType.Error,error:e}}if(!s)return{previewType:a.PreviewType.Error,error:new u.FVError(u.FVErrorCode.FileNotProvided,u.ErrorLifecycle.Support)};return null==s?void 0:s.pkgData},_r=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=jn(a.useSelector((e=>e)),e);return pr(t)},pr=e=>{const t=ur(),i=e&&Pn(e),a=or(!!i);return i&&a?a:t},gr=({fileTypeSpecificQueryFn:e,fieldName:t})=>o.createGenericQuery({queryRouteFilter:["custom","riviera"],getQueryKey:o.getGenericQueryKey("custom",`riviera_${t}`,(e=>{var t;return null===(t=e.previewKey)||void 0===t?void 0:t.serialized})),queryFn:t=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{previewKey:i,previewMetadata:a}=t.apiArg;if(!i)throw new Error("No preview key provided to Riviera query.");try{return{apiData:yield e(a,i),pkgData:null}}catch(e){throw e}}))}),fr=()=>Promise.resolve({navigationTime:0,isAjaxNavigation:!1,pathname:window.location.pathname});function mr(){return"undefined"!=typeof performance?performance.now():0}const hr=e=>{var t,i;return{source_context:e.sourceSession.source_context,logged_in_user:e.isLoggedIn,preview_type:null===(i=null===(t=e.previewMetadata)||void 0===t?void 0:t.content)||void 0===i?void 0:i[".tag"]}};function vr({page:e=0,imageUrlTmpl:t},i){const a=new URL(t);return a.searchParams.set("page",e.toString()),i&&"scalePercent"in i&&i.scalePercent&&a.searchParams.set("scale_percent",i.scalePercent.toString()),i&&"width"in i&&null!=i.width&&a.searchParams.set("width",i.width.toString()),a.toString()}const Sr=1<<18,Er=1,wr=64;function br(e,t,i){return i&&i[0]?vr({imageUrlTmpl:e,page:t},{width:i[0]}):vr({imageUrlTmpl:e,page:t})}function yr(e,t=[],i,a){const n=t.reduce(((e,[t,i,a])=>{for(let n=0;n<a;n++)e.push([t,i]);return e}),[]);return[...Array(i)].map(((t,i)=>({dimension:n[i],thumbnailUrl:br(e,i,a),imgUrls:{"1x":vr({imageUrlTmpl:e,page:i},{scalePercent:100}),"4x":vr({imageUrlTmpl:e,page:i},{scalePercent:400}),imageUrlTmpl:e}})))}function Tr(e){const{text:t}=e;if(!t||!t.pages)return[];const{links:i,pages:a}=t,n=(t.fonts||[]).reduce(((e,t)=>(e[t.f]=function(e){const t=e.n.lastIndexOf(",");return{fontFamily:`"${t>-1?e.n.substr(0,t):e.n}", ${e.f&Er?"monospace":"serif"}`,isBold:(e.f&Sr)>0,isItalic:(e.f&wr)>0}}(t),e)),{});return Object.keys(a).map((e=>({pageIndex:+e,textboxes:(a[e]||[]).map((e=>Object.assign(Object.assign({},e),{font:n[e.f]}))),links:i&&i[e]||[]})))}const Ir=(e,t,i)=>{const a=e.map(((e,t)=>Object.assign(Object.assign({pageIndex:i+t},e),{textboxes:[],links:[]})));return t.forEach((e=>{const t=e.pageIndex-i;t>=0&&t<a.length&&(a[t].textboxes=e.textboxes,a[t].links=e.links)})),a},Cr=(e,t="")=>{var i,a,n,r;const o="/"===e.name?"":e.name,s="/"===e.name?"":`${t}/${e.name}`,l=null!==(a=null===(i=e.children)||void 0===i?void 0:i.reduce(((e,t)=>Object.assign(Object.assign({},e),Cr(t,s))),{}))&&void 0!==a?a:void 0,c=e.isDir?{isDir:!0,children:null!==(r=null===(n=e.children)||void 0===n?void 0:n.map((e=>e.name)))&&void 0!==r?r:[],name:o,size:void 0}:{isDir:!1,size:e.size?Number(e.size):0,name:o,children:void 0};return Object.assign(Object.assign({},l),{[s]:c})},Ar=(e,t)=>Object.assign(Object.assign({},t),{tags:Object.assign({image_type:e},t.tags)}),Mr=(t,i,r)=>n.__awaiter(void 0,void 0,void 0,(function*(){if(t.logDuration){const o=yield t.logDuration();if(o){const s=yield function(t){return n.__awaiter(this,void 0,void 0,(function*(){const i=new Map;let a;for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&i.set(a,String(t[a]));const{isAjaxNavigation:r}=yield fr();i.set("navigation_type",r||t.file_flip?"ajax":"page_load");let o=!1;if(n.isServedByEdisonWebServer()){const{Edison:t}=yield new Promise((function(t,i){e(["./e_edison"],t,i)})).then((function(e){return e.edison_esnext}));o=t.getIsBuildTimePrefetchesEnabled()}return i.set("is_build_time_prefetches_enabled",String(o)),Object.fromEntries(i.entries())}))}(t.tags),l=yield function(e){var t;return n.__awaiter(this,void 0,void 0,(function*(){const{navigationTime:i}=yield fr();let n=i;return(e.file_flip||["browse","home","Photos"].includes(e.source_context))&&(n=(null===(t=a.PreviewsEventLogger.getStartEntry())||void 0===t?void 0:t.startTime)||i),n}))}(t.tags);o({eventName:"prefetch.time_to_start_prefetch",durationInMs:i-l,session:void 0,tags:s,shouldLogToHive:!0}),o({eventName:"prefetch.prefetch_duration",durationInMs:r-i,session:void 0,tags:s,shouldLogToHive:!0}),o({eventName:"prefetch.time_to_complete_prefetch",durationInMs:r-l,session:void 0,tags:s,shouldLogToHive:!0})}}})),Or=new Set,Pr=(e,t,i,a)=>n.__awaiter(void 0,void 0,void 0,(function*(){return new Promise(((n,r)=>{const o=mr(),s=new Image;s.onload=()=>{const r=`${e}:${t}:${i}`;a&&!Or.has(r)&&(Or.add(r),a.tags=Object.assign({status:"success"},a.tags),Mr(a,o,mr())),n(e)},s.onerror=()=>{a&&(a.tags=Object.assign({status:"error"},a.tags),Mr(a,o,mr())),r(new u.RivieraError(`Failed to load image ${e}`,u.RivieraStatus.Unknown))},t&&i&&(s.srcset=t,s.sizes=i),s.src=e}))}));function xr(e,t,i){return 401===e&&i?new u.RivieraError("Password required",u.RivieraStatus.PasswordProtected):new u.RivieraError("Load Error",t.rivieraStatusCode)}const Dr=e=>n.__awaiter(void 0,void 0,void 0,(function*(){return null==e?void 0:e.json()})),Rr=(...e)=>n.__awaiter(void 0,void 0,void 0,(function*(){return Nr(Dr,e)})),Nr=(e,t)=>n.__awaiter(void 0,void 0,void 0,(function*(){var i,a,n,r;let o;try{o=yield fetch(...t)}catch(e){o=void 0}const s=null!==(i=null==o?void 0:o.ok)&&void 0!==i&&i,l=null!==(a=null==o?void 0:o.status)&&void 0!==a?a:400,c=(e=>{let t={};try{e&&(t=JSON.parse(e))}catch(e){}return t})(null!==(n=null==o?void 0:o.headers.get("x-dropbox-metadata"))&&void 0!==n?n:void 0),d=null!==(r=null==o?void 0:o.headers.get("x-dropbox-pdf-password-needed"))&&void 0!==r?r:void 0;let u;try{u=yield e(o)}catch(e){u=void 0}if(s&&u)return{data:u};return{error:xr(l,c,"1"===d)}})),kr={refreshDocBlob:(e,t)=>Rr(e,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({password:t||""}),credentials:"include",method:"POST"}),fetchDocMetadata:(e,t=!1,i=0,a=50,n=!1)=>Rr(function(e,t,i=0,a=50,n=!1){const r=new URL(e);return t&&r.searchParams.set("metadata","1"),void 0!==i&&(r.searchParams.set("text","1"),r.searchParams.set("page_start",i.toString()),r.searchParams.set("page_end",a.toString())),n&&r.searchParams.set("canned_file_name","spdf/audi.pdf.json"),r.toString()}(e,t,i,a,n),{headers:{"content-type":"application/json"},credentials:"include"}),fetchMediaMetadata:e=>Rr(e,{credentials:"include"}),fetchWaveformData:e=>Rr(e,{credentials:"include"}),fetchTranscriptData(e){var t,i;return n.__awaiter(this,void 0,void 0,(function*(){const a=yield Rr(e,{credentials:"include",cache:"no-cache"});let n=a.error;return n||0!==(null===(i=null===(t=a.data)||void 0===t?void 0:t.segments)||void 0===i?void 0:i.length)||(n=new u.TranscriptRivieraError("no_speech",u.RivieraStatus.Unknown)),n?{error:n}:a}))},fetchLinkfileData:(e,t)=>Rr(e,{credentials:t?"include":"omit",headers:{"content-type":"application/json"},method:"POST"}),fetchArchiveTopLevelData:e=>Rr(e,{headers:{"content-type":"application/json"},credentials:"include",method:"POST"}),fetchPageDataWithMetadata(e,t,i,a){var r,o,s;return n.__awaiter(this,void 0,void 0,(function*(){const{textUrlTmpl:n,imageUrlTmpl:l,supportedWidths:c}=e,{metadata:d}=a&&!a.isPasswordProtected?a:{metadata:void 0},_=yield kr.fetchDocMetadata(n,!d,t,i);if(_.error&&_.error.statusCode===u.RivieraStatus.PasswordProtected)return{data:{isPasswordProtected:!0,needsPassword:!0,pages:[],metadata:{page_count:0,dimensions:[]}}};if(_.error)return _;const p=null!=d?d:_.data.metadata;if(!p)return{error:new u.RivieraError("Response from riviera ssr_doc has no metadata and we also have no existing metadata",u.RivieraStatus.InvalidRequest)};const g=Object.keys(null!==(o=null===(r=_.data.text)||void 0===r?void 0:r.pages)&&void 0!==o?o:{}).length,f=yr(l,null===(s=_.data.metadata)||void 0===s?void 0:s.dimensions,g,c),m=Tr(_.data);return{data:{metadata:p,pages:Ir(f,m,t),isPasswordProtected:!1,needsPassword:!1}}}))},fetchDocImage:({imageUrlTmpl:e,width:t,scalePercent:i,page:a})=>{const n=vr({page:a,imageUrlTmpl:e},i?{scalePercent:i}:{width:t});return Pr(n).then((()=>({data:n})))},fetchImage:(e,t,i,a)=>Pr(e,t,i,a).then((()=>({data:e})))};const Lr=50;function Fr(e){const t=Math.floor(e/Lr)*Lr;return[t,t+Lr]}const Ur=(({infiniteQueryFn:e,fieldName:t,getNextPageParam:i,getPreviousPageParam:a,getQueryKey:r})=>o.createGenericInfiniteQuery({queryRouteFilter:["custom","riviera"],getQueryKey:null!=r?r:o.getGenericQueryKey("custom",`riviera_${t}`,(e=>{var t;return null===(t=e.previewKey)||void 0===t?void 0:t.serialized})),queryFn:({apiArg:t})=>({pageParam:i})=>n.__awaiter(void 0,void 0,void 0,(function*(){const{previewKey:a,previewMetadata:n}=t;if(!a)throw new Error("No preview key provided to Riviera query.");const r=null==i?void 0:i.continueArg;try{return yield e(n,r)}catch(e){throw e}})),optionsFn:e=>Object.assign({getNextPageParam:i,getPreviousPageParam:a},e)}))({infiniteQueryFn:(e,t)=>n.__awaiter(void 0,void 0,void 0,(function*(){const i=null==e?void 0:e.content;if(!i||"ssr_doc"!==i[".tag"]&&"cloud_doc"!==i[".tag"])throw new Error("Invalid content metadata when fetching document.");if(!i.image_url_tmpl||!i.text_url_tmpl)throw new Error("Must specify image and text URLs in preview metadata.");let a,n;void 0===(null==t?void 0:t.apiArg.batchFirstPage)||void 0===(null==t?void 0:t.apiArg.batchLastPage)?[a,n]=Fr(0):(a=t.apiArg.batchFirstPage,n=t.apiArg.batchLastPage);const r=yield kr.fetchPageDataWithMetadata({textUrlTmpl:i.text_url_tmpl,imageUrlTmpl:i.image_url_tmpl,supportedWidths:"supported_widths"in i?i.supported_widths:void 0},a,n,null==t?void 0:t.pkgArg);if(r.error)throw r.error;return{apiData:r.data,pkgData:{isPasswordProtected:r.data.isPasswordProtected,metadata:r.data.metadata}}})),fieldName:"ssr_doc",getNextPageParam:(e,t)=>{const i=0===e.apiData.pages.slice(-1).length?0:e.apiData.pages.slice(-1)[0].pageIndex,[a,n]=Fr(i);return n===i?null:{continueArg:{apiArg:{batchFirstPage:a,batchLastPage:n},pkgArg:e.pkgData}}},getQueryKey:o.getGenericQueryKey("custom","riviera_ssr_doc",(e=>{var t,i,a,n,r,o,s,l;const c=("ssr_doc"===(null===(i=null===(t=e.previewMetadata)||void 0===t?void 0:t.content)||void 0===i?void 0:i[".tag"])||"cloud_doc"===(null===(n=null===(a=e.previewMetadata)||void 0===a?void 0:a.content)||void 0===n?void 0:n[".tag"]))&&null!==(o=null===(r=e.previewMetadata)||void 0===r?void 0:r.content.text_url_tmpl)&&void 0!==o?o:"";return(null===(s=e.previewKey)||void 0===s?void 0:s.serialized)+((null===(l=e.previewMetadata)||void 0===l?void 0:l.preview_url)||"")+c}))}),Vr=(e,t)=>Ur.useInfiniteQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:void 0},{enabled:!!e&&!!t}),jr=(e,t)=>{const i=((e,t)=>{const i=Vr(e,t);return Kr(null==t?void 0:t.content,i)})(e,t);return null==i?void 0:i.pages},Br=(e,t)=>{const i=Hr(e,t);return null==i?void 0:i.page_count},Hr=(e,t)=>{var i;const a=Vr(e,t),n=null==t?void 0:t.content;if(!n||"ssr_doc"!==n[".tag"]&&"cloud_doc"!==n[".tag"]||void 0===n.image_url_tmpl||!(null===(i=a.data)||void 0===i?void 0:i.pages)||0===a.data.pages.length)return;const r=a.data.pages;return r[r.length-1].apiData.metadata},Kr=(e,t)=>{var a;return i.useMemo((()=>{var i;if(!e||"ssr_doc"!==e[".tag"]&&"cloud_doc"!==e[".tag"]||void 0===e.image_url_tmpl||!(null===(i=t.data)||void 0===i?void 0:i.pages)||0===t.data.pages.length)return;const a=t.data.pages.some((e=>e.apiData.isPasswordProtected)),n=t.data.pages.some((e=>e.apiData.needsPassword));if(a)return{isPasswordProtected:!0,needsPassword:!0,pages:[],metadata:{page_count:0,dimensions:[]}};const r=t.data.pages,o=r[r.length-1].apiData.metadata;if(!o)return;const s=r.flatMap((e=>e.apiData.pages)),l=o.page_count,c=yr(e.image_url_tmpl,o.dimensions,l,"ssr_doc"===e[".tag"]?e.supported_widths:void 0);return{metadata:o,pages:Ir(c,s,0),isPasswordProtected:a,needsPassword:n}}),[e,null===(a=t.data)||void 0===a?void 0:a.pages])},zr=gr({fileTypeSpecificQueryFn:(e,t)=>n.__awaiter(void 0,void 0,void 0,(function*(){var i;if(!t||Pn(t))throw new u.FVError(u.FVErrorCode.NestedFiletypeNotSupported,u.ErrorLifecycle.Download);if("archive"!==(null===(i=null==e?void 0:e.content)||void 0===i?void 0:i[".tag"])||!(null==e?void 0:e.preview_url))throw new Error("Invalid preview metadata provided for archive preview");const a=yield kr.fetchArchiveTopLevelData(e.preview_url);if(a.error)throw a.error;return n=a.data,{entries:Cr(n),isPasswordProtected:!!n.isEncrypted};var n})),fieldName:"archive_data"}),Wr=(e,t)=>zr.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null},{enabled:!!e&&!!t}),Gr=(e,t,i)=>{var a;const n=Wr(e,t);if(!i)return;const r=null===(a=n.data)||void 0===a?void 0:a.apiData.entries;return null==r?void 0:r[i]},qr=e=>$r(Fn,e),Qr=e=>{var t;return null===(t=$r(Fn,e))||void 0===t?void 0:t.previewKey},Yr=e=>Zr(Bn,e);function $r(e,t){return a.useSelector((i=>e(i,t)))}function Zr(e,t){return a.useSelector((i=>e(i,t)))}function Xr(e,...t){return a.useSelector((i=>e(i,...t)))}const Jr=e=>{const t=i.useRef(e);t.current=e;return i.useRef(((...e)=>(0,t.current)(...e))).current};function eo(e,t){var i;return null===(i=to(e,t))||void 0===i?void 0:i.activeEditPluginId}function to(e,t){return e.plugins[t]}function io(e,t){return!!eo(e,t)}function ao(e,t){var i,a;return null===(a=null===(i=to(e,t))||void 0===i?void 0:i.sidebarPlugins)||void 0===a?void 0:a.left}function no(e,t){var i,a;return null===(a=null===(i=to(e,t))||void 0===i?void 0:i.sidebarPlugins)||void 0===a?void 0:a.right}const ro=(e,t)=>{const{fileViewerId:i,logUserAction:n}=u.useFileViewerContext(),r=$r(ao,i),o=$r(no,i),s=oo(void 0,t),l=so(void 0,t);return Jr((()=>{const i={[p.TRANSCRIPT_BLADE_PLUGIN_ID]:a.UserAction.TranscriptHide,[p.INFO_BLADE_PLUGIN_ID]:a.UserAction.InfoHide,[p.COMMENTS_PLUGIN_ID]:a.UserAction.HideComments,[p.FILE_ACTIVITY_PLUGIN_ID]:a.UserAction.FileActivityHide,[p.AI_PLUGIN_ID]:a.UserAction.HideDropboxAi};r===e?(s(),n(i[e],t)):o===e&&(l(),n(i[e],t))}))},oo=(e,t)=>{const{fileViewerId:i,logUserAction:n}=u.useFileViewerContext(),r=b.useDispatch();return Jr((()=>{const o={[p.INFO_BLADE_PLUGIN_ID]:a.UserAction.Info,[p.FILE_ACTIVITY_PLUGIN_ID]:a.UserAction.FileActivity};var s;r((s={fileViewerId:i,sourceContext:t,pluginId:e},{type:dn.SetLeftSidebarPlugin,payload:s})),void 0!==e&&n(o[e],t)}))},so=(e,t)=>{const{fileViewerId:i,logUserAction:n}=u.useFileViewerContext(),r=b.useDispatch();return Jr((()=>{const o={[p.TRANSCRIPT_BLADE_PLUGIN_ID]:a.UserAction.TranscriptShow,[p.COMMENTS_PLUGIN_ID]:a.UserAction.Comment,[p.AI_PLUGIN_ID]:a.UserAction.ShownDropboxAI};var s;r((s={fileViewerId:i,sourceContext:t,pluginId:e},{type:dn.SetRightSidebarPlugin,payload:s})),void 0!==e&&n(o[e],t)}))},lo=(e,t)=>{const{fileViewerId:i}=u.useFileViewerContext(),a=b.useDispatch();return Jr((()=>{var n;a((n={fileViewerId:i,sourceContext:t,pluginId:e},{type:dn.SetActiveTextHighlighterPlugin,payload:n}))}))},co=()=>{const e=cn().videoPlayer;return Jr((t=>{e&&(e.currentTime(t/100),e.pause())}))},uo=e=>{const t=b.useDispatch(),{fileViewerId:i}=u.useFileViewerContext(),n=$r(jn,i),r=_r(),o=r.previewType,s=Br(n,r);return Jr((r=>{o===a.PreviewType.SsrDoc&&null!=n&&(t(_n({fileViewerId:i,previewKey:n,pageIndex:r,sourceContext:e,totalPageCount:s})),t(pn({fileViewerId:i,previewKey:n,sourceContext:e,pageIndex:r})))}))},_o=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=b.useDispatch();return Jr((i=>{t({payload:{fileViewerId:e,isActive:i},type:dn.SetTitleBarRenameActive})}))},po=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=b.useDispatch();return Jr((i=>{t(Cn({fileViewerId:e,sourceContext:i||a.UserActionContext.Editor,pluginId:void 0}))}))},go=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=b.useDispatch();return Jr(((i,a,n)=>{t(Cn({fileViewerId:e,sourceContext:a,pluginId:i,pluginActivationParams:n}))}))},fo=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=b.useDispatch(),i=$r(jn,e);return Jr((a=>{var n;i&&t((n={fileViewerId:e,previewKey:i,showing:a},{type:dn.SetIsTranscriptShowing,payload:n}))}))};a.injectInternalStyle("/static/js/file_viewer/app.module.out-vflp5nH9S.css",(e=>'._container_1a5di_1{align-items:stretch;display:flex;flex:1;font-family:AtlasGrotesk,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:var(--type__body__standard--fontsize);justify-content:flex-end;min-height:0;position:relative;width:100%}._container_1a5di_1 *,._container_1a5di_1 :after,._container_1a5di_1 :before{box-sizing:border-box}._container_1a5di_1 aside{background:var(--color__standard__background)}._containerV2_1a5di_25{flex-direction:column;justify-content:flex-start}._contentContainer_1a5di_30{display:flex;flex:1}@media (max-width:600px){._container_1a5di_1{width:100%!important}}._editPluginFullscreenContainer_1a5di_40{background:var(--color__standard__background);height:100%}._transparentBackground_1a5di_45{background:transparent}._file-viewer-area_1a5di_49{color-scheme:var(--dig-color-scheme,light dark);display:flex;flex-direction:column;height:100%;width:100%}._renderer-row_1a5di_58{display:flex;flex:1;flex-direction:row;min-height:0;width:100%}._footer-row_1a5di_66{width:100%}._center-section_1a5di_70{display:flex;flex-direction:column;height:100%;width:100%}._titleBarWrapper_1a5di_77{background:var(--dig-color__background__raised);opacity:1;transition:opacity var(--duration__micro) var(--easing__transition)}._titleBarBorder_1a5di_83{border-bottom:1px solid var(--dig-color__border__subtle)}._titleBarWrapper_1a5di_77._hidden_1a5di_87{opacity:0}._titleBarWrapper_1a5di_77._isVideo_1a5di_91._isFullScreen_1a5di_91{position:absolute;top:0;width:100%;z-index:1}._fullScreenPreview_1a5di_98{height:"100vh";position:fixed;right:0;top:0;width:"100vw";z-index:1000}._previewContentWrapper_1a5di_108{height:100%}'));const mo="_file-viewer-area_1a5di_49",ho=({children:e})=>{const{fileViewerId:t}=u.useFileViewerContext(),i=$r(Yn,t),n="dark"===a.useTheme().mode,r=i||n?"dark":"bright";return te.default.createElement(a.ThemeProvider,{mode:r},te.default.createElement(a.ThemeContainer,null,e))};ho.displayName="FileViewerThemeProvider";const vo=te.createContext(null);vo.displayName="FileViewerRenderContext";const So=vo.Provider;function Eo(e){return $r(eo,e)===p.VIDEO_EDITOR_PLUGIN_ID}function wo(e){return null!=e&&null!=e.preventDefault}function bo(e){return function(t){e(),wo(t)&&t.preventDefault()}}function yo({dispatch:e,fileViewerId:t,previewKey:i,requireCommandKey:n,fileIndex:r}){if(0===r)return[];const o=bo((()=>{e(Tn({fileViewerId:t,previewKey:i,sourceContext:a.UserActionContext.Keyboard}))})),s={keyboardEventCriteria:{key:a.Key_enum.Key.ArrowLeft,osModifierKey:!0},callback:o};return n?[s]:[{keyboardEventCriteria:{key:a.Key_enum.Key.ArrowLeft},callback:o},s]}function To({dispatch:e,fileViewerId:t,previewKey:i,requireCommandKey:n,fileIndex:r,collectionFileCount:o}){if(r===o-1)return[];const s=bo((()=>{e(yn({fileViewerId:t,previewKey:i,sourceContext:a.UserActionContext.Keyboard}))})),l={keyboardEventCriteria:{key:a.Key_enum.Key.ArrowRight,osModifierKey:!0},callback:s};return n?[l]:[{keyboardEventCriteria:{key:a.Key_enum.Key.ArrowRight},callback:s},l]}function Io(e){return{keyboardEventCriteria:{key:a.Key_enum.Key.PageDown},callback:bo(e)}}function Co(e){return{keyboardEventCriteria:{key:a.Key_enum.Key.ArrowDown},callback:bo(e)}}function Ao(e){return[{keyboardEventCriteria:{key:"-",osModifierKey:!0},callback:bo(e)}]}function Mo(e){return{keyboardEventCriteria:{key:a.Key_enum.Key.End},callback:bo(e)}}function Oo({key:e,callback:t,shift:i,osModifierKey:a}){return{keyboardEventCriteria:{key:e,shiftKey:i||!1,osModifierKey:a||!1},callback:t}}const Po=()=>{},xo=te.createContext({registerKeyBindings:Po,unregisterKeyBindings:Po});xo.displayName="KeyboardBindingContext";const Do=e=>{const{keyboardBindings:t,name:i,scope:a}=e,n=te.useRef(i),r=te.useRef(a||!1),o=te.useContext(xo);return te.useEffect((()=>{const e=n.current,i=r.current;return o.registerKeyBindings(t,e,i),()=>{o.unregisterKeyBindings(e,i)}}),[o,t]),null};Do.displayName="KeyboardBindingConnector";const Ro={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,key:a.Key_enum.Key.Unidentified},No=Object.keys(Ro);function ko(e){return No.map((t=>`${t}:${e[t]}`)).join("")}function Lo(e,t){return function(e,t){return e.reduce(((e,{keyboardEventCriteria:i,callback:a})=>(e[t(i)]=a,e)),{})}(e,(e=>function(e,t){const i=function(e,t){return{altKey:!0===e.altKey,shiftKey:!0===e.shiftKey,key:e.key,ctrlKey:!1,metaKey:!1,[t]:!0===e.osModifierKey}}(e,t);return ko(i)}(e,t)))}class Fo{constructor(e,t){this.bindingDict={},this.bindingDict=Lo(e,t)}getCallbackForEvent(e){const t=function(e){return{altKey:!0===e.altKey,ctrlKey:!0===e.ctrlKey,metaKey:!0===e.metaKey,shiftKey:!0===e.shiftKey,key:e.key}}(e);return this.bindingDict[ko(t)]}}const Uo="default",Vo=e=>{const{disableBindings:t,children:i,osModifierKey:a}=e,n=te.useRef({}),r=te.useRef(Uo),o=te.useRef(null),s=te.useCallback(((e,t,i)=>{if(n.current[i]||(n.current[i]={}),e){if(n.current[i][t])throw new Error(`Keybindings for name ${t} registered twice`);n.current[i][t]=e}else delete n.current[i][t];const s=n.current[r.current];o.current=new Fo((e=>w.flatten(Object.values(e)))(s),a)}),[a]),l=te.useCallback(((e,t,i)=>{i&&t!==r.current&&(r.current=t),s(e,t,i?t:Uo)}),[s]),c=te.useCallback(((e,t)=>{t&&r.current===e&&(r.current=Uo),s(void 0,e,t?e:Uo)}),[s]),d=te.useCallback((e=>{var t;if(!function(e){const t=e.target||e.srcElement;if(!t)return!0;const i=t.tagName,a="INPUT"===i||"SELECT"===i||"TEXTAREA"===i,n=t instanceof HTMLInputElement&&("submit"===t.type||"button"===t.type),r="NAV"===i||"menu"===t.role||"menuitem"===t.role;return!(t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase())&&(!a||n)&&!r}(e))return;const i=null===(t=o.current)||void 0===t?void 0:t.getCallbackForEvent(e);i&&i(e)}),[]);te.useEffect((()=>{if(!0!==t){const e=w.throttle(d,0);return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}}),[t,d]);const u=te.useMemo((()=>({registerKeyBindings:l,unregisterKeyBindings:c,updateKeyBindings:s})),[l,c,s]);return te.createElement(xo.Provider,{value:u},i)};var jo;function Bo(e){return{type:jo.LogSessionEvent,payload:e}}function Ho(e){return{type:jo.Log,payload:e}}function Ko(e){return{type:jo.LogUserAction,payload:e}}function zo(e,t=u.FVErrorCode.Unknown,i,a){if(!e){let e;throw e=void 0===a?new u.FVError(t,i,"An error occurred for unknown reason"):new u.FVError(t,i,a),e}return e}Vo.displayName="KeyboardBindingProvider",function(e){e.Log="@@previews/log",e.LogDuration="@@previews/logDuration",e.LogUserAction="@@previews/LogUserAction",e.LogBackgroundEvent="@@previews/LogBackgroundEvent",e.LogSessionEvent="@@previews/logSessionEvent",e.LogTTI="@@previews/logTTI",e.LogVideoEvent="@@previews/logVideoEvent",e.LogVideoEventQuantity="@@previews/logVideoEventQuantity",e.LogVideoEventDuration="@@previews/logVideoEventDuration",e.UpdateFitScaleFactor="UpdateFitScaleFactor"}(jo||(jo={}));const Wo=(()=>{let e,t;const i=[];for(e=0,t=e;e<=255;e++,t=e)i.push((t+256).toString(16).substr(1));return i})();function Go(e){return e.map((e=>Wo[e])).join("")}function qo(){const e=function(){const e=new Uint8Array(16);return window.crypto.getRandomValues(e),e}();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(Go).join("-")}function Qo(e){const{file_viewer_session_id:t=qo(),file_preview_session_id:i=qo(),file_id:n="",sj_id:r,ns_id:o,file_extension:s=u.getWhitelistedFileExtension(""),device_type:l=a.DeviceType.desktop,extra:c={},file_preview_size:d}=e||{};return{file_viewer_session_id:t,file_preview_session_id:i,file_id:n,sj_id:r,ns_id:o,file_extension:s,device_type:l,file_preview_size:d,extra:Object.assign(Object.assign({},c),{source_context:c.source_context||a.SourceContext.FileViewer,was_flipped:c.was_flipped||!1,file_preview_timeline:{}})}}let Yo={};const $o=e=>void 0!==e?Yo[e]:void 0;function Zo(e){return Object.keys(e).reduce(((t,i)=>{const a=e[i];return"string"==typeof a||"number"==typeof a?t[i]=String(a):"boolean"==typeof a?t[i]=String(+a):"object"==typeof a&&a&&(t[i]=JSON.stringify(a)),t}),{})}function Xo(e,t){return Object.assign(Object.assign({},e),{file_extension:u.getWhitelistedFileExtension(e.file_extension||""),extra:Zo(Object.assign(Object.assign({},e.extra),t))})}const Jo=(e,t,i)=>{const{videoFormat:a,videoDuration:n,videoTruncated:r,extra:o}=e;return{file_viewer_session_id:t.file_viewer_session_id,file_preview_session_id:t.file_preview_session_id,video_format:a,video_duration_seconds:n,video_truncated:r,source_context:t.source_context,device_type:t.device_type,preview_type:i,file_id:t.file_id,extra:o}},es={[dn.ZoomIn]:a.UserAction.ZoomIn,[dn.ZoomOut]:a.UserAction.ZoomOut,[dn.CloseDocSidebar]:a.UserAction.CloseDocSidebar,[dn.OpenDocSidebar]:a.UserAction.OpenDocSidebar,[dn.ZoomToggleOriginalOrFit]:a.UserAction.ZoomToggleOriginalOrFit,[dn.UpdateDocCurrentPageIndex]:a.UserAction.PageJump,[dn.PageDown]:a.UserAction.PageDown,[dn.PageUp]:a.UserAction.PageUp,[dn.OpenWebPreview]:a.UserAction.OpenWebPreview,[dn.FlipToNextFile]:a.UserAction.FlipNext,[dn.FlipToPreviousFile]:a.UserAction.FlipPrevious,[dn.CloseViewer]:a.UserAction.CloseViewer,[dn.CopyToDropbox]:a.UserAction.SaveToDropbox,[dn.DownloadFile]:a.UserAction.DownloadStart,[dn.EnterFullScreen]:a.UserAction.ToggleFullscreenOn,[dn.ExitFullScreen]:a.UserAction.ToggleFullscreenOff},ts=w.lodash(es);let is;const as=(e,t,i)=>{const{payload:{event:n,previewSessionId:r,extra:o}}=i;let s=$o(r);return s&&r?(s=function(e,t){const{extra:{last_event:i}}=e;switch(zo(i!==t,u.FVErrorCode.InvalidLoggingOrder,u.ErrorLifecycle.Unknown,`Cannot log duplicate event ${t}`),t){case a.SessionEventType.FilePreviewSupportConfirmed:case a.SessionEventType.FilePreviewSupportDenied:zo(i===a.SessionEventType.FilePreviewAttemptStarted,u.FVErrorCode.InvalidLoggingOrder,u.ErrorLifecycle.Unknown,`Event ${t} out of order, expect \`last_event\` to be '${a.SessionEventType.FilePreviewAttemptStarted}' but was '${i}'`);break;case a.SessionEventType.FilePreviewDownloadAttempted:zo(i===a.SessionEventType.FilePreviewSupportConfirmed,u.FVErrorCode.InvalidLoggingOrder,u.ErrorLifecycle.Unknown,`Event ${t} out of order, expect \`last_event\` to be '${a.SessionEventType.FilePreviewSupportConfirmed}' but was '${i}'`);break;case a.SessionEventType.FilePreviewDownloadFailed:case a.SessionEventType.FilePreviewDownloadSucceeded:zo(i===a.SessionEventType.FilePreviewDownloadAttempted,u.FVErrorCode.InvalidLoggingOrder,u.ErrorLifecycle.Unknown,`Event ${t} out of order, expect \`last_event\` to be '${a.SessionEventType.FilePreviewDownloadAttempted}' but was '${i}'`);break;case a.SessionEventType.FilePreviewRenderSucceeded:case a.SessionEventType.FilePreviewRenderFailed:zo(i===a.SessionEventType.FilePreviewDownloadSucceeded,u.FVErrorCode.InvalidLoggingOrder,u.ErrorLifecycle.Unknown,`Event ${t} out of order, expect \`last_event\` to be '${a.SessionEventType.FilePreviewDownloadSucceeded}' but was '${i}'`)}return Object.assign(Object.assign({},e),{extra:Object.assign(Object.assign({},e.extra),{file_preview_timeline:Object.assign(Object.assign({},e.extra.file_preview_timeline),{[t]:Date.now()})})})}(s,n),e.log(n,Xo(s,o)),((e,t)=>{Yo=Object.assign(Object.assign({},Yo),{[e]:t})})(r,function(e,t){return Object.assign(Object.assign({},e),{extra:Object.assign(Object.assign({},e.extra),{last_event:t})})}(s,n)),i):i},ns=(e,t,i)=>{const{payload:a}=i,{event:n,fileViewerId:r}=a,o=t.loggingSessionId[r],s=$o(o);return s?(e.log(n,Xo(Object.assign(Object.assign({},s),{extra:Object.assign({source_context:s.extra.source_context,preview_type:s.extra.preview_type},a.extra)}))),i):i},rs=e=>{const t=$o(e);if(!t)return;const{file_preview_session_id:i,file_viewer_session_id:a,ns_id:n,sj_id:r,device_type:o,file_id:s,extra:{preview_type:l,source_context:c}}=null!=t?t:{extra:{}};return i&&a&&l&&c&&o?{file_preview_session_id:i,file_viewer_session_id:a,ns_id:n,sj_id:r,device_type:o,preview_type:l,source_context:c,file_id:s}:void 0},os=(e,t)=>{var i;const{payload:n}=t,{eventName:r,filePreviewSessionId:o}=n,s=rs(o);if(!s)return;const l=s.preview_type;if(l!==a.PreviewType.Video&&l!==a.PreviewType.Audio)throw new u.FVError(u.FVErrorCode.InvalidLoggingSession,u.ErrorLifecycle.Unknown,"Can't log video events for non-audio/video previews.");null===(i=e.logVideoEvent)||void 0===i||i.call(e,r,Jo(n,s,l))},ss=(e,t)=>{var i;const{payload:n}=t,{eventName:r,filePreviewSessionId:o}=n,s=rs(o);if(!s)return;const l=s.preview_type;if(l!==a.PreviewType.Video&&l!==a.PreviewType.Audio)throw new u.FVError(u.FVErrorCode.InvalidLoggingSession,u.ErrorLifecycle.Unknown,"Can't log video events for non-audio/video previews.");null===(i=e.logVideoEventQuantity)||void 0===i||i.call(e,r,n.quantity,Jo(n,s,l))},ls=(e,t)=>{var i;const{payload:n}=t,{eventName:r,filePreviewSessionId:o}=n,s=rs(o);if(!s)return;const l=s.preview_type;if(l!==a.PreviewType.Video&&l!==a.PreviewType.Audio)throw new u.FVError(u.FVErrorCode.InvalidLoggingSession,u.ErrorLifecycle.Unknown,"Can't log video events for non-audio/video previews.");null===(i=e.logVideoEventDuration)||void 0===i||i.call(e,r,n.durationInMs,Jo(n,s,l))},cs=(e,t,i)=>{const a=t.loggingSessionId[i.payload];return $o(a)&&e.logTTI(),i},ds=(e,t,i)=>{const{fileViewerId:n,sourceContext:r}=i.payload,o=t.loggingSessionId[n],s=$o(o);let l={context:r,action:es[i.type]};if(i.type===dn.CloseViewer){const e=Wn(t,n);if(e&&kn(e)&&is){const e=is();l=Object.assign(Object.assign({},l),e)}}return s&&e.log(a.EventType.UserAction,Xo(Object.assign(Object.assign({},s),{extra:Zo(l)}))),i},us=(e,t,i)=>{const{payload:n}=i,{userAction:r,actionContext:o,fileViewerId:s}=n,l=t.loggingSessionId[s],c=$o(l);return r in ts?console.warn(`WARNING: ${r} is automatically logged when it's in USER_ACTION_MAP. No need to call logUserAction for it.`):c&&e.log(a.EventType.UserAction,Xo(Object.assign(Object.assign({},c),{extra:Object.assign(Object.assign(Object.assign({},(null==c?void 0:c.extra.source_context)&&{source_context:c.extra.source_context}),n.extra),{action:r,context:o})}))),i},_s=(e,t,i)=>{const{payload:n}=i,{event:r,fileViewerId:o}=n,s=t.loggingSessionId[o],l=$o(s);return l&&e.log(a.EventType.Background,Xo(Object.assign(Object.assign({},l),{extra:Object.assign(Object.assign(Object.assign({},(null==l?void 0:l.extra.source_context)&&{source_context:l.extra.source_context}),n.extra),{event:r})}))),i},ps=(e,t,i)=>{const{fileViewerId:n,currentPath:r,isDir:o}=i.payload,s=t.loggingSessionId[n],l=$o(s);if(void 0!==o&&l){const t=Xo(Object.assign(Object.assign({},l),{extra:Zo({action:a.UserAction.ArchiveNavigation,context:a.UserActionContext.PreviewContentMain,isDir:String(o),extension:o?"":u.getWhitelistedFileExtension(u.getFileExtension(r[r.length-1]))})}));e.log(a.EventType.UserAction,t)}return i},gs=(e,t,i)=>{var a;const{eventName:n,duration:r,fileViewerId:o,tags:s,shouldLogToHive:l}=i.payload,c=t.loggingSessionId[o],d=$o(c);return d&&(null===(a=e.logDuration)||void 0===a||a.call(e,{eventName:n,durationInMs:r,session:d?Xo(d):void 0,tags:s,shouldLogToHive:l})),i};function fs(e){return({getState:t,dispatch:i})=>a=>n=>{var r,o;try{switch(n.type){case jo.LogSessionEvent:return a(as(e,t(),n));case jo.Log:return a(ns(e,t(),n));case jo.LogVideoEvent:return os(e,n),a(n);case jo.LogVideoEventQuantity:return ss(e,n),a(n);case jo.LogVideoEventDuration:return ls(e,n),a(n);case jo.LogUserAction:return a(us(e,t(),n));case jo.LogBackgroundEvent:return a(_s(e,t(),n));case jo.LogTTI:return a(cs(e,t(),n));case dn.UpdateArchiveFileCurrentPath:return a(ps(e,t(),n));case jo.LogDuration:return a(gs(e,t(),n));case dn.SetupGetPlayDurationSeconds:return void(is=n.payload.getPlayDurationSeconds)}if(n.type in es&&!n.payload.skipLogging)return a(ds(e,t(),n))}catch(e){if(e instanceof Error){const a=("object"==typeof n.payload&&"fileViewerId"in n.payload?null===(r=$o(t().loggingSessionId[n.payload.fileViewerId]))||void 0===r?void 0:r.extra.preview_type:"other")||"other";i(Mn({error:e,fileType:a,isCritical:(o=e,!sr(o)||o.type!==u.FVErrorCode.InvalidLoggingOrder&&o.type!==u.FVErrorCode.InvalidLoggingSession)})),console.warn(e.message)}}return a(n)}}function ms(e){const t=i.useRef();return i.useEffect((()=>{t.current=e}),[e]),t.current}const hs=new Set([a.PreviewsTimingEvents.CONTAINER_MOUNT,a.PreviewsTimingEvents.COLLECTION_VIEWER_MOUNT,a.PreviewsTimingEvents.SDK_FILE_VIEWER_CODE_START,a.PreviewsTimingEvents.FVSDK_CONSTRUCTOR,a.PreviewsTimingEvents.FVSDK_INITIALIZE_START,a.PreviewsTimingEvents.FVSDK_PLUGINS_INITIALIZED,a.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA_START_START,a.PreviewsTimingEvents.FVSDK_GET_PREVIEW_METADATA,a.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA,a.PreviewsTimingEvents.FVSDK_INITIALIZE_COMPLETE,a.PreviewsTimingEvents.FVSDK_TITLE_BAR_MOUNT,a.PreviewsTimingEvents.FVSDK_APP_MOUNT,a.PreviewsTimingEvents.FVSDK_MARK_TTVC,a.PreviewsTimingEvents.FVSDK_IMAGE_CONTAINER_MOUNT,a.PreviewsTimingEvents.FVSDK_IMAGE_ON_LOAD,a.PreviewsTimingEvents.FVSDK_VIDEO_CONTAINER_MOUNT,a.PreviewsTimingEvents.FVSDK_VIDEO_PLAYER_READY,a.PreviewsTimingEvents.FVSDK_DOC_CONTAINER_MOUNT,a.PreviewsTimingEvents.FVSDK_FIRST_DOC_PAGE_ON_LOAD,a.PreviewsTimingEvents.FVSDK_MARK_TTI]),vs=(e,t)=>{const i=b.useDispatch(),n=$r(Jn,e),{logger:r,isLoggedIn:o}=u.useFileViewerContext(),{onLogTimeline:s}=((e,t,i)=>{const n=$r(Jn,e),{logger:r}=u.useFileViewerContext(),o=te.default.useRef(!1),s=te.default.useCallback((()=>{var e;const s=a.PreviewsEventLogger.getStartEntry(),l=$o(n);if(s&&!o.current){const n=a.PreviewsEventLogger.getEventTimeline();Object.entries(n).forEach((([e,a])=>{var n;i.has(e)&&(null===(n=null==r?void 0:r.logDuration)||void 0===n||n.call(r,{eventName:t,durationInMs:a,tags:{event:e},session:l?Xo(l):void 0}))})),null===(e=null==r?void 0:r.logDuration)||void 0===e||e.call(r,{eventName:t,durationInMs:s.startTime,tags:{event:"session_start_since_load"},session:l?Xo(l):void 0}),o.current=!0}}),[r,t,n,i]);return{onLogTimeline:s}})(e,`preview_timeline_ttvc_${t}`,hs),l=te.default.useCallback((()=>{var t;a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.FVSDK_MARK_TTI),i((t=e,{type:jo.LogTTI,payload:t}))}),[e,i]),c=te.default.useCallback(((e,t)=>({navigation_type:e,file_flip:String(!!(null==t?void 0:t.extra.was_flipped)),logged_in_user:String(o)})),[o]),d=te.default.useCallback((e=>{var t,i;const a=$o(n);(null===(t=e.detail)||void 0===t?void 0:t.value)&&(null===(i=null==r?void 0:r.logDuration)||void 0===i||i.call(r,{eventName:"TTI",durationInMs:e.detail.value,shouldLogToHive:!0,tags:c(e.detail.isAjax?"ajax":"page_load",a),session:a?Xo(a):void 0}))}),[r,n,c]),_=te.default.useCallback((e=>{var t,i,o;a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.FVSDK_MARK_TTVC);const l=$o(n);(null===(t=e.detail)||void 0===t?void 0:t.value)&&(null===(i=null==r?void 0:r.logDuration)||void 0===i||i.call(r,{eventName:a.PREVIEW_TTVC_DURATION_EVENT,durationInMs:e.detail.value,tags:c(null!==(o=e.detail.navigation_type)&&void 0!==o?o:"unknown",l),shouldLogToHive:!0,session:l?Xo(l):void 0})),s()}),[r,s,n,c]),p=te.default.useCallback((e=>{var t,i;a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.FVSDK_MARK_LCP);const o=$o(n);(null===(t=e.detail)||void 0===t?void 0:t.value)&&(null===(i=null==r?void 0:r.logDuration)||void 0===i||i.call(r,{eventName:"largest_contentful_paint",durationInMs:e.detail.value,tags:c(e,o),shouldLogToHive:!0,session:o?Xo(o):void 0}))}),[r,n,c]);return te.default.useEffect((()=>(window.addEventListener("time_to_interactive",d),window.addEventListener("visually_complete",_),window.addEventListener("largest_contentful_paint",p),()=>{window.removeEventListener("time_to_interactive",d),window.removeEventListener("visually_complete",_),window.removeEventListener("largest_contentful_paint",p)})),[d,_,p]),{onLogTTI:l}},Ss=(e,t,i,a=!0)=>{const n=$r(Jn,e),{logger:r}=u.useFileViewerContext(),o=ms(a);te.default.useEffect((()=>{var e;const s=performance.getEntriesByName(t,"mark"),l=$o(n);if(s.length>0&&a&&!o){performance.clearMarks(t);const a=s[s.length-1],n=performance.now()-a.startTime;null===(e=null==r?void 0:r.logDuration)||void 0===e||e.call(r,{eventName:t,durationInMs:n,session:l?Xo(l):void 0,tags:i})}}),[r,a,o,n,i,t])};const Es=(e,t,i,a,n)=>{const r=i&&Pn(i);r&&a?((e,t,i,a,n)=>{const r=null!=n?n:o.queryClient,s=aa(e,i),l=r.getQueryData(s);l&&r.setQueryData(s,{apiData:Object.assign(Object.assign({},l.apiData),{[a]:t}),pkgData:null})})(e,t,a,i.subpath,n):r||ws(e,t,n)},ws=(e,t,i)=>{(null!=i?i:o.queryClient).setQueryData(ia(e),{apiData:{results:[{file:e,preview:Object.assign({},t)}]},pkgData:t})},bs=e=>void 0!==o.queryClient.getQueryData(ia(e)),ys=u.createSelector(Fn,Hn,((e,t)=>{if(null==e)return null;const{file_id:i,ns_id:a,sj_id:n,url:r}=e;if(null==i||null==a||null==n)return null;if(null==t)return null;const{file_name:o,file_path:s,file_last_modified_date:l,size:c}=t;return{fileId:i,lastModifiedDate:l,name:o,nsId:a,fqPath:s,sjId:n,url:r,size:c,revisionId:t.revisionId,readOnly:t.readOnly}})),Ts=(e,t)=>{const i=Fn(e,t);if(null!=i)return i.previewKey};const Is=i.createContext({titleBarPassUi:null,previewContent:null,titlebarDropdowns:null,toolbar:null}),Cs=()=>te.default.useContext(Is);a.injectInternalStyle("/static/js/file_viewer/loading_indicator/loading_indicator.module.out-vfloa_x0q.css",(e=>"._loadingContent_pg8hi_1{align-items:center;display:flex;flex:1;justify-content:center}@media (max-width:600px){._loadingContent_pg8hi_1{width:100%!important}}"));const As=()=>ur(),Ms=()=>As().previewType,Os=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=As(),i=$r(zn,e),n=$r(ys,e);return te.default.useMemo((()=>{if(!n)return null;if(t.previewType!==a.PreviewType.Image)return n;{const e=((e,t,i)=>{var a,n,r,o;const s=(l=i)&&"dimensions"in l&&l.dimensions?l:null;var l;return Object.assign(Object.assign({},e),{dimensions:{height:(null===(a=null==t?void 0:t.dimensions)||void 0===a?void 0:a.height)||(null===(n=null==s?void 0:s.dimensions)||void 0===n?void 0:n.height)||0,width:(null===(r=null==t?void 0:t.dimensions)||void 0===r?void 0:r.width)||(null===(o=null==s?void 0:s.dimensions)||void 0===o?void 0:o.width)||0}})})(n,t,i);if(e)return e}return null}),[n,t,i])},Ps=()=>{const{fileViewerId:e}=u.useFileViewerContext();return $r(er,e)},xs=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=$r(jn,e),i=_r();return Br(t,i)},Ds=(e,t)=>{const{optionalIOClients:{stormcrowClient:i}}=u.useFileViewerContext();return te.default.useMemo((()=>w.once((()=>{i&&"OFF"!==t&&i.logStormcrowExposure(e,t)}))),[e,i,t])},Rs=(e,t,i)=>{const a=Ds(e,t);te.default.useEffect((()=>{i&&a()}),[i,a])};const Ns={vertical:40,horizontal:72};a.injectInternalStyle("/static/js/file_viewer/preview_doc/preview_doc.module.out-vflZaDR3J.css",(e=>":root{--page-margin:16px;--page-margin-top:24px;--page-margin-left:24px}._textbox_1ythq_15{fill:transparent;cursor:text;opacity:.4;pointer-events:auto;-webkit-user-select:text;user-select:text}._textLayer_1ythq_20{left:0;mix-blend-mode:multiply;pointer-events:none;position:absolute;top:0;transform-origin:top left}._textLayer_1ythq_20 ::selection{background:var(--color__inverse__attention__background)}._textLayer_1ythq_20 text::selection{color:transparent}._linksLayer_1ythq_40{bottom:0;height:0;left:0;position:absolute;transform-origin:top left;width:0}._linksLayer_1ythq_40 ._internalLink_1ythq_50,._linksLayer_1ythq_40 a{cursor:pointer;display:block}._linksLayer_1ythq_40 ._internalLink_1ythq_50:focus,._linksLayer_1ythq_40 a:focus,._textbox_1ythq_15 a:focus{outline:auto}._imgLayer_1ythq_61{height:100%;overflow:hidden;position:relative;width:100%}._imgLayer_1ythq_61>img{background:#fff;display:block;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges;image-rendering:optimizeQuality;max-width:100%;pointer-events:auto;-webkit-user-select:none;user-select:none}.sc-annotation-conductor-layer ._imgLayer_1ythq_61>img{pointer-events:auto}._snackbar_1ythq_88{bottom:0;left:0;margin:auto;position:absolute;right:0;width:100%;z-index:1}._page_1ythq_98{margin:var(--page-margin)}._pdfViewport_1ythq_102 ._page_1ythq_98{margin:0;position:absolute;top:0}._pptViewport_1ythq_108 ._page_1ythq_98{background-color:#fff;box-sizing:border-box;flex-shrink:0;margin:auto;position:relative}._pptViewport_1ythq_108{-ms-overflow-style:-ms-autohiding-scrollbar;overflow:auto;position:relative}._pptSizer_1ythq_126,._pptViewport_1ythq_108{display:flex;height:100%;width:100%}._pdfViewport_1ythq_102{height:100%;overflow:auto;width:100%}._container_1ythq_138{align-items:stretch;display:flex;height:100%;justify-content:flex-start;overflow:hidden;width:100%}._container_1ythq_138 ol{list-style:none}._pdfViewport_1ythq_102 ol,._pptViewport_1ythq_108 ol{padding:0}._pdfViewport_1ythq_102 li{margin:var(--dig-spacing__micro__large) 0;position:absolute;top:0}._pdfViewport_1ythq_102 ol{align-items:center;display:flex;flex-direction:column;overflow:hidden;position:relative}._close_1ythq_170{right:16px}._app_1ythq_175{align-items:flex-end;display:flex;flex-grow:1;height:100%;justify-content:center;position:relative;width:100%}"));a.injectInternalStyle("/static/js/file_viewer/preview_doc/renderer/doc_sidebar.module.out-vflS9ITDd.css",(e=>":root{--thumbnailWidth:112px;--imgZIndex:1;--border:4px;--sidebar-width:196px}._container_pmkgf_14{background-color:var(--dig-color__background__raised);flex-shrink:0;font-size:var(--type__body__standard--fontsize);height:100%;outline:none;overflow:auto;transition:width 40ms;width:0;will-change:width}._container_pmkgf_14._open_pmkgf_26{width:var(--sidebar-width)}._container_pmkgf_14._open_pmkgf_26._containerBorder_pmkgf_30{border-right:1px solid var(--dig-color__border__subtle)}._container_pmkgf_14 ol{border:none;box-sizing:border-box;height:100%;list-style:none;margin:0;overflow:hidden;padding:var(--dig-spacing__macro__medium) 0 0 0;position:relative}._container_pmkgf_14 li{position:absolute;top:0;transform:translateX(-50%)}._container_pmkgf_14 li a:any-link{box-sizing:border-box;color:var(--dig-color__text__base);display:flex;margin-bottom:var(--dig-spacing__macro__small);outline:none;padding:0 0 0 34px;position:relative;text-decoration:none}._container_pmkgf_14._isEditMode_pmkgf_69 li a:any-link{color:var(--color__inverse__standard__text)}._thumbnail_pmkgf_73{font-size:0;line-height:0;position:relative;width:var(--thumbnailWidth)}._thumbnailContainer_pmkgf_80{align-items:center;display:flex;flex-direction:column;gap:var(--dig-spacing__micro__small);padding:var(--dig-spacing__micro__small) var(--dig-spacing__micro__medium)}._thumbnail_pmkgf_73 img{border:1px solid var(--dig-color__border__subtle);border-radius:4px;box-sizing:border-box;margin:3px;position:absolute;width:calc(100% - var(--border)*2 + 2px);z-index:var(--imgZIndex)}._thumbnail_pmkgf_73 ._loader_pmkgf_100{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}._thumbnail_pmkgf_73._selected_pmkgf_109 img{border:4px solid var(--dig-color__border__subtle);border-radius:4px;margin:0;width:100%}._container_pmkgf_14._focused_pmkgf_116 ._thumbnail_pmkgf_73._selected_pmkgf_109 img{border:4px solid var(--dig-color__utility__focus-ring);border-radius:4px}._thumbnail_pmkgf_73._isUnfocusedInEditMode_pmkgf_121._selected_pmkgf_109{border-color:var(--color__inverse__standard__border)}"));const ks="196px",Ls=parseInt("16px",10),Fs=parseInt("24px",10),Us=parseInt("24px",10),Vs=parseInt(ks,10),js=Vs+600,Bs=[...a.PDF_EXTS,...a.WORDPROC_EXTS];function Hs(e){return a.PRESENTATION_EXTS.includes(u.getFileExtension(e))}function Ks(e,t){return e>=js&&(t===a.PreviewType.SsrDoc||t===a.PreviewType.CloudDoc)}function zs(e){const{width:t,height:i,dimensions:a,isDocSidebarVisible:n,scaleToFit:r,fileName:o,maxWidth:s}=e;if(0===a.length)return 1;const l=Math.max(0,t-Ls-Us-(n?Vs:0)-30),c=Hs(o)?Math.max(0,i-2*Fs):Math.max(0,i-Fs),d=null!=s?Math.min(l,s):l,_=c,p=Bs.includes(u.getFileExtension(o)),g="width_and_height"===r&&!p,f=a.reduce(((e,[t,i])=>Math.min(e,d/t,g?_/i:Number.POSITIVE_INFINITY)),Number.POSITIVE_INFINITY);return Math.min(f,g?Number.POSITIVE_INFINITY:1.75)}const Ws=({url:e,width:t,height:i,onImgLoad:a,sizeScale:n})=>te.default.createElement("div",{className:"skeleton-page-container",style:{margin:"auto",width:`${t}px`,height:`${i}px`}},te.default.createElement("img",{className:"skeleton-image",src:e,style:{width:`${t}px`,height:`${i}px`,opacity:"60%"},alt:"",onLoad:a,sizes:n?`${n}vw`:void 0}));Ws.displayName="SkeletonPage";const Gs=({viewportWidth:e,viewportHeight:t,docSidebarCollapsed:r,previewMetadata:o,previewKey:s,fileName:l})=>{var c,d;const[u,_]=te.default.useState(0),[p,g]=te.default.useState(0),[f,m]=te.default.useState(0),h=!r&&Ks(e,a.PreviewType.SsrDoc)?Vs:0,v=Hs(l),S=Hr(s,o),E="ssr_doc"===(null===(c=null==o?void 0:o.content)||void 0===c?void 0:c[".tag"])||"cloud_doc"===(null===(d=null==o?void 0:o.content)||void 0===d?void 0:d[".tag"])?null==o?void 0:o.content:void 0;te.default.useEffect((()=>{const i=i=>{const a=zs({width:e,height:t,dimensions:i.dimensions,isDocSidebarVisible:!r,fileName:l,scaleToFit:"width_and_height"}),n=i.dimensions[0][0],o=i.dimensions[0][1],s=100*(n*a)/window.innerWidth/window.devicePixelRatio;_(n*a),g(o*a),m(2*s)};0!==(null==S?void 0:S.page_count)&&(null==S?void 0:S.dimensions.length)&&i(S)}),[S,r,l,t,e]);const[w,b]=te.default.useState();return i.useEffect((()=>{E&&(e=>n.__awaiter(void 0,void 0,void 0,(function*(){return e.image_url_tmpl?kr.fetchDocImage({imageUrlTmpl:e.image_url_tmpl}):Promise.resolve({data:void 0})})))(E).then((({data:e})=>b(e)))}),[E]),te.default.createElement("div",{className:"skeleton-doc-viewport-wrapper",style:{width:`${e}px`,height:"100%",display:"flex",overflow:"hidden"}},h>0&&te.default.createElement("div",{className:"skeleton-doc-sidebar",style:{width:`${h}px`,height:"100%",boxSizing:"border-box",borderRight:"1px solid rgba(166,158,146,0.6)",flexShrink:0}}),w&&te.default.createElement("div",{className:"skeleton-doc-viewport",style:{display:"flex",width:"100%"}},v?te.default.createElement("div",{className:"skeleton-ppt-viewport",style:{width:"100%"}},te.default.createElement("div",{className:"skeleton-ppt-sizer",style:{height:`calc(100% - ${2*Fs}px)`,width:"100%",display:"flex"}},te.default.createElement(Ws,{width:u,height:p,url:w,sizeScale:f}))):te.default.createElement("ol",{style:{width:e-h+"px",height:`${p}px`,padding:0,listStyle:"none",display:"flex",flexDirection:"column",alignItems:"center",overflow:"hidden"}},te.default.createElement("li",{style:{transform:"translateY(16px)",margin:"16px 0"}},te.default.createElement(Ws,{width:u,height:p,url:w,sizeScale:f})))))};Gs.displayName="SkeletonViewportDoc";const qs=({viewport:e,imageContent:t,dimensions:i})=>{const[a,n]=te.default.useState();te.default.useEffect((()=>{(e=>{const t=e.default_src;return t?kr.fetchImage(t):Promise.resolve({data:void 0})})(t).then((({data:e})=>n(e)))}),[t]);const[r,o]=te.default.useState(),[s,l]=te.default.useState(!!i),c=te.default.useMemo((()=>{const t=(null==i?void 0:i.width)||(null==r?void 0:r.width)||0,a=(null==i?void 0:i.height)||(null==r?void 0:r.height)||0;return t&&a&&l(!0),t>e.width||a>e.height}),[null==i?void 0:i.height,null==i?void 0:i.width,null==r?void 0:r.height,null==r?void 0:r.width,e.height,e.width]),d=te.default.useCallback((({currentTarget:{naturalWidth:e,naturalHeight:t}})=>{e&&t&&o({height:t,width:e})}),[]);return te.default.createElement("div",{style:s?{height:"100%",width:"100%"}:{height:0,width:0,overflow:"hidden"}},te.default.createElement("img",{src:a,onLoad:d,style:{height:"100%",width:"100%",boxSizing:"border-box",objectFit:c?"contain":"scale-down",paddingTop:Ns.vertical/2,paddingBottom:Ns.vertical/2,paddingLeft:Ns.horizontal/2,paddingRight:Ns.horizontal/2},alt:""}))};qs.displayName="SkeletonViewportImage";const Qs=({width:e,height:t,docSidebarCollapsed:i,previewKey:n,featureConfig:r,fileContent:o,fileName:s})=>{const l=null==o?void 0:o.content,c=null==l?void 0:l[".tag"],d="BOTH"===r.previews_exp_remove_skeleton||"CONTROL"===r.previews_exp_remove_skeleton||"IMAGES"===r.previews_exp_remove_skeleton&&c===a.PreviewType.Image||"DOCS"===r.previews_exp_remove_skeleton&&(c===a.PreviewType.SsrDoc||c===a.PreviewType.CloudDoc);if(Rs("previews_exp_remove_skeleton",r.previews_exp_remove_skeleton,d),"BOTH"===r.previews_exp_remove_skeleton)return null;const u={width:e,height:t};return te.default.createElement("div",{className:"skeleton-viewport",style:u},c===a.PreviewType.Image&&"IMAGES"!==r.previews_exp_remove_skeleton&&"ON"!==r.previews_exp_img_size_optimization_variant&&te.default.createElement(qs,{viewport:u,imageContent:l,dimensions:null==o?void 0:o.dimensions}),c===a.PreviewType.SsrDoc&&"DOCS"!==r.previews_exp_remove_skeleton&&te.default.createElement(Gs,{viewportWidth:e,viewportHeight:t,docSidebarCollapsed:i,previewMetadata:o,previewKey:n,fileName:s}),c===a.PreviewType.CloudDoc&&"DOCS"!==r.previews_exp_remove_skeleton&&te.default.createElement(Gs,{viewportWidth:e,viewportHeight:t,docSidebarCollapsed:i,previewMetadata:o,previewKey:n,fileName:s}))};Qs.displayName="SkeletonViewportComponent";const Ys=te.default.memo(Qs);Ys.displayName="SkeletonViewport";const $s=({activeOverlayEditor:e,width:t})=>{var i;const n=a.useIntl(),{rendererWidth:r,rendererHeight:o}=te.useContext(vo),{fileViewerId:s,featureConfig:l}=u.useFileViewerContext(),c=_r(),d=c.previewType,_=$r(Xn,s),p=$r(jn,s),g=$r(tr,s),f=Zr(Bn,p),m=null!==(i=null==f?void 0:f.file_name)&&void 0!==i?i:"",h=Ks(t,d),v=$r(Gn,s),S=h&&(null==v?void 0:v.isDocSidebarOpen),E=!!e,w=!!p&&Pn(p),b=!E&&!y.isSupportedMobileBrowser()&&function(e){if(!e)return!1;const t=e[".tag"];return t===a.PreviewType.Image||t===a.PreviewType.SsrDoc||t===a.PreviewType.CloudDoc}(null==c?void 0:c.content)&&!_&&!w,T=te.default.createElement(a.Spinner,{"aria-label":n.formatMessage({id:"zqXonC",defaultMessage:"Your preview is loading"})}),I=b&&te.default.createElement(Ys,{width:r,height:o,fileContent:c,docSidebarCollapsed:!S,featureConfig:l,previewKey:p,fileName:m});return te.default.createElement("div",{className:"_loadingContent_pg8hi_1"},g?b?I:T:null)};$s.displayName="LoadingIndicator";a.injectInternalStyle("/static/js/file_viewer/preview_content/preview_content.module.out-vflEvd5Ci.css",(e=>"._previewContent_1o8j2_1{align-items:stretch;background:var(--dig-color__background__subtle);flex:1;flex-direction:column;max-height:100%;max-width:100%}._previewContent_1o8j2_1,._previewContentWrapper_1o8j2_13{display:flex;position:relative;width:100%}._previewContentWrapper_1o8j2_13{height:100%}._hidden_1o8j2_20{display:none}"));const Zs=e=>{const[t,i]=te.default.useState(!0),a=te.default.useRef(void 0),n=te.default.useMemo((()=>w.throttle((()=>{const t=()=>{a.current&&window.clearTimeout(a.current)};return i(!0),t(),a.current=window.setTimeout((()=>{i(!1)}),e),t}))),[e]);te.default.useEffect((()=>(window.addEventListener("mousemove",n),()=>window.removeEventListener("mousemove",n))));return{isUserInteractingWithElement:t,handleFocus:te.default.useCallback((()=>{i(!0)}),[]),handleBlur:te.default.useCallback((()=>{i(!1)}),[])}};var Xs;t.FileViewerBreakpoint=void 0,(Xs=t.FileViewerBreakpoint||(t.FileViewerBreakpoint={})).SM="small",Xs.MD="medium",Xs.LG="large";const Js=()=>{const e=(()=>{const[e,t]=te.default.useState();return te.default.useEffect((()=>{const e=new a.ResizeObserver((e=>{t(e[0].contentRect)}));return e.observe(document.body),()=>e.disconnect()}),[]),e})(),i=null==e?void 0:e.width;return void 0===i||i>1024?t.FileViewerBreakpoint.LG:i>768?t.FileViewerBreakpoint.MD:t.FileViewerBreakpoint.SM},el=({label:e,onClick:t,icon:i,disabled:n,variant:r})=>te.createElement(a.IconButton,{variant:null!=r?r:"transparent","aria-label":e,onClick:t,disabled:n},te.createElement(a.UIIcon,{src:i,width:"20px",height:"20px"}));el.displayName="ToolbarIcon";const tl=e=>e===t.FileViewerBreakpoint.MD||e===t.FileViewerBreakpoint.SM,il=({fileViewerId:e,previewKey:t,variant:i})=>{const n=b.useDispatch(),r=a.useIntl(),o=$r(Yn,e),s=Jr((()=>{const i={fileViewerId:e,previewKey:t,sourceContext:a.UserActionContext.PreviewToolbar};n(o?bn(i):wn(i))})),l=o?r.formatMessage({id:"VOB6G0",defaultMessage:"Exit full screen"}):r.formatMessage({id:"2iLco8",defaultMessage:"Full screen"});return te.createElement(el,{label:l,onClick:s,icon:o?T.FullscreenExitLine:T.FullscreenLine,disabled:!1,variant:i})};il.displayName="FullscreenButton";a.injectInternalStyle("/static/js/file_viewer/ui/fullscreen_right_section.module.out-vflUdQoXf.css",(e=>":root{--abovePreviewZIndex:10}._fullscreenRightSection_k1zqn_5{display:flex;gap:var(--dig-spacing__micro__small);padding:var(--dig-spacing__macro__xsmall);position:absolute;right:0;top:0;transition:opacity var(--easing__transition) var(--duration__micro);z-index:var(--abovePreviewZIndex)}._hidden_k1zqn_16{opacity:0}"));const al=({fileViewerId:e})=>{const t=a.useIntl(),i=b.useDispatch(),{logUserAction:n}=u.useFileViewerContext(),r=$r(Gn,e),o=null==r?void 0:r.isUiHidden.fullscreen,s=o?a.ShowLine:a.HideLine,l=o?t.formatMessage({id:"qJIBhE",defaultMessage:"Show toolbar"}):t.formatMessage({id:"Pwe/D+",defaultMessage:"Hide toolbar"}),c=Jr((()=>{const t={fileViewerId:e,isFullscreen:!0,sourceContext:a.UserActionContext.TitleBarMain};o?(n(a.UserAction.ShowTools,a.UserActionContext.PreviewToolbar),i(Sn(t))):(n(a.UserAction.HideTools,a.UserActionContext.PreviewToolbar),i(En(t)))}));return te.default.createElement(a.Button,{variant:"opacity",withIconStart:te.default.createElement(a.UIIcon,{src:s}),onClick:c},l)};al.displayName="HideToolbarButton";const nl=({fileViewerId:e,previewKey:t})=>{const{isUserInteractingWithElement:i,handleBlur:n,handleFocus:r}=Zs(5e3),o=Ms();return te.default.createElement("div",{className:a.cx("_fullscreenRightSection_k1zqn_5",{_hidden_k1zqn_16:!i}),onBlur:n,onFocus:r},te.default.createElement(al,{fileViewerId:e}),o!==a.PreviewType.Video&&o!==a.PreviewType.Audio&&te.default.createElement(il,{fileViewerId:e,previewKey:t,variant:"borderless"}))};nl.displayName="FullscreenRightSection";a.injectInternalStyle("/static/js/file_viewer/ui/show_tools_button.module.out-vflakd9Zc.css",(e=>":root{--abovePreviewZIndex:10}._showTools_10bo0_5{padding:var(--dig-spacing__micro__large);position:absolute;right:0;top:0;transition:opacity var(--easing__transition) var(--duration__micro);z-index:var(--abovePreviewZIndex)}._hidden_10bo0_14{opacity:0}"));const rl=({fileViewerId:e})=>{const t=a.useIntl(),i=b.useDispatch(),{isUserInteractingWithElement:n,handleBlur:r,handleFocus:o}=Zs(5e3),s=Jr((()=>{const t={fileViewerId:e,isFullscreen:!1,sourceContext:a.UserActionContext.TitleBarMain};i(Sn(t))}));return te.default.createElement("div",{className:a.cx("_showTools_10bo0_5",{_hidden_10bo0_14:!n}),onFocus:o,onBlur:r},te.default.createElement(a.Button,{variant:"opacity",withIconLeft:te.default.createElement(a.UIIcon,{src:a.ShowLine}),onClick:s},t.formatMessage({id:"vQPZmq",defaultMessage:"Show tools"})))};rl.displayName="ShowToolsButton";const ol=({activeOverlayEditor:e,children:t,width:n})=>{const{fileViewerId:r}=u.useFileViewerContext(),o=$r(jn,r),s=$r(Yn,r),l=$r(Zn,r),c=$r(tr,r);(()=>{const{fileViewerId:e,optionalIOClients:{preferencesClient:t}}=u.useFileViewerContext(),i=b.useDispatch();te.default.useEffect((()=>{var n;const r=null===(n=null==t?void 0:t.ui)||void 0===n?void 0:n.getHiddenState();i((r?En:Sn)({fileViewerId:e,sourceContext:a.UserActionContext.Initialization,isFullscreen:!0}))}),[i,e,null==t?void 0:t.ui])})();const{handleTouchStart:d,handleTouchEnd:_}=((e,t)=>{const n=b.useDispatch(),r=i.useRef(0),o=i.useRef(0),s=i.useRef(0),l=i.useRef(!1);return{handleTouchStart:i.useCallback((e=>{const t=e.changedTouches[0];r.current=Date.now(),o.current=t.pageX,s.current=t.pageY,e.touches.length>1&&(l.current=!0)}),[r,o,s,l]),handleTouchEnd:i.useCallback((i=>{const c=i.changedTouches[0];if(l.current)return void(0===i.touches.length&&(l.current=!1));if(Math.abs(c.pageY-s.current)>200)return;if(Date.now()-r.current>500)return;const d=c.pageX-o.current;d<=-100?n(yn({fileViewerId:e,previewKey:t,sourceContext:a.UserActionContext.SurfaceGesture})):d>=100&&n(Tn({fileViewerId:e,previewKey:t,sourceContext:a.UserActionContext.SurfaceGesture}))}),[e,t,r,o,s,l,n])}})(r,o);return te.default.createElement("div",{className:"_previewContentWrapper_1o8j2_13",onTouchStart:d,onTouchEnd:_},c?te.default.createElement($s,{activeOverlayEditor:e,width:n}):null,te.default.createElement("div",{className:a.cx("_previewContent_1o8j2_1",{_hidden_1o8j2_20:c})},l?s?te.default.createElement(nl,{fileViewerId:r,previewKey:o}):te.default.createElement(rl,{fileViewerId:r}):null,t))};ol.displayName="PreviewContent";const sl=()=>{const{previewContent:e}=Cs();return te.default.useMemo((()=>{return e?(t=e,e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(t,Object.assign({},e)))):ol;var t}),[e])},ll=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=$r(Fn,e),i=$r(er,e),a=$r(jn,e);return a&&Pn(a)?ta(t,i):ea(t,i)};class cl extends te.default.PureComponent{componentDidCatch(e){this.props.onError(e)}static getDerivedStateFromError(){return{}}render(){return this.props.children}}cl.displayName="UnconnectedErrorBoundary";const dl=({fileViewerId:e,previewKey:t,children:i})=>{var n;const r=_r(),o=ll(),s=$r(ar,e),l=null===(n=u.useFileViewerContext().optionalIOClients.reportExceptionClient)||void 0===n?void 0:n.reportException,c=Jr((e=>{var i;null==l||l(e,(null===(i=null==r?void 0:r.content)||void 0===i?void 0:i[".tag"])||"other",!0),t&&Es(o,{previewType:a.PreviewType.Error,error:sr(e)?e:new u.FVError(u.FVErrorCode.Unknown,u.ErrorLifecycle.Render,e.message)},t,s)}));return te.default.createElement(cl,{onError:c},i)};dl.displayName="ErrorBoundary";const ul=e=>{var t,i;const n=null==e?void 0:e.previewType;if((n===a.PreviewType.SsrDoc||n===a.PreviewType.CloudDoc)&&"cloud_doc"===(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t[".tag"])&&(null===(i=null==e?void 0:e.content)||void 0===i?void 0:i.exit_url))return e.content.exit_url},_l=()=>{const[e,t]=te.default.useState(null),[i,n]=te.default.useState();return te.default.useEffect((()=>{if(!e)return;const t=new a.ResizeObserver((e=>n(e[0].contentRect)));return t.observe(e),n(e.getBoundingClientRect()),()=>t.disconnect()}),[e]),{nodeRef:t,contentRect:i,node:e}},pl=(e,t,i,a)=>{const n=b.useDispatch();te.default.useMemo((()=>{e&&t&&n(Bo({event:t,previewSessionId:e}))}),[t,n,e]),te.default.useMemo((()=>{e&&a&&n(Bo({event:i,previewSessionId:e}))}),[n,a,e,i])},gl=(e,t)=>{pl(e,a.SessionEventType.FilePreviewDownloadAttempted,a.SessionEventType.FilePreviewDownloadSucceeded,t)},fl=(e,t)=>{const i=b.useDispatch(),{deviceType:n,fileViewerId:r,featureConfig:o,sourceSession:s}=u.useFileViewerContext(),l=$r(Fn,r),c=$r(Hn,r);te.default.useRef(o).current=o;const d=te.default.useRef(s);d.current=s;const[_,p]=te.default.useMemo((()=>{const i=qo();if(!e||!l||!(null==c?void 0:c.file_name))return[void 0,void 0];const o=Pn(e),s=u.getFileExtension(o?e.subpath:c.file_name),_=o?{source_context:a.SourceContext.ArchiveFile,page_start_ts:Date.now(),was_flipped:!1}:d.current,p=u.resolvePreviewTypeFromExtension(s);var g,f;return g=i,f={file_viewer_session_id:r,file_preview_session_id:i,file_id:l.file_id,sj_id:l.sj_id,ns_id:l.ns_id,device_type:n,file_extension:u.getWhitelistedFileExtension(s),file_preview_size:c.size,extra:Object.assign(Object.assign({},_),{preview_type:p})},Yo=Object.assign(Object.assign({},Yo),{[g]:Qo(f)}),null==t||t(i),[i,{fileViewerId:r,previewKey:e,fileExtension:s,previewType:p,filePreviewSessionId:i}]}),[n,r,t,e,l,null==c?void 0:c.file_name,null==c?void 0:c.size]);return te.default.useEffect((()=>{var e;p&&i((e=p,{type:dn.InitializeFilePreviewSession,payload:e}))}),[i,p]),_},ml=(e,t,a=[])=>{const n=i.useRef(null),r=()=>{n.current&&(window.clearTimeout(n.current),n.current=null)};return i.useEffect((()=>r),[...a,t]),()=>{r(),n.current=window.setTimeout(e,t)}},hl=(e,t,i)=>{const{fileViewerId:n}=u.useFileViewerContext(),r=te.default.useRef(!1),o=ll(),s=$r(ar,n);if(!r.current&&t&&(null==i?void 0:i.previewType)&&(a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA_START_START),e.isSuccess&&(a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA),r.current=!0),e.isError)){const i=sr(e.error)?e.error:new u.FVError(u.FVErrorCode.RivieraDataFetchFailure,u.ErrorLifecycle.Download,e.error.message),n={previewType:a.PreviewType.Error,error:i};Es(o,n,t,s),r.current=!0}},vl=(e,t)=>{const i=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){return{default:(yield t())[e]}})))),a=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(i,Object.assign({},e)));return a.displayName=`Async${e}`,a},Sl=vl("PreviewArchive",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_archive2"],t,i)})))),El=e=>{const{previewKey:t,previewSessionId:i}=e,a=_r(),n=Wr(t,a);return gl(i,n.isSuccess),hl(n,t,a),te.default.createElement(Sl,Object.assign({},e,{archiveDataResult:n}))};El.displayName="AsyncPreviewArchiveWithRivieraFetch";const wl=(e,t,i,a)=>{var r,s,l,c,d;const u=o.useQueryClient(),_=o.createGenericQuery({queryRouteFilter:["custom","CustomMutation"],queryFn:()=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){return{apiData:void 0,pkgData:null}})),getQueryKey:o.getGenericQueryKey("custom","CustomMutation",(e=>{var t;return null===(t=e.previewKey)||void 0===t?void 0:t.serialized})),optionsFn:()=>({retry:!1,cacheTime:1/0,staleTime:1/0})}),p=_.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null}),g=o.createGenericQuery({queryRouteFilter:["custom","CustomMutationError"],queryFn:()=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){return{apiData:void 0,pkgData:null}})),getQueryKey:o.getGenericQueryKey("custom","CustomMutationError",(e=>{var t;return null===(t=e.previewKey)||void 0===t?void 0:t.serialized})),optionsFn:()=>({retry:!1,cacheTime:1/0,staleTime:1/0})}),f=g.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null}),m=o.createGenericQuery({queryRouteFilter:["custom","CustomMutationSuccess"],queryFn:()=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){return{apiData:void 0,pkgData:null}})),getQueryKey:o.getGenericQueryKey("custom","CustomMutationSuccess",(e=>{var t;return null===(t=e.previewKey)||void 0===t?void 0:t.serialized})),optionsFn:()=>({retry:!1,cacheTime:1/0,staleTime:1/0})}),h=m.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null}),v=["custom","riviera_mutation",null==e?void 0:e.serialized],S=o.useMutation(v,((...a)=>n.__awaiter(void 0,void 0,void 0,(function*(){u.setQueryData(["CustomMutationError",v],null),u.setQueryData(["CustomMutationSuccess",v],!1);try{const n=yield i(...a);return _.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:n,pkgData:null}),m.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:!0,pkgData:null}),g.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:void 0,pkgData:null}),n}catch(i){const a=i;_.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:void 0,pkgData:null}),g.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:a,pkgData:null}),m.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:!1,pkgData:null})}}))),a),E=function(e,t,i){const[a,n={}]=o.parseMutationFilterArgs(e,t,i),r=o.useQueryClient({context:n.context}),s=r.getMutationCache();return o.useSyncExternalStore(te.useCallback((e=>s.subscribe(o.notifyManager.batchCalls(e))),[s]),(()=>r.isMutating(a)),(()=>r.isMutating(a)))}(v);return Object.assign(Object.assign({},S),{data:null===(r=p.data)||void 0===r?void 0:r.apiData,isLoading:!!E,error:null===(s=f.data)||void 0===s?void 0:s.apiData,isError:!!(null===(l=f.data)||void 0===l?void 0:l.apiData),isSuccess:null!==(d=null===(c=h.data)||void 0===c?void 0:c.apiData)&&void 0!==d&&d,reset:()=>{_.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:void 0,pkgData:null}),m.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:void 0,pkgData:null}),g.setQueryData(u,{previewKey:e,previewMetadata:t},{apiData:void 0,pkgData:null}),S.reset()}})},bl=(e,t,i)=>{const a=[yl.prefetchQuery(e,{apiArg:{previewKey:t,previewMetadata:i},pkgArg:null})];return a.push(Il.prefetchQuery(e,{apiArg:{previewKey:t,previewMetadata:i},pkgArg:null})),Promise.all(a)},yl=gr({fileTypeSpecificQueryFn:e=>n.__awaiter(void 0,void 0,void 0,(function*(){const t=null==e?void 0:e.content;if("video"!==(null==t?void 0:t[".tag"])||!t.metadata_url)return;const i=yield kr.fetchMediaMetadata(t.metadata_url);if(i.error)throw i.error;return i.data})),fieldName:"media_metadata"}),Tl=(e,t)=>yl.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null},{enabled:!!e&&!!t}),Il=gr({fileTypeSpecificQueryFn:e=>n.__awaiter(void 0,void 0,void 0,(function*(){const t=null==e?void 0:e.content;if("audio"!==(null==t?void 0:t[".tag"])||!t.waveform_url)return;const i=yield kr.fetchWaveformData(t.waveform_url);if(i.error)throw i.error;return i.data})),fieldName:"waveform_data"}),Cl=(e,t)=>Il.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null},{enabled:!!e&&!!t}),Al=gr({fileTypeSpecificQueryFn:e=>n.__awaiter(void 0,void 0,void 0,(function*(){const t=null==e?void 0:e.content;if("video"!==(null==t?void 0:t[".tag"])&&"audio"!==(null==t?void 0:t[".tag"])||!t.transcript_url)return;const i=yield kr.fetchTranscriptData(t.transcript_url);if(i.error)throw i.error;return Object.assign({segments:i.data.segments||[],transcriptLocale:i.data.transcriptLocale},i.data)})),fieldName:"transcript_data"}),Ml=(e,t)=>{const i=null==t?void 0:t.content,a="video"===(null==i?void 0:i[".tag"])||"audio"===(null==i?void 0:i[".tag"]);return Al.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null},{enabled:!!e&&!!t&&a})},Ol=(e,t)=>{const{optionalIOClients:{flowsClient:i},isLoggedIn:a}=u.useFileViewerContext(),r=o.useQueryClient(),s=te.default.useCallback((({previewKey:e,previewMetadata:t,fileId:o,sharedLinkUrl:s})=>n.__awaiter(void 0,void 0,void 0,(function*(){var n,l,c;if(!i||!o||!e)throw new u.TranscriptRivieraError("error_unknown");if(!a)throw new u.TranscriptRivieraError("insufficient_permissions");if(("video"===(null===(n=null==t?void 0:t.content)||void 0===n?void 0:n[".tag"])||"audio"===(null===(l=null==t?void 0:t.content)||void 0===l?void 0:l[".tag"]))&&"opted_in"!==(null===(c=t.content.transcript_permission)||void 0===c?void 0:c[".tag"]))throw new u.TranscriptRivieraError("insufficient_permissions");const d=yield i.submitFileWorkflow({template:{sequence:[{workflow_action:{".tag":"transcribe_media"}}]},file_ids:[o],shared_link_url:s},900);if("success"===d.status)return Al.refetchQueries(r,{previewKey:e,previewMetadata:t}),!0;if("error"===d.status){Al.refetchQueries(r,{previewKey:e,previewMetadata:t});throw new u.TranscriptRivieraError(d.errorReason||"error_unknown")}throw new u.TranscriptRivieraError("error_unknown")}))),[i,a,r]);return wl(e,t,s)},Pl=vl("PreviewAudioVideo",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_audio_video_preview_video"],t,i)})).then((function(e){return e.preview_video_esnext})))),xl=e=>{const{fileViewerId:t,previewKey:i,previewSessionId:n}=e,r=ll(),s=$r(ar,t);Pn(i)&&Es(r,{previewType:a.PreviewType.Error,error:new u.FVError(u.FVErrorCode.NestedFiletypeNotSupported,u.ErrorLifecycle.Render)},i,s);const l=_r(),c=o.useQueryClient();l&&bl(c,i,l),gl(n,!0);const d=Tl(i,l),_=Cl(i,l),p=(null==l?void 0:l.previewType)===a.PreviewType.Audio?_:d;return hl(p,i,l),te.default.createElement(Pl,Object.assign({},e))};xl.displayName="AsyncPreviewAudioVideoWithLifecycleLogging";const Dl=vl("PreviewCloudDoc",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_cloud_doc"],t,i)})))),Rl=e=>(gl(e.previewSessionId,!0),te.default.createElement(Dl,Object.assign({},e)));Rl.displayName="AsyncPreviewCloudDocWithRivieraFetch";const Nl=vl("PreviewDeprecatedGdss",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_cloud_doc_preview_deprecated_gdss"],t,i)})))),kl=e=>(gl(e.previewSessionId,!0),te.default.createElement(Nl,Object.assign({},e)));kl.displayName="AsyncPreviewDeprecatedGdssWithRivieraFetch";const Ll=vl("PreviewDoc",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_doc"],t,i)})))),Fl=e=>{const{previewKey:t,previewSessionId:i}=e,a=_r(),n=Vr(t,a);hl(n,t,a);const r=Kr(null==a?void 0:a.content,n);return gl(i,!!r&&!(null==r?void 0:r.needsPassword)),te.default.createElement(Ll,Object.assign({},e,{rivieraData:r,fetchNextPageBatch:n.fetchNextPage}))};Fl.displayName="AsyncPreviewDocWithRiviera";const Ul=vl("PreviewError",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_error"],t,i)})))),Vl=vl("PreviewHTML",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_html"],t,i)})))),jl=e=>(gl(e.previewSessionId,!0),te.default.createElement(Vl,Object.assign({},e)));jl.displayName="AsyncPreviewHTMLWithRivieraFetch";const Bl=vl("PreviewImage",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_image"],t,i)})))),Hl=e=>(gl(e.previewSessionId,!0),te.default.createElement(Bl,Object.assign({},e))),Kl=gr({fileTypeSpecificQueryFn:e=>n.__awaiter(void 0,void 0,void 0,(function*(){var t;if("linkfile"!==(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t[".tag"])||!e.content.url)throw new Error("Invalid preview metadata provided for linkfile preview");const{url:i,authenticated:a}=e.content,n=yield kr.fetchLinkfileData(i,!!a);if(n.error)throw n.error;return n.data.uri})),fieldName:"linkfile_uri"}),zl=vl("PreviewLinkfile",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_linkfile2"],t,i)})))),Wl=e=>{const{previewKey:t,previewSessionId:i}=e,a=_r(),n=((e,t)=>Kl.useQuery({apiArg:{previewKey:e,previewMetadata:t},pkgArg:null},{enabled:!!e&&!!t}))(t,a);return gl(i,n.isSuccess),hl(n,t,a),te.default.createElement(zl,Object.assign({},e,{linkfileResult:n}))};Wl.displayName="AsyncPreviewLinkfileWithLifecycleLogging";const Gl=e=>{const{children:t,className:i}=e,{nodeRef:n,contentRect:r}=_l();return te.createElement("div",{className:a.cx("_container_1a5di_1",i),ref:n,id:"fvsdk-container"},r&&(null==t?void 0:t(r)))};Gl.displayName="Preview";const ql=e=>{var t,i,{callbacks:r}=e,o=n.__rest(e,["callbacks"]);const s=b.useDispatch(),{fileViewerId:l}=u.useFileViewerContext(),c=$r(jn,l),d=Zr(Bn,c),_=_r(),p=null==_?void 0:_.previewType,g=$r(tr,l),f=fl(c,null==r?void 0:r.onPreviewSessionInitialized);((e,t)=>{pl(e,a.SessionEventType.FilePreviewAttemptStarted,a.SessionEventType.FilePreviewSupportConfirmed,t)})(f,!!p&&p!==a.PreviewType.Error),(e=>{const t=b.useDispatch();te.default.useEffect((()=>{if(!e)return;const i=()=>{var i;const n=a.PreviewsEventLogger.getEventTimelineWithStartTime(),r=null===(i=$o(e))||void 0===i?void 0:i.extra.last_event;t(Bo({event:a.SessionEventType.FilePreviewSessionEnded,previewSessionId:e,extra:Object.assign(Object.assign({},Object.keys(n)&&{timeline:JSON.stringify(n)}),r&&{last_session_event:r})})),a.PreviewsEventLogger.endCurrentSession()};return window.addEventListener("beforeunload",i),()=>{i(),window.removeEventListener("beforeunload",i)}}),[t,e])})(f);const m=te.useCallback((()=>s(On({isPreviewLoading:!1,fileViewerId:l}))),[s,l]),h=ml((()=>{s(Ho({event:a.EventType.UserEngaged3SecondsAfterRenderSucceeded,fileViewerId:l}))}),3e3,[l,f]),v=Jr((()=>{var e;h(),m(),null===(e=null==r?void 0:r.onRenderSucceeded)||void 0===e||e.call(r)}));if(!f||!c||!p||p===a.PreviewType.Error&&g&&(null===(t=_.error)||void 0===t?void 0:t.type)===u.FVErrorCode.FileNotProvided)return null;const S={previewSessionId:f,onRenderSucceeded:v,onSetPreviewLoaded:m,previewKey:c};switch(p){case a.PreviewType.Image:return te.createElement(Hl,Object.assign({},o,S,{key:c.serialized}));case a.PreviewType.SsrDoc:case a.PreviewType.CloudDoc:const e=(null==d?void 0:d.file_name)||"",t=a.file_extension(e);return["gdoc","gsheet","gslides"].includes(t)&&o.featureConfig.google_editor_disabled_by_deprecation_date?te.createElement(kl,Object.assign({},o,S,{key:c.serialized})):ul(_)?te.createElement(Rl,Object.assign({},o,S,{key:c.serialized})):(null===(i=null==d?void 0:d.file_name)||void 0===i?void 0:i.endsWith(".gsheet"))?te.createElement(jl,Object.assign({},o,S,{isRawHtml:!0,key:c.serialized})):te.createElement(Fl,Object.assign({},o,S,{key:c.serialized}));case a.PreviewType.Video:case a.PreviewType.Audio:return te.createElement(xl,Object.assign({},o,S,{isAudio:p===a.PreviewType.Audio,key:c.serialized}));case a.PreviewType.Excel:case a.PreviewType.HTML:case a.PreviewType.RawHTML:return te.createElement(jl,Object.assign({},o,S,{isRawHtml:p===a.PreviewType.RawHTML,key:c.serialized}));case a.PreviewType.Archive:return te.createElement(El,Object.assign({},o,S,{key:c.serialized}));case a.PreviewType.Linkfile:return te.createElement(Wl,Object.assign({},o,S,{key:c.serialized}));case a.PreviewType.Error:return te.createElement(Ul,Object.assign({error:(null==_?void 0:_.error)||new u.FVError(u.FVErrorCode.Unknown,u.ErrorLifecycle.Render)},o,S))}return te.createElement(Ul,Object.assign({error:new u.FVError(u.FVErrorCode.UnsupportedPreviewType,u.ErrorLifecycle.Render)},o,S))};ql.displayName="PreviewRenderer",ql.displayName="PreviewRenderer";a.injectInternalStyle("/static/js/file_viewer/right_rail/right_rail.module.out-vflGyYAhv.css",(e=>"._editPluginContainer_kj1u0_1{background-color:var(--dig-color__background__raised);height:100%;width:328px}"));const Ql=({Sidebar:e,titleBarActionSetters:t})=>te.default.createElement("div",{className:"_editPluginContainer_kj1u0_1"},te.default.createElement(e,{titleBarActionSetters:t}));Ql.displayName="EditPluginSidebarInternal";const Yl=te.default.memo(Ql);Yl.displayName="EditPluginSidebar";a.injectInternalStyle("/static/js/file_viewer/ui/drawer_wrapper.module.out-vflbfZJSU.css",(e=>"._drawer-wrapper_lyxv4_1{color-scheme:var(--dig-color-scheme,light dark);flex:1;min-width:0}._inline-drawer_lyxv4_8{box-sizing:border-box;width:329px}"));class $l extends te.default.PureComponent{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){this.props.onException(e)}render(){const{fallback:e,children:t}=this.props;return this.state.hasError?e:t}}$l.displayName="ErrorBoundaryInternal";const Zl=({children:e,fallback:t,onError:i})=>{const a=b.useDispatch(),n=_r(),r=te.default.useCallback((e=>{var t;null==i||i(e),a(Mn({error:e,fileType:(null===(t=null==n?void 0:n.content)||void 0===t?void 0:t[".tag"])||"unknown",isCritical:!0}))}),[a,i,null==n?void 0:n.content]);return te.default.createElement($l,{fallback:t,children:e,onException:r})};Zl.displayName="ErrorBoundary";const Xl=({leftSidebarContent:e,rightSidebarContent:t,children:i})=>te.default.createElement(a.Drawer.InlineFrame,{withDrawer:te.default.createElement(Jl,{sidebarContent:t,alignment:"right"}),className:"_drawer-wrapper_lyxv4_1"},te.default.createElement(a.Drawer.InlineFrame,{withDrawer:te.default.createElement(Jl,{sidebarContent:e,alignment:"left"})},i));Xl.displayName="DrawerWrapper";const Jl=({sidebarContent:e,alignment:t})=>{var i;const{fileViewerId:n}=u.useFileViewerContext(),r=$r(Gn,n),o=null!==(i=null==r?void 0:r.shouldAnimateSidebar)&&void 0!==i&&i,s=ms(e);return te.default.createElement(Zl,{fallback:null},te.default.createElement(a.Drawer.InlineDrawer,{alignment:t,isOpen:!!e,className:"_inline-drawer_lyxv4_8",shouldAnimate:o},null!=e?e:s))};Jl.displayName="SidebarDrawer";const ec=te.memo((e=>{const{fileViewerId:t,previewKey:i,isDeleteEnabled:n,isFileFlippingEnabled:r,isPreviewZoomed:o,enableFullscreen:s,fileIndex:l,collectionFileCount:c}=e,{logUserAction:d}=u.useFileViewerContext(),_=$r(ir,t),p=$r(io,t),g=b.useDispatch(),f=s&&!p?Oo({callback:()=>g(wn({previewKey:i,fileViewerId:t,sourceContext:a.UserActionContext.Keyboard})),key:"f"}):null,m=Oo({key:a.Key_enum.Key.Escape,callback:()=>{g(In({fileViewerId:t,sourceContext:a.UserActionContext.Keyboard}))}}),h=i&&function(e){const t=Oo({key:a.Key_enum.Key.Delete,callback:()=>{e(a.Key_enum.Key.Delete)}}),i=Oo({key:a.Key_enum.Key.Backspace,callback:()=>{e(a.Key_enum.Key.Backspace)}});return y.mac?[t,i]:[t]}((e=>{d(a.UserAction.Delete,a.UserActionContext.Keyboard),g({payload:{previewKey:i,fileViewerId:t,sourceContext:a.UserActionContext.Keyboard,key:e===a.Key_enum.Key.Delete?"delete":"backspace"},type:dn.Delete})})),v=[...To(S={dispatch:g,previewKey:i,fileViewerId:t,requireCommandKey:o,fileIndex:l,collectionFileCount:c}),...yo(S)];var S;const E=[];return f&&E.push(f),r&&!_&&(E.push(...v),E.push(m)),n&&!_&&h&&E.push(...h),te.createElement(Do,{name:"app",keyboardBindings:E})}));ec.displayName="AppKeyboardBindings";const tc=e=>{var t,i,n,r,o,s;const{fileConfig:l,onMount:c,onDestroy:d,callbacks:_,components:g,brandingInfo:f,editors:m,sidebars:h,textHighlighters:v,comments:S}=e,{fileViewerId:E,featureConfig:w}=u.useFileViewerContext(),y=$r(Wn,E),T=$r(Zn,E),I=$r(Fn,E),C=$r(Yn,E),A=Eo(E),M=$r(to,E),O=$r(Qn,E),P=null==I?void 0:I.previewKey,x=_r().previewType,D=Zr(Bn,P),R=sl(),{onLogTTI:N}=vs(E,x);a.useMarkTimingEventOnMount(a.PreviewsTimingEvents.FVSDK_APP_MOUNT),te.useEffect((()=>(c&&c(),()=>{d&&d()})),[d,c]),(()=>{const{logUserAction:e}=u.useFileViewerContext(),t=_r().previewType,i=go(),n=te.useCallback((()=>{i(p.PDF_EDITOR_PLUGIN_ID,a.UserActionContext.PostDownloadEditModal),e(a.UserAction.EditPdf,a.UserActionContext.PostDownloadEditModal)}),[e,i]),r=te.useCallback((()=>{i(p.PHOTO_EDITOR_PLUGIN_ID,a.UserActionContext.PostDownloadEditModal,{initialAction:"adjust"}),e(a.UserAction.EditImageAttempt,a.UserActionContext.PostDownloadEditModal,{entryAction:"adjust"})}),[e,i]),o=te.useCallback((()=>{i(p.VIDEO_EDITOR_PLUGIN_ID,a.UserActionContext.Initialization,{initialEditAction:"crop"}),e(a.UserAction.EditVideoAttempt,a.UserActionContext.PostDownloadEditModal,{entryAction:"crop"})}),[e,i]),s=te.useCallback((()=>{i(p.VIDEO_EDITOR_PLUGIN_ID,a.UserActionContext.Initialization,{initialEditAction:"trim"}),e(a.UserAction.EditVideoAttempt,a.UserActionContext.PostDownloadEditModal,{entryAction:"trim"})}),[e,i]);te.useEffect((()=>{const e=()=>{"#edit"===window.location.hash&&(t===a.PreviewType.Image?r():t===a.PreviewType.Video?o():t===a.PreviewType.Audio?s():n())};return window.addEventListener("hashchange",e,!1),()=>{window.removeEventListener("hashchange",e)}}),[n,r,o,t,s])})();const k=so(p.TRANSCRIPT_BLADE_PLUGIN_ID,a.UserActionContext.Initialization);te.useEffect((()=>{const e=new URL(window.location.href);e.searchParams.get("transcript")&&(e.searchParams.delete("transcript"),window.history.replaceState(null,"",e.href),k())}),[k]);const L=w.mobile_web,F=w.transparent_background,U=w.preview_content_only,V=te.useMemo((()=>v&&Object.values(v).filter((e=>!!e))),[v]),{activeTextHighlighterPluginId:j}=M||{},B=j?null==v?void 0:v[j]:void 0,{activeEditPluginId:H}=M||{},K=H?(z=null==m?void 0:m[H])&&function(e){return!!e&&"editUI"in e}(z)?z:void 0:void 0;var z;const W=H?function(e){return e&&function(e){return!!e&&"fullscreenLayer"in e}(e)?e:void 0}(null==m?void 0:m[H]):void 0,G=w.show_titlebar&&(!K||!!(null==K?void 0:K.allowTitleBar))&&!w.preview_content_only&&!T,{titleBarActionSetters:q,titleBarActionGetters:Q}=function(){const e=b.useDispatch(),{fileViewerId:t}=u.useFileViewerContext(),i=te.useCallback((()=>{e(Cn({sourceContext:a.UserActionContext.TitleBarMain,fileViewerId:t,pluginId:void 0}))}),[e,t]),n=te.useCallback((()=>{e(In({sourceContext:a.UserActionContext.TitleBarMain,fileViewerId:t}))}),[e,t]),r=a.useSelector((e=>io(e,t))),[o,s]=te.useState(!1),[l,c]=te.useState(!1),[d,_]=te.useState(!1),[p,g]=te.useState(),[f,m]=te.useState(),[h,v]=te.useState((()=>i)),[S,E]=te.useState((()=>n)),w=te.useCallback((()=>{s(!1),c(!1),_(!1),g(void 0),m(void 0),v((()=>i))}),[i]);return te.useEffect((()=>(r||w(),w)),[r,w]),{titleBarActionSetters:te.useMemo((()=>({setIsEditorReady:s,setHasEditorChanges:c,setEditorCanSave:_,setOnCancel:v,setOnSaveReplace:g,setOnSaveCopy:m,setOnClose:E})),[]),titleBarActionGetters:te.useMemo((()=>({isEditorReady:o,hasEditorChanges:l,editorCanSave:d,onCancel:h,onSaveReplace:p,onSaveCopy:f,onClose:S})),[d,l,o,h,S,f,p])}}();(e=>{var t;const{optionalIOClients:i}=u.useFileViewerContext(),{preferencesClient:n}=i,r=null==e?void 0:e.defaultLeftSidebar,o=null==e?void 0:e.defaultRightSidebar,s=null===(t=null==n?void 0:n.sidebar)||void 0===t?void 0:t.getSidebarState(),l=null!=r?r:null==s?void 0:s.left,c=null!=o?o:null==s?void 0:s.right,d=oo(l,r?a.UserActionContext.Initialization:a.UserActionContext.UserPreference),_=so(c,o?a.UserActionContext.Initialization:a.UserActionContext.UserPreference);te.default.useEffect((()=>{d(),_()}),[])})(e.defaultUi);const Y=$r(ao,E),$=$r(no,E),Z=null==g?void 0:g.previewOverlay;if(W){const{editPluginActivationParams:e}=M||{},t=W.fullscreenLayer;return te.createElement("div",{className:"_editPluginFullscreenContainer_1a5di_40"},te.createElement(t,{activationParams:e}))}const X=x===a.PreviewType.Video,J=null!==(t=null==g?void 0:g.banner)&&void 0!==t?t:null,ee=!(null==g?void 0:g.toolbar)||T||Q.isEditorReady||X&&C?()=>null:null==g?void 0:g.toolbar,ie=null===(i=null==g?void 0:g.titlebar)||void 0===i?void 0:i.component,ae=G&&(L?null==g?void 0:g.mobileHeader:ie&&te.createElement(ie,Object.assign({},null==g?void 0:g.titlebar,{titleBarActionGetters:Q,commentIconWithUnreadCount:null==S?void 0:S.commentUI.CommentIconWithUnreadCount}))),ne=null!==(n=null==g?void 0:g.floatingToolbar)&&void 0!==n?n:()=>null,re=null===(r=null==K?void 0:K.editUI)||void 0===r?void 0:r.Sidebar;let oe,se,le;const ce=null===(o=null==g?void 0:g.sidebarContent)||void 0===o?void 0:o.component,de=!(C||T||K||A),ue=C||A;if(!w.preview_content_only&&!L&&(oe=re?te.createElement(Yl,{Sidebar:re,titleBarActionSetters:q}):void 0,ce&&de)){const e=Y&&(null==h?void 0:h[Y]);se=Y&&e&&te.createElement(ce,{sidebarPluginId:Y,sidebarPlugin:e});const t=$&&(null==h?void 0:h[$]);le=$&&t&&te.createElement(ce,{sidebarPluginId:$,sidebarPlugin:t})}const _e=kn(y),pe=null!==(s=null==_e?void 0:_e.areControlsHidden)&&void 0!==s&&s;return te.createElement(ho,null,te.createElement("div",{className:C?a.cx(["_fullScreenPreview_1a5di_98",mo]):mo},te.createElement("div",{className:a.cx("_titleBarWrapper_1a5di_77",{_titleBarBorder_1a5di_83:!Q.isEditorReady,_isVideo_1a5di_91:X,_isFullScreen_1a5di_91:C,_hidden_1a5di_87:pe})},ae,te.createElement(ee,null)),te.createElement("div",{className:"_renderer-row_1a5di_58"},te.createElement(Xl,{leftSidebarContent:se,rightSidebarContent:le},te.createElement("div",{className:"_center-section_1a5di_70"},de&&J,te.createElement(Gl,{className:a.cx("_containerV2_1a5di_25",{_transparentBackground_1a5di_45:F})},(({width:e,height:t})=>{var i,a;const n={fileViewerId:E,width:e,height:t,onInteractive:N,featureConfig:w,comments:S,activeOverlayEditor:K,fileConfig:l,header:null==g?void 0:g.header,fileSaver:null==g?void 0:g.fileSaver,titleBarActionSetters:q,callbacks:_,textHighlighters:V,activeTextHighlighter:B,brandingInfo:f};return te.createElement(So,{value:{rendererWidth:e,rendererHeight:t}},te.createElement("div",{className:"_previewContentWrapper_1a5di_108"},te.createElement(R,{width:e,activeOverlayEditor:K},te.createElement(dl,{fileViewerId:E,previewKey:P},te.createElement(ql,Object.assign({},n))))),te.createElement(ec,{fileViewerId:E,previewKey:P,enableFullscreen:w.enable_fullscreen,isDeleteEnabled:!K,isFileFlippingEnabled:null!=D&&!!D.file_collection_context&&!K,isPreviewZoomed:O,fileIndex:(null===(i=null==D?void 0:D.file_collection_context)||void 0===i?void 0:i.file_index)||0,collectionFileCount:(null===(a=null==D?void 0:D.file_collection_context)||void 0===a?void 0:a.parent_files_count)||0}),null!=Z?Z:null)})),te.createElement(ne,null))),te.createElement("div",{style:ue?{display:"none"}:{}},oe)),te.createElement("div",{className:"_footer-row_1a5di_66",style:C?{display:"none"}:{}},!U&&L?null==g?void 0:g.mobileFooter:null)))};tc.displayName="App";const ic=e=>{const{store:t,intl:i,platformConfig:r,isLoggedIn:o,deviceType:s,sourceSession:c,featureConfig:d,fileViewerId:_,canCloseViewer:p,apiV2Client:g,optionalIOClients:f,logger:m,reinitializeCallback:h,initialEditorParams:v}=e,S=n.__rest(e,["store","intl","platformConfig","isLoggedIn","deviceType","sourceSession","featureConfig","fileViewerId","canCloseViewer","apiV2Client","optionalIOClients","logger","reinitializeCallback","initialEditorParams"]),E=te.useMemo((()=>(({store:e,fileViewerId:t,reinitializeFileViewer:i})=>({fileFlipping:{flipToNextFile(i){const a=Ts(e.getState(),t);null!=a&&e.dispatch(yn({fileViewerId:t,previewKey:a,sourceContext:i}))},flipToPreviousFile(i){const a=Ts(e.getState(),t);null!=a&&e.dispatch(Tn({fileViewerId:t,previewKey:a,sourceContext:i}))}},reinitializeFileViewer(e){i(e)},updatePreviewMetadata(e,t){Es(e,t,Rn(e))},closeViewer(i){e.dispatch(In({fileViewerId:t,sourceContext:i}))}}))({store:t,fileViewerId:_,reinitializeFileViewer:h})),[_,h,t]),w=te.useMemo((()=>function({store:e,sdkConfig:t,fileViewerId:i,navigation:n}){return{fileViewerId:i,logUserAction:(t,n,r)=>{e.dispatch(Ho({event:a.EventType.UserAction,fileViewerId:i,extra:Object.assign(Object.assign({action:t},n?{context:n}:{}),r||{})}))},sdkConfig:t,navigation:n}}({store:t,sdkConfig:d,fileViewerId:_,navigation:E})),[d,_,E,t]);te.useEffect((()=>{if(v){const{activeEditPlugin:e,editActivationParams:i}=v;t.dispatch(Cn({fileViewerId:_,pluginId:e,pluginActivationParams:i,sourceContext:a.UserActionContext.Initialization}))}}),[_,v,t]);const b=te.useMemo((()=>({fileViewerId:_,featureConfig:d,platformConfig:r,pluginContext:w,canCloseViewer:p,pluginNavigation:E,isLoggedIn:o,deviceType:s,sourceSession:c,apiV2Client:g,optionalIOClients:f,logger:m,logUserAction:w.logUserAction})),[_,d,r,w,p,E,o,s,c,g,f,m]);return te.createElement(a.Provider,{store:t},te.createElement(l.Provider,{value:i},te.createElement(u.FileViewerContextProvider,{value:b},te.createElement(sn,null,te.createElement(Vo,{disableBindings:!d.keyboard_shortcuts||d.preview_content_only,osModifierKey:r.osModifierKey},te.createElement(a.LayerContext.Provider,{value:{zIndex:501}},te.createElement(tc,Object.assign({},S))))))))};ic.displayName="AppWithProvider";const ac={},nc={},rc={},oc={},sc={},lc={},cc={},dc={},uc={volume:1,muted:!1},_c={currentPath:void 0,currentSubpaths:void 0},pc=Object.assign(Object.assign({},_c),{fitScaleFactor:0}),gc=Object.assign(Object.assign({},_c),{currentPageIndex:0,passwordAttempts:0,fitScaleFactor:0}),fc=Object.assign(Object.assign({},_c),{currentTimestamp:0,isPlaying:!1,isTranscriptShowing:!1,isClosedCaptionShowing:!1,isDefaultAudioTrackSelected:!0,areControlsHidden:!1}),mc={isDocSidebarOpen:!1,isFullScreen:!1,hasBeenFlipped:!1,isPreviewLoading:!1,isDeleteFileModalOpen:!1,isTitleBarRenameActive:!1,isUiHidden:{fullscreen:!1,nonFullscreen:!1},shouldAnimateSidebar:!1},hc=[".gdoc",".gslides",".paper",".papert",".binder"],vc={max:64,min:.01,multiplier:1.25,delta:.05},Sc=(e,t,i)=>Math.abs(e-t)<Math.abs(e-i)?e:t,Ec=(e,t)=>{const{delta:i,multiplier:a}=vc;let n=e*(t?a:1/a);return i&&(n=Math.round(n/i)*i,Math.abs(n-e)<i&&(n+=t?i:-i)),(e=>{const{min:t,max:i}=vc;return Math.min(Math.max(e,t),i)})(n)},wc=({scaleFactor:e,ascend:t,fitScaleFactor:i})=>{if(!e)return 1;const a=Ec(e,t),n=Ec(a,t);for(const r of((e,t)=>{const i=[1];return t&&Math.abs(1-t)>.02&&i.push(t),((e,t)=>e?e.sort(((e,i)=>t?e-i:i-e)):[])(i,e)})(t,i))if(t){if(e<r&&n>=r)return Sc(r,a,n)}else if(e>r&&n<=r)return Sc(r,a,n);return a},bc={fileMetadata:(e=ac,t)=>{if(t.type===dn.SetFileMetadata){const i=t.payload.previewKey.serialized;return Object.assign(Object.assign({},e),{[i]:t.payload})}return e},filePreviewUi:(e=nc,t)=>{var i,n,r,o,s,l,c,d,u;if(!t.payload)return e;if(!t.payload.previewKey)return e;const _=t.payload.previewKey,p=_.serialized,g=t.payload.fileViewerId,f=e[g]||{},m=f[p]||{},h=Ln(m);switch(t.type){case dn.InitializeFilePreviewSession:{const{previewType:i,fileExtension:n}=t.payload,r=((e,t)=>{switch(e){case a.PreviewType.Image:return pc;case a.PreviewType.SsrDoc:return gc;case a.PreviewType.Audio:case a.PreviewType.Video:return fc;case a.PreviewType.CloudDoc:return t&&hc.includes(t)?gc:_c;default:return _c}})(i,n);return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign(Object.assign({},r),{currentPath:Pn(_)?_.subpath.split("/").slice(1):void 0}),m)})})}case dn.PageNavigation:{const{sourceContext:i,pageIndex:a,centerOnYOffset:n}=t.payload;return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{pageNavigation:{sourceContext:i,pageIndex:a,centerOnYOffset:n}})})})}case dn.ResolvePageNavigation:return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{pageNavigation:void 0})})});case dn.UpdateDocCurrentPageIndex:let{pageIndex:v,totalPageCount:S}=t.payload;const E=null!=S?S:0;return v<0?v=0:E&&v>=E-1&&(v=E-1),Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{currentPageIndex:v})})});case dn.IncrementDocPasswordAttempts:const b=null!==(n=null===(i=Nn(m))||void 0===i?void 0:i.passwordAttempts)&&void 0!==n?n:0;return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{passwordAttempts:b+1})})});case dn.PageUp:{const t=null!==(o=null===(r=Nn(m))||void 0===r?void 0:r.currentPageIndex)&&void 0!==o?o:null;if(t)return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{currentPageIndex:Math.max(t-1,0)})})});break}case dn.PageDown:{const i=null!==(l=null===(s=Nn(m))||void 0===s?void 0:s.currentPageIndex)&&void 0!==l?l:null;if(i)return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{currentPageIndex:Math.min(i+1,t.payload.pageCount||1)})})});break}case dn.ZoomIn:{if(null==h)return e;const t=null!==(c=h.zoomScaleFactor)&&void 0!==c?c:h.fitScaleFactor;return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{zoomScaleFactor:wc({scaleFactor:t,ascend:!0,fitScaleFactor:h.fitScaleFactor})})})})}case dn.ZoomOut:{if(null==h)return e;const t=null!==(d=h.zoomScaleFactor)&&void 0!==d?d:h.fitScaleFactor;return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{zoomScaleFactor:wc({scaleFactor:t,ascend:!1,fitScaleFactor:h.fitScaleFactor})})})})}case dn.ZoomToggleOriginalOrFit:{if(null==h)return e;const i=null!==(u=h.zoomScaleFactor)&&void 0!==u?u:h.fitScaleFactor,a=i===h.fitScaleFactor?1:void 0,n=(null==h?void 0:h.storedFitScaleFactor)&&1===i?null==h?void 0:h.storedFitScaleFactor:void 0,r=t.payload.fitOnly?void 0:n||a;return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{zoomScaleFactor:r})})})}case dn.UpdateFitScaleFactor:{if(null==h)return e;const{fitScaleFactor:i}=h;return i===t.payload.fitScaleFactor?e:Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{storedFitScaleFactor:t.payload.storedFitScaleFactor,fitScaleFactor:t.payload.fitScaleFactor})})})}case dn.UpdateFitToWidthScaleFactor:{if(null==h)return e;const{storedFitToWidthScaleFactor:i}=h;return i===t.payload.storedFitToWidthScaleFactor?e:Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{storedFitToWidthScaleFactor:t.payload.storedFitToWidthScaleFactor})})})}case dn.UpdateZoomScaleFactor:{if(null==h)return e;const{fitScaleFactor:i,storedFitScaleFactor:a,storedFitToWidthScaleFactor:n,zoomScaleFactor:r}=h;let o=t.payload.zoomScaleFactor;return"fitToPage"===t.payload.zoomType?o=1===i?i:a:"fitToWidth"===t.payload.zoomType&&(o=n),r===o?e:Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{zoomScaleFactor:o})})})}case dn.UpdateDimensions:return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{dimensions:t.payload.dimensions})})});case dn.UpdateArchiveFileCurrentPath:return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{currentPath:t.payload.currentPath})})});case dn.UpdateArchiveFileCurrentSubpaths:return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{currentSubpaths:t.payload.subpaths})})});case dn.UpdateAudioVideoPlaybackState:const y=w.pick(t.payload,"currentTimestamp","isPlaying");return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),y)})});case dn.SetIsClosedCaptionShowing:return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{isClosedCaptionShowing:t.payload.showing})})});case dn.SetIsTranscriptShowing:return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{isTranscriptShowing:t.payload.showing})})});case dn.SetIsDefaultAudioTrackSelected:return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{isDefaultAudioTrackSelected:t.payload.isDefaultAudioTrackSelected})})});case dn.SetAreVideoControlsHidden:return Object.assign(Object.assign({},e),{[g]:Object.assign(Object.assign({},f),{[p]:Object.assign(Object.assign({},m),{areControlsHidden:t.payload.areVideoControlsHidden})})})}return e},fileViewerUi:(e=rc,t)=>{if(!t.payload)return e;const{fileViewerId:i}=t.payload,n=e[i];if(!n)return e;switch(t.type){case dn.OpenDocSidebar:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isDocSidebarOpen:!0})});case dn.CloseDocSidebar:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isDocSidebarOpen:!1})});case dn.EnterFullScreen:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isFullScreen:!0})});case dn.ExitFullScreen:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isFullScreen:!1})});case dn.FlipToNextFile:case dn.FlipToPreviousFile:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{hasBeenFlipped:!0})});case dn.SetPreviewLoadingAction:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isPreviewLoading:t.payload.isPreviewLoading})});case dn.UpdateArchiveFileCurrentPath:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isPreviewLoading:!t.payload.isDir||n.isPreviewLoading})});case dn.SetDeleteFileModalOpen:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isDeleteFileModalOpen:t.payload.isOpen})});case dn.SetTitleBarRenameActive:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isTitleBarRenameActive:t.payload.isActive})});case dn.SetUiShown:{const{isFullscreen:a}=t.payload,r=a?"fullscreen":"nonFullscreen";return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isUiHidden:Object.assign(Object.assign({},n.isUiHidden),{[r]:!1})})})}case dn.SetUiHidden:{const{isFullscreen:a}=t.payload,r=a?"fullscreen":"nonFullscreen";return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{isUiHidden:Object.assign(Object.assign({},n.isUiHidden),{[r]:!0})})})}case dn.SetLeftSidebarPlugin:case dn.SetRightSidebarPlugin:{const r=t.payload.sourceContext,o=r!==a.UserActionContext.UserPreference&&r!==a.UserActionContext.Initialization;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},n),{shouldAnimateSidebar:o})})}default:return e}},loggingSessionId:(e=lc,t)=>{if(t.type===dn.InitializeFilePreviewSession){const{fileViewerId:i,filePreviewSessionId:a}=t.payload;return Object.assign(Object.assign({},e),{[i]:a})}return e},rootFileInfo:(e=oc,t)=>{if(t.type===dn.SetRootFileInfo){const{previewKey:i,fileInfo:a}=t.payload;return Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:Object.assign({previewKey:i},a)})}return e},currentPreviewKey:(e=sc,t)=>{switch(t.type){case dn.SetRootFileInfo:const{previewKey:i}=t.payload;return Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:i});case dn.UpdateArchiveFileCurrentPath:const a=Dn(t.payload.currentPath),n=t.payload.rootFileInfo;if(!n)return e;const r=0===t.payload.currentPath.length||t.payload.isDir?n.previewKey:xn(n.file_id,a),o=e[t.payload.fileViewerId];return(null==o?void 0:o.serialized)===r.serialized?e:Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:Object.assign({},r)})}return e},plugins:(e=cc,t)=>{var i,a,n,r,o;if(t.type===dn.FlipToNextFile||t.type===dn.FlipToPreviousFile){const{fileViewerId:r}=t.payload;if((null===(a=null===(i=e[r])||void 0===i?void 0:i.sidebarPlugins)||void 0===a?void 0:a.right)===p.TRANSCRIPT_BLADE_PLUGIN_ID)return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},e[r]),{sidebarPlugins:Object.assign(Object.assign({},null===(n=e[r])||void 0===n?void 0:n.sidebarPlugins),{right:void 0})})})}if(t.type===dn.SetActiveEditPlugin){const{fileViewerId:i,pluginId:a,pluginActivationParams:n}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{activeEditPluginId:a,editPluginActivationParams:n})})}if(t.type===dn.SetActiveTextHighlighterPlugin){const{fileViewerId:i,pluginId:a}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{activeTextHighlighterPluginId:a,activeEditPluginId:void 0,editPluginActivationParams:void 0})})}if(t.type===dn.SetLeftSidebarPlugin){const{fileViewerId:i,pluginId:a}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{sidebarPlugins:Object.assign(Object.assign({},null===(r=e[i])||void 0===r?void 0:r.sidebarPlugins),{left:a}),activeTextHighlighterPluginId:void 0})})}if(t.type===dn.SetRightSidebarPlugin){const{fileViewerId:i,pluginId:a}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{sidebarPlugins:Object.assign(Object.assign({},null===(o=e[i])||void 0===o?void 0:o.sidebarPlugins),{right:a}),activeTextHighlighterPluginId:void 0})})}return e},sharedLinkInfo:(e=dc,t)=>{const{payload:i,type:a}=t;if(a===dn.SetSharedLinkInfo){const t=i.fileViewerId;return Object.assign(Object.assign({},e),{[t]:Object.assign(Object.assign({},e[t]),i)})}return e},volume:(e=uc,t)=>{switch(t.type){case dn.SetVolume:return Object.assign(Object.assign({},e),{volume:t.payload.volume});case dn.SetMuted:return Object.assign(Object.assign({},e),{muted:t.payload.muted});default:return e}}};function yc(e){return()=>t=>i=>{switch(i.type){case dn.TriggerDynamicRoutingModalCheck:e.triggerDynamicRoutingModalCheck();break;case dn.OpenGdssFileConversionModal:e.openGdssFileConversionModal()}return t(i)}}function Tc(e){return({dispatch:t})=>i=>r=>n.__awaiter(this,void 0,void 0,(function*(){const n=i(r);if(r.type===dn.Rename&&e.rename){const{newFilename:i,isRenameFromOverflowMenu:n}=r.payload,o=()=>{t(Ko({userAction:a.UserAction.RenameSuccess,fileViewerId:r.payload.fileViewerId,actionContext:r.payload.sourceContext}))},s=()=>{t(Ko({userAction:a.UserAction.RenameFailed,fileViewerId:r.payload.fileViewerId,actionContext:r.payload.sourceContext}))};e.rename({newFilename:i,isRenameFromOverflowMenu:n,onRenameSuccess:o,onRenameFailed:s})}else if(r.type===dn.Delete&&e.delete){t(Ko({userAction:a.UserAction.DeleteStart,fileViewerId:r.payload.fileViewerId,actionContext:r.payload.sourceContext,extra:{key:r.payload.key}}));const i=()=>{},n=()=>{t(Ko({userAction:a.UserAction.DeleteSuccess,fileViewerId:r.payload.fileViewerId,actionContext:r.payload.sourceContext}))},o=()=>{t(Ko({userAction:a.UserAction.DeleteFailed,fileViewerId:r.payload.fileViewerId,actionContext:r.payload.sourceContext}))},s=()=>{t(Ko({userAction:a.UserAction.DeleteFailedNoPermission,fileViewerId:r.payload.fileViewerId,actionContext:r.payload.sourceContext}))},l=()=>{t(Ko({userAction:a.UserAction.DeleteCancel,fileViewerId:r.payload.fileViewerId,actionContext:r.payload.sourceContext}))},c=e=>{t(un({isOpen:e,fileViewerId:r.payload.fileViewerId}))};e.delete({onDelete:i,onDeleteSuccess:n,onDeleteFailed:o,onDeleteFailedNoPermission:s,onDeleteCancel:l,setDeleteFileModalOpen:c})}return n}))}function Ic(e){return({dispatch:t})=>i=>n=>(n.type===dn.DownloadFile?e.downloadFile():n.type===dn.CopyToDropbox&&e.copyToDropbox({role:n.payload.role,logModalConfirm:()=>{t(Ko({userAction:a.UserAction.SaveToDropboxApprove,fileViewerId:n.payload.fileViewerId,actionContext:a.UserActionContext.Sidebar}))},logModalCancel:()=>{t(Ko({userAction:a.UserAction.SaveToDropboxCancel,fileViewerId:n.payload.fileViewerId,actionContext:a.UserActionContext.Sidebar}))}}),i(n))}function Cc(e){return({dispatch:t})=>i=>r=>n.__awaiter(this,void 0,void 0,(function*(){const n=i(r);if(r.type===dn.EnterFullScreen){const{fileViewerId:i,previewKey:n}=r.payload,s=()=>{t(bn(Object.assign(Object.assign({},r.payload),{skipAction:!0,skipLogging:!1})))};e.enterFullScreen(s,!!r.payload.skipAction),t((o={fileViewerId:i,previewKey:n,sourceContext:a.UserActionContext.Toolbar,fitOnly:!0,skipLogging:!0},{type:dn.ZoomToggleOriginalOrFit,payload:o}))}else r.type===dn.ExitFullScreen&&e.exitFullScreen(!!r.payload.skipAction);var o;return n}))}function Ac(e){return({getState:t})=>i=>a=>{var n,r,o,s,l,c;switch(a.type){case dn.OpenWebPreview:return null===(n=e.openWebPreview)||void 0===n||n.call(e),i(a);case dn.OpenUrl:const{url:d,fallbackUrl:u}=a.payload;return e.openUrl&&e.openUrl(d,u),i(a);case dn.CloseViewer:{const n=Wn(t(),a.payload.fileViewerId),s=Fn(t(),a.payload.fileViewerId);if(s&&(null===(r=null==n?void 0:n.currentPath)||void 0===r?void 0:r.length)){const e=n.currentPath.slice(0,-1);return i(An(Object.assign(Object.assign({},a.payload),{previewKey:null==s?void 0:s.previewKey,rootFileInfo:s,currentPath:e,fromUrlChanged:!1,isDir:!0})))}return null===(o=e.closeViewer)||void 0===o||o.call(e),i(a)}case dn.ShowAuthModal:const{encryptionOptions:_,sharedLinkUrl:p,kind:g,mode:f,loggingExtra:m}=a.payload;return e.showAuthModal&&e.showAuthModal({encryptionOptions:_,sharedLinkUrl:p,kind:g,mode:f,loggingExtra:m}),i(a);case dn.FlipToNextFile:case dn.FlipToPreviousFile:{const n=Wn(t(),a.payload.fileViewerId),r=a.payload.previewKey,o=Fn(t(),a.payload.fileViewerId);return a.type===dn.FlipToNextFile?null===(s=e.flipToNextFile)||void 0===s||s.call(e):null===(l=e.flipToPreviousFile)||void 0===l||l.call(e),o&&(null===(c=null==n?void 0:n.currentPath)||void 0===c?void 0:c.length)?i(An(Object.assign(Object.assign({},a.payload),{previewKey:r,rootFileInfo:o,currentPath:[],fromUrlChanged:!1,isDir:!0}))):i(a)}case dn.UpdateFiles:return e.updateFiles&&e.updateFiles(),i(a);default:return i(a)}}}function Mc(e){return()=>t=>i=>n.__awaiter(this,void 0,void 0,(function*(){var a,n,r,o,s,l,c,d,u;switch(i.type){case dn.OpenDocSidebar:null===(a=e.docSidebar)||void 0===a||a.setCollapsedState({isCollapsed:!1});break;case dn.CloseDocSidebar:null===(n=e.docSidebar)||void 0===n||n.setCollapsedState({isCollapsed:!0});break;case dn.SetVolume:null===(r=e.video)||void 0===r||r.setVolumeState(i.payload.volume);break;case dn.SetMuted:null===(o=e.video)||void 0===o||o.setMuteState(i.payload.muted);break;case dn.SetLeftSidebarPlugin:null===(s=e.sidebar)||void 0===s||s.setLeftSidebarState(i.payload.pluginId);break;case dn.SetRightSidebarPlugin:i.payload.pluginId!==p.AI_PLUGIN_ID&&(null===(l=e.sidebar)||void 0===l||l.setRightSidebarState(i.payload.pluginId));break;case dn.SetUiShown:i.payload.isFullscreen&&(null===(c=e.ui)||void 0===c||c.setHiddenState({isHidden:!1}));break;case dn.SetUiHidden:i.payload.isFullscreen&&(null===(d=e.ui)||void 0===d||d.setHiddenState({isHidden:!0}));break;case dn.SetLinkWarningIsHidden:null===(u=e.link)||void 0===u||u.setWarningHiddenState({isHidden:i.payload.isHidden})}return t(i)}))}function Oc(e){return()=>t=>i=>n.__awaiter(this,void 0,void 0,(function*(){if(i.type===dn.ReportException){const t=i.payload.fileType||"unknown";e.reportException(i.payload.error,t,i.payload.isCritical)}return t(i)}))}const Pc="file_subpath";function xc(e){return()=>t=>i=>{switch(i.type){case dn.UpdateArchiveFileCurrentPath:i.payload.fromUrlChanged||e.setQueryStringParameter(Pc,0===(a=i.payload.currentPath).length?null:`/${a.join("/")}`);break;case dn.CloseViewer:e.setQueryStringParameter(Pc,null);break;case dn.Redirect:e.redirect(i.payload.href,i.payload.newTab)}var a;return t(i)}}class Dc{constructor(e,t,i,r,s){this.mounted=!1,this.initializeOpts=void 0,this.hasFileFlipped=e=>{const t=Fn(this.store.getState(),this.fileViewerId);return(null==t?void 0:t.previewKey.serialized)!==e.serialized},this.reinitialize=e=>n.__awaiter(this,void 0,void 0,(function*(){if(!this.initializeOpts)throw new Error("Reinitialize called before initialization");let t;var i;t=(null==e?void 0:e.fileInfo)?e.fileInfo:this.initializeOpts.fileInfo.file_id?{file_id:this.initializeOpts.fileInfo.file_id}:this.initializeOpts.fileInfo,this.store.dispatch((i={},{type:dn.UpdateFiles,payload:i})),o.queryClient.invalidateQueries({queryKey:ia(t)});const a=Object.assign(Object.assign(Object.assign({},this.initializeOpts),e),{fileInfo:t});return this.initialize(a)})),this.initialize=e=>n.__awaiter(this,void 0,void 0,(function*(){const{fileMetadata:t,fileInfo:i,sourceSession:n,sharedLinkInfo:r}=e;this.initializeOpts=e,a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.FVSDK_INITIALIZE_START);const{size:o,timeRange:s}=t,l=Rn(i),{store:c}=this.platformProps,d=this.fileViewerId;var u;Fn(c.getState(),d)&&this.mounted&&(n.was_flipped=!0),c.dispatch(On({isPreviewLoading:!0,fileViewerId:d})),c.dispatch((u={fileViewerId:d,fileInfo:i,previewKey:l},{type:dn.SetRootFileInfo,payload:u})),c.dispatch(function(e){return{type:dn.SetFileMetadata,payload:e}}(Object.assign(Object.assign({},t),{size:o,previewKey:l,timeRange:s}))),this.hasFileFlipped(l)||(r&&c.dispatch(function(e){return{type:dn.SetSharedLinkInfo,payload:e}}(Object.assign(Object.assign({},r),{fileViewerId:d}))),a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.FVSDK_INITIALIZE_COMPLETE))})),this.getStaticProps=e=>{const{store:t,intl:i,featureConfig:a,platformConfig:n,callbacks:r,canCloseViewer:o}=this.platformProps,s=this.handleAppDestroy,l=this.handleAppMount,{fileConfig:c,isLoggedIn:d,sourceSession:_,brandingInfo:p,defaultUi:g,pluginParams:f}=e;return{store:t,intl:i,fileViewerId:this.fileViewerId,callbacks:r,featureConfig:a,canCloseViewer:o,onDestroy:s,onMount:l,platformConfig:n,fileConfig:Object.assign(Object.assign({},u.DEFAULT_FILE_CONFIG),c),isLoggedIn:d,deviceType:this.platformProps.deviceType,sourceSession:_,brandingInfo:null!=p?p:{},optionalIOClients:this.optionalIOClients,apiV2Client:this.apiV2Client,logger:this.logger,defaultUi:g,reinitializeCallback:this.reinitialize,initialEditorParams:f}},this.handleAppDestroy=()=>n.__awaiter(this,void 0,void 0,(function*(){this.mounted=!1})),this.handleAppMount=()=>{this.mounted=!0},this.fileViewerId=e,this.platformProps=t,this.apiV2Client=i,this.optionalIOClients=r,this.logger=s;const{store:l}=t;this.store=l,a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.FVSDK_CONSTRUCTOR)}}const Rc={osModifierKey:"ctrlKey"};function Nc(e){var t;const{apiV2Client:i,logger:n,intl:r,optionalIOClients:o,callbacks:s,featureConfig:l,initData:c,platformConfig:d,fileViewerId:_}=e,{accountId:p,deviceType:g}=c||{},{fileSystemClient:f,fileActionsClient:m,fullScreenClient:h,navigationClient:v,urlClient:S,preferencesClient:E,cloudDocsClient:w,reportExceptionClient:b}=o,y=null!=_?_:qo(),T=function(e,t){const i="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?a.compose(a.applyMiddleware(...e),window.__REDUX_DEVTOOLS_EXTENSION__({name:"File Viewer SDK"})):a.applyMiddleware(...e);return a.createStore(a.combineReducers(bc),t,i)}([...v?[Ac(v)]:[],...S?[xc(S)]:[],...f?[Ic(f)]:[],...m?[Tc(m)]:[],...h?[Cc(h)]:[],...E?[Mc(E)]:[],...w?[yc(w)]:[],...b?[Oc(b)]:[],...n?[fs(n)]:[]],{filePreviewUi:{[y]:{}},fileViewerUi:{[y]:mc}});let I=u.DEFAULT_CONFIG;l&&(I=Object.assign(Object.assign({},I),l));const C={callbacks:s,intl:r,store:T,accountId:p,showAuthModal:o.showAuthModal,canCloseViewer:!!(null===(t=o.navigationClient)||void 0===t?void 0:t.closeViewer),deviceType:g||a.DeviceType.desktop,featureConfig:I,platformConfig:Object.assign(Object.assign({},Rc),d)};return{createFileViewer:()=>new Dc(y,C,i,o,n),featureConfig:I}}a.injectInternalStyle("/static/js/file_viewer/file_viewer/components.module.out-vflTN_nvc.css",(e=>"._fvsdk-mount-point_1vaza_1{height:100%;overflow:hidden}"));function kc(e,t,i){const a=e/t;return isNaN(i)||isNaN(a)||!isFinite(a)||!isFinite(i)?[0,0]:a>i?[t*i,t]:[e,e/i]}function Lc(e){return e/window.innerWidth*100/window.devicePixelRatio}const Fc=(e,t,i)=>{switch(Xi(i)){case a.PreviewType.Video:case a.PreviewType.Audio:return bl(e,t,i);case a.PreviewType.Linkfile:return((e,t,i)=>Kl.prefetchQuery(e,{apiArg:{previewKey:t,previewMetadata:i},pkgArg:null}))(e,t,i);case a.PreviewType.SsrDoc:case a.PreviewType.CloudDoc:return((e,t,i)=>Ur.prefetchInfiniteQuery(e,{apiArg:{previewKey:t,previewMetadata:i},pkgArg:void 0}))(e,t,i);case a.PreviewType.Archive:return((e,t,i)=>zr.prefetchQuery(e,{apiArg:{previewKey:t,previewMetadata:i},pkgArg:null}))(e,t,i);default:return Promise.resolve()}};const Uc=(e,t,i,a,n)=>{const r=te.default.useRef(void 0);te.default.useMemo((()=>{let o=!1;r&&r.current!==a.url&&(o=!0),n.tags=Object.assign({file_flip:o},n.tags),r.current=a.file_id,((e,t,i,a,n)=>{const r=[Vc(e,t,n)],o=Rn(a);t&&r.push(Fc(i,o,t)),Promise.all(r)})(e,t,i,a,n)}),[e,a,t,i])},Vc=(e,t,i)=>{var a;const n={prefetchImage:!0,prefetchOptimizedImage:"ON"===(r=e).previews_exp_img_size_optimization_variant&&!r.mobile_web,prefetchDocImage:!0,prefetchFullSizeImage:r.previews_exp_prefetch_full_img||!1};var r;switch(null===(a=null==t?void 0:t.content)||void 0===a?void 0:a[".tag"]){case"image":return jc(t,n,i);case"ssr_doc":return Bc(t.content.image_url_tmpl,n);default:return Promise.resolve()}},jc=(e,t,i)=>{var a;const n="image"===(null===(a=e.content)||void 0===a?void 0:a[".tag"])?e.content:void 0;if(!t.prefetchImage||!(null==n?void 0:n.default_src))return Promise.resolve();if(t.prefetchOptimizedImage){if(!e.dimensions)return Promise.resolve();const t=function(e){const t=e.width/e.height,i=window.innerWidth,a=window.innerHeight-132,[n]=kc(i-Ns.horizontal,a-Ns.vertical,t);return Lc(n)}(e.dimensions);return kr.fetchImage(n.default_src,n.src_set,t+"vw",i?Ar("optimized",i):void 0)}return t.prefetchFullSizeImage&&(null==n?void 0:n.full_size_src)?Promise.all([kr.fetchImage(n.full_size_src,void 0,void 0,i?Ar("full-size",i):void 0).catch(),kr.fetchImage(n.default_src,void 0,void 0,i?Ar("default",i):void 0).catch()]):kr.fetchImage(n.default_src,void 0,void 0,i?Ar("default",i):void 0).catch()},Bc=(e,t)=>t.prefetchDocImage?kr.fetchDocImage({imageUrlTmpl:e}).catch():Promise.resolve(),Hc=te.createContext(null),Kc=({initData:e,children:t,apiV2Client:i,logger:a,intl:n,optionalIOClients:r,callbacks:o,featureConfig:s,platformConfig:l})=>{const c=te.useMemo((()=>Nc({apiV2Client:i,logger:a,intl:n,optionalIOClients:r,callbacks:o,featureConfig:s,initData:e,platformConfig:l})),[i,a,n,r,o,s,e,l]);return te.createElement(Hc.Provider,{value:c},t)};Kc.displayName="FileViewerSDKContextProvider";const zc=e=>{const{initializeOpts:t,className:i,id:n,components:r,editors:s,sidebars:l,textHighlighters:c,comments:d}=e,u=te.useContext(Hc);if(!u)throw new Error("File Viewer SDK Context must be provided");const _=o.useQueryClient(),p=te.useMemo((()=>u.createFileViewer()),[u]),g=te.useMemo((()=>p.getStaticProps(t)),[p,t]);Uc(u.featureConfig,t.previewMetadata,_,t.fileInfo,{logDuration:()=>{var e;return Promise.resolve(null===(e=g.logger)||void 0===e?void 0:e.logDuration)},tags:hr(t)});const f=te.useRef(null);return te.useEffect((()=>{p.initialize(t)}),[p,t]),te.createElement("div",{className:a.cx(i||"_fvsdk-mount-point_1vaza_1"),id:n||"fvsdk-mount-point",ref:f},te.createElement(ic,Object.assign({},g,{editors:s,textHighlighters:c,comments:d,components:r,sidebars:l})))};zc.displayName="FileViewerInstance",zc.displayName="FileViewerInstance";const Wc=e=>{const{initializeOpts:t,className:i,id:a,components:r,editors:s,sidebars:l,textHighlighters:c,comments:d}=e,u=n.__rest(e,["initializeOpts","className","id","components","editors","sidebars","textHighlighters","comments"]),_={initializeOpts:t,className:i,id:a,components:r};return te.createElement(o.QueryClientProvider,{client:o.queryClient},te.createElement(Kc,Object.assign({},u),te.createElement(zc,Object.assign({},_,{editors:s,sidebars:l,textHighlighters:c,comments:d}))))};Wc.displayName="FileViewer",Wc.displayName="FileViewer";a.injectInternalStyle("/static/metaserver/static/js/file_viewer/mobile_web/mobile_footer.module.out-vflN0LpDp.css",(e=>":root{--mobileFooterHeight:72px}._footerContainer_3b0az_5{background:var(--dig-color__background__base);bottom:0;box-sizing:border-box;height:var(--mobileFooterHeight);padding:var(--dig-spacing__macro__xsmall);width:100%}._footer_3b0az_5,._footerContainer_3b0az_5{align-items:center;display:flex}._footer_3b0az_5{border-top:1px solid var(--dig-color__border__subtle);height:35px;justify-content:space-around;margin-top:var(--dig-spacing__macro__xsmall);padding:0 var(--dig-spacing__macro__small)}._footer_3b0az_5 a,._footer_3b0az_5 span{color:var(--dig-color__text__subtle);cursor:pointer;text-decoration:none}._middleButton_3b0az_33{margin-right:var(--dig-spacing__micro__small)}._rightButtonsContainer_3b0az_37{display:flex;flex:1;justify-content:right}"));const Gc="_footerContainer_3b0az_5",qc=()=>te.default.createElement("div",{className:Gc});a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/mobile/mobile_title_bar.module.out-vfl97ByBO.css",(e=>":root{--titlebarHeight:64px}._titleBar_ux84q_5{align-items:center;background:var(--color__standard__background);border-bottom:1px solid var(--color__standard__border);display:flex;height:var(--titlebarHeight);justify-content:space-between}._title_ux84q_5{display:flex;overflow:hidden;padding-left:var(--dig-spacing__macro__xsmall);padding-right:var(--dig-spacing__macro__medium)}._mobileMeatball_ux84q_21{padding-right:var(--dig-spacing__micro__large)}"));const Qc="_titleBar_ux84q_5",Yc=()=>te.default.createElement("div",{className:Qc});a.injectInternalStyle("/static/metaserver/static/js/file_viewer/mobile_web_redesign/mobile_header.module.out-vflUStUeh.css",(e=>"._susiHeader_1tzd1_1{align-items:center;background:var(--dig-color__background__raised);border-bottom:1px solid var(--dig-color__border__subtle);display:flex;justify-content:space-between;padding:var(--dig-spacing__micro__xsmall) var(--dig-spacing__micro__small)}._rhsHeader_1tzd1_10{display:flex;flex-direction:row;justify-content:flex-end}._rhsHeader_1tzd1_10>*{margin-right:var(--dig-spacing__micro__small)}"));const $c="_susiHeader_1tzd1_1";a.injectInternalStyle("/static/metaserver/static/js/file_viewer/mobile_web_redesign/mobile_title_bar.module.out-vfl5m8AlN.css",(e=>"._mobileTitleBar_bcnab_1{align-items:center;background:var(--dig-color__background__raised);display:flex;justify-content:space-between;padding:var(--dig-spacing__micro__xsmall) var(--dig-spacing__micro__small)}._mobileTitleBarLoggedIn_bcnab_9{height:var(--dig-spacing__macro__xlarge);padding:var(--dig-spacing__micro__small)}._title_bcnab_14{flex-direction:column;height:var(--dig-spacing__macro__large);min-width:0}._fileCounter_bcnab_22,._title_bcnab_14{display:flex;justify-content:center}._fileCounter_bcnab_22{margin-top:calc(var(--dig-spacing__micro__small)*-1)}._overflowMenu_bcnab_28{margin:var(--dig-spacing__micro__xsmall) var(--dig-spacing__micro__xsmall) var(--dig-spacing__micro__xsmall) 0}._fileName_bcnab_33{display:flex;overflow:hidden}"));const Zc="_mobileTitleBar_bcnab_1",Xc=()=>te.default.createElement(te.default.Fragment,null,te.default.createElement("div",{className:$c}),te.default.createElement("div",{className:Zc}));a.injectInternalStyle("/static/metaserver/static/js/file_viewer/mobile_web_redesign/mobile_action_bar.module.out-vflwXvg-Z.css",(e=>"._actionBar_qv956_1{align-items:center;background:var(--dig-color__background__raised);display:flex;gap:var(--dig-spacing__micro__small);height:72px;overflow-x:scroll;white-space:nowrap}._actionBar_qv956_1 ._button_qv956_11:first-child{margin-left:auto}._actionBar_qv956_1 ._button_qv956_11:last-child{margin-right:auto}._actionBar_qv956_1::-webkit-scrollbar{display:none}._actionBar_qv956_1{-ms-overflow-style:none;scrollbar-width:none}._button_qv956_11{display:inline-block;flex:none;height:58px;letter-spacing:0;min-width:58px}._buttonContent_qv956_39{align-items:center;display:flex;flex-direction:column;justify-content:center;padding:0}"));const Jc="_actionBar_qv956_1",ed=()=>te.default.createElement("div",{className:Jc}),td=te.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{MobileFooter:t}=yield new Promise((function(t,i){e(["./c_file_viewer_mobile_web_mobile_footer"],t,i)}));return{default:t}})))),id=e=>te.createElement(te.Suspense,{fallback:te.createElement(qc,null)},te.createElement(td,Object.assign({},e)));id.displayName="LazyMobileFooter";const ad=te.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{MobileActionBar:t}=yield new Promise((function(t,i){e(["./c_file_viewer_mobile_web_redesign_mobile_action_bar"],t,i)}));return{default:t}})))),nd=e=>te.createElement(te.Suspense,{fallback:te.createElement(ed,null)},te.createElement(ad,Object.assign({},e)));nd.displayName="LazyMobileActionBar";const rd=te.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{MobileHeader:t}=yield new Promise((function(t,i){e(["./c_file_viewer_mobile_web_mobile_header"],t,i)}));return{default:t}})))),od=e=>te.createElement(te.Suspense,{fallback:te.createElement(Yc,null)},te.createElement(rd,Object.assign({},e)));od.displayName="LazyMobileHeader";const sd=te.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{MobileHeaderRedesign:t}=yield new Promise((function(t,i){e(["./c_file_viewer_mobile_web_redesign_mobile_header"],t,i)})).then((function(e){return e.mobile_header_esnext}));return{default:t}})))),ld=e=>te.createElement(te.Suspense,{fallback:te.createElement(Xc,null)},te.createElement(sd,Object.assign({},e)));ld.displayName="LazyMobileHeaderRedesign";const cd=te.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{SaveDialog:t}=yield new Promise((function(t,i){e(["./c_folder_dialog_save_dialog"],t,i)}));return{default:t}})))),dd=e=>te.createElement(te.Suspense,{fallback:null},te.createElement(cd,Object.assign({},e)));dd.displayName="LazySaveDialog";const ud=u.createSelector([e=>{const t=a.getStateAtNamespace(e,a.INTEGRATIONS_NAMESPACE_KEY);return{listServices:t.listServices,latestListServicesResult:t.latestListServicesResult}}],(e=>e));function _d(e){var t,i,n;const r=a.getStateAtNamespace(e,a.DEEP_INTEGRATIONS_NAMESPACE_KEY);return!!(null===(n=null===(i=null===(t=null==r?void 0:r.userSettingsState)||void 0===t?void 0:t.latestUserSettings)||void 0===i?void 0:i.hellosign_settings)||void 0===n?void 0:n.send_for_signature_enabled)}function pd(e){var t,i,n;const r=a.getStateAtNamespace(e,a.DEEP_INTEGRATIONS_NAMESPACE_KEY);return null===(n=null===(i=null===(t=null==r?void 0:r.userSettingsState)||void 0===t?void 0:t.latestUserSettings)||void 0===i?void 0:i.hellosign_settings)||void 0===n?void 0:n.has_dmt_conflict}function gd(e){var t,i,n;const r=a.getStateAtNamespace(e,a.DEEP_INTEGRATIONS_NAMESPACE_KEY);return!!(null===(n=null===(i=null===(t=null==r?void 0:r.userSettingsState)||void 0===t?void 0:t.latestUserSettings)||void 0===i?void 0:i.hellosign_settings)||void 0===n?void 0:n.should_disable_features_if_team_suspended)}u.createSelector([e=>a.getStateAtNamespace(e,a.INTEGRATIONS_NAMESPACE_KEY).featureAvailability||{}],(e=>e));const fd={};let md=null,hd=0;const vd=(e,t)=>{const i=()=>{md&&(md.unsubscribe(),md=null)},a=()=>n.__awaiter(void 0,void 0,void 0,(function*(){if(md)return;const n=yield d.GetFlowsRoutes(t()).rpc("get_bolt_data",void 0,{});if(!((null==n?void 0:n.app_id)&&n.unique_id&&n.revision&&n.token))return;const r=new C.SignedChannelState(n.app_id,n.unique_id,n.revision,n.token);md=new C.ThunderClient([r],(e=>{const t=e.map((e=>e.payloads)).reduce(((e,t)=>e.concat(t)),[]).map((e=>e.payload));for(const e of Object.values(fd))e(t)}),(()=>{i(),a()}),e),md.start()}));return{subscribe:e=>{const t="flows-subscription-"+hd++;return fd[t]=e,1===Object.keys(fd).length&&a(),t},unsubscribe:e=>{delete fd[e],0===Object.keys(fd).length&&i()}}};let Sd=null;const Ed=()=>{return e="thunder.dropbox.com",t=()=>new a.DefaultUserApiV2Client(o.mustGetActiveUser()),Sd||(Sd=vd(e,t)),Sd;var e,t},wd=e=>{var t;return(null===(t=null==e?void 0:e.headers)||void 0===t?void 0:t["x-dropbox-request-id"])||""};function bd(t){return n.__awaiter(this,void 0,void 0,(function*(){const{preprocessPayload:i,handleMultiStepNotification:a,handleSingleStepNotification:n}=yield new Promise((function(t,i){e(["./c_flows_utils_notifications"],t,i)})),r=i(t);if(r.template&&r.template.length>1)a([r],(()=>{}));else{if(!r.action_type||"list_directory"===r.action_type||"transcribe_media"===r.action_type||"video_edit"===r.action_type||"video_scale"===r.action_type)return;const[{getAllowedWorkflowActions:t},{getStoreForAutomations:i},{loadWorkflowActionUi:a}]=yield Promise.all([new Promise((function(t,i){e(["./c_flows_redux_selectors"],t,i)})),new Promise((function(t,i){e(["./c_flows_redux_store"],t,i)})),new Promise((function(t,i){e(["./c_workflow_builder_workflow_actions_action_ui_config"],t,i)})).then((function(e){return e.action_ui_config_esnext}))]),o=t(i().getState()),s=a(r.action_type);s&&o.includes(r.action_type)&&n([r],s,(()=>{}))}}))}const yd=e=>{return t=Ed(),i=e,a=bd,{submitFileWorkflow:(e,r)=>n.__awaiter(void 0,void 0,void 0,(function*(){var n,o,s;const l=null===(s=null===(o=null===(n=e.template)||void 0===n?void 0:n.sequence)||void 0===o?void 0:o[0].workflow_action)||void 0===s?void 0:s[".tag"];if(!l)throw new Error("Unknown operation");let c;const u=Date.now(),_=window.setTimeout((()=>{p({status:"error",error:"timeout",errorReason:"timeout",timeToStartRecieved:c})}),1e3*r);let p;const g=new Promise((e=>{p=t=>{window.clearTimeout(_),e(t)}}));return t.subscribe((e=>{e.forEach((e=>{var t;if((null==(t=e)?void 0:t.revkey)&&t.action_type&&t.status&&e.action_type===l){if(a(e),"start"===e.status)return void(c=Date.now()-u);"fail"===e.status?p({status:"error",error:"failure",errorReason:e.exit_reason,timeToStartRecieved:c}):"success"===e.status&&p({status:"success",createdFqPath:e.created_fq_path})}}))})),yield d.GetFlowsRoutes(i).rpc("submit_file_workflow",e,{}).catch((e=>{var t,i;const a=(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t[".tag"])||(null===(i=null==e?void 0:e.raw)||void 0===i?void 0:i.status)||"";p({status:"error",error:"failed_to_submit",requestId:wd(e),errorReason:a,timeToStartRecieved:c})})),yield g}))};var t,i,a};a.injectInternalStyle("/static/metaserver/static/js/file_viewer/file_viewer.module.out-vflKzrZrC.css",(e=>":root{--file_viewer_z_index:500}._fvsdk-container_amzuv_5{bottom:0;display:flex;flex-direction:column;left:0;position:fixed;right:0;top:0;z-index:var(--file_viewer_z_index)}._fvsdk-embed-viewport_amzuv_16{height:100%;position:relative}body,html{height:100%}"));const Td={span:([e])=>te.default.createElement(a.Text,{size:"small",color:"standard",key:e},e)},Id=a.defineMessage({id:"JZ4ppi",defaultMessage:"Trim"}),Cd=a.defineMessage({id:"R/NK7Q",defaultMessage:"Crop"}),Ad=a.defineMessage({id:"gdluqV",defaultMessage:"Rotate left <span>(L)</span>"}),Md=a.defineMessage({id:"uOI2Jj",defaultMessage:"Rotate right <span>(R)</span>"}),Od=a.defineMessage({id:"0c76Q7",defaultMessage:"Flip horizontal"}),Pd=a.defineMessage({id:"vD6c5O",defaultMessage:"Flip vertical"}),xd=(e,t,i)=>{const a=i.formatMessage({id:"lCY+s2",defaultMessage:"This file can’t be edited"}),n=i.formatMessage({id:"1iP6an",defaultMessage:"OK"});let r;switch(e){case"tooLong":r=i.formatMessage({id:"mKX3ij",defaultMessage:"Editing is a new feature and doesn’t yet support editing files over {durationMinutes} minutes."},{durationMinutes:u.AUDIO_VIDEO_EDITING_DURATION_MINS_LIMIT});break;case"tooBig":r=i.formatMessage({id:"Mu4jJx",defaultMessage:"Editing is a new feature and doesn’t yet support editing files over {sizeGB}GB."},{sizeGB:u.AUDIO_VIDEO_EDITING_SIZE_LIMIT/u.GB_1});break;case"tooShort":r=i.formatMessage({id:"QmbeZU",defaultMessage:"Cannot edit files under 1 second long."});break;case"over4k":r=i.formatMessage({id:"zyIqo8",defaultMessage:"Editing is a new feature and doesn’t yet support editing videos over 4K resolution."});break;case"codecNotSupported":r=i.formatMessage({id:"MVmlaY",defaultMessage:"Editing is a new feature and doesn’t yet support editing files of this codec."});break;case"extensionNotSupported":r=i.formatMessage({id:"IDzGb8",defaultMessage:"Editing is a new feature and doesn’t yet support editing {extension} files."},{extension:"."+t})}return{title:a,body:r,ok:n}},Dd=e=>((null==e?void 0:e.toString())||"").split(",")[0].trim(),Rd=()=>{const e=a.useIntl();return te.default.useMemo((()=>{const t=e.formatMessage({id:"EC7glm",defaultMessage:"Cancel"}),i=e.formatMessage({id:"XyKAut",defaultMessage:"Save"}),a=e.formatMessage({id:"PAYmUy",defaultMessage:"Save a copy"}),n=e.formatMessage({id:"uZ3zJr",defaultMessage:"Replace original"}),r=e.formatMessage({id:"fascrS",defaultMessage:"Undo"}),o=e.formatMessage({id:"jxFvAv",defaultMessage:"Undo <span>(Cmd+Z)</span>"},Td),s=e.formatMessage({id:"t/M1tq",defaultMessage:"Undo <span>(Ctrl+Z)</span>"},Td),l=e.formatMessage({id:"cKqMnZ",defaultMessage:"Redo"}),c=e.formatMessage({id:"6Zq2Zb",defaultMessage:"Redo <span>(Cmd+Shift+Z)</span>"},Td),d=e.formatMessage({id:"WZ84Gg",defaultMessage:"Redo <span>(Ctrl+Y)</span>"},Td),u=e.formatMessage({id:"7aw+Po",defaultMessage:"Can‘t edit original file"}),_=e.formatMessage(Md,Td),p=e.formatMessage(Ad,Td),g=e.formatMessage({id:"7ytn9Q",defaultMessage:"Pause <span>(Spacebar)</span>"},Td),f=e.formatMessage({id:"Gy3vv2",defaultMessage:"Play <span>(Spacebar)</span>"},Td),m=e.formatMessage(Od),h=e.formatMessage(Pd),v=e.formatMessage({id:"BMDf8I",defaultMessage:"Flip horizontally"}),S=e.formatMessage({id:"FrFlZp",defaultMessage:"Flip vertically"}),E=e.formatMessage(Cd),w=e.formatMessage(Id),b=e.formatMessage({id:"19KWhz",defaultMessage:"Transcript"}),y=e.formatMessage({id:"3KFaoZ",defaultMessage:"Save or discard changes to transcribe"}),T=e.formatMessage({id:"o0EWb8",defaultMessage:"Dropbox AI"}),I=e.formatMessage({id:"NO5UIk",defaultMessage:"Save or discard changes to use Dropbox AI"}),C=e.formatMessage({id:"vj99JN",defaultMessage:"Enhance"});return{cancelMessage:t,saveMessage:i,saveACopyMessage:a,replaceOriginalMessage:n,undoMessage:r,undoShortcutWin:"(Ctrl+Z)",undoShortcutMac:"(Cmd+Z)",undoTooltipWin:s,undoTooltipMac:o,redoMessage:l,redoShortcutWin:"(Ctrl+Y)",redoShortcutMac:"(Cmd+Shift+Z)",redoTooltipWin:d,redoTooltipMac:c,replaceOriginalDisabledTooltip:u,rotateRightTooltip:_,rotateLeftTooltip:p,pauseButtonTooltip:g,playButtonTooltip:f,playLabel:Dd(f),pauseLabel:Dd(g),rotateLeftLabel:Dd(p),rotateRightLabel:Dd(_),flipHorizontallyTootltip:v,flipVerticallyTooltip:S,cropTooltip:E,cropLabel:Dd(E),flipHorizontalLabel:m,flipVerticalLabel:h,trimTooltip:w,trimLabel:Dd(w),transcribeLabel:b,transcibeTooltip:y,dropboxAiLabel:T,dropboxAiTooltip:I,enhanceLabel:C}}),[e])},Nd=(e,t)=>{const{previewType:i,previewSurface:a,file:n,user:r,sharePermission:o,previewKey:s,canRestoreRevision:l,sharedLinkInfo:c}=e,{shouldShowForPreviewType:d,shouldShowForPreviewSurface:u,filterValidUser:_,filterValidFile:p}=t,g=!!s&&Pn(s),f=_(r),m=p(n,o,g,l,c);if(d(i)&&u(a)&&f&&m)return{user:f,file:m}},kd=(e,t,i)=>(a,...n)=>{const r=Nd(a,e);return r?t({user:r.user.user,file:r.file},...n):i},Ld=e=>e,Fd=()=>!0,Ud=e=>e?{user:e}:void 0,Vd=e=>!c.is_mobile_or_tablet()&&e?{user:e}:void 0,jd=e=>t=>e.includes(t),Bd=e=>jd(e),Hd=e=>jd(e),Kd=e=>a.isBrowseFile(e)&&!ct(e)&&st(e),zd=e=>e!==a.SDKPreviewSurface.VERSION_HISTORY,Wd={shouldShowForPreviewSurface:zd,shouldShowForPreviewType:Fd,filterValidUser:Ud,filterValidFile:e=>Kd(e)?e:void 0},Gd={shouldShowForPreviewSurface:zd,shouldShowForPreviewType:e=>e!==a.PreviewType.Archive,filterValidUser:Ud,filterValidFile:(e,t,i)=>Kd(e)&&!i?e:void 0},qd=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],Qd={filterValidFile:(e,t,i)=>t&&!a.isDownloadAllowed(t)||i||a.isEncryptedFile(e)?void 0:e,shouldShowForPreviewSurface:Bd(qd),shouldShowForPreviewType:e=>{const t="ON"===a.fileViewerFeatureExperiments.previewsExpAudioTrimmingStr?[a.PreviewType.Video,a.PreviewType.Audio]:[a.PreviewType.Video];return Hd(t)(e)}},Yd=Object.assign(Object.assign({},Qd),{filterValidUser:Ud}),$d=Object.assign(Object.assign({},Qd),{filterValidUser:e=>e?void 0:{user:e}}),Zd=({logUserAction:e,setActiveEditorCallback:t,initialEditAction:i,extraForLogging:n})=>{const{userActionContext:r,entryAction:o,direction:s}=n||{};e(a.UserAction.EditVideoAttempt,r||a.UserActionContext.PreviewTopNav,Object.assign(Object.assign({},o&&{entryAction:o}),s&&{direction:s})),performance.mark(a.PreviewsTimer.VideoEditorOpen),t(p.VIDEO_EDITOR_PLUGIN_ID,r||a.UserActionContext.PreviewTopNav,i&&{initialEditAction:i})},Xd=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){Zd({logUserAction:e,setActiveEditorCallback:t,initialEditAction:"rotateLeft",extraForLogging:{userActionContext:i,entryAction:"rotate",direction:"left"}})})),Jd=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){Zd({logUserAction:e,setActiveEditorCallback:t,initialEditAction:"rotateRight",extraForLogging:{userActionContext:i,entryAction:"rotate",direction:"right"}})})),eu=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){Zd({logUserAction:e,setActiveEditorCallback:t,initialEditAction:"flipHorizontal",extraForLogging:{userActionContext:i,entryAction:"flip",direction:"horizontal"}})})),tu=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){Zd({logUserAction:e,setActiveEditorCallback:t,initialEditAction:"flipVertical",extraForLogging:{userActionContext:i,entryAction:"flip",direction:"vertical"}})})),iu=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){Zd({logUserAction:e,setActiveEditorCallback:t,initialEditAction:"crop",extraForLogging:{userActionContext:i,entryAction:"crop"}})})),au=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){Zd({logUserAction:e,setActiveEditorCallback:t,initialEditAction:"trim",extraForLogging:{userActionContext:i,entryAction:"trim"}})})),nu=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{MagicToolsVideo:t}=yield new Promise((function(t,i){e(["./c_preview_audio_video_video_editing_magic_tools_video"],t,i)}));return{default:t}})))),ru=e=>te.default.createElement(te.default.Suspense,{fallback:ou},te.default.createElement(nu,Object.assign({},e)));ru.displayName="AsyncMagicToolsVideo";const ou=e=>te.default.createElement(a.Menu.Content,Object.assign({},e),te.default.createElement(a.Menu.Segment,null,te.default.createElement(a.Menu.ActionItem,null,te.default.createElement(A.Skeleton.Text,{width:120,size:"medium"})),te.default.createElement(A.Skeleton.Text,{width:120}),te.default.createElement(A.Skeleton.Text,{width:120}))),su="files:get_file_content_metadata",lu=e=>o.createGenericQuery({queryRouteFilter:["apiv2",su],queryFn:({apiArg:t})=>({})=>n.__awaiter(void 0,void 0,void 0,(function*(){if(!t.file_path_or_id&&!t.url)return{apiData:void 0,pkgData:null};return{apiData:yield a.GetFilesRoutes(e).rpc("get_file_content_metadata",t,{}),pkgData:null}})),getQueryKey:o.getGenericQueryKey("apiv2",su)}),cu=e=>{const t={file_id:null==e?void 0:e.fileId,ns_id:null==e?void 0:e.nsId,sj_id:null==e?void 0:e.sjId,url:null==e?void 0:e.url};return du(t)},du=e=>{const t=u.useFileViewerContext();if(!t)throw new Error("useFileContentMetadataQuery must be called within a FileViewerContext");const{apiV2Client:i}=t,a=null==e?void 0:e.file_id,n={file_path_or_id:null!=a?a:"",url:null==e?void 0:e.url};return te.default.useMemo((()=>lu(i)),[i]).useQuery({apiArg:n,pkgArg:null})},uu=["mov","mp4","m4v","avi","mkv","mpeg","mpg"],_u=["aac","aif","aiff","flac","m4a","m4r","mp3","oga","ogg","wav","wma"],pu=e=>uu.includes(e)||_u.includes(e),gu=e=>n.__awaiter(void 0,void 0,void 0,(function*(){return new Promise((t=>requestAnimationFrame((()=>e&&e.current?t(e.current.getBoundingClientRect().left):t(void 0)))))})),fu=(e,t,i)=>e>i?i:e<t?t:e,mu=(e,t,i,a)=>fu(t,i,a)-e,hu=(e,t,i,a)=>{const n=a-i;return Math.floor(i+e/t*n)},vu=(e,t,i,a)=>a*(i-e)/(t-e),Su=(e,t,i=1e-6)=>Math.abs(e-t)<i,Eu=(e,t)=>!(null==t||Su(e.start,0)&&Su(e.end,t)),wu=(e,t,i)=>{if("video"!==e[".tag"]&&"audio"!==e[".tag"]||void 0===t||!i)return"codecNotSupported";const n=a.file_extension(i),r=e.duration||e.duration_precise;return bu(t)?"tooBig":yu(r)?"tooLong":Tu(r)?"tooShort":"video"===e[".tag"]&&Iu(e)?"over4k":pu(n)?Mu(e.codec)?void 0:"codecNotSupported":"extensionNotSupported"},bu=e=>e>u.AUDIO_VIDEO_EDITING_SIZE_LIMIT,yu=e=>e&&e>60*u.AUDIO_VIDEO_EDITING_DURATION_MINS_LIMIT,Tu=e=>e&&e<=1,Iu=e=>{if(e&&e.resolution_height&&e.resolution_width){const t=e.resolution_width,i=e.resolution_height;if(Math.max(t,i)>3840||Math.min(t,i)>2160)return!0}return!1},Cu=["h264"],Au=[...Cu,"aac","flac","mp3","opus","pcm","hevc","mjpeg","av1"],Mu=e=>e&&Au.includes(e),Ou=e=>{const t=window.location.href.replace(e,"");window.history.replaceState(null,"",t)},Pu=e=>{const t=new URL(window.location.href);for(const i of e)t.searchParams.delete(i);window.history.replaceState(null,"",t.href)};var xu;!function(e){e.PHOTOS="PHOTOS",e.PREVIEWS="PREVIEWS"}(xu||(xu={}));const Du=["rotateLeft","rotateRight","flip","crop","adjust","upscale","colorCorrect","filter"],Ru="init",Nu=["edit","transcript","verify_email"],ku=["save"],Lu=a.defineMessage({id:"P6BFYK",defaultMessage:"Edit"}),Fu=a.defineMessage({id:"OMdXIO",defaultMessage:"To edit a copy of this file, log in or sign up"});function Uu(e){return Du.includes(e)}function Vu(e){return p.videoEditorInitialActionStrings.includes(e)}function ju(e){return ku.includes(e)}const Bu=()=>{const e=new URL(window.location.href);let t;for(const i of Nu)if("1"===e.searchParams.get(i)){t=i;break}if(!t||!function(e){return Nu.includes(e)}(t))return;const i=e.searchParams.get(Ru),a=i&&function(e){if(!e)return!0;for(const t of[Uu,Vu,ju])if(t(e))return!0;return!1}(i)?i:void 0;return Pu([Ru]),{action:t,initialAction:a}},Hu=(e,t,i)=>{const n="transcript"===e.action?a.LoginOrRegisterKind.TRANSCRIPT:(e=>e===a.PreviewType.Image&&"ON"===a.fileViewerFeatureExperiments.previewsExpUngateImageEdit||e===a.PreviewType.SsrDoc&&"ON"===a.fileViewerFeatureExperiments.previewsExpUngatePdfEdit)(t)?a.LoginOrRegisterKind.SHARED_LINK_UNGATED_EDIT:a.LoginOrRegisterKind.LOGGED_OUT_EDIT,r=new URL(window.location.href);r.searchParams.set(e.action,"1"),e.initialAction&&r.searchParams.set(Ru,e.initialAction);const{cleanupGOTLoginContinuation:o}=(s=r.href,a.GoogleOneTapPlatform.updateLoginContUrl(s),{cleanupGOTLoginContinuation:()=>a.GoogleOneTapPlatform.updateLoginContUrl(window.location.href)});var s;const l={mode:a.AuthMode.LOGIN,kind:n,encryptionOptions:i,authDialogPreviousElement:"edit"===e.action?a.AuthDialogPreviousElementTag.EDIT:a.AuthDialogPreviousElementTag.TRANSCRIPT,sharedLinkUrl:r.href,onCancel:o,previewType:t};switch(t){case a.PreviewType.Image:return Object.assign(Object.assign({},l),{signupTag:a.RegistrationSource.IMAGE_EDIT});case a.PreviewType.Audio:case a.PreviewType.Video:return Object.assign(Object.assign({},l),{signupTag:a.RegistrationSource.AUDIO_VIDEO_EDIT});case a.PreviewType.SsrDoc:return Object.assign(Object.assign({},l),{signupTag:a.RegistrationSource.PDF_EDIT});default:return l}},Ku=(e,t,i,a)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{showAuthModal:n}=yield Promise.resolve().then((function(){return yt})),r=Hu(e,t,i);n(Object.assign(Object.assign({},r),{onCancel:()=>{var e;null===(e=r.onCancel)||void 0===e||e.call(r),null==a||a()}}))})),zu=(e,t)=>({type:"click",handler:e,keyboardBinding:t}),Wu=(e,t)=>{var i;const{fileViewerId:n}=u.useFileViewerContext(),r=qr(n),{data:o}=du(r),s=null===(i=null==o?void 0:o.apiData)||void 0===i?void 0:i.metadata;let c;if("video"===(null==s?void 0:s[".tag"])||"audio"===(null==s?void 0:s[".tag"])){const i=wu(s,t,e);if(e&&i){const t=a.file_extension(e);c=xd(i,t,l.intl).body}}return c},Gu=()=>e=>zu(e.handler,e.keyboardBinding),qu=(e,t)=>(i,a,n)=>a?zu(Ku(n,e,t)):zu(i.handler,i.keyboardBinding),Qu=(e,t,i,r,o,s,l,c)=>{const d=qu(e,c),u=d({handler:au(i,o,a.UserActionContext.PreviewToolbar)},l,{action:"edit",initialAction:"trim"}),_=d({handler:iu(i,o,a.UserActionContext.PreviewToolbar)},l,{action:"edit",initialAction:"crop"}),p=d({handler:Xd(i,o,a.UserActionContext.PreviewToolbar)},l,{action:"edit",initialAction:"rotateLeft"}),g=d({handler:Jd(i,o,a.UserActionContext.PreviewToolbar)},l,{action:"edit",initialAction:"rotateRight"}),f=d({handler:eu(i,o,a.UserActionContext.PreviewToolbar)},l,{action:"edit",initialAction:"flipHorizontal"}),m=d({handler:tu(i,o,a.UserActionContext.PreviewToolbar)},l,{action:"edit",initialAction:"flipVertical"}),h=((e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){Zd({logUserAction:e,setActiveEditorCallback:t,initialEditAction:"enhanceSpeech",extraForLogging:{userActionContext:i}})})))(i,o,a.UserActionContext.PreviewToolbar),{trimLabel:v,cropLabel:S,rotateLeftLabel:E,rotateRightLabel:w,flipHorizontalLabel:b,flipVerticalLabel:y,enhanceLabel:I}=t,C=[{label:v,icon:T.CutLine,handler:u,actionType:l?a.UserAction.LoggedOutTrim:a.UserAction.Trim,tooltip:s?{text:s}:void 0,disabled:!l&&!!s}],A=[{label:v,icon:T.CutLine,handler:u,actionType:l?a.UserAction.LoggedOutEditAudioVideoAttempt:a.UserAction.Trim,tooltip:s?{text:s}:void 0,disabled:!l&&!!s},{label:S,icon:T.CropLine,handler:_,actionType:l?a.UserAction.LoggedOutEditAudioVideoAttempt:a.UserAction.Crop,tooltip:s?{text:s}:void 0,disabled:!l&&!!s},{label:E,icon:T.ShapeRotateLeftLine,handler:p,actionType:l?a.UserAction.LoggedOutEditAudioVideoAttempt:a.UserAction.RotateLeft,tooltip:s?{text:s}:void 0,disabled:!l&&!!s},{label:w,icon:T.ShapeRotateRightLine,handler:g,actionType:l?a.UserAction.LoggedOutEditAudioVideoAttempt:a.UserAction.RotateRight,tooltip:s?{text:s}:void 0,disabled:!l&&!!s},{label:b,icon:T.FlipHorizontalLine,handler:f,actionType:l?a.UserAction.LoggedOutEditAudioVideoAttempt:a.UserAction.FlipHorizontal,tooltip:s?{text:s}:void 0,disabled:!l&&!!s},{label:y,icon:T.FlipVerticalLine,handler:m,actionType:l?a.UserAction.LoggedOutEditAudioVideoAttempt:a.UserAction.FlipVertical,tooltip:s?{text:s}:void 0,disabled:!l&&!!s}];return e===a.PreviewType.Video&&"ON"===r.previews_video_enhancements&&A.push({label:I,icon:M.MagicWandLine,handler:{type:"menu",menu:te.default.createElement(ru,{onEnhanceSpeech:h})},actionType:a.UserAction.Enhance}),e===a.PreviewType.Video?A:C},Yu=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.QUICK_VIEW_BROWSE,a.SDKPreviewSurface.QUICK_VIEW_SEARCH,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],$u={filterValidFile:(e,t)=>Ya(e,t)?e:void 0,shouldShowForPreviewSurface:Bd(Yu),shouldShowForPreviewType:Fd,filterValidUser:e=>({user:e})};var Zu,Xu,Ju,e_,t_,i_,a_,n_,r_,o_;t.Rotation=void 0,(Zu=t.Rotation||(t.Rotation={}))[Zu.UP=0]="UP",Zu[Zu.RIGHT=90]="RIGHT",Zu[Zu.DOWN=180]="DOWN",Zu[Zu.LEFT=270]="LEFT",t.RotationDirection=void 0,(Xu=t.RotationDirection||(t.RotationDirection={}))[Xu.LEFT=0]="LEFT",Xu[Xu.RIGHT=1]="RIGHT",t.AdjustType=void 0,(Ju=t.AdjustType||(t.AdjustType={})).BRIGHTNESS="brightness",Ju.CONTRAST="contrast",Ju.HIGHLIGHT="highlight",Ju.SHADOW="shadow",Ju.TEMPERATURE="temperature",Ju.SATURATION="saturation",Ju.EXPOSURE="exposure",t.ImageFilterType=void 0,(e_=t.ImageFilterType||(t.ImageFilterType={})).Grayscale="Grayscale",e_.Sepia="Sepia",e_.Vintage="Vintage",e_.Kodachrome="Kodachrome",e_.Noise="Noise",e_.Polaroid="Polaroid",e_.Pixelate="Pixelate",t.DisplayMode=void 0,function(e){e.NO_MENU="noMenu",e.CROP="crop",e.SAVE_CROP="save_crop",e.CANCEL_CROP="cancel_crop",e.ADJUST="adjust",e.UPSCALE="upscale",e.FILTER="filter",e.INIT="init"}(t.DisplayMode||(t.DisplayMode={})),t.LeftBarButtons=void 0,(t_=t.LeftBarButtons||(t.LeftBarButtons={})).ADJUST="adjust",t_.UPSCALE="upscale",t_.FILTER="filter",t.CropMenuOptions=void 0,(i_=t.CropMenuOptions||(t.CropMenuOptions={})).FREE_FORM="free_form",i_.POPULAR_RATIOS="popular_ratios",i_.FACEBOOK="facebook",i_.INSTAGRAM="instagram",t.UpscaleOption=void 0,(a_=t.UpscaleOption||(t.UpscaleOption={})).UPSCALE_2X="upscale_2x",a_.UPSCALE_4X="upscale_4x",a_.UPSCALE_8X="upscale_8x",t.CropRatioType=void 0,(n_=t.CropRatioType||(t.CropRatioType={})).UNSELECTED="unselected",n_.SQUARE_ONE_BY_ONE="square_1_1",n_.PORTRAIT_THREE_BY_FOUR="portrait_3_4",n_.LANDSCAPE_FOUR_BY_THREE="landscape_4_3",n_.WIDESCREEN_SIXTEEN_BY_NINE="widescreen_16_9",n_.FB_PROFILE_PICTURE="profile_picture170x170px",n_.FB_STORY="story1080x1920px",n_.FB_TIMELINE_POST="timeline_post1200x630px",n_.FB_PROFILE_COVER="profile_cover820x312px",n_.FB_EVENT_COVER="event_cover1200x628px",n_.INSTA_PROFILE_PICTURE="profile_picture320x320px",n_.INSTA_STORY="story1020x1920px",n_.INSTA_SQUARE="feed_photo_square1080x1080px",n_.INSTA_PORTRAIT="feed_photo_portrait1080x1350px",n_.INSTA_LANDSCAPE="feed_photo_landscape1080x566px",t.RatioResizeType=void 0,(r_=t.RatioResizeType||(t.RatioResizeType={})).RESIZE_WIDTH="resize_width",r_.RESIZE_HEIGHT="resize_height",t.EditingAction=void 0,(o_=t.EditingAction||(t.EditingAction={})).ADJUST="adjust",o_.FILTER="filter",o_.CROP="crop",o_.FLIP="flip",o_.NONE="none",o_.ROTATE="rotate",o_.COLOR_CORRECT="color_correct",o_.UPSCALE="upscale";const s_=(e,i,r,o)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){u_(i,e===t.RotationDirection.LEFT?"rotateLeft":"rotateRight"),r(a.UserAction.EditImageAttempt,o,{entryAction:"rotate",direction:e===t.RotationDirection.LEFT?"left":"right"})})),l_=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){u_(e,"crop"),t(a.UserAction.EditImageAttempt,i,{entryAction:"crop"})})),c_=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){u_(e,"flip"),t(a.UserAction.EditImageAttempt,i,{entryAction:"flip",direction:"horizontal"})})),d_=(e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){u_(e,"adjust"),t(a.UserAction.EditImageAttempt,i,{entryAction:"adjust"})})),u_=(e,t)=>{e(p.PHOTO_EDITOR_PLUGIN_ID,a.UserActionContext.EditMenu,{initialAction:t})},__={addSignaturesButtonText:a.defineMessage({id:"dbiSCk",defaultMessage:"Add signatures"}),addSignaturesTooltipText:a.defineMessage({id:"pp5zWD",defaultMessage:"Save or discard changes to add signatures"}),watermarkTooltipText:a.defineMessage({id:"iE4cHZ",defaultMessage:"Save or discard changes to watermark"}),watermarkButtonText:a.defineMessage({id:"OaGK0k",defaultMessage:"Watermark"}),adjustButtonText:a.defineMessage({id:"ekmSF9",defaultMessage:"Adjust"}),rotateRightButtonText:a.defineMessage({id:"21K5j5",defaultMessage:"Rotate right"}),rotateLeftButtonText:a.defineMessage({id:"O7JVMl",defaultMessage:"Rotate left"}),rotateButtonText:a.defineMessage({id:"GeZ+qC",defaultMessage:"Rotate"}),adjustTooltipText:a.defineMessage({id:"IRA9UZ",defaultMessage:"Adjust"}),flipButtonText:a.defineMessage({id:"pfbDIS",defaultMessage:"Flip"}),cropButtonText:a.defineMessage({id:"h4HdXM",defaultMessage:"Crop"}),enhanceButtonText:a.defineMessage({id:"qBO39c",defaultMessage:"Enhance"}),undoButtonAriaLabel:a.defineMessage({id:"OzCOpq",defaultMessage:"Undo"}),redoButtonAriaLabel:a.defineMessage({id:"GW0XXD",defaultMessage:"Redo"}),rotateButtonTooltip:a.defineMessage({id:"E4nd4H",defaultMessage:"Rotate 90°"}),flipButtonTooltip:a.defineMessage({id:"w1wlND",defaultMessage:"Flip horizontal"}),cropButtonKeyboardShortcut:"(C)",rotateRightButtonKeyboardShortcut:"(R)",rotateLeftButtonKeyboardShortcut:"(L)",flipButtonKeyboardShortcut:"(F)",adjustKeyboardShortcut:"(A)",undoButtonKeyboardShortcut:a.defineMessage({id:"ym6Uoa",defaultMessage:"(Ctrl Z)"}),redoButtonKeyboardShortcut:a.defineMessage({id:"mLcZBJ",defaultMessage:"(Ctrl Shift Z)"}),undoMacButtonKeyboardShortcut:a.defineMessage({id:"xzBcbc",defaultMessage:"(Cmd Z)"}),redoMacButtonKeyboardShortcut:a.defineMessage({id:"JN3BDi",defaultMessage:"(Cmd Shift Z)"})};const p_=O.createAction("history/undo"),g_=O.createAction("history/redo"),f_=O.createAction("reset"),m_={undo:p_,redo:g_,reset:f_};const h_={flipX:!1,flipY:!1,rotation:t.Rotation.UP},v_={brightness:0,contrast:0,highlight:0,shadow:0,temperature:0,saturation:0,exposure:0},S_={canSave:!1,imageWidth:0,imageHeight:0,zoom:{value:1,min:.25,max:2,default:1,increment:.25},displayMode:t.DisplayMode.NO_MENU,leftMenuMode:t.LeftBarButtons.ADJUST,history:{maxHistory:1e3,current:{isCommittable:!0,imageState:void 0,orientation:h_,adjust:v_,filter:void 0,actionApplied:t.EditingAction.NONE,isUpscaled:!1,isColorCorrected:!1,rotationAngle:0},past:[],future:[]},cropControls:{cropTop:0,cropLeft:0,cropWidth:0,cropHeight:0,aspectRatioLocked:!1,aspectRatioSelected:t.CropRatioType.UNSELECTED,selectedMenuOption:t.CropMenuOptions.FREE_FORM,customRatioWidth:0,customRatioHeight:0,showImageTooSmallMessage:!1,straightenAngle:0},integratedEditor:!1,seeOriginal:!1,seeColorCorrectWaitingModal:!1,seeColorCorrectSnackbar:!1},E_=function(e){return(t,i)=>{const a=t.history.current;a.isCommittable=e(a,i)}},w_={setShowImageTooSmallMessage(e,{payload:t}){e.cropControls.showImageTooSmallMessage=t},canSave(e){e.canSave=!0},cannotSave(e){e.canSave=!1},zoomIn(e){e.zoom.value=Math.min(e.zoom.max,e.zoom.value+e.zoom.increment)},zoomOut(e){e.zoom.value=Math.max(e.zoom.min,e.zoom.value-e.zoom.increment)},zoomRealSize(e){e.zoom.value=e.zoom.default},rotate:E_(((e,{payload:i})=>(e.orientation.rotation=function(e,i=t.RotationDirection.RIGHT){switch(e){case t.Rotation.UP:return i===t.RotationDirection.RIGHT?t.Rotation.RIGHT:t.Rotation.LEFT;case t.Rotation.RIGHT:return i===t.RotationDirection.RIGHT?t.Rotation.DOWN:t.Rotation.UP;case t.Rotation.DOWN:return i===t.RotationDirection.RIGHT?t.Rotation.LEFT:t.Rotation.RIGHT;case t.Rotation.LEFT:return i===t.RotationDirection.RIGHT?t.Rotation.UP:t.Rotation.DOWN}}(e.orientation.rotation,i),e.actionApplied=t.EditingAction.ROTATE,!0))),setRotationAngle(e,{payload:i}){e.displayMode===t.DisplayMode.CROP&&(e.cropControls.straightenAngle=i)},crop(e){e.displayMode===t.DisplayMode.CROP?e.displayMode=t.DisplayMode.CANCEL_CROP:e.displayMode=t.DisplayMode.CROP},flip:E_((e=>{const i=e.orientation.rotation;return i===t.Rotation.LEFT||i===t.Rotation.RIGHT?e.orientation.flipY=!e.orientation.flipY:e.orientation.flipX=!e.orientation.flipX,e.actionApplied=t.EditingAction.FLIP,!0})),saveCrop(e){e.displayMode=t.DisplayMode.SAVE_CROP},cancelCrop(e){e.displayMode===t.DisplayMode.CROP&&(e.displayMode=t.DisplayMode.CANCEL_CROP)},closeCropMenu(e){e.displayMode!==t.DisplayMode.CROP&&e.displayMode!==t.DisplayMode.CANCEL_CROP||(e.displayMode=t.DisplayMode.NO_MENU,e.cropControls.selectedMenuOption=t.CropMenuOptions.FREE_FORM,e.cropControls.aspectRatioSelected=t.CropRatioType.UNSELECTED,e.cropControls.cropWidth=0,e.cropControls.cropHeight=0,e.cropControls.aspectRatioLocked=!1),e.cropControls.straightenAngle=e.history.current.rotationAngle},setBrightness:E_(((e,{payload:i})=>(e.adjust.brightness=y_(i.value),e.actionApplied=t.EditingAction.ADJUST,i.commit))),setContrast:E_(((e,{payload:i})=>(e.adjust.contrast=y_(i.value),e.actionApplied=t.EditingAction.ADJUST,i.commit))),setHighlight:E_(((e,{payload:i})=>(e.adjust.highlight=y_(i.value),e.actionApplied=t.EditingAction.ADJUST,i.commit))),setShadow:E_(((e,{payload:i})=>(e.adjust.shadow=y_(i.value),e.actionApplied=t.EditingAction.ADJUST,i.commit))),setTemperature:E_(((e,{payload:i})=>(e.adjust.temperature=y_(i.value),e.actionApplied=t.EditingAction.ADJUST,i.commit))),setSaturation:E_(((e,{payload:i})=>(e.adjust.saturation=y_(i.value),e.actionApplied=t.EditingAction.ADJUST,i.commit))),setExposure:E_(((e,{payload:i})=>(e.adjust.exposure=y_(i.value),e.actionApplied=t.EditingAction.ADJUST,i.commit))),setFilter:E_(((e,{payload:i})=>(e.filter=i,e.actionApplied=t.EditingAction.FILTER,!0))),closeLeftMenu(e,{payload:i}){e.leftMenuMode!==i||e.displayMode!==t.DisplayMode.ADJUST&&e.displayMode!==t.DisplayMode.UPSCALE&&e.displayMode!==t.DisplayMode.FILTER||(e.displayMode=t.DisplayMode.NO_MENU)},toggleLeftMenu(e,{payload:i}){if(e.leftMenuMode!==i||e.displayMode!==t.DisplayMode.ADJUST&&e.displayMode!==t.DisplayMode.UPSCALE&&e.displayMode!==t.DisplayMode.FILTER)switch(i){case t.LeftBarButtons.ADJUST:e.displayMode=t.DisplayMode.ADJUST,e.leftMenuMode=i;break;case t.LeftBarButtons.UPSCALE:e.displayMode=t.DisplayMode.UPSCALE,e.leftMenuMode=i;break;case t.LeftBarButtons.FILTER:e.displayMode=t.DisplayMode.FILTER,e.leftMenuMode=i;break;default:e.displayMode=t.DisplayMode.NO_MENU}else e.displayMode=t.DisplayMode.NO_MENU},setImageWidth(e,{payload:t}){e.imageWidth=t},setImageHeight(e,{payload:t}){e.imageHeight=t},selectCropMenuOption(e,{payload:i}){var a;(a=e.cropControls.aspectRatioSelected)!==t.CropRatioType.FB_EVENT_COVER&&a!==t.CropRatioType.FB_PROFILE_COVER&&a!==t.CropRatioType.FB_PROFILE_PICTURE&&a!==t.CropRatioType.FB_STORY&&a!==t.CropRatioType.FB_TIMELINE_POST&&a!==t.CropRatioType.INSTA_LANDSCAPE&&a!==t.CropRatioType.INSTA_PORTRAIT&&a!==t.CropRatioType.INSTA_PROFILE_PICTURE&&a!==t.CropRatioType.INSTA_SQUARE&&a!==t.CropRatioType.INSTA_STORY||i!==t.CropMenuOptions.FREE_FORM||(e.cropControls.aspectRatioLocked=!1),e.cropControls.selectedMenuOption=i,i!==t.CropMenuOptions.FREE_FORM&&i!==t.CropMenuOptions.POPULAR_RATIOS||(e.cropControls.aspectRatioSelected=t.CropRatioType.UNSELECTED)},selectCropRatioOption(e,{payload:i}){e.cropControls.aspectRatioSelected=i,e.cropControls.cropWidth=e.imageWidth,e.cropControls.cropHeight=e.imageHeight,e.cropControls.showImageTooSmallMessage=!1;const a=(t,i)=>{(e.imageWidth<t||e.imageHeight<i)&&(e.cropControls.showImageTooSmallMessage=!0)};switch(i){case t.CropRatioType.UNSELECTED:break;case t.CropRatioType.SQUARE_ONE_BY_ONE:e.cropControls.customRatioWidth=1,e.cropControls.customRatioHeight=1,e.cropControls.aspectRatioLocked=!0;break;case t.CropRatioType.PORTRAIT_THREE_BY_FOUR:e.cropControls.customRatioWidth=3,e.cropControls.customRatioHeight=4,e.cropControls.aspectRatioLocked=!0;break;case t.CropRatioType.LANDSCAPE_FOUR_BY_THREE:e.cropControls.customRatioWidth=4,e.cropControls.customRatioHeight=3,e.cropControls.aspectRatioLocked=!0;break;case t.CropRatioType.WIDESCREEN_SIXTEEN_BY_NINE:e.cropControls.customRatioWidth=16,e.cropControls.customRatioHeight=9,e.cropControls.aspectRatioLocked=!0;break;case t.CropRatioType.FB_PROFILE_PICTURE:e.cropControls.customRatioWidth=1,e.cropControls.customRatioHeight=1,e.cropControls.cropWidth=170,e.cropControls.cropHeight=170,e.cropControls.aspectRatioLocked=!0,a(170,170);break;case t.CropRatioType.FB_STORY:e.cropControls.customRatioWidth=9,e.cropControls.customRatioHeight=16,e.cropControls.cropWidth=1080,e.cropControls.cropHeight=1920,e.cropControls.aspectRatioLocked=!0,a(1080,1920);break;case t.CropRatioType.FB_TIMELINE_POST:e.cropControls.customRatioWidth=40,e.cropControls.customRatioHeight=21,e.cropControls.cropWidth=1200,e.cropControls.cropHeight=630,e.cropControls.aspectRatioLocked=!0,a(1200,630);break;case t.CropRatioType.FB_PROFILE_COVER:e.cropControls.customRatioWidth=205,e.cropControls.customRatioHeight=78,e.cropControls.cropWidth=820,e.cropControls.cropHeight=312,e.cropControls.aspectRatioLocked=!0,a(820,312);break;case t.CropRatioType.FB_EVENT_COVER:e.cropControls.customRatioWidth=300,e.cropControls.customRatioHeight=157,e.cropControls.cropWidth=1200,e.cropControls.cropHeight=628,e.cropControls.aspectRatioLocked=!0,a(1200,628);break;case t.CropRatioType.INSTA_PROFILE_PICTURE:e.cropControls.customRatioWidth=1,e.cropControls.customRatioHeight=1,e.cropControls.cropWidth=320,e.cropControls.cropHeight=320,e.cropControls.aspectRatioLocked=!0,a(320,320);break;case t.CropRatioType.INSTA_STORY:e.cropControls.customRatioWidth=17,e.cropControls.customRatioHeight=32,e.cropControls.cropWidth=1020,e.cropControls.cropHeight=1920,e.cropControls.aspectRatioLocked=!0,a(1020,1920);break;case t.CropRatioType.INSTA_SQUARE:e.cropControls.customRatioWidth=1,e.cropControls.customRatioHeight=1,e.cropControls.cropWidth=1080,e.cropControls.cropHeight=1080,e.cropControls.aspectRatioLocked=!0,a(1080,1080);break;case t.CropRatioType.INSTA_PORTRAIT:e.cropControls.customRatioWidth=4,e.cropControls.customRatioHeight=5,e.cropControls.cropWidth=1080,e.cropControls.cropHeight=1350,e.cropControls.aspectRatioLocked=!0,a(1080,1350);break;case t.CropRatioType.INSTA_LANDSCAPE:e.cropControls.customRatioWidth=540,e.cropControls.customRatioHeight=283,e.cropControls.cropWidth=1080,e.cropControls.cropHeight=566,e.cropControls.aspectRatioLocked=!0,a(1080,566)}b_(e,{changeType:t.RatioResizeType.RESIZE_WIDTH,changeSize:e.cropControls.cropWidth}),b_(e,{changeType:t.RatioResizeType.RESIZE_HEIGHT,changeSize:e.cropControls.cropHeight})},setAspectRatioLock(e,{payload:t}){e.cropControls.aspectRatioLocked=t,t?(e.cropControls.customRatioWidth=e.cropControls.cropWidth,e.cropControls.customRatioHeight=e.cropControls.cropHeight):(e.cropControls.customRatioWidth=0,e.cropControls.customRatioHeight=0)},resizeCropBox(e,{payload:t}){b_(e,t)},resizeCropBoxFromCanvas(e,{payload:t}){e.cropControls.cropWidth=t.width,e.cropControls.cropHeight=t.height},moveCropBox(e,{payload:t}){e.cropControls.cropLeft=t.left,e.cropControls.cropTop=t.top},rotateResetCropBoxFromCanvas(e){e.cropControls.aspectRatioLocked=!1,e.cropControls.aspectRatioSelected=t.CropRatioType.UNSELECTED,e.cropControls.selectedMenuOption=t.CropMenuOptions.FREE_FORM},colorCorrect:E_(((e,{payload:i})=>(e.imageState=i,e.actionApplied=t.EditingAction.COLOR_CORRECT,e.isColorCorrected=!0,!0))),seeColorCorrectSnackbar(e,{payload:t}){e.seeColorCorrectSnackbar=t},seeColorCorrectWaitingModal(e,{payload:t}){e.seeColorCorrectWaitingModal=t},saveCropToHistory:E_(((e,{payload:i})=>(e.imageState=i.imageData,e.rotationAngle=i.straightenAngle,e.actionApplied=t.EditingAction.CROP,e.hasCrop=!0,!0))),applyUpscale:E_(((e,{payload:i})=>(e.imageState=i,e.actionApplied=t.EditingAction.UPSCALE,e.isUpscaled=!0,!0))),setSeeOriginalImageUrl(e,{payload:t}){e.seeOriginalImageUrl=t},setSeeOriginal(e,{payload:t}){e.seeOriginal=t},setIntegratedEditor(e){e.integratedEditor=!0}};function b_(e,i){if(0===i.changeSize)return;const a=function(e,i,a,n,r,o,s,l,c){let d={width:a,height:n};if(s)if(i===t.RatioResizeType.RESIZE_WIDTH){const t=e,i=Math.floor(t*c/l);if(i>o){d.height=o;const e=Math.floor(o*l/c);if(e>r){const e=Math.floor(r*c/l);d.width=r,d.height=e}else d.width=e}else d.width=t,d.height=i}else{const t=e,i=Math.floor(t*l/c);if(i>r){d.width=r;const e=Math.floor(r*c/l);if(e>o){const e=Math.floor(o*l/c);d.height=o,d.width=e}else d.height=e}else d.height=t,d.width=i}else i===t.RatioResizeType.RESIZE_WIDTH?d.width=Math.min(e,r):d.height=Math.min(e,o);return d}(i.changeSize,i.changeType,e.cropControls.cropWidth,e.cropControls.cropHeight,e.imageWidth-20,e.imageHeight-20,e.cropControls.aspectRatioLocked,e.cropControls.customRatioWidth,e.cropControls.customRatioHeight);e.cropControls.cropWidth=Math.round(a.width),e.cropControls.cropHeight=Math.round(a.height)}function y_(e,t=-100,i=100){return e<t?t:e>i?i:e}const T_=O.createSlice({name:"editor",initialState:S_,reducers:w_}),I_=T_.actions,C_=Object.assign(Object.assign({},I_),m_),A_=b.useDispatch;a.injectInternalStyle("/static/typescript/component_libraries/photo-editor/src/components/magic-tools.module.out-vflK54I7y.css",(e=>"._button_12imv_1{font-weight:var(--type__body__standard--fontweight)}"));const M_="_button_12imv_1";var O_;t.ImageEditorEvent=void 0,(O_=t.ImageEditorEvent||(t.ImageEditorEvent={})).selectEdit="select_edit",O_.selectRotate="select_rotate",O_.selectCrop="select_crop",O_.selectSaveCrop="select_save_crop",O_.selectCropOption="select_crop_option",O_.selectFlip="select_flip",O_.selectZoomIn="select_zoom_in",O_.selectZoomActualSize="select_zoom_actual_size",O_.selectZoomOut="select_zoom_out",O_.selectUndo="select_undo",O_.selectRedo="select_redo",O_.selectAdjust="select_adjust",O_.selectEnhance="select_enhance",O_.selectUpscale="select_upscale",O_.selectApplyUpscale="apply_upscale",O_.selectSaveUpscale="select_save_upscale",O_.selectSeeOriginal="select_see_original",O_.selectAutoStraighten="auto_straighten",O_.selectApplyAutoStraighten="select_apply_auto_straighten",O_.selectApplyManualStraighten="select_apply_manual_straighten",O_.changeAdjustValue="change_adjust_value",O_.selectDone="select_done",O_.selectSaveACopy="select_save_a_copy",O_.selectSaveFromSaveACopy="select_save_from_save_a_copy",O_.selectReplaceOriginal="select_replace_original",O_.selectSaveFromReplaceOriginal="select_save_from_replace_original",O_.applyColorCorrect="apply_color_correct",O_.selectSaveColorCorrect="select_save_color_correct",O_.engImageEditError="eng_image_edit_error";const P_=[2,4,8],x_=3840,D_=({onUpscale:e,onColorCorrect:n,colorCorrected:r,onAutoStraighten:o,onFilter:s,imageDimensions:l,previewsImageEnhancements:c})=>{const{colorCorrectLabel:d,colorCorrectedTooltip:u,upscaleLabel:_,upscaleTooltip:p,autoStraightenLabel:g,filterLabel:f}=function(){const e=a.useIntl();return{colorCorrectLabel:e.formatMessage({id:"WVZWN+",defaultMessage:"Color correct"}),colorCorrectedTooltip:e.formatMessage({id:"EnazIF",defaultMessage:"File has been color corrected"}),upscaleLabel:e.formatMessage({id:"iXqhWo",defaultMessage:"Upscale"}),upscaleTooltip:e.formatMessage({id:"/z8bgO",defaultMessage:"Can't upscale beyond current resolution"}),autoStraightenLabel:e.formatMessage({id:"WLfTVj",defaultMessage:"Auto-straighten"}),filterLabel:e.formatMessage({id:"5bCKGr",defaultMessage:"Filter"})}}(),m=A_(),h=i.useCallback((()=>{m(C_.toggleLeftMenu(t.LeftBarButtons.UPSCALE)),null==e||e()}),[e,m]),v=i.useMemo((()=>!R_(l)),[l]),S=i.useCallback((()=>{m(C_.toggleLeftMenu(t.LeftBarButtons.FILTER)),null==s||s()}),[s,m]);return te.default.createElement(a.Menu.Segment,null,(null==c?void 0:c.upscale)&&te.default.createElement(a.Tooltip,{title:p,placement:"right",hidden:!v},te.default.createElement(a.Menu.ActionItem,{withLeftAccessory:te.default.createElement(a.UIIcon,{size:"small",src:T.ScaleLine}),value:"upscale"},te.default.createElement(a.Button,{size:"standard",variant:"transparent",hasNoUnderline:!0,onClick:h,className:M_,disabled:v},_))),(null==c?void 0:c.autoStraighten)&&te.default.createElement(a.Menu.ActionItem,{withLeftAccessory:te.default.createElement(a.UIIcon,{src:T.AlignVerticalLine}),value:"autostraighten"},te.default.createElement(a.Button,{size:"standard",variant:"transparent",hasNoUnderline:!0,onClick:o,className:M_},g)),(null==c?void 0:c.colorCorrect)&&te.default.createElement(a.Tooltip,{title:u,placement:"right",hidden:!r},te.default.createElement(a.Menu.ActionItem,{withLeftAccessory:te.default.createElement(a.UIIcon,{src:T.CustomizeLine}),value:"color-correct",disabled:r},te.default.createElement(a.Button,{size:"standard",variant:"transparent",hasNoUnderline:!0,onClick:n,className:M_,disabled:r},d))),(null==c?void 0:c.filter)&&te.default.createElement(a.Menu.ActionItem,{withLeftAccessory:te.default.createElement(a.UIIcon,{size:"small",src:M.MagicWandLine}),value:"filter"},te.default.createElement(a.Button,{size:"standard",variant:"transparent",hasNoUnderline:!0,onClick:S,className:M_},f)))};const R_=e=>{if(!e)return!1;return P_.filter((t=>!(e.height*t>x_||e.width*t>x_))).length>0},N_=(e,t,i,a,n)=>Nd(e,$u)?k_(t,i,a,!e.user,n):[],k_=(e,t,i,n,r)=>{const o=n&&"ON"===i.previews_exp_ungate_image_edit;n&&a.logStormcrowExposure("previews_exp_ungate_image_edit",i.previews_exp_ungate_image_edit);const s=!n||o?Gu():qu(a.PreviewType.Image,r);return[{icon:T.SliderLine,label:__.adjustButtonText,handler:s({handler:d_(e,t,a.UserActionContext.PreviewToolbar),keyboardBinding:{key:"a"}},n,{action:"edit",initialAction:"adjust"}),tooltip:n?void 0:{text:__.adjustButtonText,keyboardShortcut:__.adjustKeyboardShortcut},actionType:n?a.UserAction.LoggedOutAdjust:a.UserAction.Adjust}]},L_=(e,i,r,o,s,l)=>{const c=s&&"ON"===r.previews_exp_ungate_image_edit,d=!s||c?Gu():qu(a.PreviewType.Image,l),u=((e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){u_(e,"upscale"),t(a.UserAction.EditImageAttempt,i,{entryAction:"upscale"})})))(e,i,a.UserActionContext.PreviewToolbar),_=((e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){u_(e,"colorCorrect"),t(a.UserAction.EditImageAttempt,i,{entryAction:"color_correct"})})))(e,i,a.UserActionContext.PreviewToolbar),p=((e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){u_(e,"crop"),t(a.UserAction.EditImageAttempt,i,{entryAction:"auto_straighten"})})))(e,i,a.UserActionContext.PreviewToolbar),g=((e,t,i)=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){u_(e,"filter"),t(a.UserAction.EditImageAttempt,i,{entryAction:"filter"})})))(e,i,a.UserActionContext.PreviewToolbar);let f;o&&"image"===o[".tag"]&&o.image_width&&o.image_height&&(f={width:o.image_width,height:o.image_height});const m={upscale:"ON"===r.previews_image_enhancements_upscale,colorCorrect:"ON"===r.previews_image_enhancements_color_correct,autoStraighten:"ON"===r.previews_image_enhancements_auto_straighten,filter:"ON"===r.previews_image_enhancements_filter},h=m.upscale||m.colorCorrect||m.autoStraighten||m.filter;a.logStormcrowExposure("intelligence_april_2024_holdout_control",r.intelligence_april_2024_holdout_control);const v=[{icon:T.ShapeRotateLeftLine,label:__.rotateLeftButtonText,handler:d({handler:s_(t.RotationDirection.LEFT,e,i,a.UserActionContext.PreviewToolbar),keyboardBinding:{key:"l"}},s,{action:"edit",initialAction:"rotateLeft"}),tooltip:s?void 0:{text:__.rotateLeftButtonText,keyboardShortcut:__.rotateLeftButtonKeyboardShortcut},actionType:s?a.UserAction.LoggedOutRotateLeft:a.UserAction.RotateLeft},{icon:T.ShapeRotateRightLine,label:__.rotateRightButtonText,handler:d({handler:s_(t.RotationDirection.RIGHT,e,i,a.UserActionContext.PreviewToolbar),keyboardBinding:{key:"r"}},s,{action:"edit",initialAction:"rotateRight"}),tooltip:s?void 0:{text:__.rotateRightButtonText,keyboardShortcut:__.rotateRightButtonKeyboardShortcut},actionType:s?a.UserAction.LoggedOutRotateRight:a.UserAction.RotateRight},{icon:T.FlipHorizontalLine,label:__.flipButtonText,handler:d({handler:c_(e,i,a.UserActionContext.PreviewToolbar)},s,{action:"edit",initialAction:"flip"}),tooltip:s?void 0:{text:__.flipButtonText},actionType:s?a.UserAction.LoggedOutFlipHorizontal:a.UserAction.FlipHorizontal},{icon:T.CropLine,label:__.cropButtonText,handler:d({handler:l_(e,i,a.UserActionContext.PreviewToolbar),keyboardBinding:{key:"c"}},s,{action:"edit",initialAction:"crop"}),tooltip:s?void 0:{text:__.cropButtonText,keyboardShortcut:__.cropButtonKeyboardShortcut},actionType:s?a.UserAction.LoggedOutCrop:a.UserAction.Crop}];return!s&&h&&v.push({icon:T.ImageEnhanceLine,label:__.enhanceButtonText,handler:{type:"menu",menu:te.default.createElement(D_,{onUpscale:u,onColorCorrect:_,onAutoStraighten:p,onFilter:g,imageDimensions:f,previewsImageEnhancements:m})},actionType:a.UserAction.Enhance}),v},F_=a.defineMessages({close:{id:"EZPNVs",defaultMessage:"Close"},loading:{id:"bG8AW5",defaultMessage:"Loading"}}),U_=a.defineMessages({editingPrefix:{id:"lZGCKB",defaultMessage:"Editing: {pdfName}"},save:{id:"T0AX5K",defaultMessage:"Save"},saveCopy:{id:"zma8+9",defaultMessage:"Save a copy"},replaceOriginal:{id:"Xy0sN5",defaultMessage:"Replace original"},replaceOriginalDisabledToolTip:{id:"ps4fD3",defaultMessage:"You don't have permission to make changes to this file"},cancel:{id:"p2r4/n",defaultMessage:"Cancel"},helpCenter:{id:"HSHSqg",defaultMessage:"Help center"},privacyAndLegacy:{id:"QUX8aS",defaultMessage:"Privacy and legal"},cookiesPreferences:{id:"/jgDAz",defaultMessage:"Cookies preferences"},reportAnIssue:{id:"pvQBao",defaultMessage:"Report an issue"},helpIconLabel:{id:"yXlaNs",defaultMessage:"Help"},signButton:{id:"O0/dqs",defaultMessage:"Sign"},renameFileButtonTooltip:{id:"f8Qf9a",defaultMessage:"Rename file"},confirmRenameFileLabel:{id:"Wt4Ztz",defaultMessage:"Confirm rename"},cancelRenameFileLabel:{id:"w61T5i",defaultMessage:"Cancel rename"},renameTextInputLabel:{id:"Sxj4pv",defaultMessage:"Rename text input"},changesWereMadeLabel:{id:"+pdY5a",defaultMessage:"Changes were made"},convertedToPdfLabel:{id:"tB/Chr",defaultMessage:"Converted to a PDF"},sendForSignatureButton:{id:"tadcN4",defaultMessage:"Send..."},sendForSignatureButtonEnabledTooltip:{id:"AdTIKf",defaultMessage:"Review and send for signature"},sendForSignatureButtonDisabledTooltip:{id:"ykpshN",defaultMessage:"You haven’t assigned any fields to others"},unassignedFieldsTooltip:{id:"jiO2Cl",defaultMessage:"You have unassigned fields. Assign all fields to recipients before sending for signature."}}),V_=w.identity(a.defineMessages({save:{id:"Mf2Cjs",defaultMessage:"Save Template"}})),j_=a.defineMessages({selectedPageLabel:{id:"yaSI1u",defaultMessage:"Page:"},page:{id:"CgP3fo",defaultMessage:"Page"},selectedPageTotal:{id:"eNb9PL",defaultMessage:"of"},ofPage:{id:"Xar3Xv",defaultMessage:"of {numPages, number}"},insertPageButton:{id:"i+eebg",defaultMessage:"Insert page"},rotatePageButton:{id:"RXl9OR",defaultMessage:"Rotate right"},rotatePageButtonAriaLabel:{id:"FSQvqB",defaultMessage:"Rotate right"},counterRotatePageButton:{id:"PBFKSe",defaultMessage:"Rotate left"},counterRotatePageAriaLabel:{id:"VVo4hx",defaultMessage:"Rotate left"},deletePageButton:{id:"LI6gKX",defaultMessage:"Delete page"},deletePageButtonAriaLabel:{id:"ZUtC7Y",defaultMessage:"Delete page"},movePageButton:{id:"hBBHZF",defaultMessage:"Move page"},addTextButton:{id:"B1Oo3m",defaultMessage:"Add text"},movePageTitle:{id:"4ILrYt",defaultMessage:"Move page:"},movePageSelectedPagesAriaLabel:{id:"pages-to-move-aria-label",defaultMessage:"Selected pages to move"},movePageSelectedPagesEndIndexAriaLabel:{id:"end-index-to-move-aria-label",defaultMessage:"Page to insert selected pages after"},movePageEndIndex:{id:"SImBMF",defaultMessage:"After page:"},movePageSelectedPagesPlaceholder:{id:"T+nnfx",defaultMessage:"Enter a page number or range"},movePageEndIndexPlaceholder:{id:"9WSR7I",defaultMessage:"Enter a page number"},movePageConfirmationButton:{id:"7AYF8p",defaultMessage:"Move"},movePageTooltip:{id:"/BJk2b",defaultMessage:"Move pages"},invalidMoveInput:{id:"invalid-move-pages",defaultMessage:"Input is invalid"},movePageCancelButton:{id:"cancel-move-button",defaultMessage:"Cancel"},selectedPageNumberTooltip:{id:"6L9tQ3",defaultMessage:"Enter page number"},insertPageButtonTooltip:{id:"vrGXYA",defaultMessage:"Insert pages into the PDF"},rotatePageButtonTooltip:{id:"EHnPix",defaultMessage:"Rotate selected pages clockwise"},counterRotatePageButtonTooltip:{id:"opfMB/",defaultMessage:"Rotate selected pages counterclockwise"},deletePageButtonTooltip:{id:"UOx2TV",defaultMessage:"Delete selected pages"},addTextButtonTooltip:{id:"iKV4QE",defaultMessage:"Add text annotation"},zoomOut:{id:"yG5dvt",defaultMessage:"Zoom out"},zoomIn:{id:"WvL0c3",defaultMessage:"Zoom in"},zoomSelectPageZoomLevel:{id:"7SIRgn",defaultMessage:"Select page zoom level"},zoomFitToWidth:{id:"QandaV",defaultMessage:"Fit to width"},zoomFitToPage:{id:"WbwDqw",defaultMessage:"Fit to page"},zoomDisabled:{id:"8rkH4d",defaultMessage:"Switch back to List View to enable zoom"},searchButtonAriaLabel:{id:"y7PDmG",defaultMessage:"Search"},searchButtonTooltip:{id:"YuD44M",defaultMessage:"Search in this document"},searchButtonDisabledTooltip:{id:"L92QrK",defaultMessage:"Switch out of Grid view to search the document"},highlightButton:{id:"e7+jFI",defaultMessage:"Highlight"},highlightTooltip:{id:"HTO93S",defaultMessage:"Highlight text"},drawButton:{id:"7E2+UP",defaultMessage:"Draw"},drawTooltip:{id:"5L2CQA",defaultMessage:"Add freehand drawing"},editTextButton:{id:"uo/w/v",defaultMessage:"Edit text"},editTextBetaDisclaimerTooltip:{id:"TAMU0+",defaultMessage:"Text editing is available with limited functionality in this early beta version. Feedback is appreciated."},renameFileButtonTooltip:{id:"f8Qf9a",defaultMessage:"Rename file"},confirmRenameFileLabel:{id:"Wt4Ztz",defaultMessage:"Confirm rename"},cancelRenameFileLabel:{id:"w61T5i",defaultMessage:"Cancel rename"},signButton:{id:"O0/dqs",defaultMessage:"Sign"},signTooltip:{id:"ojGjrL",defaultMessage:"Add a signature"},oneOffRequestSignaturesTooltipTitle:{id:"D1Xe9A",defaultMessage:"Request Signatures"},oneOffRequestSignaturesTooltipMessage:{id:"wcmd0c",defaultMessage:"Now you can easily edit, prepare, and send documents for signature directly from here."},oneOffTooltipConfirm:{id:"cbLxZ6",defaultMessage:"Got it"}}),B_=a.defineMessages({modalApply:{id:"C5yn6i",defaultMessage:"Apply"},modalCancel:{id:"aZCjT8",defaultMessage:"Cancel"},modalApplyHeader:{id:"zy8YSP",defaultMessage:"Apply text edit changes?"},modalApplyBody:{id:"25Mix4",defaultMessage:"Do you want to proceed and apply the changes you made to the text? Please note that text edit changes cannot be undone."},inlineModalApply:{id:"0jeKlY",defaultMessage:"Apply changes"},inlineModalDiscard:{id:"Iz80vM",defaultMessage:"Discard changes"},inlineModalApplyClose:{id:"Gq5xf9",defaultMessage:"Close"},warningDocument:{id:"oN/142",defaultMessage:"No editable text found in the PDF. This may occur on documents that are scanned images."},warningPage:{id:"w5l8pc",defaultMessage:"No editable text found on this page of the PDF. This may occur on pages that are scanned images."},deleteTextBoxWarningTitle:{id:"8nMBhq",defaultMessage:"Delete selected content?"},deleteTextBoxWarningBody:{id:"ZTHUx8",defaultMessage:"Are you sure you want to delete the selected content? This can't be undone."},deleteTextBoxWarningConfirm:{id:"KnwZBm",defaultMessage:"Delete"}}),H_=a.defineMessages({titleText:{id:"Pokr08",defaultMessage:"Replace Original PDF"},bodyText:{id:"h8R2nq",defaultMessage:"All changes made will be saved as the original PDF. Everyone with access to this file will see the changes."},cancelButton:{id:"7U56Ie",defaultMessage:"Cancel"},confirmButton:{id:"XvU3Ze",defaultMessage:"Replace Original"}}),K_=a.defineMessages({titleDeletePageOrPages:{id:"aDs4IN",defaultMessage:"Delete {pageSize, plural, one {# page} other {# pages}}?"},bodyConfirmDeletePageOrPages:{id:"vU0/4L",defaultMessage:"Are you sure you want to delete {pageSize, plural, one {# page} other {# pages}} from this document?"},cancelButton:{id:"mg68jL",defaultMessage:"Cancel"},confirmDeletePagesButton:{id:"WcOqCA",defaultMessage:"Delete {pageSize, plural, one {page} other {pages}}"},checkboxText:{id:"5PRHWF",defaultMessage:"Don't ask me again for this document."},close:{id:"kQvCiN",defaultMessage:"Close"}}),z_=a.defineMessages({deleteInProgressSinglePage:{id:"oWCLzr",defaultMessage:"Deleting 1 page..."},deleteInProgressMultiplePages:{id:"hQZiWx",defaultMessage:"Deleting {totalPages} pages..."},deleteSuccessSinglePage:{id:"VcH+eA",defaultMessage:"Deleted 1 page."},feedbackSubmitted:{id:"sszkQ4",defaultMessage:"Thank you for your feedback."},deleteSuccessMultiplePages:{id:"4ER82j",defaultMessage:"Deleted {totalPages} pages."},insertInProgress:{id:"+fKBm2",defaultMessage:"Inserting pages..."},insertSuccessSinglePage:{id:"BJx5qt",defaultMessage:"Inserted 1 page."},insertSuccessMultiplePages:{id:"ZB2S0S",defaultMessage:"Inserted {totalPages} pages."},closeButton:{id:"BH2Vmj",defaultMessage:"Close"},searchError:{id:"omy5wW",defaultMessage:"Search failed."},renameInvalidError:{id:"5D6lwo",defaultMessage:"Name is invalid"},ungateStoreError:{id:"pY4LFK",defaultMessage:"Couldn’t save changes. Log in and try editing again."},ungateSaveError:{id:"IgHOSJ",defaultMessage:"Couldn’t save changes. Try editing again."}}),W_=a.defineMessages({listViewAriaLabel:{id:"list-view",defaultMessage:"Button to change sidebar grid view to list view"},gridViewAriaLabel:{id:"grid-view",defaultMessage:"Button to change sidebar list view to grid view"},listViewTooltip:{id:"list-view-tooltip",defaultMessage:"List View"},gridViewTooltip:{id:"grid-view-tooltip",defaultMessage:"Grid View"},selectableThumbnailPreview:{id:"unselected-thumbnail-page",defaultMessage:"Page {val}. Selectable thumbnail preview"},currentlySelectedThumbnailPreview:{id:"selected-thumbnail-page",defaultMessage:"Page {val}. Selected thumbnail preview"},rotatedSelectableThumbnailPreview:{id:"rotated-unselected-thumbnail-page",defaultMessage:"Page {val}. Selectable thumbnail preview. Rotated {rotation} degrees"},rotatedCurrentlySelectedThumbnailPreview:{id:"rotated-selected-thumbnail-page",defaultMessage:"Page {val}. Selected thumbnail preview. Rotated {rotation} degrees"},singularDragTooltip:{id:"osOLvR",defaultMessage:"Move {val} page"},pluralDragTooltip:{id:"q0r+TG",defaultMessage:"Move {val} pages"}}),G_=a.defineMessages({title:{id:"4lnLZc",defaultMessage:"Change folder"},backButton:{id:"9q7UZs",defaultMessage:"Back"},chooseButton:{id:"FKhjCo",defaultMessage:"Choose"},closeButton:{id:"p0nMDT",defaultMessage:"Close"},rootFolderLabel:{id:"N5f5c7",defaultMessage:"All files"},createNewFolder:{id:"xzWUQq",defaultMessage:"Create new folder"}}),q_=a.defineMessages({saveCopyTitle:{id:"EzCfED",defaultMessage:"Save a copy"},saveCopyFileName:{id:"DO/9NI",defaultMessage:"File name"},saveCopyDefaultFileName:{id:"Xqxi09",defaultMessage:"{value} (edited).pdf"},saveCopySignedFileName:{id:"Q1zdYR",defaultMessage:"{value} (signed).pdf"},saveCopyDefaultFileNameAriaLabel:{id:"Q2Ak06",defaultMessage:"New name for the copy of the file"},saveCopyFolderLocation:{id:"65nt4I",defaultMessage:"Location"},saveCopyCreateNewFolder:{id:"xzWUQq",defaultMessage:"Create new folder"},saveCopyCancel:{id:"oKRmT+",defaultMessage:"Cancel"},saveCopyConfirm:{id:"4rX4Om",defaultMessage:"Save copy"},saveOriginalConfirmationTitle:{id:"7IB9il",defaultMessage:"Can't replace original"},saveOriginalConfirmationBody:{id:"MyLiwe",defaultMessage:"It appears that you do not have the necessary permissions to modify this file. You can save your changes as a new copy instead."},saveOriginalConfirmationRedirect:{id:"/++6KY",defaultMessage:"Save a copy"},saveOriginalConfirmationClose:{id:"tBAxdL",defaultMessage:"Close"},saveCopyPendingModalMessage:{id:"6CRqwf",defaultMessage:"Saving a copy..."}}),Q_=a.defineMessages({addNewSignature:{id:"tRIKKP",defaultMessage:"Add new signature"},savedSignaturesSectionTitle:{id:"sbS7ZC",defaultMessage:"Your signatures"},addNewSignatureButton1:{id:"6NzVRL",defaultMessage:"Sign yourself"},addNewSignatureButton2:{id:"FGh4VP",defaultMessage:"Create new"},savedSignatures:{id:"HK0ZBf",defaultMessage:"Saved signatures"},savedSignature:{id:"myaGg5",defaultMessage:"Saved signature"},savedSignatureImage:{id:"nUuBk3",defaultMessage:"Saved signature image"},editSignaturesButton:{id:"Kv2rQp",defaultMessage:"Edit your signatures"}}),Y_=a.defineMessages({getSignaturesSectionTitle:{id:"1+OcYA",defaultMessage:"Get signatures"},getSignaturesDropdownButtonLabel:{id:"vCo8oH",defaultMessage:"Get signatures"},addSignersOrFields:{id:"CRAMGA",defaultMessage:"Add signers/fields"},badge:{id:"YOAD3s",defaultMessage:"New"}}),$_=a.defineMessages({passwordProtectedWarning:{id:"VXpyyv",defaultMessage:"Password-protected PDFs can't be edited."}}),Z_=a.defineMessages({confirmButton:{id:"4aLDLg",defaultMessage:"OK"}}),X_=a.defineMessages({title:{id:"809Zqn",defaultMessage:"Can't complete the action."},warning:{id:"n5g2aw",defaultMessage:"Something went wrong. Please try again."}}),J_=a.defineMessages({title:{id:"5ZsLUS",defaultMessage:"Can't open the editor."},warning:{id:"nDF7/D",defaultMessage:"Something went wrong. Please try again."}}),ep=a.defineMessages({title:{id:"yHHQIa",defaultMessage:"Can't connect to the network."},warning:{id:"PXsfmK",defaultMessage:"There was an error connecting to the network. Please check your internet connection."}}),tp=a.defineMessages({title:{id:"z7tG3P",defaultMessage:"Can’t save the changes"},warning:{id:"lI+1be",defaultMessage:"Your Dropbox is full. To save changes to this pdf, free up some space by removing files, or upgrade to add more storage to your Dropbox."},learnMore:{id:"WaoxLp",defaultMessage:"Learn more"}}),ip=a.defineMessages({title:{id:"2GJMM2",defaultMessage:"Can't open the file."},warning:{id:"knZ5lt",defaultMessage:"Something went wrong and we weren't able to open the file. Please try again."}}),ap=a.defineMessages({title:{id:"VIcVDR",defaultMessage:"Can't save the file."},warning:{id:"rlPavf",defaultMessage:"Something went wrong and we weren't able to save the file. Please try again."}}),np=a.defineMessages({title:{id:"dyerh1",defaultMessage:"Can’t add signature."},limitationWarning:{id:"+2TtIJ",defaultMessage:"The page count and file size are too large for signatures in PDF. Try reducing the file to less than 40MB or 500 pages."},unverifiedEmailWarning:{id:"CMLi+b",defaultMessage:"You have an unverified email. In order to use this feature, the email address of your Dropbox account needs to be verified."},unverifiedEmailWarningAddOn:{id:"bqZOkf",defaultMessage:"If you’ve already verified your email, please save your edits and then re-enter this page to proceed."},learnMore:{id:"K2Yiyj",defaultMessage:"Learn more"}}),rp=a.defineMessages({title:{id:"5P3jLp",defaultMessage:"Can’t send the request"},msg:{id:"nCsC6P",defaultMessage:"Something went wrong and we weren’t able to process the signature request at the moment. Please try again."},signature_setting_title:{id:"/Wbi6x",defaultMessage:"Can’t send signature request"},signature_disabled:{id:"glcDni",defaultMessage:"Signature features are turned off for your team. Try contacting your admin if you need a document signed."},external_error_msg:{id:"53sVjW",defaultMessage:"Signature requests can’t be sent to people outside your team. Try contacting your admin if you need people outside your team to sign."},signature_disabled_header:{id:"LGACUK",defaultMessage:"Can’t use signature features"}}),op=a.defineMessages({fileTooBigToDownloadTitle:{id:"NtJj30",defaultMessage:"This file is too big to edit"},fileTooBigToDownloadWarning:{id:"vn11Kz",defaultMessage:"To edit this file, reduce the size of the PDF and try again."}}),sp=a.defineMessages({fileTooBigToSignTitle:{id:"aDn7yM",defaultMessage:"This file is too big to edit or sign"},fileTooBigToSignWarning:{id:"Vv2hRS",defaultMessage:"Reduce the size of the file and try again"}}),lp=a.defineMessages({deleteAllPagesTitle:{id:"DHaYm2",defaultMessage:"Can't delete all pages"},deleteAllPagesWarning:{id:"b7/tgJ",defaultMessage:"At least one page must remain."}}),cp=a.defineMessages({insertErrorTitle:{id:"JwWFYJ",defaultMessage:"Can't insert the PDF"},insertTotalSizeWarning:{id:"LtUv1T",defaultMessage:"Inserting your selected PDF would exceed our maximum total file size. Try inserting a smaller document."},insertPasswordProtectedWarning:{id:"OgMwyb",defaultMessage:"The PDF you're trying to insert is password-protected and can't be added."},insertGenericWarning:{id:"EAiEH3",defaultMessage:"Something went wrong and we weren't able to insert the PDF into this file."}}),dp=a.defineMessages({titleText:{id:"qzVfp7",defaultMessage:"Discard changes?"},bodyText:{id:"jOV5BJ",defaultMessage:"This document contains unsaved changes. If you leave the document now, your changes will be lost. To save your changes, stay on the page and click Done."},cancelButton:{id:"V7lUP7",defaultMessage:"Stay on page"},confirmButton:{id:"UmV3Ms",defaultMessage:"Discard changes"}}),up=a.defineMessages({modalAriaLabel:{id:"IadlMs",defaultMessage:"Insert pages dialog"}}),_p=a.defineMessages({shareFeedbackButton:{id:"39mnFi",defaultMessage:"Share Feedback"},shareFeedbackButtonAltText:{id:"wsA6LJ",defaultMessage:"Feedback on PDF editing"},modalTitleText:{id:"RMO7H5",defaultMessage:"Share feedback about PDF editing"},modalTextAreaPlaceholderText:{id:"ychPKa",defaultMessage:"Share all your hopes and dreams for this feature. Just leave out any personal info to protect your privacy."},modalTextAreaAriaLabel:{id:"zgxPH4",defaultMessage:"Provide user feedback"},modalCheckboxText:{id:"kNtCMH",defaultMessage:"I’d like to participate in Dropbox user research."},modalFeedbackLimitError:{id:"R7XAdk",defaultMessage:"The maximum character limit is 5000."},modalCancelButton:{id:"z3V5z8",defaultMessage:"Cancel"},modalConfirmSendButton:{id:"BxAMAt",defaultMessage:"Send"}}),pp=a.defineMessages({titleText:{id:"hY3bFJ",defaultMessage:"Can’t submit the feedback"},bodyText:{id:"44IgjS",defaultMessage:"Something went wrong and we weren’t able to submit your feedback. Please try again later."},confirmButton:{id:"6/j3Cq",defaultMessage:"OK"}}),gp=a.defineMessages({placeholder:{id:"Xrvcsk",defaultMessage:"Type text here"}}),fp=a.defineMessages({textFontMenu:{id:"mmZztq",defaultMessage:"Change text font"},textSizeMenu:{id:"tvBQUd",defaultMessage:"Change text size"},boldButton:{id:"y0oWis",defaultMessage:"Bold"},italicButton:{id:"W40S6C",defaultMessage:"Italic"},underlineButton:{id:"lzX+oP",defaultMessage:"Underline"},strikethroughButton:{id:"8U3ivV",defaultMessage:"Strikethrough"},linkButton:{id:"MukLTN",defaultMessage:"Link"},textAlignmentLabel:{id:"5+pV3t",defaultMessage:"Text alignment"},textAlignLeftButton:{id:"S6PpbM",defaultMessage:"Align text left"},textAlignCenterButton:{id:"TKFTjO",defaultMessage:"Align text center"},textAlignRightButton:{id:"R7hA/G",defaultMessage:"Align text right"},colorSwatchBlack:{id:"6642Nj",defaultMessage:"Black"},colorSwatchWhite:{id:"DYSuTS",defaultMessage:"White"},colorSwatchRed:{id:"9EGf/X",defaultMessage:"Red"},colorSwatchBlue:{id:"gqincf",defaultMessage:"Blue"},colorSwatchYellow:{id:"UADpVy",defaultMessage:"Yellow"},colorSwatchHighlightBlue:{id:"G9vAMQ",defaultMessage:"Blue"},colorSwatchHighlightYellow:{id:"UADpVy",defaultMessage:"Yellow"},colorSwatchHighlightGreen:{id:"pxBEbj",defaultMessage:"Green"},colorSwatchHighlightRed:{id:"9EGf/X",defaultMessage:"Red"},colorSwatchHighlightPurple:{id:"bNen8A",defaultMessage:"Purple"},colorSwatchUnsupported:{id:"NHFi6v",defaultMessage:"Unsupported"},deleteAnnotationButton:{id:"OJOudl",defaultMessage:"Delete"},eraseButton:{id:"msdoMa",defaultMessage:"Eraser"},undoAnnotationButton:{id:"USTIF/",defaultMessage:"Undo"},redoAnnotationButton:{id:"Kq91IT",defaultMessage:"Redo"},discardEditTextButton:{id:"HasKil",defaultMessage:"Discard"},applyEditTextButton:{id:"H7FbGh",defaultMessage:"Apply"},applyEditTextTooltipTitle:{id:"Mdu5GM",defaultMessage:"Apply Changes?"},applyEditTextTooltipBody:{id:"6TlkFJ",defaultMessage:"Your changes to the text will be lost if you don't apply them."},closeButton:{id:"yyzaoC",defaultMessage:"Close"},opacityLabel:{id:"dRAwo+",defaultMessage:"Opacity"},strokeLabel:{id:"PB6Oi6",defaultMessage:"Stroke"},opacitySliderLabel:{id:"gpQ9oU",defaultMessage:"Opacity Slider"},eraserButtonTooltip:{id:"/bWUrp",defaultMessage:"Eraser"},undoAnnotationButtonTooltip:{id:"af3lWg",defaultMessage:"Undo"},redoAnnotationButtonTooltip:{id:"WHKyKS",defaultMessage:"Redo"},discardEditTextButtonTooltip:{id:"cweee9",defaultMessage:"Discard"},applyEditTextButtonTooltip:{id:"xkJkIc",defaultMessage:"Apply"},stylesMixed:{id:"SfnQ8J",defaultMessage:"Mixed"},stylesMissing:{id:"HH8gPx",defaultMessage:"Missing"},color:{id:"AXolGl",defaultMessage:"Color"},font:{id:"49lEF4",defaultMessage:"Font"},size:{id:"2jWOm1",defaultMessage:"Size"},numberInPts:{id:"jhHIv3",defaultMessage:"{numPts, number}pt"},buttonSelectedLabel:{id:"LrrSsN",defaultMessage:"{iconLabel}: selected"}}),mp=a.defineMessages({dropboxSignNotice:{id:"BllqaG",defaultMessage:"Powered by Dropbox Sign"},drawLabel:{id:"draw",defaultMessage:"Draw"},typeLabel:{id:"type",defaultMessage:"Type"},uploadLabel:{id:"upload",defaultMessage:"Upload"},savedLabel:{id:"saved",defaultMessage:"Saved"},dropboxSignTermsLink:{id:"7AxEZ+",defaultMessage:"Dropbox Sign Terms"},privacyPolicyLink:{id:"zLHDfc",defaultMessage:"Privacy Policy"},termsOfServiceAgreement:{id:"a3ULEn",defaultMessage:"I agree to the <termsLink>Dropbox Sign Terms</termsLink>. Learn about how we use and protect your data in our <privacyPolicyLink>Privacy Policy</privacyPolicyLink>. We’ll create a Dropbox Sign account with your Dropbox email address, or link to your existing account."},thisIsMySignature:{id:"tlGfbJ",defaultMessage:"By selecting “Insert,” I agree to be legally bound by this document and that the signature above is a legal representation of my signature."},thisIsMySignatureSave:{id:"iSW7vU",defaultMessage:"I understand this is a legal representation of my signature."},dropboxSignInfo:{id:"I1OraU",defaultMessage:"Dropbox Sign eSignatures are secure and legally binding"},insertSignatureButton:{id:"qwlq14",defaultMessage:"Insert"},saveSignatureButton:{id:"MvgUgx",defaultMessage:"Save"},signatureModalTitle:{id:"HyXaps",defaultMessage:"Add your signature"},initialsModalTitle:{id:"nsXVMm",defaultMessage:"Add your initials"},signatureModalTitleCreate:{id:"87psb3",defaultMessage:"Create your signature"},drawCanvasAriaLabel:{id:"LwpkTF",defaultMessage:"Draw your signature"},clearCanvasButton:{id:"hISede",defaultMessage:"Clear"},inputPlaceHolder:{id:"IVa7fQ",defaultMessage:"Your name"},changeFontButton:{id:"2z2C+5",defaultMessage:"Change font"},uploadPhotoButton:{id:"fGq2Vj",defaultMessage:"Upload Photo"},uploadPhoto:{id:"Ln3iFN",defaultMessage:"Upload photo"},addFromDropboxMenuButton:{id:"1SoBCB",defaultMessage:"Add from Dropbox"},uploadFromComputerMenuButton:{id:"4i8P0+",defaultMessage:"Upload from your computer"},uploadingStatusMessage:{id:"sTXSPn",defaultMessage:"Uploading files..."},newUploadingStatusMessage:{id:"DC6SD5",defaultMessage:"Uploading file..."},uploadFailedGeneralStatusMessage:{id:"nWfwNB",defaultMessage:"Upload failed. Please try again."},uploadFailedSizeLimitStatusMessage:{id:"0rdscP",defaultMessage:"Upload failed. File size exceeds the maximum limit of 1MB."},uploadFailedFileTypeStatusMessage:{id:"eC0K33",defaultMessage:"The file could not be uploaded. Allowed file types are: png, jpg, jpeg, bmp, gif"},uploadFailedFileNumberStatusMessage:{id:"oK+AhM",defaultMessage:"Upload failed. Please only select one file."},uploadSignaturePhotoLabel:{id:"ttRzcS",defaultMessage:"Upload a photo of your signature."},fileUploadSizeRequirement:{id:"ktBeOZ",defaultMessage:"Max file size: 1MB"},fileUploadTypeRequirement:{id:"nMc9gR",defaultMessage:"png, jpg, jpeg, bmp, gif"},signatureContrast:{id:"94lSnL",defaultMessage:"Contrast"},signatureRotateButton:{id:"KLrwo7",defaultMessage:"Rotate"},signatureDeleteButton:{id:"2rlGeZ",defaultMessage:"Delete"},signatureUploadModalAriaLabel:{id:"sbj0I3",defaultMessage:"Choose an image to upload..."},rotateSignatureAriaLabel:{id:"jn9l0T",defaultMessage:"Rotate, signature rotated {rotation} degrees"},decreaseContrastAriaLabel:{id:"GSE8m1",defaultMessage:"Decrease contrast"},increaseContrastAriaLabel:{id:"iXxkXE",defaultMessage:"Increase contrast"},deleteSigntureAriaLabel:{id:"Pgm/zf",defaultMessage:"Delete signature"},savedSignaturesEmpty:{id:"1hhwdC",defaultMessage:"Signatures you’ve used will appear here."},savedSignaturesError:{id:"G5mTIW",defaultMessage:"Something went wrong and we couldn’t load your signatures. Please try again."},deleteSavedSignatureAriaLabel:{id:"JgDumB",defaultMessage:"Delete selected saved signature"},selectSavedSignatureAriaLabel:{id:"8taRcm",defaultMessage:"Select saved signature"},savedSignatureImageAriaLabel:{id:"diAswL",defaultMessage:"Signature image"}}),hp=a.defineMessages({modalTitle:{id:"oBHgh3",defaultMessage:"Signers"},modalMessage:{id:"AGsB5s",defaultMessage:"Add the people who need to sign this document."},externalSharingPolicyMessage:{id:"wm9qba",defaultMessage:"Only people on your team can be added as signers. Contact your admin if you need signers outside your team."},listTitle:{id:"K3sdun",defaultMessage:"Signers"},signerNameLabel:{id:"UgY0Mg",defaultMessage:"Name"},signerEmailLabel:{id:"1g6jKA",defaultMessage:"Email address"},deleteSignerButtonLabel:{id:"PR/wPP",defaultMessage:"Delete"},undoReminderMsg:{id:"N9ze3W",defaultMessage:"'{signer}' deleted."},undoDeleteSignerButtonLabel:{id:"u6x7k8",defaultMessage:"Undo"},addAnotherSignerButton:{id:"qhiHXg",defaultMessage:"Add another signer"},cancelButton:{id:"NO9BYl",defaultMessage:"Cancel"},addButton:{id:"RU+T8+",defaultMessage:"Add"},applyChangesButton:{id:"x6rr3V",defaultMessage:"Apply changes"},settingsTitle:{id:"pQZIoe",defaultMessage:"Signer settings"},setSignerOrderLabel:{id:"c8xb19",defaultMessage:"Set signer order"},reachMaxSignerLimitError:{id:"AbycdN",defaultMessage:"You can only add up to {value, plural, one {# signer} other {# signers}}"},invalidSignerNameError:{id:"cBn7nY",defaultMessage:"A signer's name is required"},invalidEmailError:{id:"8uyHih",defaultMessage:"The email address is invalid"},duplicatedSignersError:{id:"BNI6q+",defaultMessage:"Signer name and email combinations must be unique"},undoDeleteBannerMessage:{id:"arzExe",defaultMessage:"’{participant_name}’ deleted."},externalSignerError:{id:"+nFiRs",defaultMessage:"This email isn't on your team"}}),vp=w.identity(a.defineMessages({signerNameLabel:{id:"4L+c20",defaultMessage:"Role name"},modalTitle:{id:"JJoMwT",defaultMessage:"Add the roles of people who will sign"},modalMessage:{id:"nPNy8n",defaultMessage:"Add the typical roles of people who will sign this template. For example, Manager and Employee. Then, you can select fields for each to complete."},addAnotherSignerButton:{id:"1nX6Hs",defaultMessage:"Add another"},reachMaxSignerLimitError:{id:"2x1tCF",defaultMessage:"You can only add up to {value, plural, one {# signer role} other {# signer roles}}."}})),Sp=a.defineMessages({addFields:{id:"iKRP46",defaultMessage:"Add fields"},saveTemplateFor:{id:"6bcea0",defaultMessage:"Save template for {name}"},defaultSettings:{id:"NHprso",defaultMessage:"These are default settings for this template. You can always adjust these settings when it’s time to send."},closeWithoutSaving:{id:"nBhm3X",defaultMessage:"Close without saving template?"},closeMessage:{id:"oHpaBr",defaultMessage:"If you close now, your work on this template will be lost. To save it, click <Cancel>Cancel</Cancel> and then <Save>Save template</Save>."},savingTemplate:{id:"1Ju7Az",defaultMessage:"Saving template"},savingTo:{id:"Zbi6Vy",defaultMessage:"Saving to <strong>Signatures</strong> page"},onlySaved:{id:"ryhGx8",defaultMessage:"Only signed documents will save here. The template will save to the Signatures page."},createTemplate:{id:"XHkxYt",defaultMessage:"Create template"}}),Ep=a.defineMessages({statusModalTitle:{id:"MGqjUe",defaultMessage:"Preparing your signed document"},statusModalMessage:{id:"XDf30h",defaultMessage:"Please wait while we create a legal representation of your signature."},sendingStatus:{id:"sending",defaultMessage:"Sending to Dropbox Sign…"},tamperStatus:{id:"tamperProofing",defaultMessage:"Tamper proofing your document…"},finishingStatus:{id:"finishing",defaultMessage:"Finishing up…"}}),wp=a.defineMessages({frameTitleText:{id:"To2KFc",defaultMessage:"Document Preview"},pageText:{id:"WSzsWD",defaultMessage:"Page {pageNumber}. {text} End of page {pageNumber}."}}),bp=a.defineMessages({frameAltText:{id:"DvSFQG",defaultMessage:"Disclaimer: Please be aware that our efforts to maintain accessibility and usability are ongoing. While we strive to make the website as accessible as possible, some issues may be encountered by different assistive technology as the range of assistive technology is wide and varied. We appreciate your understanding."},accessibilityWarning:{id:"ukmzHL",defaultMessage:"Note: There may be limited functionality for screen reader users for this editing tool."}}),yp=a.defineMessages({placeholderText:{id:"YuD44M",defaultMessage:"Search in this document"},findPreviousTooltip:{id:"wubqu1",defaultMessage:"Find previous"},findNextTooltip:{id:"cp9VDY",defaultMessage:"Find next"},closeSearchTooltip:{id:"LK/f9v",defaultMessage:"Close search"},resultCounter:{id:"vuF5Gx",defaultMessage:"{currentResult} of {totalResults}"}}),Tp=a.defineMessages({linkTitle:{id:"ws48cM",defaultMessage:"Enter URL"},linkPlaceholder:{id:"supHl2",defaultMessage:"https://example.com"},apply:{id:"SSywG/",defaultMessage:"Apply"},cancel:{id:"1genlL",defaultMessage:"Cancel"},removeLink:{id:"34AOWb",defaultMessage:"Remove link"}}),Ip=a.defineMessages({editTextModalTitle:{id:"kx2sZZ",defaultMessage:"Upgrade to edit PDF text right in Dropbox"},editTextModalBodyCanUpgrade:{id:"s8bOY1",defaultMessage:"Upgrade to edit, move, and delete text in the PDF itself."},editTextModalBodyCanNotUpgrade:{id:"FZTEWp",defaultMessage:"Ask your admin about upgrading so you can edit text in the PDF itself."},editTextTooltipTitle:{id:"L2FTmr",defaultMessage:"Edit PDF text"},editTextTooltiplBody:{id:"fPNXIa",defaultMessage:"Upgrade your plan to edit PDF text right in Dropbox."},upsellClose:{id:"tRq3qG",defaultMessage:"Close"},upsellGotIt:{id:"2SUBUI",defaultMessage:"Got it"},upsellComparePlans:{id:"VAiLnX",defaultMessage:"Compare plans"},upsellUpgrade:{id:"ZZ1Nvu",defaultMessage:"Upgrade now"},signatureQuotaTitle:{id:"62A0ZN",defaultMessage:"Looks like you need more"},signatureQuotaTeamTitle:{id:"5T7LKQ",defaultMessage:"You’re out of signature requests—get more with Dropbox Sign"},signatureQuotaBodyCanUpgrade:{id:"YDL9nd",defaultMessage:"You're out of signature requests for the month. Upgrade to get unlimited signatures, reusable templates, and more."},signatureQuotaBodyCanUpgradeStandard:{id:"7C5I9S",defaultMessage:"You're out of signature requests for the month. Upgrade to Dropbox Business to get unlimited signatures, reusable templates, and more."},signatureQuotaBodyCanNotUpgrade:{id:"qwXUvD",defaultMessage:"You're out of signature requests for the month. Ask your admin about upgrading to get unlimited signatures."},signatureQuotaBodyCanNotUpgradeOther:{id:"FrIlLt",defaultMessage:"You're out of signature requests for the month."},signatureQuotaBodyTeamUpgrade:{id:"8+NJ+K",defaultMessage:"Try Dropbox Sign free for 30 days to get unlimited signatures, reusable templates, and more. Your signature requests will be available on both dropboxsign.com and the Signatures page in Dropbox."}}),Cp=a.defineMessages({sidePanelHeader:{id:"z8YgWN",defaultMessage:"Signers and fields"},signerTitle:{id:"Vqr7vZ",defaultMessage:"Signer"},signersDropdownAria:{id:"HxAfcS",defaultMessage:"Select signer to assign fields to"},selfSignerLabel:{id:"6wRnqb",defaultMessage:"Me (now)"},addSignersButton:{id:"Gm4e9l",defaultMessage:"Add/Edit signers"},addEditSigners:{id:"Uj1f20",defaultMessage:"Add/edit signers"},editSignersButton:{id:"ak3qko",defaultMessage:"Edit signers"},addOrEditSignersButtonAria:{id:"RWBLah",defaultMessage:"Open modal to add or edit signers"},signatureFieldsTitle:{id:"oZHCn6",defaultMessage:"Signature fields"},signatureFormField:{id:"aIWw+a",defaultMessage:"Signature"},signatureFormFieldAria:{id:"FDXZ2h",defaultMessage:"Add signature form field"},initialsFormField:{id:"UDAn2/",defaultMessage:"Initials"},initialsFormFieldAria:{id:"IX+gqY",defaultMessage:"Add initials form field"},autoFillFieldsTitle:{id:"FbhdRO",defaultMessage:"Auto-fill fields"},dateFormat:{id:"zYek29",defaultMessage:"MM/DD/YYYY"},dateFormField:{id:"zEUgJt",defaultMessage:"Date signed"},dateFormFieldAria:{id:"pNM7mx",defaultMessage:"Add date form field"},nameFormField:{id:"OBtJW4",defaultMessage:"Full name"},nameFormFieldAria:{id:"ZNgd3z",defaultMessage:"Add name form field"},emailFormField:{id:"zdDAbF",defaultMessage:"Email address"},emailFormFieldAria:{id:"FfbxiY",defaultMessage:"Add email address form field"},titleFormField:{id:"Hu4XHt",defaultMessage:"Title"},titleFormFieldAria:{id:"P29XHU",defaultMessage:"Add work title form field"},companyFormField:{id:"h6r2yv",defaultMessage:"Company"},companyFormFieldAria:{id:"YH1ich",defaultMessage:"Add company form field"},standardFieldsTitle:{id:"5U18JT",defaultMessage:"Standard fields"},textboxFormField:{id:"N1V8tc",defaultMessage:"Textbox"},textboxFormFieldAria:{id:"QQvVdl",defaultMessage:"Add textbox form field"},checkboxFormField:{id:"GyYhI6",defaultMessage:"Checkbox"},checkboxFormFieldAria:{id:"soUk+B",defaultMessage:"Add checkbox form field"},assigneeLabel:{id:"zfutcc",defaultMessage:"Assigned to"},textboxPlaceholderLabel:{id:"tX3aKR",defaultMessage:"Placeholder text"},fieldNameLabel:{id:"+qQ1Yw",defaultMessage:"Field name"},requiredFieldCheckbox:{id:"4Kj7kQ",defaultMessage:"Required fields"},requiredFieldLabel:{id:"WIW5fL",defaultMessage:"(required)"},checkByDefaultCheckbox:{id:"jP2enI",defaultMessage:"Checked by default"},multiSelectLabel:{id:"TAjfHL",defaultMessage:"Select"},unassignedLabel:{id:"dgjnxr",defaultMessage:"Unassigned"},fieldsSelectedLabel:{id:"Ekpw/a",defaultMessage:"fields selected"},numFieldsSelected:{id:"qv7oHv",defaultMessage:"{numSelected, plural, one {# field} other {# fields}} selected"},closeSidePanelAria:{id:"RQnvA9",defaultMessage:"Close form building panel"},removeFieldAria:{id:"aGYuNq",defaultMessage:"Remove field"},editFieldAria:{id:"PrcXkV",defaultMessage:"Edit field"}}),Ap=w.identity(a.defineMessages({nameFormFieldPlaceholder:{id:"pqoHE1",defaultMessage:"Examples: Manager, Employee"},addSignersButton:{id:"U/d9Mq",defaultMessage:"Add/Edit roles"},editSignersButton:{id:"8Azm5T",defaultMessage:"Edit roles"},sidePanelHeader:{id:"usZitb",defaultMessage:"Roles and fields"},signerTitle:{id:"YvXh94",defaultMessage:"Role"},nameFormField:{id:"YvXh94",defaultMessage:"Role"}})),Mp=a.defineMessages({saveFormFieldsHeader:{id:"PA+6IM",defaultMessage:"Not ready to send for signature?"},saveFormFieldsBody:{id:"srTa2E",defaultMessage:"Just a heads up, if you save now, the assigned field information will be lost. Next time, you'll need to reassign fields before sending for signatures."},saveFormFieldsContinue:{id:"UMy8bo",defaultMessage:"Continue saving"}}),Op=a.defineMessages({modalTitle:{id:"soVHYm",defaultMessage:"Send <name>{fileName}</name>"},emailToSignersLabel:{id:"97rio+",defaultMessage:"Email to signers"},emailSubjectLabel:{id:"JY65Z1",defaultMessage:"Subject"},emailMessageLabel:{id:"M6Msnr",defaultMessage:"Message"},optionalLabel:{id:"QrGIHG",defaultMessage:"(optional)"},fileSaveSectionTitle:{id:"qjovzs",defaultMessage:"Signed document"},fileLocationLabel:{id:"SLIOHm",defaultMessage:"Location"},fileNameLabel:{id:"urBVI1",defaultMessage:"Save signed copy as"},confirmButton:{id:"eZCDd8",defaultMessage:"Send"},cc:{id:"8LH0SW",defaultMessage:"CC"},deleteEmailButtonLabel:{id:"KJ1oIF",defaultMessage:"Delete"},invalidEmailError:{id:"8uyHih",defaultMessage:"The email address is invalid"},displayFileName:{id:"VHZl8e",defaultMessage:"{filename} (signed)"}}),Pp=a.defineMessages({sendForSignatureStatusModalHeader:{id:"t8OPVm",defaultMessage:"Sending your document for Signature…"},sendForSignatureStatusModalTitle:{id:"tHLj5J",defaultMessage:"Sending your document for signature…"},sendForSignatureStatusModalBody:{id:"Wiyk7B",defaultMessage:"We are securely sending your document for signature. This may take a few moments."},sendForSignatureStatusModalStatus:{id:"Xc0AZB",defaultMessage:"Sending to Dropbox Sign…"}}),xp=a.defineMessages({modalTitle:{id:"mJ4iqF",defaultMessage:"Save template for <name>{fileName}</name>"},emailToSignersLabel:{id:"wsVwqQ",defaultMessage:"Default email to signers"},emailSubjectLabel:{id:"JY65Z1",defaultMessage:"Subject"},emailMessageLabel:{id:"M6Msnr",defaultMessage:"Message"},optionalLabel:{id:"QrGIHG",defaultMessage:"(optional)"},fileSaveSectionTitle:{id:"ZFUAy4",defaultMessage:"Defaults for signed documents"},fileLocationLabel:{id:"SLIOHm",defaultMessage:"Location"},fileNameLabel:{id:"qjv29d",defaultMessage:"Save as"},fileNameTooltip:{id:"Q2peIG",defaultMessage:"Only signed documents will save here. The template will save to the Signatures page."},fileNameTooltipAriaLabel:{id:"QMkkeo",defaultMessage:"Open for more information"},confirmButton:{id:"iVqXCh",defaultMessage:"Save template"},cc:{id:"8LH0SW",defaultMessage:"CC"},deleteEmailButtonLabel:{id:"KJ1oIF",defaultMessage:"Delete"},invalidEmailError:{id:"8uyHih",defaultMessage:"The email address is invalid"},displayTemplateName:{id:"rMkExj",defaultMessage:"{filename}"},displaySavedFileName:{id:"kFzEbC",defaultMessage:"{filename} (signed)"}}),Dp=a.defineMessages({dragFieldsTooltipTitle:{id:"FgnaKp",defaultMessage:"Drag fields where you want them"},dragFieldsTooltipText:{id:"47vt2S",defaultMessage:"Select the fields you need and drag them over."},addSignersTooltipTitle:{id:"LuQc0F",defaultMessage:"Add anyone you missed"},addSignersTooltipText:{id:"rBE1V2",defaultMessage:"It’s not too late. Add or remove signers from here."},switchSignersTooltipTitle:{id:"5fJobH",defaultMessage:"Switch between signers"},switchSignersTooltipText:{id:"KIlDhb",defaultMessage:"You can select specific fields for each signer to complete."},nextButtonTitle:{id:"w8ma64",defaultMessage:"Next"},skipButtonTitle:{id:"eWSo0v",defaultMessage:"Skip"},doneButtonTitle:{id:"5QHXNh",defaultMessage:"Done"},walktroughStepsCounter1of3:{id:"884FNz",defaultMessage:"1 of 3"},walktroughStepsCounter2of3:{id:"8otnaj",defaultMessage:"2 of 3"},walktroughStepsCounter3of3:{id:"CpGpJ7",defaultMessage:"3 of 3"}}),Rp=a.defineMessages({header:{id:"o69Rrs",defaultMessage:"Drag your PDF here to start editing"},subtext:{id:"fcBSGW",defaultMessage:"When you’re done, sign up to save changes. Or, Dropbox can delete your file so no data stays behind."},choosePDFButton:{id:"ICKI6z",defaultMessage:"Choose PDF"},samplePDFButton:{id:"AsmheZ",defaultMessage:"Edit sample PDF"},privacyPolicyLink:{id:"zLHDfc",defaultMessage:"Privacy Policy"},privacyPolicyText:{id:"lrI1df",defaultMessage:"To learn how your data is protected and used, visit our <privacyPolicyLink>Privacy Policy</privacyPolicyLink>."},chooserModalHeader:{id:"xcImwW",defaultMessage:"Choose a PDF document to edit"},chooserModalPlaceholder:{id:"OCfadh",defaultMessage:"This folder doesn’t contain any PDF files"},chooserModalUpload:{id:"t3o/9z",defaultMessage:"Upload file"},uploadFailedGeneric:{id:"Qgsihr",defaultMessage:"Upload failed. Please try again."},uploadFailedFileSize:{id:"3UVwTH",defaultMessage:"Can’t upload PDF over 111 MB."},uploadFailedFileType:{id:"IUR/C7",defaultMessage:"This file type is unsupported."},loadingFile:{id:"8kjBj4",defaultMessage:"Loading file…"},savingFile:{id:"mCMJd/",defaultMessage:"Saving to Dropbox…"}}),Np=a.defineMessages({bannerText:{id:"TV5ivo",defaultMessage:"Sign up to save your changes and keep editing PDFs, right in Dropbox."},bannerActionButton:{id:"K/0zxI",defaultMessage:"Sign up for free"}}),kp=a.defineMessages({authErrorHeader:{id:"RP3dnV",defaultMessage:"Turn off 2FA or SSO to continue"},authErrorStepsHeader:{id:"E7V11d",defaultMessage:"To use signing tools on dropbox.com:"},authErrorRemediationStep:{id:"zerFUi",defaultMessage:"Go to hellosign.com, then turn off 2-factor authentication or SAML SSO"},authErrorProTip:{id:"JjuJLl",defaultMessage:"If you haven't already, turn on 2-step verification on dropbox.com in your settings"},authErrorButtonText:{id:"YqKkni",defaultMessage:"Go to hellosign.com"}}),Lp=e=>{let t,i,n;e.header&&(t=te.default.createElement(a.Modal.Title,null,l.intl.formatMessage(e.header))),e.body&&(i=l.intl.formatMessage(e.body)),e.bodyAddOn&&(n=l.intl.formatMessage(e.bodyAddOn));const r=e.confirmationString||Z_.confirmButton;return te.default.createElement(a.Modal,{open:e.isOpen,isCentered:!0,withCloseButton:"Close",onRequestClose:e.close},te.default.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},t),te.default.createElement(a.Modal.Body,{hasVerticalSpacing:!1},i,te.default.createElement("br",null),te.default.createElement("br",null),n),te.default.createElement(a.Modal.Footer,null,e.additionalCloseButton&&te.default.createElement(a.Button,{variant:"opacity",onClick:e.close},l.intl.formatMessage(e.additionalCloseButton)),te.default.createElement(a.Button,{variant:"primary",onClick:()=>{e.confirmRedirect?window.open(e.confirmRedirect):e.onConfirm?e.onConfirm():e.close()},withIconLeft:e.confirmRedirect?te.default.createElement(a.UIIcon,{src:M.OpenLine}):null},l.intl.formatMessage(r))))};Lp.displayName="ConfirmationModal";const Fp=e=>e&&a.isBrowseFile(e)&&!a.isEncryptedFile(e)&&m.HELLOSIGN_SUPPORTED_EXTENSIONS.includes("."+a.getExtension$1(e));function Up(e,t,i,a,n){return{file:a,entryPoint:"file_preview_workflows_tab",logContext:"preview_workflows_button",logUserAction:t,user:i,uxaLogPrefix:"send_signatures_on_workflow",setActiveEditorCallback:e,pageCount:n}}const Vp=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.VIDEO_SYNTHESIS,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],jp={filterValidFile:e=>Fp(e)?e:void 0,filterValidUser:Vd,shouldShowForPreviewSurface:Bd(Vp),shouldShowForPreviewType:Fd},Bp=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.VIDEO_SYNTHESIS,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],Hp={filterValidFile:e=>Fp(e)?e:void 0,filterValidUser:Vd,shouldShowForPreviewSurface:Bd(Bp),shouldShowForPreviewType:Fd};function Kp(e,t,i,a,n,r){return{file:a,entryPoint:"file_preview_workflows_tab_self_sign",logContext:r,logUserAction:e,setActiveEditorCallback:t,user:i,uxaLogPrefix:"self_sign_on_workflow",pageCount:n}}const zp=(t,i,r,o,s,l)=>{if(s||!l)return[];const d=Nd(t,Hp),u=d&&Up(i,r,d.user.user,d.file,o),_=u&&{label:be,icon:P.SendLine,handler:zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){(yield new Promise((function(t,i){e(["./c_action_plugins_send_for_signature_action_action"],t,i)}))).sendForSignatureAction(u)})))),actionType:a.UserAction.SendForSignature},p=c.is_supported_mobile_browser()?void 0:Nd(t,jp),g=p&&Kp(r,i,p.user.user,p.file,o,a.UserActionContext.PreviewToolbar),f=g&&{label:Te,icon:a.SignatureLine,handler:zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){(yield new Promise((function(t,i){e(["./c_action_plugins_self_sign_action_action"],t,i)}))).selfSignAction(g)})))),actionType:a.UserAction.SelfSign};return[...f?[f]:[],..._?[_]:[]]},Wp=2147483648,Gp=301989888,qp=209715200,Qp=107374182400,Yp=536870912,$p=8388608,Zp=1073741824,Xp={".ppt":Gp,".pptx":Gp},Jp={".3fr":qp,".ai":268435456,".arw":qp,".bmp":104857600,".cr2":qp,".crw":qp,".dcr":qp,".dcs":qp,".dng":qp,".dwg":104857600,".erf":qp,".gif":104857600,".heic":104857600,".jpeg":104857600,".jpg":104857600,".kdc":qp,".mef":qp,".mos":qp,".mrw":qp,".nef":qp,".nrw":qp,".orf":qp,".pef":qp,".png":104857600,".ppm":104857600,".psd":1073741824,".r3d":qp,".raf":qp,".rw2":qp,".rwl":qp,".sr2":qp,".svg":50331648,".svgz":50331648,".tif":qp,".tiff":qp,".wbmp":104857600,".webp":104857600,".x3f":qp},eg={".3gp":Qp,".3gpp":Qp,".3gpp2":Qp,".asf":Qp,".avi":Qp,".dv":Qp,".m2t":Qp,".m4v":Qp,".mkv":Qp,".mov":Qp,".mp4":Qp,".mpeg":Qp,".mpg":Qp,".mts":Qp,".ogv":Qp,".rm":Qp,".ts":Qp,".vob":Qp,".webm":Qp,".wmv":Qp},tg={".7z":Yp,".rar":Yp,".zip":Yp,".zipx":Yp},ig={".txt":$p},ag={".aac":Zp,".aif":Zp,".aiff":Zp,".m4a":Zp,".m4r":Zp,".mp3":Zp,".oga":Zp,".ogg":Zp,".wav":Zp,".wma":Zp},ng=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Xp),Jp),eg),tg),ig),{".csv":41943040,".doc":167772160,".docx":167772160,".pdf":524288e3,".rtf":167772160,".xls":41943040,".xlsx":41943040}),ag),{}),rg=Object.keys(ng);function og(e,t){return e<=ng[cg(t)]}const sg=new Set(["deck","agreement","report","investor","overview","letter","fund","pitch","series","signed","summary","llc","presentation","form","proposal","board","copy","inc.","financial","capital","final","certificate","sheet","plan","investment","nda","executed","update","statement","data","stock","ventures","contract","note","model","offer","health","business","safe","consent","may","seed","meeting","june","new","cap","intro","sales","inc"]);function lg(e){const t=new Set([...e.split(" "),...e.split("_"),...e.split("-")]);for(const e of t)if(sg.has(e.toLowerCase()))return!0;return!1}function cg(e){return e.toLowerCase().replace(/^\.*/,".")}var dg=Object.freeze({__proto__:null,ACCEPTED_EXTENSIONS:rg,AUDIO_DEFAULT_FILE_SIZE_LIMIT:Zp,DEFAULT_FILE_SIZE_LIMIT:Wp,FILE_SIZE_LIMITS:ng,IMAGE_DEFAULT_FILE_SIZE_LIMIT:qp,LINK_DEFAULT_FILE_SIZE_LIMIT:10485760,PRESENTATION_DEFAULT_FILE_SIZE_LIMIT:Gp,TEXT_DEFAULT_FILE_SIZE_LIMIT:$p,VIDEO_DEFAULT_FILE_SIZE_LIMIT:Qp,ZIP_DEFAULT_FILE_SIZE_LIMIT:Yp,canonicalizeFileExt:cg,isFileNameHighIntent:lg,isFileSupported:og});const ug=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.VIDEO_SYNTHESIS,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],_g={filterValidFile:e=>(e=>e&&a.isBrowseFile(e)&&!a.isEncryptedFile(e)&&og(e.bytes,a.getExtension$1(e)))(e)?e:void 0,filterValidUser:Ud,shouldShowForPreviewSurface:Bd(ug),shouldShowForPreviewType:Fd};function pg(e){return{class:"docsend",action:"view",object:"docsend_hub_entry_button",properties:e}}const gg=["off","on","control"];function fg(e){return gg.find((t=>t===(null==e?void 0:e.toLowerCase())))}const mg=["off","on","control"];function hg(e){return mg.find((t=>t===(null==e?void 0:e.toLowerCase())))}function vg(t,i){const r=te.default.useCallback(w.once((()=>{a.logStormcrowExposure("send_and_track_previews_exp",String(t.sdkConfig.send_and_track_previews_exp))})),[t.sdkConfig.send_and_track_previews_exp]),o=te.default.useCallback(w.once((()=>{a.logStormcrowExposure("send_and_track_file_name_targeting",String(t.sdkConfig.send_and_track_file_name_targeting))})),[t.sdkConfig.send_and_track_file_name_targeting]);"OFF"!==t.sdkConfig.send_and_track_file_name_targeting&&t.sdkConfig.can_access_docsend_hub&&o(),"OFF"!==t.sdkConfig.send_and_track_previews_exp&&t.sdkConfig.can_access_docsend_hub&&r();const s="OFF"!==t.sdkConfig.send_and_track_previews_exp&&"CONTROL"!==t.sdkConfig.send_and_track_previews_exp,l="OFF"!==t.sdkConfig.send_and_track_file_name_targeting&&"CONTROL"!==t.sdkConfig.send_and_track_file_name_targeting,c="CONTROL"===t.sdkConfig.send_and_track_file_name_targeting,d=Nd(i,_g),[u,_]=te.default.useState([]);return te.default.useEffect((()=>{if(s&&d&&t.sdkConfig.can_access_docsend_hub||l&&d&&t.sdkConfig.can_access_docsend_hub&&(i=d.file,lg(a.getFilenameWithoutExtension(i)))||c&&d&&t.sdkConfig.can_access_docsend_hub){a.UDCL.logEvent(pg({docsendHubEntryButtonTarget:"docsend_hub",actionSurface:"previews",sendAndTrackPreviewsExpVariant:fg(t.sdkConfig.send_and_track_previews_exp),sendAndTrackFileNameTargetingVariant:hg(t.sdkConfig.send_and_track_file_name_targeting)}));const i={label:Ge,icon:x.AnalyticsLine,handler:zu((()=>n.__awaiter(this,void 0,void 0,(function*(){(yield new Promise((function(t,i){e(["./c_action_plugins_send_and_track_action_action"],t,i)}))).sendAndTrackAction({user:d.user.user,file:d.file,canTryDocsendHub:t.sdkConfig.can_try_docsend_hub,docsendHubTrialImplicit:t.sdkConfig.docsend_hub_trial_implicit,sendAndTrackPreviewsExpVariant:t.sdkConfig.send_and_track_previews_exp,sendAndTrackFileNameTargetingVariant:t.sdkConfig.send_and_track_file_name_targeting})})))),actionType:a.UserAction.SendAndTrack,campaignElementId:"toolbar-send-and-track-button"};_([i])}else _([]);var i}),[]),u}const Sg=[a.SDKPreviewSurface.BACKUP,a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.VIDEO_SYNTHESIS,a.SDKPreviewSurface.QUICK_VIEW_BROWSE,a.SDKPreviewSurface.QUICK_VIEW_SEARCH,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],Eg={filterValidFile:e=>!st(e)||lt(e)||ct(e)?void 0:e,filterValidUser:Ud,shouldShowForPreviewSurface:Bd(Sg),shouldShowForPreviewType:Fd},wg=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.VIDEO_HOME],bg={filterValidFile:(e,t)=>qa(e,t)?e:void 0,shouldShowForPreviewSurface:Bd(wg),shouldShowForPreviewType:Fd,filterValidUser:e=>c.is_mobile_or_tablet()?void 0:{user:e}},yg=[$u,Yd,bg,jp,Hp],Tg=vl("OpenInMenuContent",(()=>new Promise((function(t,i){e(["./c_action_plugins_open_in_action_dropdown"],t,i)})))),Ig=e=>e&&[a.SDKPreviewSurface.QUICK_VIEW_BROWSE,a.SDKPreviewSurface.QUICK_VIEW_SEARCH].includes(e),Cg=(e,t)=>{const i=Nd(e,Eg);if(i&&(a.MSOFFICE_EDITOR_FILE_EXTS.includes(`.${a.getExtension$1(i.file)}`)||!(e=>{for(const t of yg)if(Nd(e,t))return!0;return!1})(e)||Ig(t)))return i},Ag=(e,t,i)=>{const n=Cg(e,i);if(!n||!t)return[];const r=Ig(i)?a.UserActionContext.QuickViewToolbar:a.UserActionContext.PreviewToolbar;return[{label:ce,icon:M.OpenLine,handler:{type:"menu",menu:te.default.createElement(a.Provider,{store:a.getStore()},te.default.createElement(Tg,{user:n.user.user,file:n.file,actionContext:r,surface:i}))},actionType:a.UserAction.OpenInMenu}]},Mg=e=>{if(a.isBrowseFile(e)&&"read_only"in e&&!e.read_only&&a.isSupportedPreviewType(e.ext)&&!a.isEncryptedFile(e))return e},Og=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],Pg={filterValidFile:Mg,filterValidUser:e=>e&&a.fileViewerConfiguration.watermarkingByUserId[e.id]?{user:e}:void 0,shouldShowForPreviewSurface:Bd(Og),shouldShowForPreviewType:Fd},xg="water_marking";var Dg;!function(e){e.Draw="unfurl_actions_draw",e.Highlight="unfurl_actions_highlight",e.AddText="unfurl_actions_add_text"}(Dg||(Dg={}));const Rg=(e,t)=>[Vg(e,t),Lg(e,t),Fg(e,t),Ug(e,t)],Ng=()=>n.__awaiter(void 0,void 0,void 0,(function*(){return yield new Promise((function(t,i){e(["./c_action_plugins_pdf_edit_action_action"],t,i)}))})),kg=(e,t,i)=>({handler:null!=t?t:zu(Ku({action:"edit"},a.PreviewType.SsrDoc,i)),actionType:t?e:a.UserAction.LoggedOutEditPdfAttempt,tooltip:t?void 0:{text:Fu}}),Lg=(e,t)=>Object.assign({icon:T.ScribbleLine,label:l.intl.formatMessage({id:"7E2+UP",defaultMessage:"Draw"})},kg(a.UserAction.Draw,e?zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){(yield Ng()).pdfEditAction(e,a.UserActionContext.PreviewToolbar,Dg.Draw)})))):void 0,t)),Fg=(e,t)=>Object.assign({icon:T.HighlightLine,label:l.intl.formatMessage({id:"e7+jFI",defaultMessage:"Highlight"})},kg(a.UserAction.Highlight,e?zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){(yield Ng()).pdfEditAction(e,a.UserActionContext.PreviewToolbar,Dg.Highlight)})))):void 0,t)),Ug=(e,t)=>Object.assign({icon:T.TextBoxLine,label:l.intl.formatMessage({id:"B1Oo3m",defaultMessage:"Add text"})},kg(a.UserAction.AddText,e?zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){(yield Ng()).pdfEditAction(e,a.UserActionContext.PreviewToolbar,Dg.AddText)})))):void 0,t)),Vg=(e,t)=>Object.assign({icon:D.EditLine,label:l.intl.formatMessage({id:"ey0C8F",defaultMessage:"Edit PDF"}),campaignElementId:"toolbar-edit-pdf-button"},kg(a.UserAction.EditPdf,e?zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){(yield Ng()).pdfEditAction(e,a.UserActionContext.PreviewToolbar)})))):void 0,t)),jg=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.SHARED_LINK_EMBED,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.STARRED],Bg=[a.PreviewType.Video,a.PreviewType.Audio],Hg={filterValidFile:e=>a.isEncryptedFile(e)?void 0:e,filterValidUser:e=>({user:e}),shouldShowForPreviewSurface:Bd(jg),shouldShowForPreviewType:e=>Hd(Bg)(e)},Kg=(e,t)=>{const i=e.previews_exp_logged_out_audio_video_editing;return(t===a.PreviewType.Audio||t===a.PreviewType.Video)&&("V1"===i||"V2"===i)},zg=({featureConfig:e,file:t,previewType:i,sharePermission:n,user:r})=>{if(!r||!t)return!1;if(a.isEncryptedFile(t))return!1;if(n&&!a.isDownloadAllowed(n))return!1;if(!i||i===a.PreviewType.Loading){const e=a.getExtension$1(t);i=u.resolvePreviewTypeFromExtension(`.${e}`)}if(i===a.PreviewType.Video)return!0;const o=null==e?void 0:e.previews_exp_audio_trimming_str,s="ON"===o;return!(i!==a.PreviewType.Audio||(o&&a.logStormcrowExposure("previews_exp_audio_trimming",o,null==r?void 0:r.id),!s))},Wg=e=>{var t,i;const a=null===(i=null===(t=e.data)||void 0===t?void 0:t.apiData)||void 0===i?void 0:i.segments;return a&&(null==a?void 0:a.length)>0},Gg=(e,t)=>{var i,a;const n=Ml(e,t),r=Ol(e,t);return!(!e||!t||"video"!==(null===(i=t.content)||void 0===i?void 0:i[".tag"])&&"audio"!==(null===(a=t.content)||void 0===a?void 0:a[".tag"]))&&(!(!n.error||n.error.statusCode!==u.RivieraStatus.NotFound)&&(!r.isLoading&&!r.isError))},qg="ON",Qg="INTERNAL_RELEASE",Yg=[qg,Qg,"BETA"],$g=()=>!!a.fileViewerFeatureExperiments.acqSusiUngatedDropboxAiVariant&&"OFF"!==a.fileViewerFeatureExperiments.acqSusiUngatedDropboxAiVariant&&"CONTROL"!==a.fileViewerFeatureExperiments.acqSusiUngatedDropboxAiVariant;const Zg=[...a.PDF_EXTS,...a.ROOT_VIDEO_EXTS,...a.AUDIO_EXTS,...a.DOC_PDF_PREVIEW_EXTS,".txt",".ai",".eps",".ps",".dot",".dotx",".dwg",".azw4",".djvu",".epub",".mobi",".fdr",".fdx",".odg",".ods",".binder",".hwp",".paper",".papert"],Xg=[...a.ROOT_VIDEO_EXTS,...a.AUDIO_EXTS],Jg=(e,t=!0)=>t?Zg.includes(u.getFileExtension(e)):a.PDF_EXTS.includes(u.getFileExtension(e));a.DOCUMENT_EXTS,a.PLAINTEXT_EXTS;const ef=e=>Xg.includes(u.getFileExtension(e))&&"OFF"===a.fileViewerFeatureExperiments.previewsExpDropboxAiVideoEnabled,tf=()=>{const e=u.useFileViewerContext();return!e||(null==e?void 0:e.isLoggedIn)},af=e=>a.getLinkType(e)===a.LinkTypes.Righteous?N.Cookies.read("rl_auth"):a.getLinkType(e)===a.LinkTypes.Shmodel?N.Cookies.read("sm_auth"):null,nf=(e,t,i,n=!0)=>Jg(a.getFilename(e),n)&&!ef(a.getFilename(e))&&!a.isEncryptedFile(e)&&$g()?void 0!==t&&a.isDownloadAllowed(t)&&!(null==i?void 0:i.isPasswordRequired):!(!Jg(a.getFilename(e),n)||ef(a.getFilename(e))||a.isEncryptedFile(e)),rf=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.DESKTOP_PREVIEW,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],of=()=>{let e=rf;return a.fileViewerFeatureExperiments.previewsExpDropboxAiInbandShare===qg&&(e=e.concat([a.SDKPreviewSurface.INBAND_SHARE])),a.fileViewerFeatureExperiments.previewsExpDropboxAiSharedLinks===qg&&(e=e.concat([a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.SHARED_CONTENT_LINK])),$g()&&(e=e.concat([a.SDKPreviewSurface.SHARED_LINK])),e},sf={filterValidFile:(e,t,i,a,n)=>nf(e,t,n)?e:void 0,filterValidUser:e=>$g()?{user:e}:Yg.includes(a.fileViewerFeatureExperiments.previewsExpDropboxAiAssistant)?Ud(e):void 0,shouldShowForPreviewSurface:e=>Bd(of())(e),shouldShowForPreviewType:Fd};const lf={generic_error:"failGeneric",permission_error:"failGeneric",unsupported_error:"failGeneric",filesystem_error:"failGeneric",filesystem_transient_error:"failRetryable",over_quota_error:"failOverQuota",riviera_permanent_error:"failGeneric",riviera_retryable_error:"failRetryable",riviera_too_large_error:"failTooLarge",riviera_source_corrupt_error:"failCorrupt",riviera_password_protected_error:"failPassword",password_protected_shared_link_error:"failPasswordLink",riviera_internal_failure_error:"failGeneric",riviera_invalid_request_error:"failGeneric",riviera_unsupported_format_error:"failGeneric",other:"failGeneric"};function cf(e,t){return(a.isBrowseFile(e)||t&&t.canDownloadRoles.length>0)&&!a.isEncryptedFile(e)}function df(e){return t=>{if(1!==t.length||t[0].is_dir)return!1;const i=a.getExtension$1(t[0]);return e.includes(i)}}function uf(e,t,i){const n=a.filename(e),r=a.parentDirName(e);return r?t(n,r):i(n)}const _f=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.VIDEO_HOME],pf={filterValidFile:(e,t)=>{if(e&&cf(e,t)&&df(d.SUPPORTED_UNZIP_EXTENSIONS)([e]))return e},filterValidUser:Ud,shouldShowForPreviewSurface:Bd(_f),shouldShowForPreviewType:e=>e===a.PreviewType.Archive||e===a.PreviewType.Error};const gf=(t,i,r)=>{if(!Nd(t,pf))return[];const o={context:i,file:t.file,sharePermission:t.sharePermission,shareToken:r,user:t.user},s=l.intl.formatMessage({id:"pB6h1Y",defaultMessage:"Archive files over 512 MB cannot be extracted"}),c=o.file.bytes/1048576>=u.UNZIP_MAX_FILESIZE_MB;return o.user?[{label:l.intl.formatMessage({id:"u1R/iY",defaultMessage:"Extract all"}),icon:D.ZipLine,handler:zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){(yield new Promise((function(t,i){e(["./c_conversions_actions_unzip"],t,i)})).then((function(e){return e.unzip_esnext}))).UnzipAction.convert([o.file],o.user,{shareToken:r,source:"preview"})})))),actionType:a.UserAction.ExtractAll,disabled:c,tooltip:c?{text:s}:void 0}]:[]},ff=(e,t,i,r,o,s,c,d,_,g)=>{var f,m;const{fileViewerId:h,logUserAction:v,featureConfig:S,pluginContext:E}=u.useFileViewerContext(),w=_r(),b=Rd(),y=null!==(f=null==w?void 0:w.previewType)&&void 0!==f?f:a.PreviewType.Other,I=Jr(((e,t,i)=>v(e,i?a.UserActionContext.Keyboard:t?a.UserActionContext.PreviewToolbarOverflowMenu:a.UserActionContext.PreviewToolbar))),C=$r(jn,h),A=Br(C,w),M=$r(Wn,h),O=Jr((()=>{var e;return null===(e=Nn(M))||void 0===e?void 0:e.currentPageIndex})),P=te.default.useMemo((()=>({user:e,file:t,previewSurface:r,previewType:y,sharePermission:i,previewKey:C,sharedLinkInfo:g})),[e,t,r,y,i,C,g]),x=Zr(Bn,C),R=Wu(null==x?void 0:x.file_name,null==x?void 0:x.size),N=Os(),{data:k}=cu(N),L=null===(m=null==k?void 0:k.apiData)||void 0===m?void 0:m.metadata,F=go(),U=te.default.useMemo((()=>((e,t,i,a,n,r)=>Nd(e,$u)?L_(t,i,a,n,!e.user,r):[])(P,F,v,S,L,_)),[P,_,S,L,v,F]),V=te.default.useMemo((()=>((e,t,i,r,o,s,l)=>{if(Nd(e,$d)&&!s){if(a.logVariantExposure("previews_exp_logged_out_audio_video_editing",r.previews_exp_logged_out_audio_video_editing),"V1"===r.previews_exp_logged_out_audio_video_editing){const t=qu(e.previewType,l);return[{icon:T.CutLine,label:Lu,handler:t({handler:()=>n.__awaiter(void 0,void 0,void 0,(function*(){}))},void 0===e.user,{action:"edit"}),tooltip:{text:Fu},actionType:a.UserAction.LoggedOutEditAudioVideoAttempt}]}if("V2"===r.previews_exp_logged_out_audio_video_editing)return Qu(e.previewType,t,i,r,o,void 0,!0,l)}return Nd(e,Yd)?Qu(e.previewType,t,i,r,o,s):[]})(P,b,v,S,F,R,_)),[R,P,_,S,v,F,b]),j=te.default.useMemo((()=>((e,t,i,n,r,o)=>{if(!Nd(e,bg))return[];const s=!!e.user,l="ON"===i.previews_exp_ungate_pdf_edit;s||a.logStormcrowExposure("previews_exp_ungate_pdf_edit",i.previews_exp_ungate_pdf_edit);const c=s||l?{logUserAction:t,setActiveEditorCallback:n,getCurrentPage:r}:void 0;return s&&"ON"!==i.pdf_editing_unfurl_actions?[Vg(c,o)]:Rg(c,o)})(P,v,S,F,O,_)),[P,_,S,O,v,F]),B=te.default.useMemo((()=>((e,t)=>Nd(e,Pg)?[{icon:D.StampLine,label:l.intl.formatMessage({id:"Hmnxto",defaultMessage:"Watermark"}),handler:zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){return t(xg,a.UserActionContext.PreviewToolbar)})))),actionType:a.UserAction.Watermark}]:[])(P,F)),[P,F]),H=te.default.useMemo((()=>[...U,...V,...j,...B]),[U,V,j,B]),K=vg(E,P),z=((e,t)=>{var i,r;const{fileViewerId:o,featureConfig:s}=u.useFileViewerContext(),l=(null===(r=null===(i=$r(to,o))||void 0===i?void 0:i.sidebarPlugins)||void 0===r?void 0:r.right)===p.TRANSCRIPT_BLADE_PLUGIN_ID,c=ro(p.TRANSCRIPT_BLADE_PLUGIN_ID,a.UserActionContext.PreviewToolbar),d=so(p.TRANSCRIPT_BLADE_PLUGIN_ID,a.UserActionContext.PreviewToolbar),_=Qr(o),g=As(),f=Ml(_,g),m=Wg(f);if(!Nd(e,Hg))return[];const h=!e.user&&Kg(s,e.previewType)&&!m,v=zu(h?Ku({action:"transcript"},e.previewType,t):()=>n.__awaiter(void 0,void 0,void 0,(function*(){l?c():d()})));return[{icon:T.ClosedCaptionsLine,label:ze,handler:v,actionType:void 0,tooltip:h?{text:We}:void 0}]})(P,_),W=(e=>{var t,i;const{fileViewerId:r}=u.useFileViewerContext(),o=(null===(i=null===(t=$r(to,r))||void 0===t?void 0:t.sidebarPlugins)||void 0===i?void 0:i.right)===p.AI_PLUGIN_ID,s=ro(p.AI_PLUGIN_ID,a.UserActionContext.Toolbar),c=so(p.AI_PLUGIN_ID,a.UserActionContext.Toolbar);if(!Nd(e,sf))return[];const d=p.AI_PLUGIN_ID+"-action-button"+(o?"-opened":"-closed");return[{icon:a.Twinkle2Line,label:l.intl.formatMessage({id:"aNz4Ju",defaultMessage:"Dropbox AI"}),handler:zu((()=>n.__awaiter(void 0,void 0,void 0,(function*(){o?s():c()})))),actionType:a.UserAction.DropboxAI,campaignElementId:d}]})(P),G=te.default.useMemo((()=>[...N_(P,F,v,S,_),...gf(P,E,d),...z,...zp(P,F,v,A,s,c),...Ag(P,o),...W,...K]),[P,F,v,S,_,E,d,z,A,s,c,o,W,K]);return{actions:te.default.useMemo((()=>H.length||G.length?{editActions:H,fileActions:G}:void 0),[H,G]),logAction:I}};a.injectInternalStyle("/static/js/file_viewer/components/preview_button.module.out-vflh2TWhu.css",(e=>"._preview-button_1gfbp_1{letter-spacing:0}"));const mf=te.forwardRef(((e,t)=>{var{children:i,color:r="Text Base"}=e,o=n.__rest(e,["children","color"]);return te.createElement(a.Box,Object.assign({as:a.Button},o,{fontFamily:"Text",fontSize:"Text Medium",fontWeight:"Base",color:o.disabled?"Disabled Base":r,ref:t,className:"_preview-button_1gfbp_1"}),i)}));mf.displayName="PreviewButton";a.injectInternalStyle("/static/js/file_viewer/toolbar/action_bar.module.out-vfl6ZzEe6.css",(e=>"._action-bar_1ywq1_1{align-items:center;display:flex;flex:1 1 0;justify-content:space-between;min-width:0}._action-bar_1ywq1_1>*{flex-grow:0;flex-shrink:0}._action-bar-buttons_1ywq1_14{align-items:center;display:flex}._action-bar-button-dig-override_1ywq1_19{font-family:var(--type__body__standard--fontfamily);font-size:var(--type__body__standard--fontsize);font-weight:var(--type__body__standard--fontweight);letter-spacing:0;line-height:var(--type__body__standard--lineheight)}._action-bar-button-icon_1ywq1_27{display:flex;margin-right:calc(var(--dig-spacing__micro__medium)/2)}"));const hf="_action-bar_1ywq1_1";a.injectInternalStyle("/static/js/file_viewer/toolbar/previews_controls.module.out-vflb5AMqK.css",(e=>'._separator_1k7wo_1{border-right:1px solid var(--dig-color__border__subtle);height:var(--dig-spacing__macro__small);margin:0 var(--dig-spacing__micro__small);width:0}._left-spacing_1k7wo_8{margin:0 0 0 var(--dig-spacing__micro__small)}._spacing_1k7wo_12{margin:0 var(--dig-spacing__micro__xsmall) 0 var(--dig-spacing__micro__small)}._fullscreen_1k7wo_16{margin-left:0}._page-display_1k7wo_20,._page-display-padding_1k7wo_21{font-feature-settings:"tnum"}._page-display-padding_1k7wo_21{opacity:0}'));const vf=()=>te.default.createElement("div",{className:"_separator_1k7wo_1"}),Sf=({fileViewerId:e,previewKey:i,breakpoint:n})=>{var r;const o=b.useDispatch(),s=a.useIntl(),{logUserAction:l}=u.useFileViewerContext(),c=$r(Yn,e),d=null===(r=$r(Gn,e))||void 0===r?void 0:r.isDocSidebarOpen,_=Nn(Xr(Kn,e,i)),p=xs(),g=Jr((()=>{d?(o(vn({fileViewerId:e,sourceContext:a.UserActionContext.Toolbar})),l(a.UserAction.HidePageSelector,a.UserActionContext.PreviewToolbar)):(o(hn({fileViewerId:e,sourceContext:a.UserActionContext.Toolbar})),l(a.UserAction.PageSelector,a.UserActionContext.PreviewToolbar))}));if(!_)return null;const f=d?s.formatMessage({id:"0r5Vny",defaultMessage:"Hide sidebar"}):s.formatMessage({id:"FyinXl",defaultMessage:"Show sidebar"}),m=d?T.SidebarHideLine:T.SidebarShowLine;return c?te.default.createElement(wf,{pageCount:p,currentPage:_.currentPageIndex,breakpoint:n}):te.default.createElement(te.default.Fragment,null,n!==t.FileViewerBreakpoint.SM&&te.default.createElement(el,{onClick:g,label:f,icon:m}),te.default.createElement(wf,{pageCount:p,currentPage:_.currentPageIndex,breakpoint:n}),te.default.createElement(vf,null))};Sf.displayName="DocControls";const Ef=e=>te.default.createElement("span",{className:"_page-display_1k7wo_20"},e),wf=({pageCount:e,currentPage:i,breakpoint:n})=>{const r=a.useIntl(),{fileViewerId:o}=u.useFileViewerContext(),s=$r(Yn,o),l=i+1,c=e?e.toString().length-l.toString().length:0,d="".padEnd(c,"0");return e?te.default.createElement(a.Text,{"data-testid":"page-count",className:a.cx("_spacing_1k7wo_12","_left-spacing_1k7wo_8",{_fullscreen_1k7wo_16:s}),size:"small"},n===t.FileViewerBreakpoint.LG?r.formatMessage({id:"R9Qzvb",defaultMessage:"Page <page>{currentPage, number}</page> of {totalPages, number}"},{currentPage:l,totalPages:e,page:Ef}):r.formatMessage({id:"sDSg9c",defaultMessage:"<page>{currentPage, number}</page> of {totalPages, number}"},{currentPage:l,totalPages:e,page:Ef}),te.default.createElement("span",{className:"_page-display-padding_1k7wo_21","aria-hidden":!0},d)):null};wf.displayName="PageCountDisplay";const bf=e=>(t,i)=>i?[...t,i.offsetLeft+i.offsetWidth-e]:t,yf=(e,t)=>(i,a,n)=>a>e||!t(n)&&a+48>e?i:i+1,Tf=te.default.memo((({actions:e,logAction:t})=>{if(!e)return null;const i=[],a=e=>{const a=e.handler;"click"===a.type&&a.keyboardBinding&&i.push(Oo(Object.assign(Object.assign({},a.keyboardBinding),{callback:()=>{a.handler(),e.actionType&&t(e.actionType,!1,!0)}})))};return e.editActions.forEach(a),e.fileActions.forEach(a),te.default.createElement(Do,{name:"action_bar",keyboardBindings:i})}));Tf.displayName="ActionBarKeyboardBindings";const If=e=>{const{fileViewerId:t}=u.useFileViewerContext();return $r(Yn,t)?te.default.createElement("div",{className:hf}):te.default.createElement(Cf,Object.assign({},e))};If.displayName="ActionBar";const Cf=({actions:e,logAction:i,breakpoint:a})=>{const{fileViewerId:n}=u.useFileViewerContext(),r=$r(io,n),o=$r(tr,n),s=r||o,{containerRef:l,editActions:c,getEditButtonRef:d,fileActions:_,getFileButtonRef:p,overflowActions:g}=((e,t)=>{const{editActions:i=[],fileActions:a=[],overflowActions:n=[]}=null!=e?e:{},[r,o]=te.default.useState(),[s,l]=te.default.useState(),[c,d]=te.default.useState(),[u,_]=te.default.useState(),{nodeRef:p,node:g}=_l(),f=te.default.useRef([]),m=te.default.useRef([]);e!==r&&(f.current=new Array(i.length),m.current=new Array(a.length)),te.default.useLayoutEffect((()=>{var i;o(e),l(t);const a=null!==(i=null==g?void 0:g.offsetLeft)&&void 0!==i?i:0;d(f.current.reduce(bf(a),[])),_(m.current.reduce(bf(a),[]))}),[e,t]);const h=g?g.offsetWidth:0,{shownEditActions:v,shownFileActions:S,shownOverflowActions:E}=te.default.useMemo((()=>{if(e!==r||t!==s||!h||!c||!u)return{shownEditActions:i,shownFileActions:a,shownOverflowActions:n};const o=!!a.length,l=!!n.length,d=c.reduce(yf(h,(e=>!(o||l)&&e===c.length-1)),0);if(d<i.length)return{shownEditActions:i.slice(0,d),shownFileActions:[],shownOverflowActions:[i.slice(d),a,...n]};const _=u.reduce(yf(h,(e=>!l&&e===u.length-1)),0);return{shownEditActions:i,shownFileActions:a.slice(0,_),shownOverflowActions:[a.slice(_),...n].filter((e=>0!==e.length))}}),[e,r,t,s,h,c,u,a,n,i]),w=te.default.useCallback((e=>t=>f.current[e]=t),[]),b=te.default.useCallback((e=>t=>m.current[e]=t),[]);return{containerRef:p,editActions:v,getEditButtonRef:w,fileActions:S,getFileButtonRef:b,overflowActions:E}})(e,a),f=c.length>0&&_.length>0,m=tl(a),h=a===t.FileViewerBreakpoint.SM;return te.default.createElement("div",{className:hf,ref:l},te.default.createElement(Tf,{actions:e,logAction:i}),te.default.createElement("div",{className:"_action-bar-buttons_1ywq1_14"},c.map(((e,t)=>te.default.createElement(Af,{action:e,key:t,disabled:e.disabled||s,buttonRef:d(t),iconOnly:m,logAction:i}))),f&&te.default.createElement(vf,null),_.map(((e,t)=>te.default.createElement(Af,{action:e,key:t,disabled:e.disabled||s,buttonRef:p(t),iconOnly:h,logAction:i})))),te.default.createElement(Rf,{actionGroups:g,logAction:i}))};Cf.displayName="ActionBarContent";const Af=e=>{var{action:t}=e,i=n.__rest(e,["action"]);const a=t.handler;return"click"===a.type?te.default.createElement(Of,Object.assign({action:Object.assign(Object.assign({},t),{handler:a})},i)):te.default.createElement(xf,Object.assign({action:Object.assign(Object.assign({},t),{handler:a})},i))};Af.displayName="ToolbarAction";const Mf=te.default.forwardRef(((e,t)=>{var{action:i,iconOnly:r}=e,o=n.__rest(e,["action","iconOnly"]);const s=a.useIntl(),l={variant:"borderless",ref:t},{label:c,icon:d,tooltip:u,campaignElementId:_}=i,p="string"==typeof c?c:s.formatMessage(c),g=te.default.createElement(a.UIIcon,{src:d,width:"20px",height:"20px"}),f=r||i.iconOnly?te.default.createElement(a.IconButton,Object.assign({},l,o,{"aria-label":p,"data-campaigns-element-id":_}),g):te.default.createElement(mf,Object.assign({},l,o,{"data-campaigns-element-id":_}),te.default.createElement("span",{className:"_action-bar-button-icon_1ywq1_27"},te.default.createElement(a.UIIcon,{isOpticallyAligned:!0,src:d,width:"20px",height:"20px"})),p),m=r&&!u?{text:p}:u;if(!m)return f;const h="string"==typeof m.text?m.text:s.formatMessage(m.text),v=m.keyboardShortcut?" "+m.keyboardShortcut:"";return te.default.createElement(a.Tooltip,{title:h+v,shouldCloseOnClick:!0,placement:"bottom"},te.default.createElement("span",null,f))}));Mf.displayName="ActionButton";const Of=({action:e,disabled:t,iconOnly:i,buttonRef:a,logAction:n})=>{const r=Jr((()=>{e.handler.handler(),e.actionType&&n(e.actionType,!1,!1)}));return te.default.createElement(Mf,{action:e,iconOnly:i,onClick:r,disabled:t,ref:a})};Of.displayName="ClickAction";const Pf=e=>{var t,i,a;(null==e?void 0:e.menuItem)&&"dropdown"===(null==e?void 0:e.nodeType)?null===(i=(t=e.menuItem).handler)||void 0===i||i.call(t):null===(a=null==e?void 0:e.handler)||void 0===a||a.call(e)},xf=({action:e,disabled:t,iconOnly:i,buttonRef:n,logAction:r})=>{const o=()=>{e.actionType&&r(e.actionType,!1,!1)};return te.default.createElement(a.Menu.Wrapper,{onSelection:Pf},(({getContentProps:r,getTriggerProps:s})=>te.default.createElement(te.default.Fragment,null,te.default.createElement("span",{ref:n},te.default.createElement(Mf,Object.assign({action:e,disabled:t,iconOnly:i,withDropdownIcon:!0},s()))),te.default.createElement(a.Menu.Content,Object.assign({},r(),{onContentOpened:o}),e.handler.menu))))};xf.displayName="MenuAction";const Df=({actions:e,logAction:t,isOverflowMenu:i})=>{const n=a.useIntl();return te.default.createElement(a.Menu.Segment,null,e.map((e=>{const{label:r,icon:o,handler:s,actionType:l,disabled:c,tooltip:d}=e,u="string"==typeof r?r:n.formatMessage(r),_=te.default.createElement(a.UIIcon,{src:o}),p="click"===s.type?te.default.createElement(a.Menu.ActionItem,{key:u,disabled:c,value:{handler:()=>{s.handler(),l&&t(l,i,!1)}},withLeftAccessory:_},u):te.default.createElement(a.Menu.Submenu,{key:u,withTriggerContent:u,withLeftAccessory:_,onSubmenuOpened:()=>{l&&t(l,i,!1)}},s.menu);return d?te.default.createElement(a.Tooltip,{title:d.text},p):p})))};Df.displayName="ActionMenuItems";const Rf=({actionGroups:e,logAction:t})=>{const i=a.useIntl();if(!e||0===e.flat().length)return null;return te.default.createElement(a.Menu.Wrapper,{onSelection:Pf,onToggle:e=>{e.isOpen&&t(a.UserAction.OpenActionBarOverflow,!1,!1)}},(({getTriggerProps:n,getContentProps:r})=>te.default.createElement(te.default.Fragment,null,te.default.createElement(a.IconButton,Object.assign({variant:"borderless",withDropdownIcon:!0},n()),te.default.createElement(a.UIIcon,{src:a.MoreHorizontalLine,"aria-label":i.formatMessage({id:"CkWL4V",defaultMessage:"More"})})),te.default.createElement(a.Menu.Content,Object.assign({},r(),{"data-testid":"action-bar-overflow-menu"}),e.map(((e,i)=>te.default.createElement(Df,{key:i,actions:e,logAction:t,isOverflowMenu:!0})))))))};Rf.displayName="OverflowMenu";const Nf=()=>{const e=a.useIntl(),{onFindInDoc:t}=cn(),i=e.formatMessage({id:"hYpvWY",defaultMessage:"Find in document"});return t?te.createElement(te.Fragment,null,te.createElement(el,{label:i,onClick:t,icon:L.SearchLine,disabled:!1,variant:"borderless"}),te.createElement(vf,null)):null};a.injectInternalStyle("/static/js/file_viewer/toolbar/zoom_controls.module.out-vflZO0n7q.css",(e=>"._zoom-controls_19i79_1{align-items:center;display:flex;padding-right:0}._zoom-button-wrapper_19i79_7{padding-left:var(--dig-spacing__micro__xsmall)}._zoom-button-spacing_19i79_11{padding:0 var(--dig-spacing__micro__small)}"));const kf=({fileViewerId:e,previewType:i,callbacks:n,breakpoint:r=t.FileViewerBreakpoint.LG})=>{var o;const{onZoomOut:s,onZoomIn:l,onZoomToPercent:c,onFitToWidthOrPage:d}=n,u=a.useIntl(),_=Ln($r(Wn,e)),p=null!==(o=null==_?void 0:_.zoomScaleFactor)&&void 0!==o?o:null==_?void 0:_.fitScaleFactor,g=null==_?void 0:_.fitScaleFactor,f=u.formatMessage({id:"0ZiqhW",defaultMessage:"Zoom out"}),m=u.formatMessage({id:"yuwJIR",defaultMessage:"Zoom in"});return void 0!==p&&void 0!==g&&[a.PreviewType.Image,a.PreviewType.SsrDoc].includes(i)?te.createElement("div",{className:"_zoom-controls_19i79_1"},te.createElement(el,{label:f,onClick:s,icon:T.ZoomOutLine,disabled:p<=.01,variant:"borderless"}),te.createElement(el,{label:m,onClick:l,icon:T.ZoomInLine,disabled:p>=64,variant:"borderless"}),r!==t.FileViewerBreakpoint.SM&&te.createElement("div",{className:"_zoom-button-spacing_19i79_11"},te.createElement(Ff,{scaleFactor:p,previewType:i,callbacks:{onZoomToPercent:c,onFitToWidthOrPage:d}}))):null};kf.displayName="ZoomControls";const Lf=[.1,.25,.5,.75,1,1.25,1.5,2,4,8,16,64],Ff=({scaleFactor:e,callbacks:t})=>{const{onZoomToPercent:i,onFitToWidthOrPage:n}=t,r=a.useIntl(),{logUserAction:o}=u.useFileViewerContext(),s=r.formatNumber(e,{style:"percent",maximumFractionDigits:0}),l=r.formatMessage({id:"XHCS37",defaultMessage:"Zoom percentage dropdown button; {percentage}"},{percentage:s}),c=Jr((e=>{"fit_to_width"===e?(o(a.UserAction.ZoomFitToWidth,a.UserActionContext.PreviewToolbar),n(!0)):"fit_to_page"===e?(o(a.UserAction.ZoomFitToPage,a.UserActionContext.PreviewToolbar),n(!1)):(o(a.UserAction.ZoomChangePercentage,a.UserActionContext.PreviewToolbar),i(e))}));return te.createElement(a.Menu.Wrapper,{onSelection:c},(({getTriggerProps:t,getContentProps:i})=>te.createElement(te.Fragment,null,te.createElement(mf,Object.assign({},t(),{variant:"outline","aria-label":l,hasNoUnderline:!0,withDropdownIcon:!0}),r.formatNumber(e,{style:"percent",maximumFractionDigits:0})),te.createElement(a.Menu.Content,Object.assign({},i()),te.createElement(a.Menu.Segment,null,te.createElement(a.Menu.ActionItem,{value:"fit_to_width"},r.formatMessage({id:"WCG5C5",defaultMessage:"Fit to width"})),te.createElement(a.Menu.ActionItem,{value:"fit_to_page"},r.formatMessage({id:"nfpyB1",defaultMessage:"Fit to page"}))),te.createElement(a.Menu.Segment,null,Lf.map((e=>te.createElement(a.Menu.ActionItem,{key:e,value:e},r.formatNumber(e,{style:"percent",maximumFractionDigits:0})))))))))};Ff.displayName="ZoomButton";const Uf=e=>{const{fileViewerId:t,previewKey:i,previewType:n,breakpoint:r,sourceContext:o}=e,s=b.useDispatch(),l=Jr((()=>{s(fn({fileViewerId:t,previewKey:i,sourceContext:null!=o?o:a.UserActionContext.Toolbar}))})),c=Jr((()=>{s(gn({fileViewerId:t,previewKey:i,sourceContext:null!=o?o:a.UserActionContext.Toolbar}))})),d=Jr((e=>{e&&s(mn({fileViewerId:t,previewKey:i,zoomType:"zoomPercent",zoomScaleFactor:e}))})),u=Jr((e=>{s(mn({fileViewerId:t,previewKey:i,zoomType:e?"fitToWidth":"fitToPage"}))}));return te.default.createElement(kf,{fileViewerId:t,previewType:n,callbacks:{onZoomOut:l,onZoomIn:c,onZoomToPercent:d,onFitToWidthOrPage:u},breakpoint:r})};Uf.displayName="PreviewZoomControl";a.injectInternalStyle("/static/js/file_viewer/toolbar/toolbar.module.out-vflq62FZV.css",(e=>"._lhs_1ubzy_1{align-items:center;display:flex}._lhs_1ubzy_1._fullscreen_1ubzy_6{padding-left:var(--dig-spacing__micro__xsmall)}._rhs_1ubzy_10{align-items:center;display:flex}"));a.injectInternalStyle("/static/js/file_viewer/toolbar/toolbar_holder.module.out-vflCkmq8h.css",(e=>"._toolbar-holder_1a4ms_1{--titlebar-inline-margin:var(--dig-spacing__micro__xlarge);--close-button-width:40px;--close-button-right-margin:var(--dig-spacing__micro__large);align-items:center;background-color:var(--dig-color__background__raised);box-sizing:border-box;display:flex;margin-top:calc(var(--dig-spacing__micro__small)*-1);padding-bottom:var(--dig-spacing__micro__medium);padding-left:calc(var(--titlebar-inline-margin) + var(--close-button-width) + var(--close-button-right-margin));padding-right:var(--titlebar-inline-margin);width:100%}._toolbar-holder_1a4ms_1._edit-mode_1a4ms_30{margin-top:0}._toolbar-holder_1a4ms_1._fullscreen_1a4ms_34{padding-left:var(--dig-spacing__micro__xlarge)}._toolbar-holder_1a4ms_1._small_1a4ms_38{padding-left:calc(var(--titlebar-inline-margin) + var(--close-button-width))}"));const Vf=e=>{var{children:i,isFullscreen:r,breakpoint:o,isEditMode:s}=e,l=n.__rest(e,["children","isFullscreen","breakpoint","isEditMode"]);return te.default.createElement("div",Object.assign({className:a.cx("_toolbar-holder_1a4ms_1",{_fullscreen_1a4ms_34:r,_small_1a4ms_38:o===t.FileViewerBreakpoint.SM,"_edit-mode_1a4ms_30":s})},l),i)};Vf.displayName="ToolbarHolder";const jf=new Set([a.PreviewType.Excel,a.PreviewType.HTML,a.PreviewType.Image,a.PreviewType.RawHTML,a.PreviewType.SsrDoc]),Bf=e=>{const{fileViewerId:t,previewKey:i,previewType:n,actions:r,breakpoint:o,logAction:s}=e,l=$r(Yn,t);return te.default.createElement(Vf,{"data-testid":"redesign-toolbar","data-tooltip":"redesigned-previews-toolbar",isFullscreen:l,breakpoint:o},n===a.PreviewType.SsrDoc&&te.default.createElement("div",{className:a.cx("_lhs_1ubzy_1",{_fullscreen_1ubzy_6:l})},te.default.createElement(Sf,{fileViewerId:t,previewKey:i,breakpoint:o})),te.default.createElement(If,{actions:r,logAction:s,breakpoint:o}),te.default.createElement("div",{className:"_rhs_1ubzy_10"},te.default.createElement(Nf,null),te.default.createElement(Uf,{fileViewerId:t,previewKey:i,previewType:n,breakpoint:o}),(e=>jf.has(e))(n)&&te.default.createElement(il,{fileViewerId:t,previewKey:i,variant:"borderless"})))};Bf.displayName="Toolbar";const Hf=()=>{const{toolbar:e}=Cs();return te.default.useMemo((()=>e?(e=>t=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(e,Object.assign({},t))))(e):Bf),[e])};a.injectInternalStyle("/static/js/file_viewer/toolbar/toolbar_wrapper.module.out-vflPTiRfz.css",(e=>"._sizer_1idgd_1{width:100%}"));const Kf=new Set([a.PreviewType.SsrDoc,a.PreviewType.Image]),zf=({actions:e,logAction:t})=>{const{fileViewerId:i}=u.useFileViewerContext(),a=$r(jn,i),n=_r(),r=null==n?void 0:n.previewType,o=Js(),s=Hf();return te.default.createElement("div",{className:"_sizer_1idgd_1"},(Kf.has(r)||e)&&a?te.default.createElement(s,{fileViewerId:i,previewKey:a,previewType:r,actions:e,logAction:t,breakpoint:o}):null)};zf.displayName="ToolbarWrapper";const Wf=e=>{const{user:t,file:i,sharePermission:n,previewSurface:r,hasOpenInActions:o,userHasDmtConflict:s,shareToken:l,isSendForSignatureEnabled:c,encryptionOptions:d,sharedLinkInfo:_}=e,{actions:p,logAction:g}=ff(t,i,n,r,o,s,c,l,d,_);return!t&&a.PDF_EXTS.includes(u.getFileExtension(a.getFilename(i)))&&n&&a.isDownloadAllowed(n)&&!(null==_?void 0:_.isPasswordRequired)&&R.useLogExposureOnce({feature:"acq_susi_ungated_dropbox_ai",variant:a.fileViewerFeatureExperiments.acqSusiUngatedDropboxAiVariant}),te.default.createElement(zf,{actions:p,logAction:g})};Wf.displayName="MetaserverToolbarWrapper";const Gf=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{PreviewTour:t}=yield new Promise((function(t,i){e(["./c_file_viewer_preview_tour_tour"],t,i)}));return{default:t}})))),qf=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(Gf,Object.assign({},e)));qf.displayName="AsyncPreviewTour";const Qf=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{SharingPreviewTour:t}=yield new Promise((function(t,i){e(["./c_file_viewer_preview_tour_sharing_tour"],t,i)}));return{default:t}})))),Yf=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(Qf,Object.assign({},e)));Yf.displayName="AsyncSharingPreviewTour";a.injectInternalStyle("/static/js/file_viewer/components/titlebar_dropdowns.module.out-vflgSMZnG.css",(e=>'._titlebar-dropdowns_hcl3i_1{align-items:center;display:flex;flex:1 1 auto}._titlebar-dropdowns__button_hcl3i_7 .dig-Button-content{padding:0 var(--dig-spacing__micro__small)}._titlebar-dropdowns__loading-indicator_hcl3i_11{background-color:var(--dig-color__background__subtle);height:16px;margin:var(--dig-spacing__micro__large);overflow:hidden;position:relative;width:120px}._titlebar-dropdowns__loading-indicator_hcl3i_11:after{animation:_shimmer_hcl3i_1 1.5s infinite;background-image:linear-gradient(90deg,transparent 0,var(--dig-color__background__base) 50%,transparent);bottom:0;content:"";left:0;opacity:.65;position:absolute;right:0;top:0}@keyframes _shimmer_hcl3i_1{0%{transform:translateX(-100%)}to{transform:translateX(100%)}}'));const $f=({contentProps:e})=>te.createElement(a.Menu.Content,Object.assign({},e),te.createElement(a.Menu.Segment,null,te.createElement(a.Menu.ActionItem,null,te.createElement(A.Skeleton.Text,{width:120,size:"medium"})),te.createElement(A.Skeleton.Text,{width:120}),te.createElement(A.Skeleton.Text,{width:120}))),Zf=({openDropdownKey:e,setOpenDropdownKey:t,dropdown:i})=>{const{title:n,LazyDropdown:r,userAction:o}=i,s=a.useIntl().formatMessage(n),{pluginContext:l}=u.useFileViewerContext(),[c,d]=te.useState({disabled:!1,tooltip:void 0}),_=te.useCallback((e=>{var t,i,a;(null==e?void 0:e.menuItem)&&"dropdown"===(null==e?void 0:e.nodeType)?null===(i=(t=e.menuItem).handler)||void 0===i||i.call(t):null===(a=null==e?void 0:e.handler)||void 0===a||a.call(e)}),[]),p=te.useCallback((({isOpen:i})=>{i&&!e?t(s):i||e!==s||t(void 0)}),[e,t,s]);return te.createElement(a.Menu.Wrapper,{key:s,onSelection:_,onToggle:p,shouldPropagateClickOutsideMouseEvents:!0},(({getContentProps:u,getTriggerProps:_,closeMenu:p,openMenu:g})=>{const f=_(),m=u();m.open&&e&&e!==s&&p({});const h=te.createElement("div",{"data-testid":"edit-menu-dropdown","data-dropdown-title":n.defaultMessage},te.createElement(mf,Object.assign({},f,{variant:m.open?"opacity":"borderless",color:"Text Subtle",disabled:c.disabled,onClick:e=>{var t;e.stopPropagation(),null===(t=f.onClick)||void 0===t||t.call(f,e),l.logUserAction(o)},onMouseEnter:i=>{i.stopPropagation(),e&&e!==s&&(t(s),g({autoFocus:!1}))},"data-tooltip":i.dataTooltip,className:"_titlebar-dropdowns__button_hcl3i_7"}),s),te.createElement(te.Suspense,{fallback:te.createElement($f,{contentProps:m})},te.createElement(r,{contentProps:m,setMenuDisabled:e=>{e.disabled===c.disabled&&e.tooltip===c.tooltip||(d(e),e.disabled&&p({}))}})));return c.disabled&&c.tooltip?te.createElement(a.Tooltip,{title:c.tooltip},h):h}))},Xf=({content:e,tooltipSelector:t})=>{const[i,a]=te.useState(void 0);return te.createElement("div",{role:"menubar",className:"_titlebar-dropdowns_hcl3i_1"},te.createElement("div",{"data-tooltip":t},e.map((e=>te.createElement(Zf,{key:e.userAction,openDropdownKey:i,setOpenDropdownKey:a,dropdown:e})))))};Xf.displayName="TitlebarDropdowns";const Jf={tooltipCloseOut:{title:a.defineMessage({id:"ttk7hT",defaultMessage:"Get back home"}),body:a.defineMessage({id:"7aYTjW",defaultMessage:"Close the file when you’re done to get started on Dropbox."})},modal:{title:a.defineMessage({id:"UK/6DV",defaultMessage:"We’ve made updates!"}),body:a.defineMessage({id:"vWudR3",defaultMessage:"Here are 3 ways to keep work flowing in Dropbox."}),primaryButton:a.defineMessage({id:"kGMStu",defaultMessage:"Show me"}),secondaryButton:a.defineMessage({id:"W9E8bv",defaultMessage:"Skip"})},tooltipEditPdf:{title:a.defineMessage({id:"pryr2f",defaultMessage:"Make edits quickly"}),body:a.defineMessage({id:"ro42fq",defaultMessage:"Reorder pages, highlight text, sign, and more with PDFs."})},tooltipEditImage:{title:a.defineMessage({id:"nU8fzX",defaultMessage:"Make edits quickly"}),body:a.defineMessage({id:"04Z/0K",defaultMessage:"Rotate, flip, crop, adjust brightness, and more with images."})},tooltipEditVideo:{title:a.defineMessage({id:"M5RHHm",defaultMessage:"Make edits quickly"}),body:a.defineMessage({id:"9Y32oh",defaultMessage:"Rotate, flip, crop, or trim videos right here in Dropbox."})},tooltipOrganizeWorkUpdated:{title:a.defineMessage({id:"vDWmCl",defaultMessage:"Organize your work"}),body:a.defineMessage({id:"L1sIA5",defaultMessage:"Move and rename files, or get activity and version history."})},tooltipStartConversation:{title:a.defineMessage({id:"Q6mxmA",defaultMessage:"Work together"}),body:a.defineMessage({id:"alKD9e",defaultMessage:"Share with others so they can edit, comment, or approve."})}},em=a.defineMessage({id:"Pt5cgF",defaultMessage:"Someone shared a file with you"}),tm=a.defineMessage({id:"oINTxL",defaultMessage:"{linkOwnerName} shared a file with you"}),im=a.defineMessage({id:"abSjGc",defaultMessage:"Here are 3 things you can do with it in Dropbox."}),am=a.defineMessage({id:"8I86uf",defaultMessage:"Here’s what you can do to keep work flowing in Dropbox."}),nm=a.defineMessage({id:"zzzWp6",defaultMessage:"Make edits quickly"}),rm=a.defineMessage({id:"f7HLIr",defaultMessage:"Reorder pages, highlight text, sign, and more with PDFs."}),om=a.defineMessage({id:"WAIlUZ",defaultMessage:"Rotate, flip, crop, adjust brightness, and more with images."}),sm=a.defineMessage({id:"/Q0Y8N",defaultMessage:"Rotate, flip, crop, or trim videos right here in Dropbox."}),lm=a.defineMessage({id:"zOydTp",defaultMessage:"Start a conversation"}),cm=a.defineMessage({id:"1Tk9o2",defaultMessage:"Read or post comments in specific places and @mention others"}),dm=a.defineMessage({id:"NqjcQy",defaultMessage:"Save a personal copy"}),um=a.defineMessage({id:"q0Im4m",defaultMessage:"Copy to Dropbox to archive or share with others later."}),_m=(e,t="")=>()=>{const i=((e,t="")=>document.querySelector(`[data-tooltip="${e}"] ${t}`))(e,t);if(i){const e=i.getAttribute("aria-expanded");e!==String(!1)&&null!==e||((e,t)=>{const i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(i)})(i,"click")}};var pm,gm,fm,mm;t.TooltipTourFileType=void 0,(pm=t.TooltipTourFileType||(t.TooltipTourFileType={})).pdf="pdf",pm.IMAGE="IMAGE",pm.VIDEO="VIDEO",pm.default="default",t.TooltipTourSurface=void 0,(gm=t.TooltipTourSurface||(t.TooltipTourSurface={})).nonSharing="nonSharing",gm.nonSharingWithCloseOut="nonSharingWithCloseOut",gm.sharingLoggedInM0="sharingLoggedInM0",gm.sharingLoggedOutM0="sharingLoggedOutM0",t.PreviewTourTooltipType=void 0,(fm=t.PreviewTourTooltipType||(t.PreviewTourTooltipType={})).CloseOut="CloseOut",fm.FileMenu="FileMenu",fm.CollabControls="CollabControls",fm.ToolbarPdf="ToolbarPdf",fm.ToolbarImage="ToolbarImage",fm.ToolbarVideo="ToolbarVideo",fm.SCLSharingEntrypointWithEditableFile="SCLSharingEntrypointWithEditableFile",fm.SCLSharingEntrypointWithNonEditableFile="SCLSharingEntrypointWithNonEditableFile",fm.ShmodelSharingEntrypointWithEditableFile="ShmodelSharingEntrypointWithEditableFile",fm.ShmodelSharingEntrypointWithNonEditableFile="ShmodelSharingEntrypointWithNonEditableFile",fm.SharingPdf="SharingPdf",fm.SharingImage="SharingImage",fm.SharingVideo="SharingVideo",fm.SharingLeaveComments="SharingLeaveComments",fm.SharingSaveACopy="SharingSaveACopy",fm.LegacySCLSharingEntrypointWithNonEditableFile="LegacySCLSharingEntrypointWithNonEditableFile",fm.LegacyShmodelSharingEntrypointWithNonEditableFile="LegacyShmodelSharingEntrypointWithNonEditableFile",fm.LegacySharingPdf="LegacySharingPdf",fm.LegacySharingImage="LegacySharingImage",fm.LegacySharingVideo="LegacySharingVideo",fm.LegacySharingLeaveComments="LegacySharingLeaveComments",fm.LegacySharingSaveACopy="LegacySharingSaveACopy",function(e){e.TitleBarCloseOut="title-bar-close-out",e.TitleBarBreadcrumb="title-bar-breadcrumb",e.TitleBarMenu="title-bar-menu",e.TitleBarRightSection="title-bar-right-section",e.TitleBarRightSectionComments="title-bar-right-section-comments",e.Toolbar="redesigned-previews-toolbar",e.FileMenuDropdown="file-menu-dropdown",e.SaveACopy="title-bar-file-dropdown-save-a-copy",e.ActionBarDownloadSplitButtonMenu="action-bar-download-split-button-menu",e.ActionBarDownloadSplitButtonMenuSaveACopyOverflowItem="action-bar-download-split-button-menu-save-a-copy-overflow-item",e.ActionBarEditButton="action-bar-edit-button",e.ActionBarVideoEditButton="action-bar-video-edit-button",e.RightRailCommentsBladeHeader="right-rail-comments-blade-header",e.FileNameDisplay="file-name-display",e.RightRailCommentsBladeCollapsed="right-rail-comments-blade-collapsed"}(mm||(mm={}));const hm={[t.PreviewTourTooltipType.CloseOut]:{selector:mm.TitleBarCloseOut,title:Jf.tooltipCloseOut.title,description:Jf.tooltipCloseOut.body,placement:"bottom"},[t.PreviewTourTooltipType.FileMenu]:{selector:mm.TitleBarMenu,title:Jf.tooltipOrganizeWorkUpdated.title,description:Jf.tooltipOrganizeWorkUpdated.body,placement:"right-start",extraAction:()=>{var e;return null===(e=document.querySelector('[data-dropdown-title="File"] button'))||void 0===e?void 0:e.click()}},[t.PreviewTourTooltipType.CollabControls]:{selector:mm.TitleBarRightSection,title:Jf.tooltipStartConversation.title,description:Jf.tooltipStartConversation.body,placement:"bottom"},[t.PreviewTourTooltipType.ToolbarPdf]:{selector:mm.Toolbar,title:Jf.tooltipEditPdf.title,description:Jf.tooltipEditPdf.body,placement:"bottom-start",shouldDismissTourOnClickInsideHighlights:!0,stylesToPreserve:["backgroundColor"]},[t.PreviewTourTooltipType.ToolbarVideo]:{selector:mm.Toolbar,title:Jf.tooltipEditVideo.title,description:Jf.tooltipEditVideo.body,placement:"bottom-start",shouldDismissTourOnClickInsideHighlights:!0,stylesToPreserve:["backgroundColor"]},[t.PreviewTourTooltipType.ToolbarImage]:{selector:mm.Toolbar,title:Jf.tooltipEditImage.title,description:Jf.tooltipEditImage.body,placement:"bottom-start",shouldDismissTourOnClickInsideHighlights:!0,stylesToPreserve:["backgroundColor"]},[t.PreviewTourTooltipType.SCLSharingEntrypointWithEditableFile]:{selector:mm.TitleBarBreadcrumb,title:em,description:im,placement:"bottom-start"},[t.PreviewTourTooltipType.SCLSharingEntrypointWithNonEditableFile]:{selector:mm.TitleBarBreadcrumb,title:em,description:am,placement:"bottom-start"},[t.PreviewTourTooltipType.ShmodelSharingEntrypointWithEditableFile]:{selector:mm.TitleBarBreadcrumb,title:tm,description:im,placement:"bottom-start"},[t.PreviewTourTooltipType.ShmodelSharingEntrypointWithNonEditableFile]:{selector:mm.TitleBarBreadcrumb,title:tm,description:am,placement:"bottom-start"},[t.PreviewTourTooltipType.SharingPdf]:{selector:mm.Toolbar,title:nm,description:rm,placement:"bottom-start",shouldDismissTourOnClickInsideHighlights:!0,offsetDistance:{mainAxis:0,crossAxis:10}},[t.PreviewTourTooltipType.SharingImage]:{selector:mm.Toolbar,title:nm,description:om,placement:"bottom-start",shouldDismissTourOnClickInsideHighlights:!0,offsetDistance:{mainAxis:0,crossAxis:10}},[t.PreviewTourTooltipType.SharingVideo]:{selector:mm.Toolbar,title:nm,description:sm,placement:"bottom-start",shouldDismissTourOnClickInsideHighlights:!0,offsetDistance:{mainAxis:0,crossAxis:10}},[t.PreviewTourTooltipType.SharingLeaveComments]:{selector:mm.TitleBarRightSectionComments,title:lm,description:cm,placement:"bottom",shouldDismissTourOnClickInsideHighlights:!0,additionalStyles:{margin:"-8px"}},[t.PreviewTourTooltipType.SharingSaveACopy]:{selector:mm.SaveACopy,title:dm,description:um,placement:"right",shouldDismissTourOnClickInsideHighlights:!0,stylesToPreserve:["padding"],extraAction:()=>_m(mm.FileMenuDropdown)()},[t.PreviewTourTooltipType.LegacySCLSharingEntrypointWithNonEditableFile]:{selector:mm.FileNameDisplay,title:em,description:am,placement:"top",offsetDistance:10},[t.PreviewTourTooltipType.LegacyShmodelSharingEntrypointWithNonEditableFile]:{selector:mm.FileNameDisplay,title:tm,description:am,placement:"top",offsetDistance:10},[t.PreviewTourTooltipType.LegacySharingPdf]:{selector:mm.ActionBarEditButton,title:nm,description:rm,placement:"bottom"},[t.PreviewTourTooltipType.LegacySharingImage]:{selector:mm.ActionBarEditButton,title:nm,description:om,placement:"bottom"},[t.PreviewTourTooltipType.LegacySharingVideo]:{selector:mm.ActionBarVideoEditButton,title:nm,description:sm,placement:"bottom"},[t.PreviewTourTooltipType.LegacySharingLeaveComments]:{selector:mm.RightRailCommentsBladeHeader,title:lm,description:cm,placement:"left-start",extraAction:()=>_m(mm.RightRailCommentsBladeCollapsed,"button")()},[t.PreviewTourTooltipType.LegacySharingSaveACopy]:{selector:mm.ActionBarDownloadSplitButtonMenuSaveACopyOverflowItem,title:dm,description:um,placement:"bottom-end",extraAction:()=>_m(mm.ActionBarDownloadSplitButtonMenu)()}},vm={[t.TooltipTourSurface.nonSharing]:{[t.TooltipTourFileType.pdf]:[t.PreviewTourTooltipType.ToolbarPdf,t.PreviewTourTooltipType.FileMenu,t.PreviewTourTooltipType.CollabControls],[t.TooltipTourFileType.IMAGE]:[t.PreviewTourTooltipType.ToolbarImage,t.PreviewTourTooltipType.FileMenu,t.PreviewTourTooltipType.CollabControls],[t.TooltipTourFileType.VIDEO]:[t.PreviewTourTooltipType.ToolbarVideo,t.PreviewTourTooltipType.FileMenu,t.PreviewTourTooltipType.CollabControls],[t.TooltipTourFileType.default]:[t.PreviewTourTooltipType.FileMenu,t.PreviewTourTooltipType.CollabControls]},[t.TooltipTourSurface.nonSharingWithCloseOut]:{[t.TooltipTourFileType.pdf]:[t.PreviewTourTooltipType.CollabControls,t.PreviewTourTooltipType.CloseOut],[t.TooltipTourFileType.IMAGE]:[t.PreviewTourTooltipType.CollabControls,t.PreviewTourTooltipType.CloseOut],[t.TooltipTourFileType.VIDEO]:[t.PreviewTourTooltipType.CollabControls,t.PreviewTourTooltipType.CloseOut],[t.TooltipTourFileType.default]:[t.PreviewTourTooltipType.CollabControls,t.PreviewTourTooltipType.CloseOut]},[t.TooltipTourSurface.sharingLoggedInM0]:{[t.TooltipTourFileType.pdf]:[t.PreviewTourTooltipType.SharingPdf,t.PreviewTourTooltipType.SharingLeaveComments,t.PreviewTourTooltipType.SharingSaveACopy],[t.TooltipTourFileType.IMAGE]:[t.PreviewTourTooltipType.SharingImage,t.PreviewTourTooltipType.SharingLeaveComments,t.PreviewTourTooltipType.SharingSaveACopy],[t.TooltipTourFileType.VIDEO]:[t.PreviewTourTooltipType.SharingVideo,t.PreviewTourTooltipType.SharingLeaveComments,t.PreviewTourTooltipType.SharingSaveACopy],[t.TooltipTourFileType.default]:[t.PreviewTourTooltipType.SharingLeaveComments,t.PreviewTourTooltipType.SharingSaveACopy]},[t.TooltipTourSurface.sharingLoggedOutM0]:{[t.TooltipTourFileType.pdf]:[t.PreviewTourTooltipType.SharingLeaveComments,t.PreviewTourTooltipType.SharingSaveACopy],[t.TooltipTourFileType.IMAGE]:[t.PreviewTourTooltipType.SharingLeaveComments,t.PreviewTourTooltipType.SharingSaveACopy],[t.TooltipTourFileType.VIDEO]:[t.PreviewTourTooltipType.SharingLeaveComments,t.PreviewTourTooltipType.SharingSaveACopy],[t.TooltipTourFileType.default]:[t.PreviewTourTooltipType.SharingLeaveComments,t.PreviewTourTooltipType.SharingSaveACopy]}},Sm=[{title:a.defineMessage({id:"j02iBx",defaultMessage:"File"}),LazyDropdown:a.lazyAfterDisplay((()=>new Promise((function(t,i){e(["./c_title_bar_dropdowns_titlebar_file_dropdown"],t,i)})))),userAction:a.UserAction.OpenFileMenu,dataTooltip:"file-menu-dropdown"},{title:a.defineMessage({id:"1O34Rd",defaultMessage:"Edit"}),LazyDropdown:te.lazy((()=>new Promise((function(t,i){e(["./c_title_bar_dropdowns_titlebar_edit_dropdown"],t,i)})))),userAction:a.UserAction.OpenEditMenu},{title:a.defineMessage({id:"excVt3",defaultMessage:"View"}),LazyDropdown:a.lazyAfterDisplay((()=>new Promise((function(t,i){e(["./c_title_bar_dropdowns_titlebar_view_dropdown"],t,i)})))),userAction:a.UserAction.OpenViewMenu},{title:a.defineMessage({id:"t5/oHD",defaultMessage:"Help"}),LazyDropdown:a.lazyAfterDisplay((()=>new Promise((function(t,i){e(["./c_title_bar_dropdowns_titlebar_help_dropdown"],t,i)})))),userAction:a.UserAction.OpenHelpMenu}],Em=()=>te.createElement(Xf,{content:Sm,tooltipSelector:mm.TitleBarMenu}),wm=()=>{const{titlebarDropdowns:e}=Cs();return te.default.useMemo((()=>e?(e=>()=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(e,null)))(e):Em),[e])};a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/close_button.module.out-vfl4LKvIo.css",(e=>"._closeButton_1717x_1{margin-right:var(--dig-spacing__micro__large)}._closeButton_1717x_1>*{padding:var(--dig-spacing__micro__small)}._small_1717x_9{margin-right:0}"));a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/shared/titlebar_logo.module.out-vfltgeu25.css",(e=>"._dropboxColor_s73th_1{color:var(--dig-color__text__base)}._dropboxLogo_s73th_5{padding:15px}._dropboxLogo_s73th_5:focus{box-shadow:inset 0 0 0 3px var(--color__accent__cloud)}"));const bm=({baseUrl:e,isMobileSize:t})=>{const{logUserAction:i}=u.useFileViewerContext();return te.default.createElement("a",{href:`//${e}?src=shmodel`,onClick:()=>{i(a.UserAction.ClickDropboxLogo,a.UserActionContext.PreviewTitlebar)},className:a.cx("_dropboxColor_s73th_1",{_dropboxLogo_s73th_5:!t})},te.default.createElement(a.UIIcon,{size:"large",src:a.DropboxLine,"aria-label":"Dropbox"}))};bm.displayName="Logo",bm.displayName="Logo";const ym=te.memo((e=>{var i,n;const{fileViewerId:r,canCloseViewer:o,baseUrl:s,inEditMode:l,titleBarActionGetters:c,breakpoint:d}=e,u=b.useDispatch(),_=a.useIntl(),p=$r(zn,r),g=()=>{l&&c.onClose?c.onClose():u(In({fileViewerId:r,sourceContext:a.UserActionContext.TitleBarMain}))},f=_.formatMessage({id:"R/Hjn0",defaultMessage:"Close"}),m=_.formatMessage({id:"IDlWPW",defaultMessage:"Back"});return o||(null===(i=null==p?void 0:p.currentPath)||void 0===i?void 0:i.length)?te.createElement("span",{className:a.cx("_closeButton_1717x_1",{_small_1717x_9:d===t.FileViewerBreakpoint.SM}),"data-tooltip":mm.TitleBarCloseOut},te.createElement(a.IconButton,{onClick:g,variant:"transparent",size:"large"},te.createElement(a.UIIcon,{"aria-label":(null===(n=null==p?void 0:p.currentPath)||void 0===n?void 0:n.length)?m:f,src:a.CloseLine}))):te.createElement(bm,{baseUrl:s})}));ym.displayName="CloseButton",ym.displayName="CloseButton";a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/title_bar.module.out-vflxKIVKU.css",(e=>"._titleBarContainer_ij09q_1{--titlebarHeight:56px}._titleBar_ij09q_1{align-items:center;background:var(--dig-color__background__raised);display:flex;height:var(--titlebarHeight);margin:var(--dig-spacing__micro__xlarge)}._titleBar_ij09q_1._editMode_ij09q_19{margin-bottom:var(--dig-spacing__micro__medium)}._titleBar_ij09q_1._fullscreen_ij09q_23{background-color:var(--dig-color__secondary__base);border-bottom:1px solid var(--dig-color__secondary__base--state-1);display:flex}._titleBarLeftSection_ij09q_29{display:flex;flex:1;flex-direction:column;min-width:0}._overlay_ij09q_36{height:var(--titlebarHeight);left:0;pointer-events:all;position:fixed;top:0;width:100%;z-index:999}._overlay_ij09q_36._transparent_ij09q_46{pointer-events:none}._spacer_ij09q_50{padding:var(--dig-spacing__micro__small) var(--dig-spacing__macro__large)}"));const Tm="_titleBarContainer_ij09q_1",Im="_titleBar_ij09q_1",Cm="_titleBarLeftSection_ij09q_29",Am=te.default.createContext(null);Am.displayName="PluginMigrationContext";const Mm=()=>te.default.useContext(Am),Om=Am.Provider;function Pm(e){return e?("/"!==e.charAt(0)&&(e=`/${e}`),"/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e):""}function xm(e,t){const i=(e=Pm(e)).split("/").pop();return i||(t||"Dropbox")}function Dm(e){if(!e)return{name:"",ext:""};const t=e.split("."),i=e.length>0&&"."===e[0];let a=e.indexOf(".")<0;i&&(a=t.length<=2);const n=t.pop();return n&&!a?{name:t.join("."),ext:n}:{name:e,ext:""}}function Rm(e){return Dm(e).ext.toLowerCase()}function Nm(e){return e.split("/").slice(0,-1).join("/")||"/"}function km(e){const t=[];let i=Nm(e);for(;"/"!==i;)t.push(i),i=Nm(i);return t}a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/title_bar_file_breadcrumb.module.out-vflyloE4H.css",(e=>`._title-bar-file-breadcrumb_thplx_1{min-width:0}._title-bar-folder_thplx_6{margin-right:-2px}._title-bar-folder_thplx_6 .dig-Button-content{letter-spacing:0;padding:0 var(--dig-spacing__micro__small)}._title-bar-folder-no-left-padding_thplx_15 .dig-Button-content{padding:0 var(--dig-spacing__micro__small) 0 0}._file-name-editing-container_thplx_19{border-radius:var(--dig-radius__medium);overflow:hidden}._file-name-container_thplx_24{align-items:baseline;display:flex;gap:var(--dig-spacing__micro__small);margin-left:2px;min-width:0}._file-name_thplx_19{padding-left:var(--dig-spacing__micro__small)}._file-name__font-change_thplx_36{font-family:var(--dig-type__family__title)}@-moz-document url-prefix(){@font-face{font-family:Atlas Grotesk FF;font-style:normal;font-weight:400;size-adjust:85%;src:url(${e("/static/metaserver/static/fonts/dig-fonts/atlas_grotesk/AtlasGrotesk-Regular-Web.woff2")}) format("woff2"),url(${e("/static/metaserver/static/fonts/dig-fonts/atlas_grotesk/AtlasGrotesk-Regular-Web-vflyEJFZg.woff")}) format("woff"),url(${e("/static/metaserver/static/fonts/dig-fonts/atlas_grotesk/AtlasGrotesk-Regular-Web-vflJ3txfq.ttf")}) format("truetype");unicode-range:u+30-39}}`));const Lm="_file-name-container_thplx_24",Fm="_file-name__font-change_thplx_36",Um=i.forwardRef((({fileViewerId:e,previewKey:t,fileName:n,allowRename:r,showExpandedView:o},s)=>{const l=a.useIntl(),c=b.useDispatch(),d=te.default.useRef(null),[_,p]=te.default.useState(n),g=$r($n,e),[f,m]=te.default.useState(.5*window.innerWidth),[h,v]=te.default.useState(0),S=te.default.useRef(null),{logUserAction:E}=u.useFileViewerContext(),w=Dm(n);te.default.useEffect((()=>{window.requestAnimationFrame((()=>{if(!d.current)return;d.current.focus();const e=n;let t=e.lastIndexOf(".");t<0&&(t=e.length),d.current.setSelectionRange(0,t)}))}),[n,g]),te.default.useEffect((()=>{S.current&&v(S.current.offsetWidth)}),[S,n,g]),te.default.useEffect((()=>{const e=()=>{m(.5*window.innerWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[n]);const y=_o(),T=te.default.useCallback((()=>{_&&n!==_?c({payload:{fileViewerId:e,previewKey:t,sourceContext:a.UserActionContext.PreviewTitlebar,isRenameFromOverflowMenu:!1,newFilename:_},type:dn.Rename}):p(n),y(!1)}),[_,n,y,c,e,t]),I=te.default.useCallback((()=>{E(a.UserAction.RenameFailed,a.UserActionContext.PreviewTitlebar),p(n),y(!1)}),[n,E,y]),C=te.default.useCallback((()=>{E(a.UserAction.Rename,a.UserActionContext.PreviewTitlebar),E(a.UserAction.RenameStart,a.UserActionContext.PreviewTitlebar),p(n),y(!0)}),[n,E,y]);return i.useImperativeHandle(s,(()=>({handleEnter(){C()}})),[C]),g?te.default.createElement("div",{className:"_file-name-editing-container_thplx_19"},te.default.createElement("span",{ref:S,style:{position:"absolute",opacity:0,zIndex:-100}},te.default.createElement(a.Text,null,_)),te.default.createElement(a.TextInput,{"data-testid":"file-name-display-text-input",ref:d,"aria-label":l.formatMessage({id:"XlFxo+",defaultMessage:"filename"}),value:_,onChange:e=>p(e.currentTarget.value),onKeyDown:e=>{e.key===a.Key_enum.Key.Enter?(e.stopPropagation(),T()):e.key===a.Key_enum.Key.Escape&&(e.stopPropagation(),I())},onBlur:T,style:{width:h,maxWidth:f}})):o?te.default.createElement("div",{className:Lm,onDoubleClick:r?C:void 0,tabIndex:0},te.default.createElement(a.Text,{size:"large",isBold:!0,className:Fm},w.name),te.default.createElement(a.Box,{as:a.Text,fontFamily:"Text",fontSize:"Text Small",fontWeight:"Base",color:"Text Subtle",style:{textTransform:"uppercase"}},w.ext)):te.default.createElement(a.Text,{className:a.cx(Fm,"_file-name_thplx_19"),size:"large",isBold:!0,onDoubleClick:r?C:void 0},n)})),Vm=({fileName:e,isBold:t=!1,showFileNameOnly:i=!1})=>{var n;const{name:r,ext:o}=Dm(e);return te.default.createElement("div",{className:Lm},te.default.createElement(a.Text,{size:i?"medium":"large",isBold:t},r),null!==(n=!i)&&void 0!==n?n:te.default.createElement(a.Box,{as:a.Text,fontSize:"Text Small",fontWeight:"Base",color:"Text Subtle",style:{textTransform:"uppercase"}},o))},jm=te.default.memo((({user:e,inEditMode:n,file:r,breakpoint:s,shouldUseAlternateStyling:l})=>{const c=a.useIntl(),d=b.useDispatch(),{fileViewerId:_}=u.useFileViewerContext(),p=Qr(_),g=a.useSelector((e=>{var t;return null===(t=Kn(e,_,p))||void 0===t?void 0:t.currentPath})),f=$r(Fn,_),m=$r(Yn,_),h=i.useRef(null),v=te.default.useCallback((e=>{p&&d(An({currentPath:e,fileViewerId:_,previewKey:p,rootFileInfo:f,isDir:!0}))}),[d,_,p,f]),S=te.default.useCallback(((e,t,i)=>te.default.createElement(a.Menu.Wrapper,null,(({getTriggerProps:n,getContentProps:r})=>{const o=r();return te.default.createElement(te.default.Fragment,null,te.default.createElement(a.Button,Object.assign({className:i?"_title-bar-folder-no-left-padding_thplx_15":"_title-bar-folder_thplx_6",variant:o.open?"opacity":"borderless",size:"small"},n()),te.default.createElement(a.Box,{as:a.Text,fontSize:"Text Small",fontWeight:"Base",color:"Text Subtle"},e)),te.default.createElement(a.Menu.Content,Object.assign({},o),te.default.createElement(a.Menu.Segment,null,...t)))}))),[]),E=te.default.useCallback(((e,t,i,n,r)=>te.default.createElement(a.Breadcrumb.Link,{href:()=>v(n.slice(1,t+1)),isCurrentPath:i,key:`${t}-${e}`},te.default.createElement(Vm,{fileName:e,isBold:i,showFileNameOnly:r}))),[v]),w=i.useMemo((()=>{const i=[],c=[],d=r instanceof F.FileSharedWithMe?r.filename:a.getFilename(r),u=!!g,f=u?[d].concat(g):[];if(!n&&!m&&e&&!(r instanceof F.FileSharedWithMe)&&a.isBrowseFile(r)){const t=o.Viewer.get_root_name(e),n=km(r.fq_path).reverse();n.unshift(""),n.forEach(((r,o)=>{const s=a.browse_uri_for_fq_path(e,r);i.push(te.default.createElement(a.Menu.LinkItem,{key:r,href:s.toString(),onClick:()=>a.redirect(s)},xm(r,t))),o===n.length-1&&f.length<2&&c.push(S(xm(r,t),i,l))}))}const w=c;return u?f.forEach(((e,t)=>{const n=t===f.length-1;n?c.push(E(e,t,n,f,l)):i.push(te.default.createElement(a.Menu.ActionItem,{onClick:()=>v(f.slice(1,t+1)),key:`${t}-${e}`},e)),t===f.length-2&&c.push(S(e,i,l))})):w.push(te.default.createElement(a.Breadcrumb.Link,{isCurrentPath:!0,key:d,tabIndex:0,onKeyDown:e=>{e.key===a.Key_enum.Key.Enter&&h.current&&h.current.handleEnter()}},te.default.createElement(Um,{ref:h,fileViewerId:_,previewKey:p,fileName:d,allowRename:!n&&!(r instanceof F.FileSharedWithMe)&&a.isBrowseFile(r),showExpandedView:!n}))),s===t.FileViewerBreakpoint.SM?w.slice(-1):w}),[r,g,n,m,e,s,S,l,E,v,_,p]);return te.default.createElement(a.Breadcrumb,{"aria-label":c.formatMessage({id:"vWiotS",defaultMessage:"Breadcrumb"}),alwaysShowRoot:!0,className:a.cx("_title-bar-file-breadcrumb_thplx_1",a.OAPulsarAction.PREVIEWS_AUTO_SAVE_ONBOARDING_V2),"data-tooltip":"title-bar-breadcrumb"},w)}));jm.displayName="TitleBarFileBreadcrumb";a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/title_bar_header.module.out-vflz5duXl.css",(e=>"._titleBarHeader_1wjc3_1{align-items:center;display:flex;padding-left:0}._titleBarHeaderDivider_1wjc3_7{margin:0 var(--dig-spacing__micro__small)}._titleBarHeader_1wjc3_1._loggedOut_1wjc3_11{padding-left:var(--dig-spacing__micro__small)}"));const Bm=te.default.memo((({inEditMode:e,file:t,breakpoint:i})=>{const{pluginArgs:n}=Mm(),{isLoggedIn:r}=u.useFileViewerContext();return te.default.createElement("div",{className:a.cx("_titleBarHeader_1wjc3_1",{_loggedOut_1wjc3_11:!r})},te.default.createElement(jm,{user:n.user,inEditMode:e,file:t,breakpoint:i}))}));Bm.displayName="TitleBarHeader";a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/title_bar_right_section.module.out-vflFwZKYX.css",(e=>"._titleBarRightSection_1rs6t_1{align-items:flex-end;display:flex;flex-direction:column;justify-content:flex-start;margin-left:var(--dig-spacing__macro__large)}._titleBarRightSectionTopRow_1rs6t_9{align-items:center;display:flex}._titleBarRightSection_1rs6t_1>:not(:last-child){margin-bottom:var(--dig-spacing__micro__small)}._editorActions_1rs6t_18{gap:var(--dig-spacing__micro__large)}._editorActions_1rs6t_18,._titleBarActionButtons_1rs6t_24{align-items:center;display:flex}._titleBarActionButtons_1rs6t_24>*{margin-left:0}._titleBarFileCounterContainer_1rs6t_33{margin:0;white-space:nowrap}._titleBarFileCounter_1rs6t_33{color:var(--dig-color__text__subtle);margin:0 var(--dig-spacing__micro__xsmall)}._separator_1rs6t_43{border-right:1px solid var(--dig-color__border__subtle);height:var(--dig-spacing__macro__medium);margin:0 var(--dig-spacing__micro__large);width:0}"));function Hm(e){return e.ns("seen_state")}a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/title_bar_pass_ui.module.out-vflMh8hJr.css",(e=>"._pass_1wgu7_1{align-items:center;display:flex;height:var(--dig-spacing__macro__medium);justify-content:center;padding-bottom:2px}"));class Km{static passPermissionRequest(e){a.dispatcherSingleton.dispatch({type:a.ActionTypes.PASS_PERMISSION_REQUEST,data:{fileId:e}})}static updatePermissions(e,t){a.dispatcherSingleton.dispatch({type:a.ActionTypes.UPDATE_PERMISSIONS,data:{fileId:e,partialPermission:t}})}static fetchPassError(e){a.dispatcherSingleton.dispatch({type:a.ActionTypes.FETCH_PASS_ERROR,data:{fileId:e}})}static fetchPassConcluded(e){a.dispatcherSingleton.dispatch({type:a.ActionTypes.FETCH_PASS_CONCLUDED,data:{fileId:e}})}static receivePresenceDelta(e,t,i,n){a.dispatcherSingleton.dispatch({type:a.ActionTypes.RECEIVE_PRESENCE_DELTA,data:{userId:e,fileId:t,onlineUniqueUsers:i,offlineUniqueUsers:n}})}static receivePresenceSnapshot(e,t,i){a.dispatcherSingleton.dispatch({type:a.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT,data:{userId:e,fileId:t,onlineUniqueUsers:i}})}static resetPassInfo(e){a.dispatcherSingleton.dispatch({type:a.ActionTypes.RESET_PASS_INFO,data:{fileId:e}})}static updateSeenStateInfo(e,t,i){a.dispatcherSingleton.dispatch({type:a.ActionTypes.UPDATE_SEEN_STATE_INFO,data:{fileId:e,seenStateInfo:t,seenStateCursor:i}})}static updateUserTeamInteractionInfo(e,t){a.dispatcherSingleton.dispatch({type:a.ActionTypes.UPDATE_USER_TEAM_INTERACTION_INFO,data:{fileId:e,userTeamInteractionInfo:t}})}static updateSeenStateInfoContinue(e,t,i){a.dispatcherSingleton.dispatch({type:a.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE,data:{fileId:e,seenStateInfo:t,seenStateCursor:i}})}static discontinueSeenStateInfo(e){a.dispatcherSingleton.dispatch({type:a.ActionTypes.DISCONTINUE_SEEN_STATE_INFO,data:{fileId:e}})}static updateSeenStateUnavailable(e,t){a.dispatcherSingleton.dispatch({type:a.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE,data:{userId:e,fileId:t}})}}function zm(e){return e.ns("file_presence")}const Wm=5e3,Gm=256,qm="-",Qm={WEB:0,IOS:1,ANDROID:2,DESKTOP:3};class Ym{constructor(e,t,i=void 0){this.platform=e,this.surface=t,this.identifier=null!=i?i:"";let a=!1;for(const e in Qm){const t=Qm[e];if(this.platform===t){a=!0;break}}if(!a)throw new Error("platform must be from Beacon.Platforms");if(this.surface.length>32||0===this.surface.length)throw new Error("surface must be populated and <= 32 chars.");if(this.identifier.length>128)throw new Error("identifier must be <= 128 chars.")}static from_json(e){return new Ym(e.platform,e.surface,e.identifier)}}class $m{constructor(e,t,i,a){if(this.user_id=e,this.app=t,this.context=i,this.source=a,this.user_id.length>Gm)throw new Error("user_id must be <= 256 chars.");if(this.app.length>32||0===this.app.length)throw new Error("app must be populated and <= 32 chars.");if(this.context.length>64||0===this.context.length)throw new Error("context must be populated and <= 64 chars.")}static from_json(e){const t=Ym.from_json(e.source);return new $m(e.user_id,e.app,e.context,t)}}class Zm{constructor(e,t,i){if(this.agent=e,this.status=t,this.auth_key=i,this.status.length>32)throw new Error("status must be <= 32 chars")}static from_json(e){return new Zm($m.from_json(e.agent),e.status)}}const Xm="UserContext",Jm="UserApp",eh="Context";class th{constructor(e,t,i,a,n){if(this.type=e,this.user_id=t,this.app=i,this.context=a,this.token=n,this.type!==Xm&&this.type!==Jm&&this.type!==eh)throw new Error(`Unsupported type: ${this.type}.`);if((null!=this.user_id?this.user_id.length:0)>Gm)throw new Error("user_id must be <= 256 chars.");if(this.app.length>32)throw new Error("app must be <= 32 chars.");if((null!=this.context?this.context.length:0)>64)throw new Error("context must be <= 64 chars.")}}class ih{constructor(e,t){this.presence_params=e,this.agents=t}}class ah{constructor(e,t){this.presence_params=e,this.status=t}}ah.Status={Offline:1,Online:2};class nh{constructor(e,t,i){this.presence_params=e,this.snapshot=t,this.delta=i}}class rh{constructor(e,t,i,a=(()=>{})){this._backoff_window=Wm,this._heartbeat=()=>{if(!this._started||0===this._presence_data.length)return;this._offline_agents=this._presence_data.filter((e=>""!==e.status)).map((e=>e.agent)),this._has_changes=!1;const e=new AbortController;this._heartbeat_xhr=fetch(`https://${this.beaconUrl}/1/update`,{method:"POST",body:JSON.stringify({token:this._token,updates:this._presence_data}),headers:{"Content-Type":"application/json; charset=utf-8"},credentials:"include",signal:e.signal}).then((e=>e.json())).then(this._handle_heartbeat_success).catch(this._handle_heartbeat_error),setTimeout((()=>e.abort()),5e3)},this._handle_heartbeat_success=e=>{if(this._heartbeat_xhr=void 0,!this._started)return;const t=[];for(const i of e.agent_errors||[]){const e=i.error,a=$m.from_json(i.agent);if("authorization_error"===e)t.push(a);else if("invalid_agent"===e)throw new Error(`Input error: ${i}`);this._presence_data=this._presence_data.filter((e=>!w.isEqual(e.agent,a)))}if(t.length){const e=this._authz_cb;window.setTimeout((()=>e(t)),0)}for(const e of this._offline_agents)for(let t=0;t<this._presence_data.length;t++){const i=this._presence_data[t];if(w.isEqual(i.agent,e)&&""===i.status){this._presence_data.splice(t,1);break}}const i=this._has_changes?0:6e4;this._backoff_window=Wm,this._timeout_id=window.setTimeout(this._heartbeat,i)},this._handle_heartbeat_error=e=>{if(this._heartbeat_xhr=void 0,!this._started)return;if(e.status>=400&&e.status<500&&401===e.status)return window.setTimeout(this._authn_cb,0),void this.stop();const t=Math.random()*this._backoff_window;this._backoff_window=Math.min(2*this._backoff_window,12e4),this._timeout_id=window.setTimeout(this._heartbeat,t)},this._token=e,this._authn_cb=i,this._authz_cb=a,this._started=!1,this._presence_data=[],this._offline_agents=[],this._has_changes=!1,this.beaconUrl=t}start(){if(!this._started)return this._backoff_window=Wm,this._started=!0,this._has_changes=!1,this._heartbeat()}stop(){this._started=!1,this._heartbeat_xhr=void 0,window.clearTimeout(this._timeout_id),this._timeout_id=void 0}add_or_update_agents(e){for(const t of e)this._has_changes=this._add_or_update_agent(t)||this._has_changes;!this._heartbeat_xhr&&this._started&&(window.clearTimeout(this._timeout_id),this._timeout_id=window.setTimeout(this._heartbeat,0))}_add_or_update_agent(e){for(let t=0;t<this._presence_data.length;t++){const i=this._presence_data[t];if(w.isEqual(i.agent,e.agent))return(i.status!==e.status||i.auth_key!==e.auth_key)&&(this._presence_data[t]=e,!0)}return this._presence_data.push(e),!0}}class oh{constructor(e,t,i,a){this._compact_context_updates=(e,t)=>{let i,a,n=!1,r=[];for(const e of t)if(null!=e.snapshot)n=!0,r=e.snapshot;else if(null!=e.delta)for(const t of e.delta){let e=!1;for(let i=0;i<r.length;i++){const a=r[i];if(w.isEqual(a.agent,t.agent)){e=!0,r[i]=t;break}}e||r.push(t)}return n?(a=r,i=void 0):(a=void 0,i=r),new nh(e,a,i)},this._on_update=e=>{const t=[];for(const i of e){const{channel_state:e}=i,a=new C.ChannelId(e.app_id,e.unique_id),n=this._bolt_channel_to_presence_params(a);switch(n.type){case Xm:{const{payload:e}=i.payloads.slice(-1)[0],a=null!=e.agents?e.agents.map(Zm.from_json):[];t.push(new ih(n,a));break}case Jm:{const{payload:e}=i.payloads.slice(-1)[0];t.push(new ah(n,e.status));break}case eh:{const e=function(e){const t=Ym.from_json(e.source),i=new $m(e.user_id,n.app,n.context,t);return new Zm(i,e.status)},a=function(t){var i,a,n,r;return{snapshot:null===(a=null===(i=t.snapshot)||void 0===i?void 0:i.agents)||void 0===a?void 0:a.map(e),delta:null===(r=null===(n=t.delta)||void 0===n?void 0:n.agents)||void 0===r?void 0:r.map(e)}},r=i.payloads.map((e=>a(e.payload)));t.push(this._compact_context_updates(n,r));break}}}return this._update_callback(t)},this._on_refresh=e=>this._refresh_callback(e.map(this._bolt_channel_to_presence_params)),this._presence_params=e,this._update_callback=t,this._refresh_callback=i;const n=this._presence_params.map(this._presence_params_to_bolt_channel);this._thunder_client=new C.ThunderClient(n,this._on_update,this._on_refresh,a)}start(){return this._thunder_client.start()}stop(){return this._thunder_client.unsubscribe()}_presence_params_to_bolt_channel(e){switch(e.type){case Xm:return new C.SignedChannelState(`beacon_uc${qm}${e.app}`,`${e.user_id}|${e.context}`,"0",e.token);case Jm:return new C.SignedChannelState(`beacon_ua${qm}${e.app}`,e.user_id||"","0",e.token);case eh:return new C.SignedChannelState(`beacon_c${qm}${e.app}`,e.context,"0",e.token);default:throw new Error(`Unknown type: ${e.type}`)}}_bolt_channel_to_presence_params(e){const t=e.app_id.split(qm),i=e.unique_id.split("|");if(2!==t.length)throw new Error(`Unexpected format of Bolt app_id: ${e.app_id}.`);const a=t[1];let n="",r="",o=Xm;switch(t[0]){case"beacon_uc":if(2!==i.length)throw new Error(`Unexpected format of beacon_uc: ${e.unique_id}.`);o=Xm,n=i[0],r=i[1];break;case"beacon_ua":if(1!==i.length)throw new Error(`Unexpected format of beacon_ua: ${e.unique_id}.`);o=Jm,n=i[0];break;case"beacon_c":if(1!==i.length)throw new Error(`Unexpected format of beacon_c: ${e.unique_id}.`);o=eh,r=i[0];break;default:throw new Error(`Unknown Bolt app_id: ${e.app_id}.`)}return new th(o,n,a,r,void 0)}}const sh=[a.LoggingActions.PRESENCE_RECEIVE,a.LoggingActions.TRANSMITTER_TOKEN_BEGIN,a.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,a.LoggingActions.RECEIVER_TOKEN_BEGIN,a.LoggingActions.RECEIVER_TOKEN_RECEIVE,a.LoggingActions.SEEN_STATE_USERS_BEGIN,a.LoggingActions.SEEN_STATE_USERS_RECEIVE];const lh=new class{constructor(){this.allTimestamps={}}record(e,t){const i=(new Date).getTime()/1e3;this.allTimestamps[t]=this.allTimestamps[t]||{};const a=this.allTimestamps[t];a.hasOwnProperty(e)?this.reportStackForRepeatedAction(a,e,t,i):a[e]=i}get(e){return this.allTimestamps[e]||{}}reportStackForRepeatedAction(e,t,i,a){if(sh.indexOf(t)>=0)return;const n=e[t];h.reportStack("Attempted to record action for which there existed a previous record",{severity:h.SEVERITY.NONCRITICAL,tags:["pass:actionTimestampsTracker"],exc_extra:{pass_session_id:i,action:t,oldTimestamp:n,newTimestamp:a}})}};function ch(e){Km.resetPassInfo(e),Km.fetchPassError(e)}function dh(e,t){return{file_identifier:e,shared_link_details:t?{url:t}:void 0}}var uh;!function(e){e.create=function(e){return e?new _.FetchAsyncTransport:new _.FetchSyncTransport}}(uh||(uh={}));class _h{static constructFakeSeenStateInfo(e,t,i){const a=i.seen_states,n=[];for(const e of a)n.push(e.seen_state_user.user_id);for(const i of e)if(!n.includes(i.user_id)){i.sharing_access_type&&(i.sharing_access_type=i.sharing_access_type);const e={seen_state_user:i,when_last_seen:t,seen_events:[]};a.unshift(e)}return i.seen_states=a,i}static convertToUnion(e){return e?_.Union.parse(e):null}static parseSeenStatePassPlatform(e){if(e){switch(_.Union.parse(e).type){case"web":return a.PassPlatform.WEB;case"mobile":return a.PassPlatform.MOBILE;case"desktop":return a.PassPlatform.DESKTOP}}return a.PassPlatform.UNKNOWN}static fetchSeenStateUsers(e,t,i,r,s,l){return n.__awaiter(this,void 0,void 0,(function*(){const n=Date.now()/1e3;let c;l&&lh.record(a.LoggingActions.SEEN_STATE_USERS_BEGIN,l);try{c=yield Hm(new o.UserApiV2Client).rpc("get_seen_state_users",{user_ids:i,file_info:dh(r,s)},{subjectUserId:e})}catch(e){return void ch(r)}l&&lh.record(a.LoggingActions.SEEN_STATE_USERS_RECEIVE,l);const d=this.constructFakeSeenStateInfo(c,n,t);Km.updateSeenStateInfo(r,d)}))}static processAndUpdateSeenStateInfo(e,t,i,a){const{seen_state_info:n,seen_state_error:r,seen_state_cursor:o}=i[0];if(r)if(a)Km.discontinueSeenStateInfo(t);else{if("no_permission"===_.Union.parse(r).type)return;ch(t)}else{for(const e of n.seen_states)e.seen_state_user.sharing_access_type=this.convertToUnion(e.seen_state_user.sharing_access_type),e.platform_type=this.parseSeenStatePassPlatform(e.platform_type);a?Km.updateSeenStateInfoContinue(t,n,o):Km.updateSeenStateInfo(t,n,o)}}static fetchSeenStateInfo(e,t,i,r,s){return n.__awaiter(this,void 0,void 0,(function*(){let n;s&&lh.record(a.LoggingActions.SEEN_STATE_BEGIN,s);try{n=yield Hm(new o.UserApiV2Client).rpc("get_seen_state_info",{file_infos:[dh(t,r)],limit:i},{subjectUserId:e.id})}catch(e){return void ch(t)}let l=!0;const{seen_state_info:c,seen_state_error:d}=n[0];l=!(!c||d),Km.updatePermissions(t,{canReadSeenState:l}),l||Km.updateSeenStateUnavailable(e.id,t),l&&s&&lh.record(a.LoggingActions.SEEN_STATE_RECEIVE,s),this.processAndUpdateSeenStateInfo(e,t,n,!1),l&&this.fetchRemainingSeenStateInfo(e,t,n,r)}))}static fetchRemainingSeenStateInfo(e,t,i,a){const n=i[0].seen_state_cursor;if(n&&n.has_next){const i=n.cursor_state;i&&this.fetchSeenStateInfoContinue(e,t,i,1e5,a)}}static fetchSeenStateInfoContinue(e,t,i,a,r){return n.__awaiter(this,void 0,void 0,(function*(){let n;try{n=yield Hm(new o.UserApiV2Client).rpc("get_seen_state_info/continue",{file_infos:[dh(t,r)],cursor:i,limit:a},{subjectUserId:e.id})}catch(e){return void Km.discontinueSeenStateInfo(t)}this.processAndUpdateSeenStateInfo(e,t,n,!0)}))}static updateSeenStateOnResign(e,t,i,a,n,r){const l=uh.create(i);return function(e,t,i,a,n){return e?t(Hm(new o.UserApiV2Client(n)),a,{subjectUserId:e.id}):i(Hm(new s.NoAuthApiV2Client(n)),a,{})}(e,((e,t,i)=>e.rpc("update_timestamps_and_mark_offline",t,i)),((e,t,i)=>e.rpc("logged_out/mark_offline",t,i)),{beacon_infos:[{beacon_user_id:a,context:r,shared_link_url:t.url,identifier:n}]},l)}}const ph=e=>e?gh:fh,gh=o.createApiv2Query({nsClient:zm,rpc:"get_pass_transmitter_token"}),fh=o.createApiv2Query({nsClient:zm,rpc:"logged_out/get_pass_transmitter_token",queryFn:(e,{reqCtx:t})=>({signal:i})=>n.__awaiter(void 0,void 0,void 0,(function*(){const a=new s.NoAuthApiV2Client,n=yield zm(a).rpcWithResponseHeaders("logged_out/get_pass_transmitter_token",e.apiArg,{signal:i});return t.responseHeaders=n.headers,{apiData:n.result,pkgData:null}}))}),mh="online";function hh(e){Km.resetPassInfo(e),Km.fetchPassError(e)}class vh{static resetClassState(){delete this.receiverData,delete this.transmitterData,delete this.lastFileIdForReceiverTokenRequest,delete this.lastFileIdForTransmitterTokenRequest}static shutdown({beaconFileData:e,user:t,async:i,shouldWritePresence:a=!0}){if(delete this.lastFileIdForReceiverTokenRequest,delete this.lastFileIdForTransmitterTokenRequest,this.transmitterData){const{beaconUserId:n,context:r,identifier:s}=this.transmitterData;this.transmitterData.transmitter.stop(),delete this.transmitterData,!o.Viewer.get_viewer().is_assume_user_session&&a&&_h.updateSeenStateOnResign(t,e,i,n,s,r)}this.receiverData&&this.receiverData.receiver&&(this.receiverData.receiver.stop(),delete this.receiverData)}static receiveBeaconData({beaconFileData:e,user:t,passSessionId:i,onUpdate:r}){return n.__awaiter(this,void 0,void 0,(function*(){const{fileId:n}=e;i&&lh.record(a.LoggingActions.RECEIVER_TOKEN_BEGIN,i),this.lastFileIdForReceiverTokenRequest=n;const o=yield this.fetchReceiverToken(t,e);if(this.lastFileIdForReceiverTokenRequest!==n)return;if(o.beacon_presence_error)return Km.updatePermissions(n,{canReadPresence:!1}),void("no_permission"===o.beacon_presence_error[".tag"]||hh(n));Km.updatePermissions(n,{canReadPresence:!0}),i&&lh.record(a.LoggingActions.RECEIVER_TOKEN_RECEIVE,i);const s=[new th(eh,t.account_id,this.APP,o.beacon_presence_info.context,o.beacon_presence_info.token)];this.receiverData&&this.receiverData.receiver&&this.receiverData.receiver.stop(),this.receiverData={authKey:o.beacon_presence_info.auth_key,receiver:new oh(s,(n=>{i&&lh.record(a.LoggingActions.PRESENCE_RECEIVE,i);const o=this.parseBeaconUpdates(n[0]);r(o,t.id,e)}),(()=>this.receiveBeaconData({user:t,beaconFileData:e,passSessionId:i,onUpdate:r})),"thunder.dropbox.com"),context:o.beacon_presence_info.context},this.receiverData.receiver.start()}))}static fetchReceiverToken(e,t){const{fileId:i,url:a}=t,n={file_info:Sh(i,a)};return zm(new o.UserApiV2Client).rpc("get_pass_receiver_token",n,{subjectUserId:e.id})}static isOnline(e){return e&&this.HARMONY_ONLINE_STATUSES.includes(e)||e===mh}static parseBeaconUpdates(e){const t={},i={},a="delta"in e?"delta":"snapshot",n="delta"in e&&e.delta?e.delta:"snapshot"in e&&e.snapshot?e.snapshot:[];for(const e of n){const a=e.agent,n=a.user_id,r=a.source.identifier;this.isOnline(e.status)?(n in t||(t[n]={}),t[n][r]=!0):(n in i||(i[n]={}),i[n][r]=!0)}return{onlineUniqueUsers:t,offlineUniqueUsers:i,type:a}}static transmitBeaconData({user:e,passSessionId:t,beaconFileData:i,prevBeaconFileData:r,featureConfig:o}){return n.__awaiter(this,void 0,void 0,(function*(){const{fileId:n}=i;this.transmitterData&&r&&(this.transmitterData.transmitter.add_or_update_agents([this.getAgentStatusForFile(this.transmitterData.beaconUserId,this.transmitterData.identifier,this.transmitterData.authKey,this.transmitterData.context,"")]),setTimeout((()=>{this.transmitterData.transmitter.stop()}),1)),t&&lh.record(a.LoggingActions.TRANSMITTER_TOKEN_BEGIN,t),this.lastFileIdForTransmitterTokenRequest=n;const s=yield this.fetchTransmitterToken(e,i,o);if(this.lastFileIdForTransmitterTokenRequest===n){if(s.beacon_presence_error)return Km.updatePermissions(n,{canWritePresence:!1}),void("no_permission"===s.beacon_presence_error[".tag"]||hh(n));Km.updatePermissions(n,{canWritePresence:!0}),t&&lh.record(a.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,t),this.transmitterData={identifier:a.UUID.v4(),beaconUserId:s.beacon_presence_info.beacon_user_id,authKey:s.beacon_presence_info.auth_key,transmitter:new rh(s.beacon_presence_info.token,"beacon.dropbox.com",(()=>this.transmitBeaconData({user:e,passSessionId:t,beaconFileData:i,prevBeaconFileData:null,featureConfig:o}))),context:s.beacon_presence_info.context},this.transmitterData.transmitter.add_or_update_agents([this.getAgentStatusForFile(this.transmitterData.beaconUserId,this.transmitterData.identifier,this.transmitterData.authKey,this.transmitterData.context,mh)]),this.transmitterData.transmitter.start()}}))}static getAgentStatusForFile(e,t,i,a,n){const r=new Ym(this.PLATFORM,this.SURFACE,t),o=new $m(e,this.APP,a,r);return new Zm(o,n,i)}static fetchTransmitterToken(e,t,i){return n.__awaiter(this,void 0,void 0,(function*(){const{fileId:a,url:n}=t,r={file_info:Sh(a,n)};if(e||n||h.reportStack("For logged out user URL is needed for get_pass_transmitter_token",{tags:["file_presence","file_presence_js"],severity:"non-critical"}),null==i?void 0:i.pass_transmitter_token_prefetch){return(yield ph(null==e?void 0:e.id).fetchQuery(o.queryClient,{apiArg:r})).apiData}return e?zm(new o.UserApiV2Client).rpc("get_pass_transmitter_token",r,{subjectUserId:e.id}):zm(new s.NoAuthApiV2Client).rpc("logged_out/get_pass_transmitter_token",r,{})}))}}function Sh(e,t){return t?{".tag":"shared_link_details",url:t}:{".tag":"file_identifier",file_identifier:e}}vh.APP="harmony",vh.PLATFORM=Qm.WEB,vh.SURFACE="file_viewer",vh.HARMONY_ONLINE_STATUSES=["modifier","viewer"];class Eh{constructor(e,t,i,a,n,r,o,s,l,c,d,u,_){this.key=e,this.displayName=t,this.isActive=i,this.isViewer=a,this.incrementOverflowBasis=n,this.email=r,this.accessLevel=o,this.whenLastSeen=s,this.photoUrl=l,this.userId=c,this.platformType=d,this.same_team=u,this.is_guest=_}}class wh{constructor(e,t){this.isLoaded=e,this.data=t}static create(e){return new wh(!0,e)}static createNotLoaded(){return new wh(!1,null)}}class bh{constructor(e,t){this.fileId=e,this.url=t}}const yh=a.withActionNamespace("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",CLEAR_SHARING_PREFS:"clear-sharing-prefs",FETCH_SHARING_PREFS_REQUEST:"sharing-prefs-request",FETCH_SHARING_PREFS_SUCCESS:"sharing-prefs-success",FETCH_SHARING_PREFS_FAILURE:"sharing-prefs-failure",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",FETCH_USER_ACCOUNTS_CONTINUED_REQUEST:"fetch-user-accounts-continued-request",FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:"fetch-user-accounts-continued-success",CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:"clear-file-membership-last-seen-info",FETCH_FILE_MEMBER_COUNT_REQUEST:"fetch-file-member-count-request",FETCH_FILE_MEMBER_COUNT_SUCCESS:"fetch-file-member-count-success",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",APPEND_TO_RECIPIENT_MESSAGE:"append-to-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",CHANGE_LINK_RECIPIENT_ACCESS:"change-link-recipient-access",CHANGE_EMAIL_RECIPIENT_ACCESS:"change-email-recipient-access",UPDATE_RECIPIENT_VALIDATION:"update-recipient-validation",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",UPDATE_LINK_SUCCESS:"update-link-success",DISPLAY_CONTENT_NAME_INFO:"display-content-name-info",SEND_SHARE_REQUEST:"send-share-request",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",MEMBER_ACTION_PENDING:"member-action-pending",MEMBER_ACTION_COMPLETE:"member-action-complete",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_KEEP_ACCESS:"remove-member-keep-access",TRANSFER_OWNER_SUCCESS:"transfer-owner-success",FETCH_CURRENT_ACCOUNT_REQUEST:"fetch-current-account-request",FETCH_CURRENT_ACCOUNT_SUCCESS:"fetch-current-account-success",FETCH_MEMBER_COUNTS_REQUEST:"fetch-member-counts-request",FETCH_MEMBER_COUNTS_SUCCESS:"fetch-member-counts-success",HANDLE_CONTENT_NAME_CHANGE:"handle-content-name-change",VALIDATE_CONTENT_NAME_SUCCESS:"validate-content-name-success",VALIDATE_CONTENT_NAME_ERROR:"validate-content-name-error",CHANGE_LINK_AUDIENCE_REQUEST:"change-link-audience-request",CHANGE_LINK_AUDIENCE_SUCCESS:"change-link-audience-success",CHANGE_LINK_AUDIENCE_FAILURE:"change-link-audience-failure",UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:"unblock-member-list-on-pass-load",UPDATE_SHARING_SETTINGS_SUCCESS:"update-sharing-settings-success",DELETE_LINK_METADATA_SUCCESS:"delete-link-metadata-success",CHANGE_CREATE_COMMENT_CHECKBOX:"change-create-comment-checkbox",SET_UPSELL_COUNTER_PREF:"set-upsell-counter-pref",SET_UPSELL_COUNTER_PREF_SUCCESS:"set-upsell-counter-pref-success",CHANGE_LINK_AUDIENCE_SELECTION:"change-link-audience-selection",TOGGLE_OPEN_AUTOMATIONS:"toggle-open-automations",DOCSEND_ANALYTICS_LINK_REQUEST:"docsend-analytics-link-request",DOCSEND_ANALYTICS_LINK_SUCCESS:"docsend-analytics-link-success",DOCSEND_ANALYTICS_LINK_FAILURE:"docsend-analytics-link-failure",DOCSEND_FILE_CONTEXT_REQUEST:"docsend-file-context-request",DOCSEND_FILE_CONTEXT_COMPLETE:"docsend-file-context-complete",MARK_EMAIL_SECTION_ACTIVE:"mark-email-section-active",NO_DOWNLOAD_EXIT:"no-download-exit-without-copy",SETTINGS_TOOLTIP_CLOSE:"settings-tooltip-close",CHANGE_RECIPIENTS_INVITED_TO_TEAM:"change-recipients-invited-to-team"}),Th=a.withActionNamespace("sharing-actions",{CLEAR_EVERYTHING:"clear-everything",FETCH_METADATA_BATCH_ATTEMPT:"fetch-metadata-batch-attempt",FETCH_METADATA_BATCH_SUCCESS:"fetch-metadata-batch-success",FETCH_METADATA_BATCH_FAIL:"fetch-metadata-batch-fail"});function Ih(e){const t=(e.isFolder?e.targetNsId:e.fileId)||e.fqPath;if(null==t)throw new Error("Not enough fields provided for extras");return t}class Ch{constructor(e,t){this.extras=e,this.id=t}static createFromParams(e){return new Ch(Object.assign({exists:!0},e),Ih(e))}setNsId(e){const t=Object.assign(Object.assign({},this.extras),{targetNsId:e});return new Ch(t,Ih(t))}setFQPath(e){const t=Object.assign(Object.assign({},this.extras),{fqPath:e});return new Ch(t,Ih(t))}isFolder(){return this.extras.isFolder}isFile(){return!this.isFolder()}isFileFolder(){return this.isFolder()&&!this.isSharedFolder()}isSharedFolder(){return Boolean(this.extras.targetNsId)}isTeamSharedFolder(){return this.extras.isTeamSharedFolder}isEncryptedFolder(){return Boolean(this.extras.isEncryptedFolder)}isFolderInsideTeamFolderTree(){return this.extras.isFolderInsideTeamFolderTree}isInSharedFolder(){return Boolean(this.extras.nsId&&this.extras.nsId!==this.extras.userHomeNs)}isNestedSharedFolder(){return this.isInSharedFolder()&&this.isSharedFolder()}isMounted(){return!this.extras.url}url(){return this.extras.url}pathExists(){return Boolean(this.extras.exists)}name(){return this.displayPath()?this.displayPath().split("/").pop():this.filename()}idForLink(){const e=this.extras.fileId||this.extras.fqPath;if(!e)throw new Error("No identifiers for getting links");return e}sharedFolderId(){const e=this.extras.targetNsId;if(!e)throw new Error("No shared folder ID");return e}displayPath(){var e;return null!==(e=this.extras.fqPath)&&void 0!==e?e:void 0}fileId(){return this.extras.fileId}filename(){return this.extras.filename}nsId(){if(!this.extras.nsId)throw new Error("Can't determine nsId");return this.extras.nsId}nsPath(){if(null==this.extras.nsPath)throw new Error("Can't determine nsPath");return this.extras.nsPath}sjid(){return this.extras.sjid}teamGroupInfo(){return this.extras&&this.extras.teamGroupInfo}ext(){var e;return null===(e=this.extras)||void 0===e?void 0:e.ext}fileType(){return this.extras&&this.extras.fileType}}var Ah,Mh,Oh,Ph,xh,Dh,Rh;!function(e){e[e.NO_MEMBERS=0]="NO_MEMBERS",e[e.INPUT_CONTENT_NAME=1]="INPUT_CONTENT_NAME"}(Ah||(Ah={})),t.CONTENT_NAME_MESSAGE_LEVELS=void 0,(Mh=t.CONTENT_NAME_MESSAGE_LEVELS||(t.CONTENT_NAME_MESSAGE_LEVELS={}))[Mh.INFO=0]="INFO",Mh[Mh.ERROR=1]="ERROR",t.FETCH_METADATA_STATUS=void 0,(Oh=t.FETCH_METADATA_STATUS||(t.FETCH_METADATA_STATUS={}))[Oh.FETCHING=0]="FETCHING",Oh[Oh.SUCCESS=1]="SUCCESS",Oh[Oh.FAIL=2]="FAIL",t.LinkabilityStates=void 0,(Ph=t.LinkabilityStates||(t.LinkabilityStates={})).CAN_LINK="CAN_LINK",Ph.INVITE_NO_LINK="INVITE_NO_LINK",Ph.NO_INVITE_NO_LINK="NO_INVITE_NO_LINK",Ph.CANT_LINK_TEAM_FOLDER="CANT_LINK_TEAM_FOLDER",Ph.ERROR_FETCHING_LINK_INFO="ERROR_FETCHING_LINK_INFO",t.MODES=void 0,(xh=t.MODES||(t.MODES={})).LINK_ONLY="link-only",xh.LOADING="loading",xh.MEMBERSHIP="membership",xh.POINTER="pointer",xh.SHARE="share",xh.SHARE_SENDING="share-sending",xh.EVOLUTION="evolution",t.LINK_ONLY_REASON=void 0,(Dh=t.LINK_ONLY_REASON||(t.LINK_ONLY_REASON={})).INSIDE_SHARED_FOLDER="inside_shared_folder",Dh.CONTAINS_SHARED_FOLDER="contains_shared_folder",Dh.LINKS_PAGE="links_page",Dh.TOTAL_MOUNTS_EXCEEDED="total_mounts_exceeded",Dh.HOME_MOUNTS_EXCEEDED="home_mounts_exceeded",Dh.TREE_SIZE_EXCEEDED="tree_size_exceeded",t.NS_LIMIT_ERROR=void 0,(Rh=t.NS_LIMIT_ERROR||(t.NS_LIMIT_ERROR={})).TOTAL_MOUNTS_EXCEEDED="total_mounts_exceeded",Rh.HOME_MOUNTS_EXCEEDED="home_mounts_exceeded",Rh.TREE_SIZE_EXCEEDED="tree_size_exceeded";const Nh=l.intl.formatMessage({id:"mYGncD",defaultMessage:"Name your shared folder"});var kh,Lh,Fh;w.values(t.MODES),w.values(Ah),w.values(t.CONTENT_NAME_MESSAGE_LEVELS),t.LINK_CREATION_SURFACE=void 0,(kh=t.LINK_CREATION_SURFACE||(t.LINK_CREATION_SURFACE={})).COPY_OR_CREATE_LINK_SECTION="COPY_OR_CREATE_LINK_SECTION",kh.NO_DOWNLOAD_EXPERIMENT="NO_DOWNLOAD_EXPERIMENT",t.EXP_LINK_IN_MEMBER_LIST_VARIANT=void 0,(Lh=t.EXP_LINK_IN_MEMBER_LIST_VARIANT||(t.EXP_LINK_IN_MEMBER_LIST_VARIANT={})).ON="ON",Lh.OFF="OFF",Lh.CONTROL="CONTROL",t.EXP_UPSELL_KIWI_PIE_VARIANT=void 0,(Fh=t.EXP_UPSELL_KIWI_PIE_VARIANT||(t.EXP_UPSELL_KIWI_PIE_VARIANT={})).OFF="OFF",Fh.CONTROL="CONTROL",Fh.V1="V1",Fh.V2="V2",Fh.V3="V3";const Uh={canRelinquishMembership:!1,contentInfo:Ch.createFromParams({fqPath:"",isFolder:!1}),contentNameInputValue:"",contentNameMessageLevel:t.CONTENT_NAME_MESSAGE_LEVELS.INFO,initialProps:{},initialRecipientTokens:[],isContentNameFocused:!1,pendingMemberAction:a.immutableExports.Set(),recipientMessage:"",recipientRawInput:"",recipientTokens:[],recipientValidation:{},linkRecipientAccess:void 0,emailRecipientAccess:void 0,referrer:"",shareAsConfidential:!1,uiMode:t.MODES.MEMBERSHIP,fetchMetadataStatus:t.FETCH_METADATA_STATUS.FETCHING,automationOptionChecked:!1,docsendAnalyticsLink:{status:"initial"},docSendFileContext:{status:"initial"},isEmailSectionActive:!1,settingsTooltipHasBeenClosed:!1,recipientsInvitedToTeam:void 0};function Vh(e,t){return t.shared_folder_id?e.setNsId(t.shared_folder_id):e}const jh={areMembersFullyLoaded:!1,areSharingPrefsLoaded:!1,sharingPrefsFetchComplete:!1,hasDisplayableMembers:!1,isLinkMetadataLoaded:!1,isCurrentAccountLoaded:!1,shouldBlockMemberListOnPassLoad:!0,memberCounts:new a.MemberCounts,members:new a.SharingMembership,sharingPrefs:new a.SharingPrefs,sharedLinks:[],selectedAudience:void 0};function Bh(e,t){const i=e.metadata,a=t.permissions||i&&i.permissions;return t.set("permissions",a)}const Hh=e=>[e.shared_folder_id,e.id,e.path_lower].filter((e=>!!e)),Kh="public";var zh;t.LinkAudienceDisallowedReason=void 0,(zh=t.LinkAudienceDisallowedReason||(t.LinkAudienceDisallowedReason={})).DeleteAndRecreate="delete_and_recreate",zh.RestrictedBySharedFolder="restricted_by_shared_folder",zh.RestrictedByTeam="restricted_by_team",zh.UserAccountType="user_account_type",zh.UserNotOnTeam="user_not_on_team",zh.PermissionDenied="permission_denied";const Wh=(e,t)=>((t=String(t)).startsWith("id:")||(t=t.toLowerCase()),`${e}::${t}`);class Gh extends U.Store{constructor(){super(),this.sharingInfoMap={}}getSharingInfo(e,t){return t?this.sharingInfoMap[Wh(e,t)]:null}mapContentIdsToSharingInfo(e,t,i){for(const a of t)a&&(this.sharingInfoMap[Wh(e,a)]=i)}_new_payload(e){if(e&&e.action&&e.action.type)switch(e.action.type){case Th.CLEAR_EVERYTHING:this.sharingInfoMap={};break;case Th.FETCH_METADATA_BATCH_SUCCESS:{const t=e.action.user;e.action.data.forEach((e=>{this._new_payload_for_single_content(yh.FETCH_METADATA_SUCCESS,t,Hh(e),{metadata:e})})),this.emit_change();break}default:if(!e.action.contentIds)return;this._new_payload_for_single_content(e.action.type,e.action.user,e.action.contentIds,e.action.data),this.emit_change()}}_new_payload_for_single_content(e,i,n,o){let s;r.assert(Boolean(i.id),"valid user needed"),r.assert(n.length>0,"contentIds cannot be empty");for(const e of n){const t=Wh(i.id,e);if(t in this.sharingInfoMap){s=this.sharingInfoMap[t];break}}s||(s=new Yh(i));const l={type:e,payload:o,user:i};return s.setState(((e,i)=>{const n=i.payload;switch(i.type){case yh.CHANGE_CREATE_COMMENT_CHECKBOX:return Object.assign(Object.assign({},e),{isShareMessageAsCommentExplicitlyChecked:n.checked});case yh.CHANGE_RECIPIENTS:{const i=n.recipientTokens,a=n.recipientRawInput;let r=e.uiMode;return i.length>0||a.length>0?r===t.MODES.MEMBERSHIP&&(r=t.MODES.SHARE):r===t.MODES.SHARE&&(r=t.MODES.MEMBERSHIP),Object.assign(Object.assign({},e),{recipientTokens:i,recipientRawInput:a,uiMode:r})}case yh.CHANGE_RECIPIENT_ACCESS:return Object.assign(Object.assign({},e),{recipientAccess:n.newAccess});case yh.CHANGE_LINK_RECIPIENT_ACCESS:return Object.assign(Object.assign({},e),{linkRecipientAccess:n.newAccess});case yh.CHANGE_EMAIL_RECIPIENT_ACCESS:return Object.assign(Object.assign({},e),{emailRecipientAccess:""===n.newAccess?void 0:n.newAccess});case yh.CHANGE_RECIPIENT_MESSAGE:return Object.assign(Object.assign({},e),{recipientMessage:n.message});case yh.APPEND_TO_RECIPIENT_MESSAGE:const i=e.recipientMessage,r=n.messageToAppend;return Object.assign(Object.assign({},e),{recipientMessage:0===i.length?r:i+"\n"+r});case yh.UPDATE_RECIPIENT_VALIDATION:const o=n.recipientValidation,s=n.resetCurrentValidations?{}:e.recipientValidation,l={};return a.ACCESS_VALUES.forEach((e=>{const t=s[e]||{},i=o[e]||{};l[e]=Object.assign(Object.assign({},t),i)})),Object.assign(Object.assign({},e),{recipientValidation:l});case yh.FETCH_METADATA_FAILURE:return Object.assign(Object.assign({},e),{uiMode:t.MODES.LINK_ONLY,linkOnlyReason:e.linkOnlyReason!==t.LINK_ONLY_REASON.LINKS_PAGE?n.reason:e.linkOnlyReason,fetchMetadataStatus:t.FETCH_METADATA_STATUS.FAIL,countsExceedNsLimit:n.countExceedNsLimit});case yh.FETCH_METADATA_SUCCESS:{const i=n.metadata,a=i.path_lower&&V.isPointerByExtension(i.path_lower)?t.MODES.POINTER:e.uiMode;return Object.assign(Object.assign({},e),{uiMode:a,contentInfo:Vh(e.contentInfo,i),fetchMetadataStatus:t.FETCH_METADATA_STATUS.SUCCESS})}case yh.HANDLE_CONTENT_NAME_CHANGE:return Object.assign(Object.assign({},e),{contentNameInputValue:n.name,contentNameMessageLevel:t.CONTENT_NAME_MESSAGE_LEVELS.INFO,contentNameMessage:""===n.name?Nh:void 0});case yh.HANDLE_CONTENT_NAME_FOCUS_CHANGE:return Object.assign(Object.assign({},e),{isContentNameFocused:n.focus});case yh.MEMBER_ACTION_COMPLETE:return Object.assign(Object.assign({},e),{pendingMemberAction:e.pendingMemberAction.delete(n.member.memberKey())});case yh.MEMBER_ACTION_PENDING:return Object.assign(Object.assign({},e),{pendingMemberAction:e.pendingMemberAction.add(n.member.memberKey())});case yh.REMOVE_MEMBER_KEEP_ACCESS:case yh.REMOVE_MEMBER_SUCCESS:return Object.assign(Object.assign({},e),{pendingMemberAction:e.pendingMemberAction.delete(n.member.memberKey())});case yh.SEND_SHARE_FAILURE:return Object.assign(Object.assign({},e),{uiMode:t.MODES.SHARE});case yh.SEND_SHARE_REQUEST:return Object.assign(Object.assign({},e),{uiMode:t.MODES.SHARE_SENDING});case yh.SEND_SHARE_SUCCESS:return Object.assign(Object.assign({},e),{uiMode:t.MODES.SHARE});case yh.SHARE_FOLDER_SUCCESS:return Object.assign(Object.assign({},e),{contentInfo:Vh(e.contentInfo,n.metadata)});case yh.SHARE_MODAL_OPEN:{const i=n.shareModalInfoAttrs.contentInfo,a=n.shareModalInfoAttrs.inLinksPage,r=i.isFolder()&&!i.pathExists(),o=r&&!n.initialProps.initialContentName;let s,l=Uh.uiMode;return V.isPointerByExtension(i.displayPath()||"")?l=t.MODES.POINTER:r?l=t.MODES.SHARE:a&&(l=t.MODES.LINK_ONLY,s=t.LINK_ONLY_REASON.LINKS_PAGE),Object.assign(Object.assign({},e),{contentInfo:i,linkOnlyReason:s,uiMode:l,contentNameInputValue:n.initialProps.initialContentName,contentNameMessage:o?Nh:"",initialProps:n.initialProps,initialRecipientTokens:n.shareModalInfoAttrs.initialRecipientTokens||[],isContentNameFocused:o,onCreateGroupCallback:n.initialProps.onCreateGroupCallback,recipientAccess:n.initialProps.defaultRecipientAccessLevel||void 0,recipientMessage:n.initialProps.recipientMessage||"",recipientTokens:[],recipientValidation:{},linkRecipientAccess:void 0,emailRecipientAccess:void 0,referrer:n.initialProps.referrer,experiments:n.initialProps.experiments,automationOptionChecked:n.initialProps.automationOptionChecked||!1,isEmailSectionActive:!1})}case yh.SHARE_MODAL_CLOSE:return Object.assign(Object.assign({},e),{initialRecipientTokens:n.tokens||e.initialRecipientTokens||[],backedOutOfNoDownloadExperiment:!1});case yh.VALIDATE_CONTENT_NAME_ERROR:return Object.assign(Object.assign({},e),{contentNameMessage:n.errorMsg,contentNameMessageLevel:t.CONTENT_NAME_MESSAGE_LEVELS.ERROR});case yh.VALIDATE_CONTENT_NAME_SUCCESS:return Object.assign(Object.assign({},e),{contentInfo:e.contentInfo.setFQPath(n.newFolderPath)});case yh.TOGGLE_OPEN_AUTOMATIONS:return Object.assign(Object.assign({},e),{automationOptionChecked:!e.automationOptionChecked});case yh.DOCSEND_ANALYTICS_LINK_REQUEST:return Object.assign(Object.assign({},e),{docsendAnalyticsLink:{status:"loading"}});case yh.DOCSEND_ANALYTICS_LINK_SUCCESS:return Object.assign(Object.assign({},e),{docsendAnalyticsLink:{status:"ready",linkData:n.linkData}});case yh.DOCSEND_ANALYTICS_LINK_FAILURE:return Object.assign(Object.assign({},e),{docsendAnalyticsLink:{status:"error"}});case yh.DOCSEND_FILE_CONTEXT_REQUEST:return Object.assign(Object.assign({},e),{docSendFileContext:{status:"loading"}});case yh.DOCSEND_FILE_CONTEXT_COMPLETE:return Object.assign(Object.assign({},e),{docSendFileContext:{status:"ready",data:n}});case yh.MARK_EMAIL_SECTION_ACTIVE:return Object.assign(Object.assign({},e),{isEmailSectionActive:n.isActive});case yh.NO_DOWNLOAD_EXIT:return Object.assign(Object.assign({},e),{backedOutOfNoDownloadExperiment:!0});case yh.SETTINGS_TOOLTIP_CLOSE:return Object.assign(Object.assign({},e),{settingsTooltipHasBeenClosed:!0});case yh.CHANGE_RECIPIENTS_INVITED_TO_TEAM:return Object.assign(Object.assign({},e),{recipientsInvitedToTeam:n.recipientsInvitedToTeam});default:return e}})(s.modalInfoState(),l),((e=jh,t)=>{const i=t.payload;switch(t.type){case yh.CHANGE_MEMBER_ACCESS_FAILURE:return Object.assign(Object.assign({},e),{members:e.members.setIn([i.member.type(),i.member.memberKey(),"access_type"],i.prevAccess)});case yh.CHANGE_MEMBER_ACCESS_REQUEST:return Object.assign(Object.assign({},e),{members:e.members.setIn([i.member.type(),i.member.memberKey(),"access_type"],i.newAccess)});case yh.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:return Object.assign(Object.assign({},e),{members:e.members.update("users",(e=>e.map((e=>e.set("time_last_seen",null)))))});case yh.CREATE_LINK_SUCCESS:return Object.assign(Object.assign({},e),{hasCreatedLink:!0,linkMetadata:i.linkMetadata,sharedLinks:e.sharedLinks.concat(i.linkMetadata)});case yh.UPDATE_LINK_SUCCESS:return Object.assign(Object.assign({},e),{linkMetadata:i.linkMetadata,sharedLinks:e.sharedLinks.filter((e=>e.link_permissions.link_access_level!==i.linkMetadata.link_permissions.link_access_level)).concat(i.linkMetadata),selectedAudience:void 0});case yh.FETCH_MEMBER_COUNTS_SUCCESS:return Object.assign(Object.assign({},e),{memberCounts:i.memberCounts});case yh.FETCH_METADATA_FAILURE:return Object.assign(Object.assign({},e),{fetchingMetadataPromise:void 0});case yh.FETCH_METADATA_REQUEST:return Object.assign(Object.assign({},e),{fetchingMetadataPromise:i.promise});case yh.FETCH_METADATA_SUCCESS:return Object.assign(Object.assign({},e),{metadata:Bh(e,i.metadata),fetchingMetadataPromise:void 0});case yh.FETCH_SHARING_PREFS_REQUEST:return Object.assign(Object.assign({},e),{sharingPrefsFetchComplete:!1});case yh.FETCH_SHARING_PREFS_SUCCESS:return Object.assign(Object.assign({},e),{areSharingPrefsLoaded:!0,sharingPrefsFetchComplete:!0,sharingPrefs:i.sharingPrefs});case yh.FETCH_LINK_METADATA_FAILURE:return Object.assign(Object.assign({},e),{isLinkMetadataLoaded:!0,linkMetadata:void 0,sharedLinks:[]});case yh.FETCH_LINK_METADATA_SUCCESS:return Object.assign(Object.assign({},e),{isLinkMetadataLoaded:!0,linkMetadata:i.sharedLinks.length>0?i.sharedLinks[0]:null,sharedLinks:i.sharedLinks,selectedAudience:void 0});case yh.DELETE_LINK_METADATA_SUCCESS:{const t=[];for(const a of e.sharedLinks)a.url!==i.deletedLink.url&&t.push(a);return Object.assign(Object.assign({},e),{hasCreatedLink:!1,hasIncrementedUpsellCounter:!1,linkMetadata:t[0]?t[0]:null,sharedLinks:t})}case yh.FETCH_USER_ACCOUNTS_REQUEST:return Object.assign(Object.assign({},e),{fetchingMembersRequest:{limitNonNull:i.limitNonNull,promise:i.promise,requestId:i.requestId}});case yh.FETCH_USER_ACCOUNTS_SUCCESS:return e.fetchingMembersRequest&&e.fetchingMembersRequest.requestId!==i.requestId||e.hasDisplayableMembers&&e.fetchingMembersRequest&&e.fetchingMembersRequest.limitNonNull<e.members.getMemberCount()?e:Object.assign(Object.assign({},e),{hasDisplayableMembers:!0,areMembersFullyLoaded:!i.members.cursor,fetchingMembersRequest:i.members.cursor?e.fetchingMembersRequest:void 0,members:i.members});case yh.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:return e.fetchingMembersRequest&&e.fetchingMembersRequest.requestId!==i.requestId?e:Object.assign(Object.assign({},e),{areMembersFullyLoaded:!i.members.cursor,fetchingMembersRequest:i.members.cursor?e.fetchingMembersRequest:void 0,members:e.members.mergeDeep(i.members)});case yh.FETCH_CURRENT_ACCOUNT_REQUEST:return Object.assign(Object.assign({},e),{isCurrentAccountLoaded:!1});case yh.FETCH_CURRENT_ACCOUNT_SUCCESS:return Object.assign(Object.assign({},e),{isCurrentAccountLoaded:!0,isFamilyUser:i.isFamilyUser,teamPolicy:i.teamPolicy,canUseExtendedSharingControls:i.canUseExtendedSharingControls,isPaired:i.isPaired});case yh.FETCH_FILE_MEMBER_COUNT_SUCCESS:return Object.assign(Object.assign({},e),{memberCounts:new a.MemberCounts({total_unique_users:i.count,users_outside_team:0,exceeds_count:i.exceeds_limit})});case yh.REMOVE_MEMBER_KEEP_ACCESS:return Object.assign(Object.assign({},e),{members:e.members.setIn([i.member.type(),i.member.memberKey(),"access_type"],i.access)});case yh.REMOVE_MEMBER_SUCCESS:return Object.assign(Object.assign({},e),{members:e.members.deleteIn([i.member.type(),i.member.memberKey()])});case yh.SHARE_FOLDER_FAILURE:return Object.assign(Object.assign({},e),{shareFolderPromise:void 0});case yh.SHARE_FOLDER_REQUEST:return Object.assign(Object.assign({},e),{shareFolderPromise:i.promise});case yh.SHARE_FOLDER_SUCCESS:return Object.assign(Object.assign({},e),{metadata:Bh(e,i.metadata),shareFolderPromise:i.promise});case yh.TRANSFER_OWNER_SUCCESS:return Object.assign(Object.assign({},e),{metadata:void 0,isLinkMetadataLoaded:!1,hasDisplayableMembers:!1});case yh.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:return Object.assign(Object.assign({},e),{shouldBlockMemberListOnPassLoad:!1});case yh.UPDATE_SHARING_SETTINGS_SUCCESS:return Object.assign(Object.assign({},e),{metadata:Bh(e,i.metadata)});case yh.SET_UPSELL_COUNTER_PREF_SUCCESS:return Object.assign(Object.assign({},e),{hasIncrementedUpsellCounter:!0});case yh.CHANGE_LINK_AUDIENCE_SELECTION:return Object.assign(Object.assign({},e),{selectedAudience:i.audience});case yh.SHARE_MODAL_OPEN:return Object.assign(Object.assign({},e),{selectedAudience:void 0});default:return e}})(s.sharingInfoState(),l)),n.push(s.fqPath()),this.mapContentIdsToSharingInfo(i.id,n,s),s}}const qh=new Gh;class Qh{constructor(e){this.change_options=w.get(e,"change_options.allow",!1),this.edit_contents=w.get(e,"edit_contents.allow",!1),this.invite_editor=w.get(e,"invite_editor.allow",!1),this.invite_viewer=w.get(e,"invite_viewer.allow",!1),this.relinquish_membership=w.get(e,"relinquish_membership.allow",!1),this.leave_a_copy=w.get(e,"leave_a_copy.allow",!1),this.create_edit_link=w.get(e,"create_edit_link.allow"),this.create_view_link=w.get(e,"create_view_link.allow",!1),this.unshare=w.get(e,"unshare.allow",!1),this.update_confidentiality=w.get(e,"update_confidentiality.allow",!1),this.is_file_permissions=e instanceof a.FilePermissions,this.share_message_as_comment=w.get(e,"share_message_as_comment.allow",!1)}canChangeOptions(){return this.change_options}canEdit(){return this.edit_contents}canInviteEditor(){return this.invite_editor}canInviteViewer(){return this.invite_viewer}canInvite(){return this.canInviteViewer()||this.canInviteEditor()}canRelinquishMembership(){return this.relinquish_membership}canCreateEditLink(){return this.is_file_permissions&&this.create_edit_link}canCreateViewLink(){return this.is_file_permissions&&this.create_view_link}canUnshare(){return this.unshare}canUpdateConfidentiality(){return this.update_confidentiality}canLeaveACopy(){return this.leave_a_copy}canShareMessageAsComment(){return this.share_message_as_comment}}class Yh{static createFromParams(e){return new Yh(e)}constructor(e){this._user=e,this.setState(Uh,jh)}setState(e,t){this._modalInfo=e,this._sharingInfoState=t,t.metadata&&qh.mapContentIdsToSharingInfo(this._user.id,Hh(t.metadata),this)}sharingInfoState(){return this._sharingInfoState}modalInfoState(){return this._modalInfo}user(){return this._user}hasDirectMemberSelf(){const e=this.members();if(e&&1===e.users.count()){return e.users.first().account_id===this._user.account_id}return!1}hasNonSelfMembers(){const e=this.members(),t=e&&e.getMemberCount();if(!t)return!1;if(1===t&&1===e.users.count()){return e.users.first().account_id!==this._user.account_id}return!0}hasNonOwnerMembers(){return this.hasNonSelfMembers()&&this.isOwner()}hasOutsideTeamMembers(){const e=this.memberCounts();return(e?e.users_outside_team:0)>0}memberNum(){const e=this.memberCounts(),t=this.members();return e&&e.total_unique_users?e.total_unique_users:t?t.getMemberCount():void 0}memberCountWithRecipients(){return(this.memberNum()||0)+a.getMemberCountForTokens(this.recipientTokens())}getInitialProps(){return this.modalInfoState().initialProps}areMembersFullyLoaded(){return this.sharingInfoState().areMembersFullyLoaded}areSharingPrefsLoaded(){return this.sharingInfoState().areSharingPrefsLoaded}sharingPrefsFetchComplete(){return this.sharingInfoState().sharingPrefsFetchComplete}setSharingPrefs(e){this._sharingInfoState.sharingPrefs=e}sharingPrefs(){return this.sharingInfoState().sharingPrefs}canShareLink(){return(!this.isConfidentialFolder()||this.isConfidentialFolderLinksEnabled())&&!a.isTeamFolderForNonTMRUser(this.isTeamSharedFolder(),this.user())&&!(this.isTeamSharedFolder()&&!this.sharingPrefs().tmr_tf_share_link_exp)&&this.contentInfo().pathExists()&&this.contentInfo().isMounted()}canDeleteLink(){const e=this.linkMetadata();return Boolean(e&&e.link_permissions.can_revoke)}contactsError(){const e=this.isM2DTLSSectionEnabled()?this.emailRecipientAccess():this.recipientAccess();return a.validateContacts(this.recipientTokens(),this._user,this.recipientValidation()[e]||{},this.isTeamSharedFolder(),this.isFolderInsideTeamFolderTree(),this.memberCountWithRecipients())}contentId(){return this.contentInfo().id}contentInfo(){return this.modalInfoState().contentInfo}contentNameInputValue(){return this.modalInfoState().contentNameInputValue}contentNameMessage(){return this.modalInfoState().contentNameMessage}contentNameMessageLevel(){return this.modalInfoState().contentNameMessageLevel}displayPath(){const e=this.metadata();return this.contentInfo().displayPath()||e&&e.path_display||""}parentFolderName(){const e=this.metadata();if(e&&e instanceof a.SharedFileMetadata){const t=e.path_display;if(t){const e=t.split("/");if(e.length>1)return e[e.length-2]}}return e&&e instanceof a.SharedFolderMetadata&&e.parent_folder_name||""}fetchingMembersRequest(){return this.sharingInfoState().fetchingMembersRequest}fetchingMetadataPromise(){return this.sharingInfoState().fetchingMetadataPromise}filePolicy(){const e=this.metadata();return e&&e.file_policy}folderPolicy(){const e=this.metadata();return e&&e.policy}fqPath(){return this.contentInfo().displayPath()}hasDisplayableMembers(){return this.sharingInfoState().hasDisplayableMembers}hasParentSharedFolder(){const e=this.metadata();return!!e&&e.is_inside_team_folder}initialRecipientTokens(){return this.modalInfoState().initialRecipientTokens}isNonUserRelativeContext(){return this.getInitialProps().isInContentManager}isFolder(){return this.contentInfo().isFolder()}isConfidentialFolder(){const e=this.metadata();return Boolean(e&&e.is_confidential)}isContentNameFocused(){return this.modalInfoState().isContentNameFocused}isFolderInsideTeamFolderTree(){const e=this.metadata();return!!e&&e.is_inside_team_folder}isInsideSharedFolder(){const e=this.metadata();return Boolean(e&&e.parent_shared_folder_id||this.contentInfo().isInSharedFolder())}isLinkMetadataLoaded(){return this.sharingInfoState().isLinkMetadataLoaded}isMetadataLoaded(){return Boolean(this.metadata())}isOwner(){const e=this.metadata();return Boolean(e&&e.access_type===a.ACCESS_LEVEL.OWNER)}isOSXPackage(){const e=this.displayPath(),t=e.substr(e.lastIndexOf("."));return a.PACKAGE_EXTS.indexOf(t)>=0}isConfidentialFolderLinksEnabled(){return this.sharingPrefs().confidential_folder_links_enabled}isShareModalUpsellPremiumSharing(){return this.sharingPrefs().in_share_modal_upsell_premium_sharing}shareModalUpsellPremiumSharingVariant(){return this.sharingPrefs().in_share_modal_upsell_premium_sharing_variant}hasSeenUpsellCounter(){return this.sharingPrefs().has_seen_share_modal_upsell_premium_sharing_counter}hasCreatedLink(){return this.sharingInfoState().hasCreatedLink}hasIncrementedUpsellCounter(){return this.sharingInfoState().hasIncrementedUpsellCounter}inviteAfterSharingModalVariant(){return this.sharingPrefs().invite_after_sharing_modal_variant}getExperiments(){return this.modalInfoState().experiments}hasSeenEsignPostSharing(){return this.sharingPrefs().has_seen_esign_post_sharing}isInEsignPostSharingExclusionPeriod(){return this.sharingPrefs().is_in_esign_post_sharing_exclusion_period}isShowingFileUploadToolkitCampaign(){return this.sharingPrefs().is_showing_file_upload_toolkit_campaign}getReferrer(){return this.modalInfoState().referrer}isUserOnOwnerTeam(){const e=this.metadata();return Boolean(e&&e.owner_team&&e.owner_team.id===this._user.team_dbtid)}isCurrentAccountLoaded(){return this.sharingInfoState().isCurrentAccountLoaded}isTeamSharedFolder(){const e=this.metadata();return Boolean(e&&e.is_team_folder||this.contentInfo().isTeamSharedFolder())}isTokenizerEmpty(){return 0===this.recipientRawInput().length&&0===this.recipientTokens().length}linkMetadata(){return this.sharingInfoState().linkMetadata}sharedLinks(){return this.sharingInfoState().sharedLinks||[]}shmodelLink(){return this.sharedLinks().filter((e=>!e.isRighteousLink()))[0]}editRighteousLink(){return this.sharedLinks().filter((e=>"editor"===e.link_permissions.link_access_level))[0]}viewRighteousLink(){return this.sharedLinks().filter((e=>"viewer"===e.link_permissions.link_access_level))[0]}linkOnlyReason(){return this.modalInfoState().linkOnlyReason}countsExceedNsLimit(){return this.modalInfoState().countsExceedNsLimit}memberCounts(){return this.sharingInfoState().memberCounts}members(){return this.sharingInfoState().members}metadata(){return this.sharingInfoState().metadata}name(){const e=this.contentInfo(),t=this.metadata();return e&&e.name()||t&&t.name||""}ownerTeam(){const e=this.metadata();return e&&e.owner_team}ownerTeamPolicy(){const e=this.metadata();return e&&e.owner_team_policies}parentSharedFolderId(){const e=this.metadata();return e&&e.parent_shared_folder_id}pendingMemberAction(){return this.modalInfoState().pendingMemberAction}permissionsObj(){return new Qh(this.permissions())}permissions(){const e=this.metadata();return e&&e.permissions}recipientAccess(){const e=this.modalInfoState();if(e.recipientAccess)return e.recipientAccess;{const e=this.permissionsObj().canInviteEditor()||this.permissionsObj().canCreateEditLink(),t=this.getDefaultSharingAccessLevel();if(t){const i=t===a.ACCESS_LEVEL.WRITER,n=t===a.ACCESS_LEVEL.READER;if(i&&e||n)return t}return e||this.editRighteousLink()?a.ACCESS_LEVEL.WRITER:a.ACCESS_LEVEL.READER}}canCreateLink(e,t){switch(e){case"writer":return this.isFolder()?this.permissionsObj().canInviteEditor()&&!a.isTeamFolderForNonTMRUser(this.isTeamSharedFolder(),this.user())&&(!this.isConfidentialFolder()||this.isConfidentialFolderLinksEnabled()):!this.isTeamSharedFolder()&&this.permissionsObj().canCreateEditLink();case"reader":return!("writer"===(null==t?void 0:t.access_type)&&!(null==t?void 0:t.path_lower))&&(this.isCloudDoc()?this.permissionsObj().canCreateViewLink():!a.isTeamFolderForNonTMRUser(this.isTeamSharedFolder(),this.user())&&this.permissionsObj().canCreateViewLink()||this.canShareLink());default:return!1}}canInvite(e){switch(e){case"writer":return this.permissionsObj().canInviteEditor();case"reader":return this.permissionsObj().canInviteViewer();default:return!1}}linkRecipientAccess(e){const t=this.modalInfoState();if(t.linkRecipientAccess)return t.linkRecipientAccess;{const t=this.canCreateLink(a.ACCESS_LEVEL.WRITER,e),i=this.canCreateLink(a.ACCESS_LEVEL.READER,e),n=this.getDefaultSharingAccessLevel();if(n){const e=n===a.ACCESS_LEVEL.WRITER,r=n===a.ACCESS_LEVEL.READER;if(e&&t||r&&i)return n}return t||this.editRighteousLink()?a.ACCESS_LEVEL.WRITER:a.ACCESS_LEVEL.READER}}emailRecipientAccess(){const e=this.modalInfoState();if(e.emailRecipientAccess)return e.emailRecipientAccess;{const e=this.canInvite(a.ACCESS_LEVEL.WRITER),t=this.canInvite(a.ACCESS_LEVEL.READER),i=this.getDefaultSharingAccessLevel();if(i){const n=i===a.ACCESS_LEVEL.WRITER,r=i===a.ACCESS_LEVEL.READER;if(n&&e||r&&t)return i}return e?a.ACCESS_LEVEL.WRITER:a.ACCESS_LEVEL.READER}}recipientMessage(){return this.modalInfoState().recipientMessage}onCreateGroupCallback(){return this.modalInfoState().onCreateGroupCallback}recipientRawInput(){return this.modalInfoState().recipientRawInput}recipientTokens(){return this.modalInfoState().recipientTokens}recipientValidation(){return this.modalInfoState().recipientValidation}shareAsConfidential(){return Boolean(this.getInitialProps().shareAsConfidential)}shareFolderPromise(){return this.sharingInfoState().shareFolderPromise}shouldBlockMemberListOnPassLoad(){return this.sharingInfoState().shouldBlockMemberListOnPassLoad}shouldSyncThisFolder(){return this.getInitialProps()?this.getInitialProps().shouldSyncThisFolder:null}isEncryptedFolder(){const e=this.metadata();return Boolean(null==e?void 0:e.is_encrypted)}shouldEncryptThisFolder(){return!!this.getInitialProps()&&this.getInitialProps().shouldEncryptThisFolder}teamPolicy(){return this.sharingInfoState().teamPolicy}isFamilyUser(){return this.sharingInfoState().isFamilyUser}canUseExtendedSharingControls(){return this.sharingInfoState().canUseExtendedSharingControls}isPaired(){return this.sharingInfoState().isPaired}uiMode(){return this.modalInfoState().uiMode}isCloudDoc(){const e=this.metadata();return!(!e||!e.is_cloud_doc)}isCloudEnhancedFile(){const e=this.name();if(e){const t=(e.substring(e.lastIndexOf(".")||e.length,e.length)||"").toLowerCase();return".docx"===t||".doc"===t||".pptx"===t||".ppt"===t||".xlsx"===t||".xls"===t}return!1}fetchMetadataStatus(){return this.modalInfoState().fetchMetadataStatus}isUlssClientOn(){return"ON"===this.sharingPrefs().user_level_sharing_settings_client_variant}isSharingUpsellKiwiPieV2Enabled(){return["V1","V2","V3"].includes(this.sharingPrefs().sharing_upsell_kiwi_pie_v2_variant)}shouldAutoShowLinkSettingsTooltip(){return this.sharingPrefs().should_auto_show_link_settings_tooltip}isShareMessageAsCommentChecked(){const e=this.modalInfoState().isShareMessageAsCommentExplicitlyChecked;return void 0===e?this.permissionsObj().canShareMessageAsComment():e}shouldSuppressRedirectToBrowse(){return this.getInitialProps()?this.getInitialProps().shouldSuppressRedirectToBrowse:null}shouldCloseImmediately(){return this.getInitialProps()?this.getInitialProps().shouldCloseImmediately:null}shouldFetchLinkMetadata(){return this.canShareLink()&&!this.isNonUserRelativeContext()&&this.contentInfo().isMounted()}getSelectedAudience(){return this.sharingInfoState().selectedAudience}getEligibleInviteAfterSharingContacts(){return((e,t,i)=>{const a=new Set(e.filter((e=>!e.invalid)).map((e=>e.getKey()))),n=Object.values(t),r=new Set,o=new Set,s=new Set;let l=new Set;i&&(l=new Set(i.map((e=>e.getKey()))));for(const e of n)for(const t in e)if(e.hasOwnProperty(t)&&a.has(t)){const i=e[t];if(i&&i.inviteAfterSharingEligibility){const e=i.inviteAfterSharingEligibility[".tag"];if(l.has(t))continue;"eligible_not_seen"===e?r.add(t):"eligible_seen"===e?o.add(t):"eligible_seen_resurface"===e&&s.add(t)}}return{inviteEligibleNotSeenContacts:e.filter((e=>r.has(e.getKey())&&!e.invalid)),inviteEligibleSeenContacts:e.filter((e=>o.has(e.getKey())&&!e.invalid)),inviteEligibleSeenResurfaceContacts:e.filter((e=>s.has(e.getKey())&&!e.invalid))}})(this.recipientTokens(),this.recipientValidation(),this.recipientsInvitedToTeam())}automationOptionChecked(){return this.modalInfoState().automationOptionChecked}isExpBsxOrganizeAroundPeopleEnabled(){return this.sharingPrefs().bsx_organize_around_people}isNoDownloadOnShareEnabled(){return this.sharingPrefs().no_download_on_share_validation_experiment}isNoDownloadOnShareValid(){return!this.isCloudDoc()&&!(this.viewRighteousLink()||this.shmodelLink())}isM2DTLSSectionEnabled(){return"V2"===this.sharingPrefs().default_to_link_sharing_m2_variant||"V3"===this.sharingPrefs().default_to_link_sharing_m2_variant}getUpsellExperimentVariant(){return this.sharingPrefs().sharing_upsell_kiwi_pie_v2_variant}isCreateViewFileLinkEnabled(){return this.sharingPrefs().create_view_file_link_enabled}isCreateViewFolderLinkEnabled(){return this.sharingPrefs().create_view_folder_link_enabled}willRLBeCreated(e){return this.isFolder()?"editor"===e||this.isCreateViewFolderLinkEnabled():this.isCloudDoc()?!this.isCloudEnhancedFile()||("editor"===e||this.isCreateViewFileLinkEnabled()):"viewer"===e&&this.isCreateViewFileLinkEnabled()}getTeamDefaultSharingAccessLevel(){var e;const t=a.DEFAULT_SHARING_ACCESS_LEVEL[null===(e=this.teamPolicy())||void 0===e?void 0:e.shared_link_default_permissions_policy];if(t!==a.SharingAccessLevel.UNKNOWN)return t}getDefaultSharingAccessLevel(){const e=this.getTeamDefaultSharingAccessLevel();if(e)return e;const t=this.sharingPrefs().default_sharing_access_level_setting?a.DEFAULT_SHARING_ACCESS_LEVEL[this.sharingPrefs().default_sharing_access_level_setting[".tag"]]:a.ACCESS_LEVEL.WRITER;return t===a.SharingAccessLevel.UNKNOWN?a.ACCESS_LEVEL.WRITER:t}getDefaultSharingLinkAudience(){const e=this.sharingPrefs().default_sharing_link_audience_setting?this.sharingPrefs().default_sharing_link_audience_setting[".tag"]:Kh;return e===a.SharingLinkAudience.UNKNOWN?Kh:e}getLastSeenTeamPolicyAudience(){const e=this.sharingPrefs().last_seen_team_policy_audience?this.sharingPrefs().last_seen_team_policy_audience[".tag"]:Kh;return e===a.SharingLinkAudience.UNKNOWN?Kh:e}isEmailSectionActive(){return this.modalInfoState().isEmailSectionActive}isReplayInShareModalEnabled(){return this.sharingPrefs().is_replay_in_share_modal_enabled}recipientsInvitedToTeam(){return this.modalInfoState().recipientsInvitedToTeam}isFromFlexibleSharingEntrypoint(){return Boolean(this.getInitialProps().isFromFlexibleSharingEntrypoint)}}const $h={loadFileMetadataBatch:(e,t)=>new a.FileShareApiClient({userId:e.id}).getMetadataBatchAlpha({contentIds:t,actions:Object.keys(a.ALPHA_FILE_METADATA_PERMISSIONS)}).then((t=>a.dispatcherSingleton.dispatch({type:Th.FETCH_METADATA_BATCH_SUCCESS,user:e,data:t}))),loadFileMetadata:({user:e,contentId:t,sourceUrl:i,client:n})=>{const r=qh.getSharingInfo(e.id,t);if(r&&r.fetchingMetadataPromise())return r.fetchingMetadataPromise();const o=(n=n||new a.FileShareApiClient({userId:e.id})).getMetadataAlpha({contentId:t,actions:Object.keys(a.ALPHA_FILE_METADATA_PERMISSIONS),sourceURL:i}).then((t=>{a.dispatcherSingleton.dispatch({type:Th.FETCH_METADATA_BATCH_SUCCESS,user:e,data:[t]}),a.dispatcherSingleton.dispatch({type:a.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:t,user:e})}));return a.dispatcherSingleton.dispatch({type:yh.FETCH_METADATA_REQUEST,contentIds:[t],data:{promise:o},user:e}),o},listMembers:({user:e,contentId:t,isFolder:i,limit:n,url:o,members:s,client:l,includeSeenState:c=!0,passSessionId:d,isNonUserRelativeContext:u=!1,isPassPrefetch:_=!1})=>{r.assert(!n||n<=100,"listMembers not implemented for limit > 100");const p=n||9999999,g=qh.getSharingInfo(e.id,t);if(g){const e=g.fetchingMembersRequest();if(e&&p<=e.limitNonNull)return e.promise;if(g.hasDisplayableMembers()&&p<g.members().getMemberCount())return Promise.resolve({})}const f=Math.random().toString(),m=!i;l||(l=i?new a.FolderShareApiClient({userId:e.id,isNonUserRelativeContext:u}):new a.FileShareApiClient({userId:e.id,isNonUserRelativeContext:u}));const h=i=>i?(a.dispatcherSingleton.dispatch({type:yh.FETCH_USER_ACCOUNTS_CONTINUED_REQUEST,contentIds:[t],user:e}),l.listMembersContinue({cursor:i,url:o,isAlpha:m}).then((i=>{a.dispatcherSingleton.dispatch({type:yh.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS,contentIds:[t],data:{members:i,requestId:f},user:e}),h(i.cursor)}))):Promise.resolve({});let v;return d&&lh.record(a.LoggingActions.LIST_MEMBERS_BEGIN,d),v=s?Promise.resolve(s):l.listMembers({contentId:t,url:o,limit:n,isAlpha:m,includeSeenState:c,isPassPrefetch:_}),v=v.then((i=>{d&&lh.record(a.LoggingActions.LIST_MEMBERS_RECEIVE,d),a.dispatcherSingleton.dispatch({type:yh.FETCH_USER_ACCOUNTS_SUCCESS,contentIds:[t],data:{members:i,requestId:f},user:e}),n||h(i.cursor)})),a.dispatcherSingleton.dispatch({type:yh.FETCH_USER_ACCOUNTS_REQUEST,contentIds:[t],data:{limitNonNull:p,requestId:f,promise:v},user:e}),v},fetchFileMemberCount:({user:e,contentId:t,limit:i,url:n,client:r,countGroupsAsMembers:o=!1,passSessionId:s,runViewerInfoChecks:l=!1,isPassPrefetch:c=!1})=>{r=r||new a.FileShareApiClient({userId:e.id}),s&&lh.record(a.LoggingActions.MEMBER_COUNTS_BEGIN,s);const d=r.getMemberCounts({contentId:t,limit:i,url:n,countGroupsAsMembers:o,runViewerInfoChecks:l,isPassPrefetch:c});return a.dispatcherSingleton.dispatch({type:yh.FETCH_FILE_MEMBER_COUNT_REQUEST,contentIds:[t],user:e}),d.then((i=>{s&&lh.record(a.LoggingActions.MEMBER_COUNTS_RECEIVE,s),a.dispatcherSingleton.dispatch({type:yh.FETCH_FILE_MEMBER_COUNT_SUCCESS,contentIds:[t],data:i,user:e})}))},fetchFolderMemberCount:({user:e,contentInfo:t,client:i})=>{const n=t.id,r=t.isSharedFolder()?t.sharedFolderId():t.nsId();return a.dispatcherSingleton.dispatch({type:yh.FETCH_MEMBER_COUNTS_REQUEST,data:{},contentIds:[n],user:e}),i.getMemberCounts({contentId:r}).then((t=>{a.dispatcherSingleton.dispatch({type:yh.FETCH_MEMBER_COUNTS_SUCCESS,data:{memberCounts:t},contentIds:[n],user:e})}))}},Zh=a.MAX_FACES_NORMAL+a.MAX_OVERFLOW_BUTTON_INDICATOR+1;class Xh{static setup({user:e,fileData:t,prevFileData:i,passSessionId:a,shouldWritePresence:n=!0,skipSharingEndpoints:r=!1,limit:o=150,maxMembersSizeLimit:s=6,featureConfig:l}){const c=t.file.file_id;this.shouldInitializePass(e,c,n)&&(Km.passPermissionRequest(c),Xh.makeAllRequests({user:e,fileData:t,prevFileData:i,passSessionId:a,shouldWritePresence:n,skipSharingEndpoints:r,limit:o,maxMembersSizeLimit:s,featureConfig:l}))}static teardown({user:e,fileData:t,async:i,shouldWritePresence:a=!0}){const{file:n,url:r}=t,o=n.file_id;if(this.shouldInitializePass(e,o,a)){Xh.removeUnloadHandler();const t=new bh(o,r);vh.shutdown({beaconFileData:t,user:e,async:i,shouldWritePresence:a})}}static shouldInitializePass(e,t,i){return(null!==e||i)&&t}static onBeaconUpdate(e,t,i){const a=i.fileId;"delta"===e.type?Km.receivePresenceDelta(t,a,e.onlineUniqueUsers,e.offlineUniqueUsers):"snapshot"===e.type&&Km.receivePresenceSnapshot(t,a,e.onlineUniqueUsers)}static makeAllRequests({user:e,fileData:t,prevFileData:i,passSessionId:a,limit:n=150,shouldWritePresence:r=!0,skipSharingEndpoints:s=!1,maxMembersSizeLimit:l,featureConfig:c}){const{file:d,url:u}=t,{file_id:_,fq_path:p}=d,g=_||p,f=new bh(d.file_id,u),m=!!c&&c.previews_pass_facepile_prefetch;e?(g&&!s&&($h.fetchFileMemberCount({user:e,contentId:g,limit:Zh,countGroupsAsMembers:!1,url:u,passSessionId:a,runViewerInfoChecks:!0,isPassPrefetch:m}),$h.listMembers({user:e,contentId:g,isFolder:!1,limit:l,url:u,passSessionId:a,includeSeenState:!1,isPassPrefetch:m})),_h.fetchSeenStateInfo(e,_,n,u,a),vh.receiveBeaconData({beaconFileData:f,user:e,passSessionId:a,onUpdate:this.onBeaconUpdate})):Km.updatePermissions(_,{canReadPresence:!1,canReadSeenState:!1});const h=o.Viewer.get_viewer().is_assume_user_session;if(!r||h)Km.updatePermissions(_,{canWritePresence:!1});else{const n=i&&new bh(i.file,i.url);vh.transmitBeaconData({user:e,passSessionId:a,beaconFileData:f,prevBeaconFileData:n,featureConfig:c}),Xh.removeUnloadHandler(),Xh.onUnload=i=>(this.teardown({user:e,fileData:t,async:!1,shouldWritePresence:!0}),i.returnValue=void 0,null),document.addEventListener("beforeunload",Xh.onUnload)}}}Xh.removeUnloadHandler=()=>{Xh.onUnload&&document.removeEventListener("beforeunload",Xh.onUnload),Xh.onUnload=void 0};class Jh{constructor(){this.userIdToUniqueIds={}}addUniqueUser(e,t){e in this.userIdToUniqueIds||(this.userIdToUniqueIds[e]={}),this.userIdToUniqueIds[e][t]=!0}removeUniqueUser(e,t){e in this.userIdToUniqueIds&&t in this.userIdToUniqueIds[e]&&(delete this.userIdToUniqueIds[e][t],Object.keys(this.userIdToUniqueIds[e]).length||delete this.userIdToUniqueIds[e])}getOnlineUserIds(){return Object.keys(this.userIdToUniqueIds)}}class ev extends U.Store{constructor(e){super(e),this.seenStateInfos={},this.seenStateCursors={},this.presenceInfos={},this.passFetchingStatusMap={},this.userIdsWithoutSeenStateInfoMap={},this.userIdsWithoutTeamInteractionInfoMap={},this.userTeamInteractionInfoMap={},this.passPermissions={}}presence(e){return e in this.presenceInfos?this.presenceInfos[e].getOnlineUserIds():null}seenStateInfo(e){return this.seenStateInfos[e]||null}identifiedSeenStateInfo(e){if(e in this.seenStateInfos){return{seen_states:w.reject(this.seenStateInfos[e].seen_states,a.AnonymousViewerUtils.isAnonymousSeenState)}}return null}seenStateCursorHasNext(e){return e in this.seenStateCursors?this.seenStateCursors[e].has_next:null}seenStateCursorState(e){return e in this.seenStateCursors?this.seenStateCursors[e].cursor_state:null}passFetchingStatus(e){return this.passFetchingStatusMap[e]||a.PassFetchingStatus.NOT_YET_KNOWN}getLinkAndGroupSeenStateInfo(e){let t=null,i=null;if(!this.seenStateInfos[e])return{linkSeenStateInfo:t,groupSeenStateInfo:i};t=[],i={};for(const n of this.seenStateInfos[e].seen_states)if(!a.AnonymousViewerUtils.isAnonymousSeenState(n)){const{seen_state_user:{sharing_access_type:e}}=n;if(e)switch(e[".tag"]){case"link_only":case"view_link_access":case"edit_link_access":t.push(n);break;case"view_member_access":case"edit_member_access":const a=e.group_ids;for(const e of a)e in i||(i[e]=[]),i[e].push(n)}}return{linkSeenStateInfo:t,groupSeenStateInfo:i}}anonymousPresence(e){return e in this.presenceInfos?a.AnonymousViewerUtils.getAnonymousUserIds(this.presenceInfos[e].getOnlineUserIds()):null}userIdsWithoutSeenStateInfo(e){return this.userIdsWithoutSeenStateInfoMap[e]||[]}userIdsWithoutTeamInteractionInfo(e){return this.userIdsWithoutTeamInteractionInfoMap[e]||[]}userTeamInteractionInfo(e){return this.userTeamInteractionInfoMap[e]||{}}isPassPermissionsPending(e){const t=this.passPermissions[e];return null!=t&&!(t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState")&&t.hasOwnProperty("canWritePresence"))}getPassPermissions(e){if(!e)return null;const t=this.passPermissions[e];return null==t||this.isPassPermissionsPending(e)?null:t}resetPassInfo(e){delete this.seenStateInfos[e],delete this.seenStateCursors[e],delete this.presenceInfos[e],delete this.passFetchingStatusMap[e],delete this.passPermissions[e],delete this.userIdsWithoutSeenStateInfoMap[e],this.emit_change()}setPassPermissionRequest(e){this.passPermissions[e]||(this.passPermissions[e]={}),this.setPassFetchingStatus(e,a.PassFetchingStatus.FETCHING)}updatePermissions(e,t){this.passPermissions.hasOwnProperty(e)&&(this.passPermissions[e]=Object.assign(Object.assign({},this.passPermissions[e]),t),this.emit_change())}markPassConcludedIfNecessary(e){const t=this.passPermissions[e];!(t&&t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState"))||t.canReadPresence||t.canReadSeenState||(this.resetPassInfo(e),this.setPassFetchingStatus(e,a.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(e))}receivePresenceDelta(e,t,i,n){r.assert(-1===[a.PassFetchingStatus.FETCHING,a.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence delta, you must call assurePresenceSuccessRegistered");const o=this.getOnlineUsersForFileId(t);this.updatePresenceInfos(t,i,n),this.updateUserIdsWithoutSeenStateInfo(e,t,o),this.emit_change()}receivePresenceSnapshot(e,t,i){r.assert(-1===[a.PassFetchingStatus.FETCHING,a.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence snapshot, you must call assurePresenceSuccessRegistered");const n=this.getOnlineUsersForFileId(t);this.presenceInfos[t]=new Jh,this.updatePresenceInfos(t,i,{}),this.updateUserIdsWithoutSeenStateInfo(e,t,n),this.emit_change()}getOnlineUsersForFileId(e){return e in this.presenceInfos||(this.presenceInfos[e]=new Jh),this.presenceInfos[e].getOnlineUserIds()}updatePresenceInfos(e,t,i){for(const t of Object.keys(i))for(const a of Object.keys(i[t]))this.presenceInfos[e].removeUniqueUser(t,a);for(const i of Object.keys(t))for(const a of Object.keys(t[i]))this.presenceInfos[e].addUniqueUser(i,a)}updateUserIdsWithoutSeenStateInfo(e,t,i){let n;const r=a.AnonymousViewerUtils.filterAnonymousUserIds(this.getOnlineUsersForFileId(t)),o=a.AnonymousViewerUtils.filterAnonymousUserIds(i),s=w.difference(o,r),l=w.difference(r,o);if(t in this.seenStateInfos){let e;const i=this.passFetchingStatus(t);if(-1!==[a.PassFetchingStatus.SEEN_STATE_DISALLOWED,a.PassFetchingStatus.PASS_MIXED_SUCCESS].indexOf(i))({userIdsWithoutSeenStateInfo:n,baseSeenStateInfo:e}=this.createMinimalBaseSeenStateInfo(t,r)),this.updateSeenStateInfo(t,e);else{const i=this.makeSeenStateAgreeWithUpdatedPresence(t,r,s,l);({userIdsWithoutSeenStateInfo:n,baseSeenStateInfo:e}=i)}}else n=[];this.userIdsWithoutSeenStateInfoMap[t]=n}makeSeenStateAgreeWithUpdatedPresence(e,t,i,a){const n=[],r=this.seenStateInfos[e],o=r.seen_states,s=[],l=[],c=[],d=Date.now()/1e3;for(const e of o){const t=e.seen_state_user.user_id;t&&(n.push(t),a.includes(t)?(e.when_last_seen=d,e.seen_events=e.seen_events||[],l.push(e)):i.includes(t)?(e.when_last_seen=d,e.seen_events=e.seen_events||[],e.seen_events.push({ts:d}),c.push(e)):s.push(e))}return r.seen_states=[...l,...c,...s],{userIdsWithoutSeenStateInfo:t.filter((e=>!n.includes(e))),baseSeenStateInfo:r}}createMinimalBaseSeenStateInfo(e,t){const i=[],a=[];for(const n of this.seenStateInfos[e].seen_states){const e=n.seen_state_user.user_id;e&&t.includes(e)&&(i.push(n),a.push(e))}return{userIdsWithoutSeenStateInfo:w.difference(t,a),baseSeenStateInfo:{seen_states:i}}}updateSeenStateInfo(e,t,i=!1){r.assert(-1===[null,a.PassFetchingStatus.FETCHING].indexOf(this.passFetchingStatus(e)),"Before updating seen state info, you must call assureSeenStateSuccessRegistered or onFetchSeenStateDisabled"),i&&e in this.seenStateInfos?this.seenStateInfos[e].seen_states=this.seenStateInfos[e].seen_states.concat(t.seen_states):this.seenStateInfos[e]=t,this.userIdsWithoutTeamInteractionInfoMap[e]=this.userIdsWithoutSeenStateInfoMap[e],this.userIdsWithoutSeenStateInfoMap[e]=[],this.emit_change()}updateSeenStateInfoWithEmptyData(e){this.updateSeenStateInfo(e,{seen_states:[]})}setPassFetchingStatus(e,t){this.passFetchingStatusMap[e]=t,this.emit_change()}updateSeenStateCursor(e,t){t&&(this.seenStateCursors[e]=t,this.emit_change())}assureSeenStateSuccessRegistered(e){switch(this.passFetchingStatus(e)){case a.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,a.PassFetchingStatus.SEEN_STATE_SUCCESS);break;case a.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,a.PassFetchingStatus.PASS_SUCCESS);break;case a.PassFetchingStatus.SEEN_STATE_DISALLOWED:h.reportStack("Debugging FETCHING_STATUS: pass fetching status is seen state disallowed",{severity:h.SEVERITY.NONCRITICAL,tags:["pass:fetch_seen_state_disallowed"],exc_extra:{storeHasPresence:e in this.presenceInfos,storeHasSeenState:e in this.seenStateInfos,passPermissions:JSON.stringify(this.passPermissions[e]),fetchingStatus:this.passFetchingStatusMap[e]}});break;case a.PassFetchingStatus.NOT_YET_KNOWN:h.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:h.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}onFetchSeenStateDisabled(e){switch(this.passFetchingStatus(e)){case a.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,a.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case a.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,a.PassFetchingStatus.SEEN_STATE_DISALLOWED);break;case a.PassFetchingStatus.NOT_YET_KNOWN:h.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:h.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}assurePresenceSuccessRegistered(e){switch(this.passFetchingStatus(e)){case a.PassFetchingStatus.SEEN_STATE_SUCCESS:this.setPassFetchingStatus(e,a.PassFetchingStatus.PASS_SUCCESS);break;case a.PassFetchingStatus.SEEN_STATE_DISALLOWED:this.setPassFetchingStatus(e,a.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case a.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,a.PassFetchingStatus.PRESENCE_SUCCESS);break;case a.PassFetchingStatus.NOT_YET_KNOWN:h.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:h.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}updateUserTeamInteractionInfo(e,t){if(e in t)for(const i of Object.keys(t))this.userTeamInteractionInfoMap[e][i]=t[i];else this.userTeamInteractionInfoMap[e]=t;this.userIdsWithoutTeamInteractionInfoMap[e]=[],this.emit_change()}_new_payload(e){const{type:t,data:i}=e.action;if(!i)return;let{userId:n,fileId:r,teamId:o,seenStateInfo:s,seenStateCursor:l,onlineUniqueUsers:c,offlineUniqueUsers:d,partialPermission:u,userTeamInteractionInfo:_,userTeamInteractionUserIds:p}=i;switch(t){case a.ActionTypes.FETCH_PASS_ERROR:this.setPassFetchingStatus(r,a.PassFetchingStatus.ERROR);break;case a.ActionTypes.FETCH_PASS_CONCLUDED:this.setPassFetchingStatus(r,a.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(r);break;case a.ActionTypes.PASS_PERMISSION_REQUEST:this.setPassPermissionRequest(r);break;case a.ActionTypes.RECEIVE_PRESENCE_DELTA:this.assurePresenceSuccessRegistered(r),this.receivePresenceDelta(n,r,c,d);break;case a.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT:this.assurePresenceSuccessRegistered(r),this.receivePresenceSnapshot(n,r,c);break;case a.ActionTypes.RESET_PASS_INFO:this.resetPassInfo(r);break;case a.ActionTypes.UPDATE_PERMISSIONS:this.updatePermissions(r,u),this.markPassConcludedIfNecessary(r);break;case a.ActionTypes.DISCONTINUE_SEEN_STATE_INFO:l={cursor_state:"",has_next:!1},this.updateSeenStateCursor(r,l);break;case a.ActionTypes.UPDATE_SEEN_STATE_INFO:this.assureSeenStateSuccessRegistered(r),this.updateSeenStateInfo(r,s),this.updateSeenStateCursor(r,l);break;case a.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE:this.assureSeenStateSuccessRegistered(r),this.updateSeenStateInfo(r,s,!0),this.updateSeenStateCursor(r,l);break;case a.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE:this.onFetchSeenStateDisabled(r),this.updateSeenStateInfoWithEmptyData(r),this.updateUserIdsWithoutSeenStateInfo(n,r,[]);break;case a.ActionTypes.UPDATE_USER_TEAM_INTERACTION_INFO:this.updateUserTeamInteractionInfo(r,_)}}}const tv=new ev;class iv extends te.default.Component{constructor(e){super(e),this.getApiV2Client=()=>this.apiV2Client,this.getIntegrationStore=()=>this.state.integrationStore,this.getPerformanceTimer=()=>this.performanceTimer,this.getLogEvent=()=>this.logEvent,this.getReportError=()=>this.reportError,this.apiV2Client=new a.DefaultUserApiV2Client(this.props.user),this.performanceTimer=a.WebPerformanceTimer;const t=a.createIntegrationsActionsLogger();this.logEvent=t.logEvent,this.reportError=a.webReportError,this.state={integrationStore:a.initStoreForIntegration(this.props.user.id)}}getChildContext(){return{getApiV2Client:this.getApiV2Client,getIntegrationStore:this.getIntegrationStore,performanceTimer:this.getPerformanceTimer,logEvent:this.getLogEvent,reportError:this.getReportError}}render(){return this.props.children}}function av(e){return e.ns("team_discovery")}var nv,rv,ov,sv,lv;function cv(e){return{request_sent:l.intl.formatMessage({id:"sQbTsQ",defaultMessage:"Request sent. Once it’s approved, you’ll get an invite from the team."}),exists_same_team:l.intl.formatMessage({id:"oZNXJZ",defaultMessage:"Looks like you’ve already asked to join this team."}),exists_different_team:l.intl.formatMessage({id:"mHIpiE",defaultMessage:"Looks like you already asked to join a different team."}),rejected:l.intl.formatMessage({id:"H8TlMC",defaultMessage:"Looks like this team already denied your request."}),max_team_size_achieved:l.intl.formatMessage({id:"dEJ+SP",defaultMessage:"Looks like this team size has already been reached"})}[e]||l.intl.formatMessage({id:"s86tt6",defaultMessage:"Couldn’t send request. Try asking to join in person."})}function dv(e){return{dbxTeamId:e.dbx_team_id,id:e.team_id,name:e.team_name,adminsCount:e.admins_count,membersCount:e.members_count,requestState:e.pending_request?sv.PendingApproval:void 0,joinTeamRequestState:e.join_request_state,joinRequestStateDate:e.join_request_state_date,isSameDomain:e.is_same_domain,isCollaborator:e.is_collaborator,sharedFolderCount:e.shared_folder_count,sharedFileCount:e.shared_file_count,lastShareTimestamp:e.last_share_timestamp,members:w.map(e.members,(e=>({memberId:e.member_id,name:e.member_name,isAdmin:e.is_admin,avatarURL:e.photo_url})))}}iv.childContextTypes={getApiV2Client:a.PropTypes.func,getIntegrationStore:a.PropTypes.func,performanceTimer:a.PropTypes.func,logEvent:a.PropTypes.func,reportError:a.PropTypes.func},iv.displayName="IntegrationProvider",function(e){e.RequestSent="request_sent",e.RequestNotSent="request_not_sent",e.CanJoin="can_join"}(nv||(nv={})),function(e){e[e.Conflict=5]="Conflict"}(rv||(rv={})),function(e){e.ExistsSameTeam="exists_same_team",e.ExistsDifferentTeam="exists_different_team",e.Conflict="conflict",e.MaxTeamSizeAchieved="max_team_size_achieved",e.Rejected="rejected",e.Other="other"}(ov||(ov={})),function(e){e.Sending="sending",e.PendingApproval="pending_approval",e.Joined="joined"}(sv||(sv={})),function(e){e.Suggest="TeamDiscovery/Suggest",e.Confirm="TeamDiscovery/Confirm"}(lv||(lv={}));const uv=["standard","enterprise","limited"];function _v(e){return uv.find((t=>t===(null==e?void 0:e.toLowerCase())))}const pv=["basic"];const gv=(e,t,i,n=!0)=>{switch(n&&a.TeamsWebActionsLogger.log(e,i),e){case S.TeamJoinerLoggerEvents.SAW_TEAM_PROMO_PAGE:{const{verified:e,has_pending_invite:n,has_outstanding_request:o,has_approved_request:s,num_auto_join:l,num_ask_to_join:c,page_type:d,user_plan_type:u,team_id:_,team_type:p}=i;a.logEvent({class:"onboard",action:"shown",object:"team_promo_page",properties:{actionSurface:t,isVerified:e,teamPromoHasPendingInvite:n,teamPromoHasOutstandingRequest:o,teamPromoHasApprovedRequest:s,teamPromoNumAutoJoin:l,teamPromoNumAskToJoin:c,teamPromoPageType:d,teamPromoPageUserPlanType:(r=u,pv.find((e=>e===(null==r?void 0:r.toLowerCase())))),teamPromoTeamTypes:(null==p?void 0:p.join(","))||"",joinableTeamIds:(null==_?void 0:_.join(","))||""}});break}case S.TeamJoinerLoggerEvents.CLICKED_ACCEPT_INVITE:{const{team_id:e,team_type:n}=i;a.logEvent(function(e){return{class:"onboard",action:"select",object:"accept_invite",properties:e}}({actionSurface:t,joinableTeamId:e,teamType:_v(n)}));break}case S.TeamJoinerLoggerEvents.CLK_COMBINE:{const{step:e}=i;a.logEvent(function(e){return{class:"onboard",action:"select",object:"combine_account",properties:e}}({actionSurface:t,teamJoinerStepName:e}));break}case S.TeamJoinerLoggerEvents.CLK_CREATE_NEW:{const{step:e}=i;a.logEvent(function(e){return{class:"onboard",action:"select",object:"create_new_account",properties:e}}({actionSurface:t,teamJoinerStepName:e}));break}}var r},fv="clicked_req_to_join";var mv,hv,vv,Sv;!function(e){e.Signup="signup",e.Preview="preview",e.Requests="requests",e.Pass="pass",e.ExistingViralInband="existing_viral_inband",e.SignupViralInband="signup_viral_inband",e.SignupViralLinksharing="signup_viral_linksharing",e.SurfaceExistingTeamHomepage="surface_existing_teams_homepage",e.ShareRequestAccessPage="share_request_access_page",e.TeamDiscoveryPageRefresh="team_discovery_page_refresh"}(mv||(mv={})),function(e){e.New="new",e.Old="old"}(hv||(hv={})),function(e){e.TEAM_DISCOVERY="team_discovery"}(vv||(vv={}));function Ev(e){const t=te.default.createElement(a.Snackbar$1,Object.assign({},e,{closeButtonText:"Close",id:"teamDiscovery"}));a.Snackbar$1.show(t)}!function(e){e.FetchInitData="FetchInitData",e.AskToJoinTeam="AskToJoinTeam",e.PopulateServerProps="PopulateServerProps",e.UpdateRequestState="UpdateRequestState",e.LoadUserData="LoadUserData",e.LoadCurrentAccountData="LoadCurrentAccountData"}(Sv||(Sv={}));const wv={currentPage:lv.Suggest,joinableTeams:[],domainName:"",userEmail:"",userId:0,userToJoinableTeam:[]};function bv(e=wv,t){switch(t.type){case Sv.FetchInitData:return Object.assign(Object.assign({},e),{currentPage:lv.Suggest,joinableTeams:t.payload.joinableTeams,domainName:t.payload.domainName});case Sv.AskToJoinTeam:return Object.assign(Object.assign({},e),{currentPage:lv.Confirm});case Sv.PopulateServerProps:return Object.assign(Object.assign({},e),{userEmail:t.payload.userEmail,userId:t.payload.userId});case Sv.UpdateRequestState:return Object.assign(Object.assign({},e),{joinableTeams:e.joinableTeams.map((e=>t.payload.teamId===e.id?Object.assign(Object.assign({},e),{requestState:t.payload.requestState}):e))});case Sv.LoadUserData:return e.userToJoinableTeam.find((e=>e.userId===t.payload.userId))||e.userToJoinableTeam.push({userId:t.payload.userId,teamId:t.payload.teamId}),Object.assign({},e);case Sv.LoadCurrentAccountData:return Object.assign(Object.assign({},e),{suggestMembersEnabled:t.payload.suggestMembersEnabled});default:return e}}class yv{static sorter(e,t){return t.domain_contact&&!e.domain_contact?-1:e.domain_contact&&!t.domain_contact?1:e.sort_key||t.sort_key?e.sort_key?t.sort_key?e.sort_key>t.sort_key?-1:e.sort_key<t.sort_key?1:0:-1:1:0}static is_valid(e){return e.dbx_account_id?e.type===a.ContactTypes.DBX_ID||e.type===a.ContactTypes.EMAIL:e.group_id?e.type===a.ContactTypes.NEW_STYLE_GROUP:!!e.email&&e.type===a.ContactTypes.EMAIL}static get_key(e){return r.assert(yv.is_valid(e),`invalid contact: type: ${e.type}`),e.dbx_account_id?`DBX_USER-${e.dbx_account_id}`:e.group_id?`DBX_GROUP-${e.group_id}`:`CONTACT-${e.type}-${e.email}`}static get_index_tokens(e){let t=[];return e.name&&t.push(e.name),e.email&&t.push(e.email),e.fname&&t.push(e.fname),e.lname&&t.push(e.lname),e.name_tokens&&(t=t.concat(e.name_tokens)),t}}class Tv{constructor({dbx_account_id:e,type:t,name:i,email:a,fb_id:n,group_id:r,group_size:o,photo_url:s,members:l,avatar_url:c,invalid:d,on_team:u,domain_contact:_,dbx_team_id:p,nameMatch:g,emailMatch:f,pending:m,join_state:h,query:v,is_directory_restricted:S=!1,invitability_state:E}){this.dbx_account_id=e,this.type=t,this.name=i,this.email=a,this.fb_id=n,this.group_id=r,this.group_size=o,this.photo_url=s,this.members=l,this.avatar_url=c,this.invalid=d,this.on_team=u,this.domain_contact=_,this.dbx_team_id=p,this.nameMatch=g,this.emailMatch=f,this.pending=m,this.join_state=h,this.query=v,this.is_directory_restricted=!!S,this.team=this.on_team,this.invitability_state=E}static buildFromRawEmail(e){const t=function(e){return e.toLowerCase()}(e);return new Tv({name:t,email:t,type:a.ContactTypes.EMAIL,invalid:!a.validateEmail(e),on_team:!1,pending:!0,query:t})}getKey(){return yv.get_key(this)}getContactID(){switch(this.type){case a.ContactTypes.FB:return this.fb_id;case a.ContactTypes.NEW_STYLE_GROUP:return this.group_id;default:return this.email}}}var Iv,Cv,Av,Mv;t.InviteSource=void 0,(Iv=t.InviteSource||(t.InviteSource={})).INVITE_LINK="invite_link",Iv.IMM_WEB="IMM_web",Iv.IMM_CB="IMM_cb",Iv.MEMBER_INVITE="member_invite",Iv.INVITE_CANCELLATION="invite_cancellation",Iv.TEAM_SETUP="team_setup",Iv.APPROVAL_CONFIRMATION_PAGE="approval_confirmation_page",Iv.PENDING_MEMBER_PAGE="pending_member_page",Iv.ENTER_EMAILS="enter_emails",Iv.INDIVIDUAL_INVITE_BUTTON="individual_invite_button",Iv.FILE_TASK_LIST="file_task_list",Iv.INVITE_AFTER_SHARING_FOR_ADMINS="invite_after_sharing_for_admins",Iv.INVITE_AFTER_SHARING_FOR_ADMINS_EXPAND_ELIGIBILITY="invite_after_sharing_for_admin_expand_eligibility",Iv.INVITE_AFTER_SHARING_FOR_MEMBERS="invite_after_sharing_for_members",Iv.INVITE_AFTER_SHARING_FOR_MEMBERS_EXPAND_ELIGIBILITY="invite_after_sharing_for_members_expand_eligibility",Iv.INVITE_AFTER_MOVE_FOR_ADMINS="invite_after_move_for_admins",Iv.INVITE_AFTER_RECEIVING_SHARE_FOR_ADMINS="invite_after_receiving_share_for_admins",Iv.MEMBERS_PAGE="members_page",Iv.DIG_INVITE_MODAL="dig_invite_modal",Iv.INVITE_CONFIRMATION_MODAL="invite_confirmation_modal",Iv.GUEST_INVITE_AFTER_SHARING_FOR_ADMINS="guest_invite_after_sharing_for_admins",Iv.INVITE_MEMBERS_CARD="invite_members_card",Iv.INVITE_RECOMMENDATIONS_MODAL="invite_recommendations_modal",Iv.MEMBERS_PAGE_REQUESTS_TABLE="members_page_requests_table",Iv.TEAM_WIDGET="team_widget",Iv.TASKS_WIDGET="tasks_widget",Iv.SHARING_MODAL_CONTACT_INVITE_BUTTON="sharing_modal_contact_invite_button",function(e){e.SIGNUP_VIRAL_INBAND="signup_viral_inband",e.EXISTING_VIRAL_INBAND="existing_viral_inband",e.SIGNUP="signup",e.PREVIEW="preview",e.REQUESTS="requests",e.PASS="pass",e.SIGNUP_VIRAL_LINKSHARING="signup_viral_linksharing",e.LINK_SHARE_CONTENT_ADD="link_share_content_add",e.SURFACE_EXISTING_TEAM_HOMEPAGE="surface_existing_teams_homepage",e.SHARE_REQUEST_ACCESS_PAGE="share_request_access_page",e.TEAM_DISCOVERY_PAGE_REFRESH="team_discovery_page_refresh",e.REONBOARD_AFTER_OFFBOARD_POST_LOGIN="reonboard_after_offboard_post_login",e.REQUEST_JOIN_AFTER_SHARING="request_join_after_sharing"}(Cv||(Cv={})),t.Source=void 0,function(e){e.RESEND_INVITE_MODAL="resend_invite_modal",e.BULK_RESEND_INVITE_MODAL="bulk_resend_invite_modal",e.BULK_SUSPEND_USER_MODAL="bulk_suspend_user_modal",e.BULK_UNSUSPEND_USER_MODAL="bulk_unsuspend_user_modal",e.REQUEST_TO_JOIN="request_to_join",e.SUGGESTION_TO_JOIN="suggestion_to_join",e.DESKTOP_REQUEST_TO_JOIN_NOTIFICATION="desktop_request_to_join_notification",e.EMAIL_REQUEST_TO_JOIN="email_request_to_join",e.EMAIL_SUGGESTION_TO_JOIN="email_suggestion_to_join",e.LIMITED_TEAM_INVITE_PAGE="limited_team_invite_page",e.MANAGE_TEAM_COLLABORATORS_PAGE="manage_team_collaborators_page",e.MANAGE_DISCOVER_ACCOUNTS_ON_DOMAIN_PAGE="manage_discover_accounts_on_domain_page",e.MEMBERS_PAGE="members_page",e.INSIGHTS_PAGE="insights_page",e.FILE_TASK_LIST="file_task_list",e.MEMBER_DELETION="member_deletion",e.MEMBER_OFFBOARD="member_offboard",e.INVITE_AFTER_SHARING_MODAL_FOR_ADMINS="invite_after_sharing_modal_for_admins",e.INVITE_AFTER_SHARING_MODAL_FOR_ADMINS_EXPAND_ELIGIBILITY="invite_after_sharing_modal_for_admins_expand_eligibility",e.INVITE_AFTER_SHARING_MODAL_FOR_MEMBERS="invite_after_sharing_modal_for_members",e.INVITE_AFTER_MOVE_MODAL_FOR_ADMINS="invite_after_move_modal_for_admins",e.INVITE_AFTER_RECEIVING_SHARE_MODAL_FOR_ADMINS="invite_after_receiving_share_modal_for_admins",e.REQUESTS_PAGE="requests_page",e.PASS_INVITE="pass_invite",e.HOME_RECOMMENDED_MEMBERS="home_recommended_members",e.SHARING_QUESTIONNAIRE="sharing_questionnaire",e.DOMAINS_PAGE="domains_page",e.INVITE_FROM_FACEPILE="invite_from_facepile",e.INVITE_CANCELLATION_MODAL="invite_cancellation_modal",e.GUEST_INVITE_AFTER_SHARING_MODAL_FOR_ADMINS="guest_invite_after_sharing_modal_for_admins",e.INVITE_AFTER_ACCOUNT_SHARING_NUDGE="invite_after_account_sharing_nudge",e.FOR_YOU_PAGE="for_you_page",e.INVITE_BUTTON_TOP_NAV="invite_button_top_nav",e.INVITE_RECOMMENDATIONS_MODAL="invite_from_recommendations_modal",e.DASH_ADMIN_PANEL_MEMBERS_PAGE="dash_admin_panel_members_page",e.SHARING_MODAL_CONTACT_INVITE_BUTTON="sharing_modal_contact_invite_button",e.LICENSE_MANAGEMENT_MODAL="license_management_modal",e.MEMBERS_PAGE_REQUESTS_TABLE="members_page_requests_table",e.LICENSE_COUNT_WIDGET="license_count_widget",e.TEAM_WIDGET="team_widget",e.TASKS_WIDGET="tasks_widget",e.TEAM_USAGE_WIDGET="team_usage_widget",e.TEAM_ONBOARDING_CHECKLIST="team_onboarding_checklist",e.CREATE_TEAM_BUTTON_TOP_NAV="create_team_button_top_nav"}(t.Source||(t.Source={})),t.Platform=void 0,(Av=t.Platform||(t.Platform={})).WEB="web",Av.DESKTOP="desktop",Av.MOBILE="mobile";class Ov{constructor(){this.inFlight=!0,this.canInvite=!1,this.reason="checking",this.callbacks=[]}whenReady(e){this.inFlight?this.callbacks.push(e):e()}resultArrived(e,t){if(this.inFlight){this.inFlight=!1,this.canInvite=e,this.reason=t;for(const e of this.callbacks)e();this.callbacks=[]}}}class Pv{constructor(e){this.checkEmails=(e,t)=>{const i={};let n=e.length;if(0===n)return t(i);const r=[];for(const a of e){let e=this.checkedEmails[a];e||(e=this.checkedEmails[a]=new Ov,r.push(a)),e.whenReady((function(){i[a]=e,0==--n&&t(i)}))}r.length>0&&(e=>{a.WebRequest({url:this.checkUrl,data:{emails:e.join(",")},subject_user:o.mustGetActiveUserId(),success:e=>{const t=JSON.parse(e);for(const e in t)if(t[e]){const{can_invite:i,reason:a}=t[e];this.checkedEmails[e]&&this.checkedEmails[e].resultArrived(i,a)}},error:()=>{for(const t of e)delete this.checkedEmails[t]}})})(r)},this.checkUrl=e,this.checkedEmails={}}getEmailCheckResult(e){return this.checkedEmails[e]}}const xv=e=>e,Dv=e=>"string"==typeof e?e:JSON.stringify(e),Rv=()=>{},Nv=e=>e?e.split(/\s+/):[],kv=e=>e?e.split(/\W+/):[],Lv=e=>function(t){return i=>{let a=[];return t.forEach((t=>{var n;a=a.concat(e(null!==(n=i[t])&&void 0!==n?n:""))})),a}},Fv={nonword:kv,whitespace:Nv,obj:{nonword:Lv(kv),whitespace:Lv(Nv)}};class Uv{constructor(){this.add=e=>{this.head&&(e.next=this.head,this.head.prev=e),this.head=e,this.tail=this.tail||e},this.remove=e=>{e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev},this.moveToFront=e=>{this.remove(e),this.add(e)},this.head=this.tail=void 0}}class Vv{constructor(e,t){this.key=e,this.val=t,this.prev=this.next=void 0}}class jv{constructor(e){this.set=(e,t)=>{const i=this.list.tail;this.size>=this.maxSize&&i&&(this.list.remove(i),delete this.hash[i.key],this.size--);const a=this.hash[e];if(a)a.val=t,this.list.moveToFront(a);else{const i=new Vv(e,t);this.list.add(i),this.hash[e]=i,this.size++}},this.get=e=>{const t=this.hash[e];if(t)return this.list.moveToFront(t),t.val},this.reset=()=>{this.size=0,this.hash={},this.list=new Uv},this.maxSize=null!=e?e:100,this.reset(),this.maxSize<=0&&(this.set=Rv,this.get=Rv)}}const Bv=window.localStorage,Hv=()=>(new Date).getTime();class Kv{constructor(e){this.getPrefix=e=>this.prefix+e,this.getTtlKey=e=>this.getPrefix(e)+this.ttlKey,this.safeSet=(e,t)=>{try{Bv.setItem(e,t)}catch(e){e instanceof Error&&"QuotaExceededError"===e.name&&this.clear()}},this.get=e=>{var t;return this.isExpired(e)&&this.remove(e),JSON.parse(null!==(t=Bv.getItem(this.getPrefix(e)))&&void 0!==t?t:"")},this.set=(e,t,i)=>(i?this.safeSet(this.getTtlKey(e),(Hv()+i).toString()):Bv.removeItem(this.getTtlKey(e)),this.safeSet(this.getPrefix(e),JSON.stringify(t))),this.remove=e=>(Bv.removeItem(this.getTtlKey(e)),Bv.removeItem(this.getPrefix(e)),this),this.clear=()=>{const e=(e=>{var t;let i,a;const n=[],r=Bv.length;for(i=0;i<r;i++)(null===(t=a=Bv.key(i))||void 0===t?void 0:t.match(e))&&n.push(a.replace(e,""));return n})(this.keyMatcher);for(let t=e.length;t--;)this.remove(e[t]);return this},this.isExpired=e=>{var t;const i=JSON.parse(null!==(t=Bv.getItem(this.getTtlKey(e)))&&void 0!==t?t:"");return"number"==typeof i&&Hv()>i},this.prefix=["__",e,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+this.prefix.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"))}}class zv{constructor(e){this.fingerprint=e=>{var t;return e.url+JSON.stringify(null!==(t=e.fingerprint)&&void 0!==t?t:{})},this.makeRequest=(e,t)=>{const i=new URL(e.url,"https://www.dropbox.com"),a=fetch(i,e).then((e=>(zv.pendingRequestsCount--,delete zv.pendingRequests[t],e.json())));return zv.pendingRequestsCount++,zv.pendingRequests[t]=a,a},this._get=e=>n.__awaiter(this,void 0,void 0,(function*(){const t=this.fingerprint(e);if(this.cancelled||t!==this.lastReq)return;const i=zv.pendingRequests[t];if(!i&&zv.pendingRequestsCount>=zv.maxPendingRequests)return;const a=i||this.makeRequest(e,t);let n;try{n=yield a,this.cache.set(t,n)}catch(e){n=void 0}return n})),this.get=e=>n.__awaiter(this,void 0,void 0,(function*(){const t="string"==typeof e?{url:e}:e,i=this.fingerprint(t);this.cancelled=!1,this.lastReq=i;const a=this.cache.get(i);return a||(yield this._get(t))})),this.cancel=()=>{this.cancelled=!0},this.cancelled=!1,this.lastReq=void 0,this.cache=!1===e.cache?new jv(0):zv.sharedCache}}Mv=zv,zv.pendingRequests={},zv.sharedCache=new jv(10),zv.pendingRequestsCount=0,zv.maxPendingRequests=6,zv.setMaxPendingRequests=e=>{Mv.maxPendingRequests=e},zv.resetCache=()=>{Mv.sharedCache.reset()};const Wv="c",Gv=e=>e.filter((e=>!!e)).map((e=>e.toLowerCase())),qv=()=>({i:[],[Wv]:{}});class Qv{constructor(e){this.bootstrap=e=>{this.datums=e.datums,this.trie=e.trie},this.add=e=>{e.forEach((e=>{const t=this.identify(e);this.datums[t]=e;Gv(this.datumTokenizer(e)).forEach((e=>{let i,a=this.trie;const n=e.split("");for(;i=n.shift();)a=a[Wv][i]||(a[Wv][i]=qv()),a.i.push(t)}))}))},this.get=e=>e.map((e=>this.datums[e])),this.search=e=>{let t;return Gv(this.queryTokenizer(e)).forEach((e=>{let i,a,n;if(t&&0===t.length)return!1;i=this.trie;const r=e.split("");for(;i&&(a=r.shift());)i=i[Wv][a];return i&&0===r.length?(n=i.i.slice(0),t=t?((e,t)=>{let i=0,a=0;const n=[];e=e.sort(),t=t.sort();const r=e.length,o=t.length;for(;i<r&&a<o;)e[i]<t[a]?i++:(e[i]>t[a]||(n.push(e[i]),i++),a++);return n})(t,n):n):t=[],!1})),t?(e=>{const t={},i=[];for(let a=0,n=e.length;a<n;a++)t[e[a]]||(t[e[a]]=!0,i.push(e[a]));return i})(t).map((e=>this.datums[e])).filter((e=>!!e)):[]},this.all=()=>{const e=[];for(const t in this.datums)if(this.datums.hasOwnProperty(t)){const i=this.datums[t];i&&e.push(i)}return e},this.reset=()=>{this.datums={},this.trie=qv()},this.serialize=()=>({datums:this.datums,trie:this.trie}),this.identify=e.identify||Dv,this.datumTokenizer=e.datumTokenizer,this.queryTokenizer=e.queryTokenizer,this.reset()}}const Yv="data",$v="protocol",Zv="thumbprint";class Xv{constructor(e){this.settings=()=>({url:this.url,method:"GET"}),this.store=e=>{this.cache&&(this.storage.set(Yv,e,this.ttl),this.storage.set($v,location.protocol,this.ttl),this.storage.set(Zv,this.thumbprint,this.ttl))},this.fromCache=()=>{if(!this.cache)return;const e=this.storage.get(Yv),t=this.storage.get($v),i=this.storage.get(Zv)!==this.thumbprint||t!==location.protocol;return e&&!i?e:void 0},this.fromNetwork=()=>n.__awaiter(this,void 0,void 0,(function*(){const e=this.prepare(this.settings());try{const t=yield fetch(e.url,e);return yield t.json()}catch(e){return}})),this.clear=()=>(this.storage.clear(),this),this.url=e.url,this.ttl=e.ttl,this.cache=e.cache,this.prepare=e.prepare,this.thumbprint=e.thumbprint,this.storage=new Kv(e.cacheKey)}}class Jv{constructor(e){this.settings=()=>({url:this.url,method:"GET"}),this.get=e=>n.__awaiter(this,void 0,void 0,(function*(){e=e||"";const t=this.prepare(e,this.settings());return yield this.transport.get(t)})),this.cancelLastRequest=()=>{this.transport.cancel()},this.url=e.url,this.prepare=e.prepare,this.transport=new zv({cache:e.cache})}}const eS=e=>{var t;if(!e)return;const i="string"==typeof e?{url:e}:e;return{url:i.url,ttl:864e5,cache:!0,prepare:null!==(t=i.prepare)&&void 0!==t?t:xv,cacheKey:i.cacheKey||i.url,thumbprint:"0.11.1"+i.thumbprint}},tS=e=>{var t;if(!e)return;const i="string"==typeof e?{url:e}:e;return{url:i.url,cache:null===(t=i.cache)||void 0===t||t,prepare:iS(i)}},iS=e=>{const{prepare:t,replace:i,wildcard:a}=e;return t||(i?(e,t)=>(t.url=i(t.url,e),t):a?(e,t)=>(t.url=t.url.replace(a,encodeURIComponent(e)),t):(e,t)=>t)};class aS{constructor(e){this.loadPrefetch=()=>n.__awaiter(this,void 0,void 0,(function*(){var e;if(!this.prefetch)return;const t=this.prefetch.fromCache();if(t)return void this.index.bootstrap(t);const i=yield this.prefetch.fromNetwork();i&&this.add(i),null===(e=this.prefetch)||void 0===e||e.store(this.index.serialize())})),this._initialize=()=>n.__awaiter(this,void 0,void 0,(function*(){this.clear(),yield this.loadPrefetch(),this.add(this.local)})),this.initialize=e=>!this.initPromise||e?this._initialize():this.initPromise,this.add=e=>(this.index.add(e),this),this.get=e=>this.index.get(e),this.search=(e,t,i)=>n.__awaiter(this,void 0,void 0,(function*(){const a=this.sorter(this.index.search(e));if(t(this.remote?a.slice():a),this.remote&&a.length<this.sufficient){const t=yield this.remote.get(e),n=[];null==t||t.forEach((e=>{a.some((t=>this.identify(e)===this.identify(t)))||n.push(e)})),null==i||i(n)}else this.remote&&this.remote.cancelLastRequest()})),this.all=()=>this.index.all(),this.clear=()=>(this.index.reset(),this),this.clearPrefetchCache=()=>{var e;return null===(e=this.prefetch)||void 0===e||e.clear(),this},this.clearRemoteCache=()=>(zv.resetCache(),this);const t=(e=>{var t,i,a;return{initialize:!0,identify:null!==(t=e.identify)&&void 0!==t?t:Dv,datumTokenizer:e.datumTokenizer,queryTokenizer:e.queryTokenizer,sufficient:null!==(i=e.sufficient)&&void 0!==i?i:5,local:"function"==typeof e.local?e.local():null!==(a=e.local)&&void 0!==a?a:[],prefetch:eS(e.prefetch),remote:tS(e.remote),sorter:e.sorter?t=>t.sort(e.sorter):xv}})(e);this.sorter=t.sorter,this.identify=t.identify,this.sufficient=t.sufficient,this.local=t.local,this.remote=t.remote?new Jv(t.remote):void 0,this.prefetch=t.prefetch?new Xv(t.prefetch):void 0,this.index=new Qv({identify:this.identify,datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer}),this.initialize()}}var nS;aS.tokenizers=Fv,function(e){e[e.ALL=0]="ALL",e[e.INDIVIDUAL=1]="INDIVIDUAL"}(nS||(nS={}));const rS={ALL:{getUrl:"/contacts/get",refreshUrl:"/contacts/refresh",boltAppId:"contacts_cache_notify"},INDIVIDUAL:{getUrl:"/contacts/get_individual_for_user",refreshUrl:"/contacts/refresh_individual_for_user",boltAppId:"individual_contacts_cache_notify"}};class oS{static create_contacts_list(e){return new oS(e,null)}static create_per_user_contacts_list(e,t){return new oS(e,t)}constructor(e,t){this.filterContacts=this.filterContacts.bind(this),this.length=this.length.bind(this),this.slice=this.slice.bind(this),this.includeForUser=this.includeForUser.bind(this),this.includeForViewer=this.includeForViewer.bind(this),this.excludeByEmail=this.excludeByEmail.bind(this),this.excludeMe=this.excludeMe.bind(this),this.excludeNewStyleGroups=this.excludeNewStyleGroups.bind(this),this.excludeFacebook=this.excludeFacebook.bind(this),this.excludeTeamMembers=this.excludeTeamMembers.bind(this),this.excludePairedUserDuplicates=this.excludePairedUserDuplicates.bind(this),this.excludeNonTeam=this.excludeNonTeam.bind(this),this.excludeNonTeamActive=this.excludeNonTeamActive.bind(this),this.excludeSuspended=this.excludeSuspended.bind(this),this.sortByTeamFirst=this.sortByTeamFirst.bind(this),this._excludeType=this._excludeType.bind(this),this._lowercaseContact=this._lowercaseContact.bind(this),this.contacts=e,this.owningUserId=t,this.lcontacts=Array.from(this.contacts).map((e=>this._lowercaseContact(e)))}filterContacts(e){const t=this.contacts.filter(e);return new oS(t,this.owningUserId)}length(){return this.contacts.length}slice(e,t){return new oS(this.contacts.slice(e,t),this.owningUserId)}includeForUser(e){if(null!=this.owningUserId)return this.owningUserId===e?this:new oS([],e);{const t=this.contacts.filter((t=>t.owning_user_id===e));return new oS(t,e)}}includeForViewer(e){const t=e.get_user_ids();return this.filterContacts((e=>Array.from(t).includes(e.owning_user_id)))}excludeByEmail(e){return e=e?e.toLowerCase():"",this.filterContacts((t=>!(e===t.email.toLowerCase())))}excludeMe(){return this.filterContacts((e=>!e.is_owner))}excludeNewStyleGroups(){return this._excludeType(a.ContactTypes.NEW_STYLE_GROUP)}excludeFacebook(){return this._excludeType(a.ContactTypes.FB)}excludeTeamMembers(){return this.filterContacts((e=>!e.team))}excludePairedUserDuplicates(){return this.filterContacts((e=>!e.paired_user_duplicate))}excludeNonTeam(){return this.filterContacts((e=>e.team))}excludeNonTeamActive(){return this.filterContacts((e=>e.team&&"active"===e.join_state))}excludeSuspended(){return this.filterContacts((e=>"suspended"!==e.join_state))}sortByTeamFirst(){return new oS(oS.sortContactsByTeamFirst(this.contacts),this.owningUserId)}static sortContactsByTeamFirst(e){const t=[],i=[];for(const a of Array.from(e))a.team?t.push(a):i.push(a);return t.concat(i)}_excludeType(e){return this.filterContacts((t=>t.type!==e))}_lowercaseContact(e){const t={};for(const i in e){let a=e[i];("string"==typeof a||a instanceof String)&&(a=a.toLowerCase()),t[i]=a}return t}}class sS{static initClass(){this.MAX_REQUEST_PERF_RECORDS=20}constructor(e){this.callbacks={},this.one_time_callbacks=[],this.cached_contacts=null,this._cache_download_name=e,this.should_force_refresh=!1,this.request_perf_records=[],this._config=null}register_for_updates(e,t){this.callbacks[e]=t}unregister_for_updates(e){null!=this.callbacks[e]&&delete this.callbacks[e]}get_contacts_count(){return null!=this.cached_contacts?this.cached_contacts.length():0}get_downloaded_time(){const e=window.performance.getEntriesByName(this._get_contacts_downloaded_mark_name());return e&&e.length?e[0].startTime:null}get_request_perf_records(){return this.request_perf_records}_is_contact_get_or_check_ajax_request(e){const{initiatorType:t}=e,{name:i}=e;return"xmlhttprequest"===t&&i.endsWith(this._config.getUrl)}_find_last_perf_entry(e=500){const t=window.performance.getEntriesByType("resource");if(t.length){for(let i=Math.min(t.length-1,e);i>=0;i--)if(this._is_contact_get_or_check_ajax_request(t[i]))return t[i]}return null}_record_perf_stats(e={}){const t=this._find_last_perf_entry();if(t&&(e.ttfb=t.responseStart-t.requestStart,e.downloading_time=t.responseEnd-t.responseStart,e.duration=t.duration,this.request_perf_records.push(e),this.request_perf_records.length>sS.MAX_REQUEST_PERF_RECORDS))return this.request_perf_records=this.request_perf_records.slice(this.request_perf_records.length-1)}_get_request_url(){throw new Error("method unimplemented")}_get_request_params(){throw new Error("method unimplemented")}_contacts_loaded_callback(e){throw new Error("method unimplemented")}_fetch_contacts(e){return a.BackgroundRequest(Object.assign(Object.assign({url:this._get_request_url(),data:this._get_request_params()},e?{subject_user:e}:{}),{success:(e,t,i)=>{const a=JSON.parse(e);if(this._contacts_loaded_callback(a),this._schedule_fetch)return this._schedule_fetch()}}))}_get_versioned_params(e,t=!0){const i={version:e};return t&&(i.force_refresh=this.should_force_refresh,this.should_force_refresh=!1),null!=this.digest&&(i.digest=this.digest),null!=this.limit&&(i.limit=this.limit),i}_get_contacts_downloaded_mark_name(){return`${this._cache_download_name}-${this.instance}`}_is_page_hidden(){return null!=window.document.visibilityState&&window.document.hidden}_add_one_time_callback(e){if(null!=e&&!Array.from(this.one_time_callbacks).includes(e))return this.one_time_callbacks.push(e)}_invoke_all_callbacks(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0),this._invoke_callbacks(this.callbacks,e,!1)}_invoke_one_time_callbacks(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0)}_invoke_callbacks(e,t,i){return(()=>{const a=[];for(const n of Array.from(Object.keys(e)))e[n](t),i?a.push(delete e[n]):a.push(void 0);return a})()}}sS.initClass();class lS extends sS{static initClass(){this.INSTANCE=0,this.BOLT_NEED_TO_SEND_REQUEST=0,this.BOLT_REQUEST_SENT=1,this.REFRESH_THRESHOLD=36e5}constructor(e,t=null,i=null){super("BoltContactsCache download"),this.bolt_update_callback=this.bolt_update_callback.bind(this),this.bolt_refresh_callback=this.bolt_refresh_callback.bind(this),this.cache_type=e,this.limit=t,this.user_id=i,this.instance=lS.INSTANCE++,this.loading_state=lS.BOLT_NEED_TO_SEND_REQUEST,this._config=rS[nS[this.cache_type]],this.current_bolt_states=null,this._notified_states={},this._bolt=null,this._last_refresh_ts=null}load_contacts(e,t){o.Viewer.get_viewer().is_signed_in&&(this._add_one_time_callback(t),(this.loading_state===lS.BOLT_NEED_TO_SEND_REQUEST||e)&&(this.loading_state=lS.BOLT_REQUEST_SENT,e&&(this.should_force_refresh=!0),this._fetch_contacts(this._getUserId())),!this._should_update_contacts()&&this.is_loaded()&&this._invoke_one_time_callbacks(this.cached_contacts))}refresh_contacts(e=!1){const t=window.performance.now();if(this._last_refresh_ts||(e=!0),!e&&this._last_refresh_ts&&t-this._last_refresh_ts<lS.REFRESH_THRESHOLD)return;const i=this._getUserId();return a.BackgroundRequest(Object.assign({url:this._get_refresh_url(),data:this._get_refresh_params({force_refresh:e})},i?{subject_user:i}:{})),this._last_refresh_ts=t}is_loaded(){return null!=this.cached_contacts}bolt_update_callback(e){for(const t of Array.from(e))(!Array.from(this._notified_states).includes(t.unique_id)||+this._notified_states[t.unique_id].revision<+t.revision)&&(this._notified_states[t.unique_id]=t);return this._should_update_contacts()&&(this.loading_state=lS.BOLT_NEED_TO_SEND_REQUEST),this.load_contacts()}bolt_refresh_callback(e){if(null!=this._bolt&&this._bolt.unsubscribe(),this._bolt=null,this.loading_state=lS.BOLT_NEED_TO_SEND_REQUEST,!this._is_page_hidden())return this.load_contacts()}_contacts_loaded_callback(e){if(this._is_old_contacts(e.bolt_info))return;const t=this._is_new_contacts(e.bolt_info);return this.current_bolt_states=e.bolt_info,null==this._bolt&&this._subscribe_to_bolt(),t&&(null!=e.contacts?e.contacts.length:void 0)?(this._record_perf_stats({num_contacts:e.contacts.length}),this.digest=e.digest,this._create_contacts_list(e.contacts),this._invoke_all_callbacks(this.cached_contacts),window.performance.mark(this._get_contacts_downloaded_mark_name())):void 0}_create_contacts_list(e){return this.cached_contacts=oS.create_contacts_list(e)}_subscribe_to_bolt(){const e=[];for(const t in this.current_bolt_states){const i=this.current_bolt_states[t];e.push(new C.SignedChannelState(this._config.boltAppId,t.toString(),i.revision,i.token))}return this._bolt=new C.MetaserverBoltClient(e,this.bolt_update_callback,this.bolt_refresh_callback),this._bolt.start()}_is_new_contacts(e){return this._first_contacts_are_newer(e,this.current_bolt_states)}_is_old_contacts(e){return this._first_contacts_are_newer(this.current_bolt_states,e)}_first_contacts_are_newer(e,t){if(!t)return!0;for(const i in t){const a=t[i];for(const t in e){const n=e[t];if(t===i&&+a.revision<+n.revision)return!0}}return!1}_should_update_contacts(){return this._is_new_contacts(this._notified_states)}_get_request_params(){return this._get_versioned_params(1)}_get_request_url(){return this._config.getUrl}_get_refresh_params(e={}){return e}_get_refresh_url(){return this._config.refreshUrl}_getUserId(){var e;const t=null!==(e=this.user_id)&&void 0!==e?e:o.getActiveUserId();return void 0===t&&h.reportStack("Contacts API request from BoltContactsCache without subject user",{tags:["contacts-uid-aware-migration"]}),t}}lS.initClass();class cS extends lS{constructor(e,t){r.assert(null!=t.id,"user has invalid id"),super(e,null,t.id),this.cache_type=e,this.user=t}_create_contacts_list(e){return this.cached_contacts=oS.create_per_user_contacts_list(e,this.user.id)}}class dS{constructor(e){this.cacheType=e}}class uS extends dS{getOrCreateForUser(e){if(!o.Viewer.get_viewer().is_uid_associated(e.id))throw new Error("Requested contacts cache for a user not associated with the current viewer.");return this.getOrCreateForViewer()}getOrCreateForViewer(){return null==this.contactsCache&&(this.contactsCache=new lS(this.cacheType)),this.contactsCache}}const _S=new uS(nS.ALL);let pS=_S;"OFF"!==ie.LEGACY_CACHE_LIMIT&&(pS=new uS(nS.ALL),pS.contactsCache=new lS(nS.ALL,+ie.LEGACY_CACHE_LIMIT));const gS=new class extends dS{constructor(){super(...arguments),this.uidToContactsCache={}}getOrCreateForUser(e){return e.id in this.uidToContactsCache||(this.uidToContactsCache[e.id]=new cS(this.cacheType,e)),this.uidToContactsCache[e.id]}}(nS.INDIVIDUAL);var fS;!function(e){e[e.ALL_LOCAL=0]="ALL_LOCAL",e[e.INDIVIDUAL_LOCAL_TEAM_REMOTE=1]="INDIVIDUAL_LOCAL_TEAM_REMOTE"}(fS||(fS={}));const mS=[fS.ALL_LOCAL],hS={ALL_LOCAL:{localCacheStore:_S,sufficientResults:1e3,remoteDebounceWait:10},INDIVIDUAL_LOCAL_TEAM_REMOTE:{localCacheStore:gS,remoteEndpoint:"/team/search_contacts",remoteBatchEndpoint:"/team/search_contacts_batch",sufficientResults:1e3,remoteDebounceWait:10}};function vS(e){return ie.MERGE_SEARCH_ALLOWED[e.id]?fS.INDIVIDUAL_LOCAL_TEAM_REMOTE:fS.ALL_LOCAL}function SS(e){return hS[fS[vS(e)]]}const ES={},wS={getOrCreateForUser(e){if(e.id in ES)return ES[e.id];const t=SS(e);let i;if(t.remoteEndpoint){const a=String(e.id);i={url:yS(t.remoteEndpoint),prepare:(e,t)=>{var i;const n=new FormData;return n.append("query",JSON.stringify(e)),n.append("_subject_uid",a),Object.assign(Object.assign({},t),{method:"POST",headers:{"X-CSRF-Token":null!==(i=N.Cookies.read("__Host-js_csrf"))&&void 0!==i?i:"","X-Dropbox-Uid":a},body:n,fingerprint:`${e}:${a}`})}}}const n=new aS({datumTokenizer:yv.get_index_tokens,queryTokenizer:aS.tokenizers.whitespace,identify:yv.get_key,sufficient:t.sufficientResults,sorter:yv.sorter,local:[],remote:i});if(ES[e.id]=n,o.Viewer.get_viewer().is_user_signed_in(e)){const i=t.localCacheStore.getOrCreateForUser(e);i.load_contacts(!1,(t=>{bS(e,t),i.register_for_updates("bloodhound_contacts_v2",(t=>{bS(e,t)}))}))}return a.LinkedProfileServices.get_linked_profile_services_for_user(e.id).register_for_service_changes("bloodhound_contacts_v2",(()=>{n.clearRemoteCache()})),ES[e.id]},search:(e,t,i,a)=>{const n=wS.getOrCreateForUser(e),r=SS(e);if(!t)return i([]),void(a&&r.remoteEndpoint&&a([]));const o=r.localCacheStore.getOrCreateForUser(e);o.is_loaded()?n.search(t,i,a):o.load_contacts(!1,(e=>{n.search(t,i,a)})),o.refresh_contacts(!1)},getAll:e=>wS.getOrCreateForUser(e).all(),clearCache(e){delete ES[e.id]}};function bS(e,t){!function(e,t){if(!(e.id in ES))return;const i=ES[e.id];t=t.filter(yv.is_valid),i.clearRemoteCache(),i.clear(),i.add(t)}(e,t.includeForUser(e.id).contacts)}function yS(e){const t=".dropbox.com",i=document.createElement("a");i.href=e;const a=i.hostname||window.location.hostname;if(-1===a.indexOf(t,a.length-12))throw new Error("Cannot send the CSRF token to "+a);return e}const TS=e=>w.debounce(e,10,{leading:!0,trailing:!0});class IS{constructor(e,t,i=!0,a=!0){this.searchInternal=TS(((e,t,i)=>{if(""===(e=IS.normalizeQuery(e)))return t([]),void(i&&i([]));wS.search(this.user,e,(i=>this.processMatches(i,t,e)),(t=>this.processMatches(t,i,e)))})),this.searchBatchInternal=TS(((e,t,i)=>{const a=e.map(IS.normalizeQuery).filter((e=>e.length>0)),n={};for(const e of a){const t=t=>{n[e]=this.processMatches(t,void 0,e)};wS.search(this.user,e,t)}if(t(n),!this.searchConfig.remoteBatchEndpoint)return;this.searchRemoteBatch(a,(e=>{if(!i)return;const t={};for(const i in e)if(e.hasOwnProperty(i)){const a=n[i].map(yv.get_key),r=e[i].filter((e=>{const t=yv.get_key(e);return a.every((e=>e!==t))}));t[i]=this.processMatches(r)}i(t)}))})),this.query=this.search,this.query_batch=this.searchBatch,this.user=e,this.filterFunc=t,this.excludeDomainContacts=i,this.excludeDirectoryRestrictedContacts=a,this.searchConfig=SS(e),this.searchMode=vS(e),this.searchModeName=fS[this.searchMode],wS.getOrCreateForUser(this.user)}search(e,t,i){this.searchInternal(e,t,i)}searchBatch(e,t,i){const a=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);if(a.is_loaded())return this.searchBatchInternal(e,t,i);a.load_contacts(!0,(()=>this.searchBatchInternal(e,t,i)))}normalizeQuery(e){return e.trim().toLowerCase()}isSearchLocalOnly(){return-1!==mS.indexOf(this.searchMode)}getStats(){const e=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);return{numLocalContacts:e.get_contacts_count(),localContactsDownloadedTime:e.get_downloaded_time()}}searchRemoteBatch(e,t){a.WebRequest({url:this.searchConfig.remoteBatchEndpoint,type:"post",subject_user:this.user.id,dataType:"json",data:{queries:JSON.stringify(e)},success:t})}isTeamContact(e){return this.user.is_team&&null!=e.team&&e.team}static isDirectoryRestrictedContact(e,t){const i=!!e.is_directory_restricted,a=t&&t===e.email;return i&&!a}processMatches(e,t,i){const n=[];for(const t of e){i&&(t.nameMatch=u.fuzzy.match(i,t.name||""),t.emailMatch=u.fuzzy.match(i,t.email||"")),t.on_team=!(t.type===a.ContactTypes.FB||!this.isTeamContact(t));const e=new Tv(t);e.pending=!1;const r=this.excludeDomainContacts&&e.domain_contact,o=this.excludeDirectoryRestrictedContacts&&IS.isDirectoryRestrictedContact(e,i);r||o||this.filterFunc&&!this.filterFunc(e)||n.push(e)}return t&&t(n),n}getAll(e){const t=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);if(t.is_loaded()){const t=wS.getAll(this.user).map((e=>new Tv(e))),i=this.filterFunc?t.filter(this.filterFunc):t;e(i)}else t.load_contacts(!0,(t=>{if(t){const i=t.contacts,a=this.filterFunc?i.filter(this.filterFunc):i;e(a)}}))}}IS.normalizeQuery=e=>e.trim().toLocaleLowerCase();const CS=({contact:e,size:t})=>{const i=e.name||e.email||"";let n=e.photo_url;e.type===a.ContactTypes.FB&&(n=`https://graph.facebook.com/${e.fb_id}/picture`);let r=a.getInitials(i);return n?te.default.createElement(a.Avatar,{size:t,src:n}):te.default.createElement(a.Avatar,{size:t,backgroundColor:a.avatarColorForUserIdentifier(r)},r)};CS.displayName="ContactAvatar";const AS={type:"expand",getKey:()=>"expand-importer"},MS=({contact:e,contactValidator:t,onDelete:i})=>{var n;const r=null==t?void 0:t(e),o={size:"small",onDelete:i,withIconLeft:e.photo_url?te.default.createElement(a.Avatar,{hasNoOutline:!0,size:"small",src:e.photo_url}):void 0,children:null!==(n=e.name)&&void 0!==n?n:e.email},s=(null==r?void 0:r.state)===a.ContactTokenState.warn?te.default.createElement(B.InputChip,Object.assign({},o,{isWarning:!0})):(null==r?void 0:r.state)===a.ContactTokenState.invalid?te.default.createElement(B.InputChip,Object.assign({},o,{isAlert:!0})):te.default.createElement(B.InputChip,Object.assign({},o));return(null==r?void 0:r.msg)?te.default.createElement(a.Tooltip,{title:r.msg},s):s};MS.displayName="ContactChip";const OS=([e,t])=>e+t,PS=({string:e,match:t})=>{if(!t||0===t.highlighted.length)return te.default.createElement(a.Text,null,e);const i=t.highlighted;return te.default.createElement(te.default.Fragment,null,i.map(((t,n)=>{const r=0===n?[0,0]:i[n-1];return te.default.createElement(te.default.Fragment,{key:n},te.default.createElement(a.Text,null,e.slice(OS(r),t[0])),te.default.createElement(a.Text,{isBold:!0},e.slice(t[0],OS(t))))})),e.slice(OS(i[i.length-1])))};PS.displayName="MatchedString";const xS=({contact:e})=>{const t=a.useIntl(),i={key:e.getKey(),value:e};return"expand"===e.type?te.default.createElement(B.Typeahead.Row,Object.assign({},i,{withTitle:t.formatMessage({id:"otWq6d",defaultMessage:"Import contacts"}),withLeftAccessory:te.default.createElement(a.UIIcon,{src:T.ImportContactsLine})})):"third-party"===e.type?te.default.createElement(B.Typeahead.Row,Object.assign({},i,{withTitle:a.ProfileServicesConstants.to_name(e.provider),withSubtitle:e.connected?t.formatMessage({id:"abwbjF",defaultMessage:"Connected"}):void 0,withLeftAccessory:te.default.createElement(a.UIIcon,{src:T.GoogleExternalLogo})})):te.default.createElement(B.Typeahead.Row,Object.assign({},i,{withTitle:te.default.createElement(PS,{string:e.name,match:e.nameMatch}),withSubtitle:e.email&&te.default.createElement(PS,{string:e.email,match:e.emailMatch}),withLeftAccessory:te.default.createElement(CS,{contact:e})}))};xS.displayName="ContactSuggestion";const DS=e=>e.email||e.getKey(),RS=e=>te.default.createElement(xS,{contact:e}),NS=(e,t)=>{let i=!1;const a=e.map((e=>{var a;if(!e.pending||!e.query)return e;const n=IS.normalizeQuery(e.query),r=null===(a=t[n])||void 0===a?void 0:a.find((t=>t.email===e.email));return i=i||!!r,null!=r?r:e}));return i?a:e},kS=new a.ProfileServicesLinkingHandler,LS=e=>{var{user:t,contactFilter:i,initialContacts:r,onContentsChange:o,contactValidator:s,onQueryChange:l,focusOnMount:c,showContactImport:d,maxContacts:u,contactsDataSourceFactory:_,resetTokenData:p}=e,g=n.__rest(e,["user","contactFilter","initialContacts","onContentsChange","contactValidator","onQueryChange","focusOnMount","showContactImport","maxContacts","contactsDataSourceFactory","resetTokenData"]);const f=te.default.useRef(null),m=te.default.useRef(null),[h,v]=te.default.useState([]),[S,E]=te.default.useState(null!=r?r:[]),[w,b]=te.default.useState(!1),[y,T]=te.default.useState(""),I=te.default.useRef(y),C=a.useIntl(),A=te.default.useMemo((()=>_?_(t,i):new IS(t,i)),[t,i]),M=te.default.useMemo((()=>d&&t?a.LinkedProfileServices.get_linked_profile_services_for_user(t.id):void 0),[d,t]);te.default.useEffect((()=>null==o?void 0:o(S)),[S]),te.default.useEffect((()=>{null==l||l(y),I.current=y}),[y]),te.default.useEffect((()=>{var e;c&&(null===(e=m.current)||void 0===e||e.focus())}),[]),te.default.useEffect((()=>{p&&S.length>0&&O([])}),[p]);const O=te.default.useCallback(((e,t="")=>{E(e),T(t)}),[]),P=te.default.useCallback(((e,t)=>O((t=>t.concat(e.split(/[, ]/).map((e=>e.trim())).filter((e=>!!e)).map(Tv.buildFromRawEmail))),t)),[O]);te.default.useEffect((()=>{const e=(e=>{const t=new Set(e.map(DS));return e=>e.filter((e=>!t.has(DS(e))))})(S);A.search(y,(t=>{v(e(t))}),(t=>{I.current===y&&v((i=>{const a=(e=>{const t=new Set(e.map(DS));return e=>e.filter((e=>!t.has(DS(e))))})(i);return i.concat(a(e(t)))}))}))}),[A,S,y]),te.default.useEffect((()=>{const e=S.reduce(((e,t)=>t.pending&&t.query?[...e,t.query]:e),[]);0!==e.length&&A.searchBatch(e,(e=>E((t=>NS(t,e)))),(e=>E((t=>NS(t,e)))))}),[S,A]);const x=te.default.useCallback((e=>{var i;"expand"===e.type?(b(!0),null===(i=m.current)||void 0===i||i.focus()):"third-party"===e.type?(((e,t,i)=>{if(t){if(!i.connected)return kS.auth_service_with_user(i.provider,t.id,a.ProfileServicesLinkingHandler.show_import_notifications);{const t=e.formatMessage({id:"6kb+zR",defaultMessage:"You're already connected to {service_name}"},{service_name:a.ProfileServicesConstants.to_name(i.provider)});a.Snackbar$1.fail(t)}}})(C,t,e),b(!1)):O((t=>t.concat(e)))}),[O,C,t]),D=te.default.useCallback((e=>O((t=>t.filter((t=>t.name!==e.name&&t.email!==e.email))))),[O]),R=te.default.useCallback((e=>{const t=e.currentTarget.value,i=Math.max(t.lastIndexOf(","),t.lastIndexOf(" "));if(i>0){const e=i+1,a=t.slice(0,e),n=e<t.length?t.slice(e):"";P(a,n)}else T(t)}),[P]),N=te.default.useCallback((e=>{e.key===a.Key_enum.Key.Backspace&&""===y&&S.length>0?(O((e=>e.slice(0,-1))),e.stopPropagation()):e.key!==a.Key_enum.Key.Enter&&" "!==e.key||""===y||(P(y),e.stopPropagation())}),[P,O,y,S.length]),k=w&&M?(e=>a.ProfileServicesConstants.importable_contact_services().map((t=>((e,t)=>({type:"third-party",provider:e,connected:t,getKey:()=>`third-party-import-${e}`}))(t,null==e?void 0:e.service_is_connected(t)))))(M):(null==M?void 0:M.has_unconnected_services(!0))?[...h,AS]:h;return te.default.createElement(B.Typeahead.Wrapper,{onSelection:x,closeOnSelection:!1},(({getTriggerProps:e,getContentProps:t})=>te.default.createElement(te.default.Fragment,null,te.default.createElement(a.TextInput.Container,{ref:f},te.default.createElement(a.TextInput.Accessory,null,te.default.createElement(a.UIIcon,{src:L.SearchLine,role:"presentation"})),te.default.createElement(a.TextInput.ChipsContainer,null,!!S.length&&S.map(((e,t)=>te.default.createElement(MS,{key:t,contact:e,onDelete:()=>D(e),contactValidator:s}))),(void 0===u||S.length<u)&&te.default.createElement(a.TextInput.Input,Object.assign({"aria-label":C.formatMessage({id:"sZaLAU",defaultMessage:"Contact input"})},g,{ref:m,value:y},e({onChange:R,onKeyDown:N}))))),te.default.createElement(B.Typeahead.Container,Object.assign({},t(),{triggerRef:f}),te.default.createElement(B.Typeahead.Results,{results:k,renderRow:RS})))))};LS.displayName="ContactsTokenizerV2";const FS=o.Viewer.get_viewer();function US(e,t,i){var n;const r=e.email;let o;if(e.invalid)o={state:a.ContactTokenState.invalid,msg:l.intl.formatMessage({id:"iWy49e",defaultMessage:"{email} is not a valid email address."},{email:r})};else if(e.on_team)o={state:a.ContactTokenState.invalid,msg:l.intl.formatMessage({id:"w6S6LE",defaultMessage:"User is already a member of this team."})};else{const e=t.getEmailCheckResult(r);let s;if(e)if(e.inFlight)o={state:a.ContactTokenState.pending,msg:s};else if(e.canInvite){if(o={state:a.ContactTokenState.ok,msg:s},i){const e=null===(n=r.match(/@(.*)$/))||void 0===n?void 0:n[1];e&&!i.includes(e)&&(o={state:a.ContactTokenState.warn,msg:l.intl.formatMessage({id:"LuEFa+",defaultMessage:"Only approved emails are automatically approved"})})}}else"team_member"===e.reason?s=l.intl.formatMessage({id:"/bTRGP",defaultMessage:"This person is already on another team."}):"already_on_this_team"===e.reason?s=l.intl.formatMessage({id:"gUZ177",defaultMessage:"User is already invited to this team."}):"error"===e.reason&&(s=l.intl.formatMessage({id:"I1RVgD",defaultMessage:"User isn’t eligible to join this team."})),o={state:a.ContactTokenState.invalid,msg:s};else o={state:a.ContactTokenState.invalid,msg:s}}return o}const VS=a.requireCssWithComponent((function({open:e,onClose:i,user:n,numAvailableLicenses:r,source:s,membersSendInviteDomainRestrictionEnabled:c=!1,teamBusinessDomains:d=[],isSuggestionMode:u,prepopulatedEmails:_=[]}){const[p,g]=te.default.useState(!1),[f,m]=te.default.useState(null),[h,v]=te.default.useState([]),[S,E]=te.default.useState(!1),w=te.default.useMemo((()=>new Pv("/team/manage/check_can_invite")),[]),[b,y]=te.default.useState(),[T,I]=te.default.useState(),[C,A]=te.default.useState(_?_.map((e=>Tv.buildFromRawEmail(e))):[]),[M,O]=te.default.useState(C),[P,x]=te.default.useState(""),D=c&&d.length>0,R=D?d:null;if(!u&&void 0===r)throw new Error("numAvailableLicenses is required in invite mode");const N=te.default.useCallback((e=>!(e.type!==a.ContactTypes.EMAIL||e.team||!e.name||e.email===n.email)),[n]),k=te.default.useCallback((()=>{const e=[a.ContactTokenState.ok,a.ContactTokenState.warn];return 0===M.length||M.every((t=>e.includes(US(t,w,R).state)))}),[R,w,M]),L=te.default.useCallback(((e,t)=>{const i=e.filter((e=>e.type===a.ContactTypes.EMAIL&&!e.invalid&&!e.on_team)),n=i.map((e=>e.email));w.checkEmails(n,(()=>{t(i)}))}),[w]),F=te.default.useCallback((e=>{L(M,(t=>{const i=t.map((e=>e.email));e({emails:i})}))}),[L,M]),U=te.default.useCallback((()=>{p||F((({emails:e})=>{if(!k())return;const n=e=>{A([]),i(e)};g(!0),u?function(e,t,i,n){a.WebRequest({url:"/team/manage/suggest-members",data:{emails:e,url:a.get_href(),source:i},subject_user:o.mustGetActiveUserId(),complete:()=>n(!1),success:()=>(j.Notify.success(l.intl.formatMessage({id:"lMqVLz",defaultMessage:"{num_suggested, plural, one {Thanks for your suggestion! We’ve sent it to the team admin.} other {Thanks for your suggestions! We’ve sent them to the team admin.}}"},{num_suggested:e.length})),t())})}(e,n,s,g):function(e,i,n,r,o,s,c){a.TeamsWebActionsLogger.log("invite_member_open_invite_click",{source:r,member_invite_on:!0,invite_count:e.length});const d={emails:e,team_id:FS.team_id,invite_source:t.InviteSource.MEMBER_INVITE,poll_events_on_commit:!1,extra:JSON.stringify({member_send_invite_experiment_enabled:!0,origin:r})},u=Array.isArray(e);i<(u?e.length:1)&&(d.charge_for_new_licenses=!0);a.WebRequest({url:"/account/team/add_users",subject_user:FS.work_user,data:d,complete:()=>o(!1),success:t=>{t=JSON.parse(t);const i=Object.values(t.users),a=t.num_suggested||0;if(i.length>0||a>0){if(0!==a)return a>0&&i.length>0?(j.Notify.success(`${l.intl.formatMessage({id:"SX0gpY",defaultMessage:"{num_invites, plural, one {Invited # person} other {Invited # people}}."},{num_invites:i.length})} ${l.intl.formatMessage({id:"lbndFp",defaultMessage:"{num_suggested, plural, one {# invite sent to admin} other {# invites sent to admin}}."},{num_suggested:a})}`),c(e.filter((e=>!i.map((e=>e.email)).includes(e)))),s({num_invited:i.length,invitedUsers:i})):(c(e),s({num_invited:0}));j.Notify.success(l.intl.formatMessage({id:"axSi6e",defaultMessage:"{num_invited, plural, one {Invited.} other {Invited # people.}}"},{num_invited:i.length}))}else j.Notify.error(l.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}));return n({num_invited:i.length,invitedUsers:i})},error:e=>("rate-limit"===e.getResponseHeader("x-dropbox-app-error")?j.Notify.error(new j.HTML(l.intl.formatMessage({id:"hQ0rRo",defaultMessage:"{team_name} has reached the maximum number of team members allowed on Dropbox Basic. Please <a>contact sales</a> to add more members to your team."},{team_name:FS.team_name,a:e=>`<a href="/business/contact">${e}</a>`}))):(a.TeamsWebActionsLogger.log("invite_member_open_invite_error",{source:r,member_invite_on:!0,client:!0}),j.Notify.error(l.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))),n({num_invited:0}))})}(e,r,n,s,g,m,v)}))}),[k,F,u,r,i,s,p]),V=te.default.useCallback((e=>{let t,i,n=!0;for(const r of e){const{state:e,msg:o}=US(r,w,R);e!==a.ContactTokenState.ok&&(e===a.ContactTokenState.warn?i=null!=i?i:o:(t=null!=t?t:o,n=!1))}I(i),y(t),E(n)}),[R,w]),B=te.default.useCallback((e=>{O(e),L(e,(()=>{V(e)}))}),[L,V]),H=te.default.useCallback((e=>US(e,w,R)),[R,w]);if(f){const t=()=>{A([]),m(null),v([]),y(void 0),I(void 0),i(f)};return te.default.createElement(a.Modal,{open:e,withCloseButton:l.intl.formatMessage({id:"a2rDhR",defaultMessage:"Close"}),onRequestClose:t,className:"suggestion-fallback-modal"},te.default.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},te.default.createElement(a.Title,null,l.intl.formatMessage({id:"qn5twm",defaultMessage:"Member requests were sent to the admin"}))),te.default.createElement(a.Modal.Body,{hasVerticalSpacing:!1},te.default.createElement("ul",null,h.map((e=>te.default.createElement("li",{key:e},e))))),te.default.createElement(a.Modal.Footer,null,te.default.createElement(a.Button,{variant:"primary",onClick:t},l.intl.formatMessage({id:"MNcs5F",defaultMessage:"Got it"}))))}const K=()=>{p||(y(void 0),I(void 0),A([]),i())},z=d.map((e=>`@${e}`)),W=l.intl.formatMessage({id:"GoJlu1",defaultMessage:"name"});let G="";if(D)switch(z.length){case 1:G=l.intl.formatMessage({id:"m6/l0s",defaultMessage:"Add any email that ends in {oneDomain}"},{oneDomain:z[0]});break;case 2:G=l.intl.formatMessage({id:"xw8mQ6",defaultMessage:"Add any email that ends in {firstDomain} or {secondDomain}"},{firstDomain:z[0],secondDomain:z[1]});break;default:G=l.intl.formatMessage({id:"7aBsbD",defaultMessage:"Add any email that ends in {headDomains} or {lastDomain}"},{headDomains:z.slice(0,z.length-1).join(", ")+",",lastDomain:z[z.length-1]})}function q(e,t){const i="invite-validation-message";let n=i,r=a.FailLine;switch(e){case"warn":r=a.WarningLine,n=a.cx(n,`${i}__non-admin-invite-modal-warn-extensions`);break;case"error":n=a.cx(n,`${i}__non-admin-invite-modal-error-extensions`)}return te.default.createElement("div",{className:n},te.default.createElement(a.UIIcon,{size:"small",src:r,className:`${i}__icon`}),te.default.createElement(a.Text,{size:"small",color:"inherit"},t))}return te.default.createElement(l.Provider,{value:l.intl},te.default.createElement(a.Modal,{open:e,withCloseButton:l.intl.formatMessage({id:"62wFTu",defaultMessage:"Cancel"}),onRequestClose:K,className:"non-admin-invite-modal"},te.default.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},te.default.createElement(a.Title,null,u?l.intl.formatMessage({id:"YF+G2c",defaultMessage:"Request Invite"}):l.intl.formatMessage({id:"veD/Im",defaultMessage:"Invite people to {team_name}"},{team_name:FS.team_name}))),te.default.createElement(a.Modal.Body,{hasVerticalSpacing:!1},D&&te.default.createElement("div",{className:"non-admin-invite-modal-team-business-domains"},G),te.default.createElement(LS,{user:n,placeholder:z.length>0?z.map((e=>`${W}${e}`)).join(", "):l.intl.formatMessage({id:"w5JCcS",defaultMessage:"Add an email"}),onContentsChange:B,onQueryChange:x,focusOnMount:!0,initialContacts:C,contactValidator:H,contactFilter:N,disabled:p}),b&&q("error",b),T&&q("warn",T)),te.default.createElement(a.Modal.Footer,null,te.default.createElement(a.Button,{disabled:p,variant:"opacity",onClick:K,"data-testid":"cancel-button"},l.intl.formatMessage({id:"62wFTu",defaultMessage:"Cancel"})),te.default.createElement(a.Button,{variant:"primary",disabled:!S||!!P,onClick:U,"data-testid":"submit-button"},p?te.default.createElement(a.Spinner,{inverse:!0,size:"small"}):l.intl.formatMessage({id:"rPSCOl",defaultMessage:"Invite to join"})))))}),["/static/metaserver/static/css/react/contacts_tokenizer-vfl1FG5b4.css","/static/metaserver/static/css/teams/let_members_invite-vflJ--Znu.css"]);const jS=e=>e.isActive?l.intl.formatMessage({id:"EhtH9U",defaultMessage:"Viewing now"}):null!=e.whenLastSeen?function(e){const t=a.ago(1e3*e.whenLastSeen,!1);return l.intl.formatMessage({id:"03+wm0",defaultMessage:"Viewed {timeAgo}"},{timeAgo:t})}(e):function(e){switch(e){case"owner":return l.intl.formatMessage({id:"/i1m6q",defaultMessage:"Owner"});case"writer":return l.intl.formatMessage({id:"yH9Gqv",defaultMessage:"Can edit"});case"reader":return l.intl.formatMessage({id:"y7bSVp",defaultMessage:"Can comment"});case"reader_no_comment":case void 0:return l.intl.formatMessage({id:"Xoza1y",defaultMessage:"Can view"})}}(e.accessLevel),BS=a.defineMessage({id:"cIE9zv",defaultMessage:"Outside {teamname}"}),HS=l.intl.formatMessage({id:"L3BzP5",defaultMessage:"Invite to team"}),KS=l.intl.formatMessage({id:"XfAovr",defaultMessage:"Join team"}),zS=a.defineMessage({id:"qRTK38",defaultMessage:"Member of {teamname}"}),WS=l.intl.formatMessage({id:"DOjvpK",defaultMessage:"Sending request..."}),GS=l.intl.formatMessage({id:"FomW4x",defaultMessage:"Request sent"}),qS=l.intl.formatMessage({id:"Q6HGJm",defaultMessage:"Joined"}),QS={};QS[a.EventTypes.PASS_SHOWN]="pass_shown",QS[a.EventTypes.PASS_HOVER]="pass_hover",QS[a.EventTypes.PASS_CLICK]="pass_click";const YS=new class{constructor(){this.eventToHandlerStack={};for(const e of[a.EventTypes.PASS_SHOWN,a.EventTypes.PASS_HOVER,a.EventTypes.PASS_CLICK])this.eventToHandlerStack[e]=[]}_log(e,t,i,n,r){const o=t?"BROWSE_FILE_FACEPILE":"PREVIEW_PAGE_FACEPILE";let s={};t||r&&(n.pass_session_id=r,s=lh.get(r));const l=new Date,c={event_name:QS[e],file_ns_id:i.ns_id,file_sjid:i.sjid,origin:o,product_surface:t?"browse":"file_preview",extra:JSON.stringify(n),action_timestamps:JSON.stringify(s),client_ts:l.getTime()/1e3};a.SilentBackgroundRequest({url:"/log/pass_facepile",data:c})}listenTo(e){this._unlistenToTopOfHandlersStack(e),this._pushHandlers(),this._listenToTopOfHandlersStack(e)}unlistenTo(e){this._unlistenToTopOfHandlersStack(e),this._popHandlers(),this._listenToTopOfHandlersStack(e)}_unlistenToTopOfHandlersStack(e){for(const t in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(t)){if(0===this.eventToHandlerStack[t].length)continue;const i=this.eventToHandlerStack[t].slice(-1)[0];e.removeListener(t,i)}}_listenToTopOfHandlersStack(e){for(const t in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(t)){if(0===this.eventToHandlerStack[t].length)continue;const i=this.eventToHandlerStack[t].slice(-1)[0];e.addListener(t,i)}}_pushHandlers(){for(const e in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(e)){const t=this._createHandlerFn(e);this.eventToHandlerStack[e].push(t)}}_popHandlers(){for(const e in this.eventToHandlerStack)this.eventToHandlerStack.hasOwnProperty(e)&&this.eventToHandlerStack[e].pop()}_createHandlerFn(e){return(t,i,a,n)=>{this._log(e,t,i,{num_accessors:a.numAccessors,num_current_viewers:a.numCurrentViewers,num_viewers:a.numViewers,num_guests:a.numGuests,num_in_team_editors:a.numInTeamEditors,num_in_team_viewers:a.numInTeamViewers,num_non_team_editors:a.numNonTeamEditors,num_non_team_viewers:a.numNonTeamViewers,can_see_viewer_history:a.canSeeViewerHistory},n)}}};function $S(e,t,i){const n={filename:a.getFilename(e),isFolder:e.is_dir,nsId:e.ns_id,origin:i,sjid:e.sjid,url:t||void 0,fqPath:""};return a.isBrowseFile(e)&&(n.fqPath=e.fq_path),null!=e.file_id&&(n.fileId=e.file_id),n}function ZS(t,i,a,n){new Promise((function(t,i){e(["./c_sharing_share_modal_util"],t,i)})).then((function(e){return e.share_modal_util_esnext})).then((e=>{const r=$S(t,a,n.origin);e.showShareModal(i,r,n)}))}var XS=Object.freeze({__proto__:null,getDataForContentInfo:$S,share:ZS});a.injectInternalStyle("/static/typescript/component_libraries/deep-integrations/src/text/index.module.out-vfljqQx1L.css",(e=>':root{--font_stack:"Atlas Grotesk",atlasgrotesk,sans-serif;--color_text_default:#1d2737;--color_blue:#0070e0;--color_text_subtext:#717781;--color_white:#fff;--color_sapphire_100:#0d2484}._int-text_oeogm_11{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--font_stack);overflow:visible;text-overflow:clip}._color-text_oeogm_20{color:var(--color_text_default)}._color-primary_oeogm_24{color:var(--color_blue)}._color-text-secondary_oeogm_28,._color-text-secondary-hover_oeogm_32{color:var(--color_text_subtext)}._color-text-inverted_oeogm_36{color:var(--color_white)}._color-inherit_oeogm_40{color:inherit}._color-highlighted_oeogm_44{color:var(--color_sapphire_100)}._color-dig-base_oeogm_48{color:var(--color__inverse__standard__text)}._color-dig-subtle_oeogm_52{color:var(--color__inverse__faint__text)}._ellipsis_oeogm_57{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}._font-weight-normal_oeogm_65{font-weight:400}._font-weight-medium_oeogm_69{font-weight:500}._font-weight-bold_oeogm_73{font-weight:700}._font-weight-inherit_oeogm_77{font-weight:inherit}._size-xsmall_oeogm_82{font-size:10px;line-height:12px}._size-small_oeogm_87{font-size:12px;line-height:16px}._size-medium_oeogm_92{font-size:14px;line-height:17px}._size-large_oeogm_97{font-size:16px;line-height:24px}._size-xlarge_oeogm_102{font-size:18px;line-height:24px}._size-xxlarge_oeogm_107{font-size:24px;line-height:29px}._size-xxxlarge_oeogm_112{font-size:40px;line-height:46px}._size-inherit_oeogm_117{font-size:inherit;line-height:inherit}._text-align-left_oeogm_123{text-align:left}._text-align-center_oeogm_127{text-align:center}._text-align-right_oeogm_131{text-align:right}._white-space-normal_oeogm_136{white-space:normal}._white-space-nowrap_oeogm_140{white-space:nowrap}._white-space-pre_oeogm_144{white-space:pre}._word-break-normal_oeogm_149{word-break:normal}._word-break-break-word_oeogm_153{word-break:break-word}._ellipsis-container_oeogm_158{display:inline-flex;min-width:0;overflow:hidden}._ellipsis_oeogm_57{min-width:0}._no-ellipsis_oeogm_168{flex-shrink:0}'));const JS={intText:"_int-text_oeogm_11",colorText:"_color-text_oeogm_20",colorPrimary:"_color-primary_oeogm_24",colorTextSecondary:"_color-text-secondary_oeogm_28",colorTextSecondaryHover:"_color-text-secondary-hover_oeogm_32",colorTextInverted:"_color-text-inverted_oeogm_36",colorInherit:"_color-inherit_oeogm_40",colorHighlighted:"_color-highlighted_oeogm_44",colorDigBase:"_color-dig-base_oeogm_48",colorDigSubtle:"_color-dig-subtle_oeogm_52",ellipsis:"_ellipsis_oeogm_57",fontWeightNormal:"_font-weight-normal_oeogm_65",fontWeightMedium:"_font-weight-medium_oeogm_69",fontWeightBold:"_font-weight-bold_oeogm_73",fontWeightInherit:"_font-weight-inherit_oeogm_77",sizeXsmall:"_size-xsmall_oeogm_82",sizeSmall:"_size-small_oeogm_87",sizeMedium:"_size-medium_oeogm_92",sizeLarge:"_size-large_oeogm_97",sizeXlarge:"_size-xlarge_oeogm_102",sizeXxlarge:"_size-xxlarge_oeogm_107",sizeXxxlarge:"_size-xxxlarge_oeogm_112",sizeInherit:"_size-inherit_oeogm_117",textAlignLeft:"_text-align-left_oeogm_123",textAlignCenter:"_text-align-center_oeogm_127",textAlignRight:"_text-align-right_oeogm_131",whiteSpaceNormal:"_white-space-normal_oeogm_136",whiteSpaceNowrap:"_white-space-nowrap_oeogm_140",whiteSpacePre:"_white-space-pre_oeogm_144",wordBreakNormal:"_word-break-normal_oeogm_149",wordBreakBreakWord:"_word-break-break-word_oeogm_153",ellipsisContainer:"_ellipsis-container_oeogm_158",noEllipsis:"_no-ellipsis_oeogm_168"},eE={text:JS.colorText,primary:JS.colorPrimary,"text-secondary":JS.colorTextSecondary,"text-secondary-hover":JS.colorTextSecondaryHover,"text-inverted":JS.colorTextInverted,inherit:JS.colorInherit,highlighted:JS.colorHighlighted,"dig-base":JS.colorDigBase,"dig-subtle":JS.colorDigSubtle},tE={normal:JS.fontWeightNormal,medium:JS.fontWeightMedium,bold:JS.fontWeightBold,inherit:JS.fontWeightInherit},iE={xsmall:JS.sizeXsmall,small:JS.sizeSmall,medium:JS.sizeMedium,large:JS.sizeLarge,xlarge:JS.sizeXlarge,xxlarge:JS.sizeXxlarge,xxxlarge:JS.sizeXxxlarge,inherit:JS.sizeInherit},aE={left:JS.textAlignLeft,center:JS.textAlignCenter,right:JS.textAlignRight};class nE extends te.Component{render(){const e=!!this.props.whiteSpace&&JS.whiteSpacePre||this.props.ellipsis&&JS.whiteSpaceNowrap||JS.whiteSpaceNormal;return te.createElement("span",{className:a.cx(JS.intText,eE[this.props.color],this.props.ellipsis?JS.ellipsis:void 0,tE[this.props.fontWeight],iE[this.props.size],aE[this.props.textAlign],e,this.props.wordBreak?JS.wordBreakBreakWord:JS.wordBreakNormal,this.props.className)},this.props.children)}}nE.defaultProps={color:"text",ellipsis:!1,fontWeight:"normal",size:"medium",textAlign:"left"},nE.displayName="Text";const rE=JSON.parse('\n    {"additional-license":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<path d=\\"M14.186 17.104h2.674v-1.428h-2.674v-2.702H12.66v2.702H10v1.428h2.66v2.73h1.526v-2.73zm6.244 4.298h1.89V11h-1.652c0 .658-.168 1.106-.49 1.4-.35.308-.868.462-1.512.462h-.28v1.232h2.044v7.308z\\" fill=\\"#0070E0\\" fill-rule=\\"evenodd\\"></path>"},"alert":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><path d=\\"M16 32C7.163 32 0 24.837 0 16S7.163 0 16 0s16 7.163 16 16-7.163 16-16 16zm-1.137-21.691l.185 8.49h1.775l.176-8.49h-2.136zm1.081 12.884c.405 0 .73-.12.976-.36s.37-.557.37-.95c0-.398-.124-.717-.37-.957s-.571-.36-.976-.36c-.41 0-.74.12-.988.36-.25.24-.374.56-.374.958 0 .392.125.709.374.949s.578.36.988.36z\\" fill=\\"#FFC726\\"></path><circle stroke=\\"#E4AB0A\\" cx=\\"16\\" cy=\\"16\\" r=\\"15.5\\"></circle></g>"},"company":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><path d=\\"M15 10v13H9V10h6zm.5-2c.8 0 1.5.7 1.5 1.5v14c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5v-14C7 8.7 7.7 8 8.5 8h7z\\" fill=\\"#0070E0\\"></path><path d=\\"M23 17v6h-6v-6h6zm.5-2c.8 0 1.5.7 1.5 1.5v7c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5V15h8.5z\\" fill=\\"#0070E0\\"></path><path d=\\"M11 13h2v2h-2v-2zm0 3h2v2h-2v-2zm0 3h2v2h-2v-2zm8 0h2v2h-2v-2z\\" fill=\\"#99C6F3\\" fill-rule=\\"nonzero\\"></path></g>"},"personal-account":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><path fill=\\"#99C6F3\\" d=\\"M19 9h3v6l-3-3z\\"></path><path d=\\"M16.707 8.707l8.485 8.485-1.414 1.415L16 10.828l-7.778 7.779-1.414-1.415L16 8l.707.707z\\" fill=\\"#0070E0\\"></path><path fill=\\"#99C6F3\\" d=\\"M15 17h2v4h-2z\\"></path><path d=\\"M10 14h12v7.494c0 .832-.68 1.506-1.496 1.506h-9.008A1.502 1.502 0 0 1 10 21.494V14zm2 0v7h8v-7h-8z\\" fill=\\"#0070E0\\"></path></g>"}}\n  '),oE=e=>{const{name:t}=e,i=te.createElement(z.SvgIconBundle,{focusable:"false",icon:rE[t]});return te.createElement(z.Component,Object.assign({icon:i},e))};oE.displayName="IconAdminsymbol";a.injectInternalStyle("/static/typescript/component_libraries/deep-integrations/src/profile_card/sections/team_expand_section.module.out-vfl2ZQCDC.css",(e=>"._profile-card-team-expand-section_18gvt_1{align-items:center;padding:0 16px 16px}._primary-text-wrapper_18gvt_6{display:flex;min-height:40px}._primary-text_18gvt_6{align-self:center;padding-bottom:8px;padding-top:16px}._text-area_18gvt_17{display:flex;flex-direction:column}._reasons-line_18gvt_22{padding-top:3px}._reasons-wrapper_18gvt_26{color:var(--dig-color__text__subtle);margin:0;padding:0 0 4px 16px}._button-wrapper_18gvt_32{padding-top:8px}._expand-button_18gvt_36{width:100%}._area-icon_18gvt_40{padding-top:5px}"));const sE="_profile-card-team-expand-section_18gvt_1",lE="_primary-text-wrapper_18gvt_6",cE="_primary-text_18gvt_6",dE="_text-area_18gvt_17",uE="_reasons-line_18gvt_22",_E="_reasons-wrapper_18gvt_26",pE="_button-wrapper_18gvt_32",gE="_expand-button_18gvt_36",fE="_area-icon_18gvt_40";class mE extends te.Component{constructor(){super(...arguments),this.handleButtonClick=()=>{this.props.teamExpandButtonHandler()}}render(){const{teamExpandButtonText:e,teamExpandPrimaryText:t,showCompanyIcon:i,teamExpandReasonsText:n,isTeamExpandButtonDisabled:r}=this.props,o=i?te.createElement(K.ColorizedIcon,{color:"#717781"},te.createElement(oE,{name:"company"})):void 0,s=n&&n.length>0?te.createElement("ul",{className:_E},n.map(((e,t)=>te.createElement("li",{className:uE,key:t},te.createElement(nE,{fontWeight:"normal",size:"small",color:"text-secondary"},e))))):void 0;return te.createElement("div",{className:sE},te.createElement("div",{className:dE},te.createElement("div",{className:lE},te.createElement("div",{className:fE},o),te.createElement("div",{className:cE},te.createElement(nE,{fontWeight:"medium",size:"small",color:"text-secondary"},t))),s),te.createElement("div",{className:pE},te.createElement(a.Button,{onClick:this.handleButtonClick,className:gE,variant:"primary",title:e,disabled:r},e)))}}mE.displayName="TeamExpandSection";let hE=class extends te.Component{constructor(){super(...arguments),this.state={hasError:!1}}render(){return this.state.hasError?te.createElement("div",null):te.createElement("div",null,this.props.children)}componentDidCatch(e,t){this.handleError(e,t)}handleError(e,t){const{reportError:i,notify:a,intl:n}=this.props;this.setState({hasError:!0}),i(e,"critical",[],t),a.showError(n.formatMessage({id:"0N4KvM",defaultMessage:"Oops, something went wrong."}))}};hE.displayName="ErrorBoundary";const vE=(e,t)=>i=>{e(Object.assign(Object.assign(Object.assign({},t),i),{extra:Object.assign(Object.assign({},t.extra),i.extra)}))};function SE(e){const t={};if(e.serviceList)for(const i of e.serviceList)t[`${i.service_type[".tag"]}_connection_state`]=i.connection_state[".tag"],t[`${i.service_type[".tag"]}_availability`]=i.service_availability[".tag"];if(e.featureGates)if(e.featureGates instanceof Array)for(const i of e.featureGates)t[`feature_gate_${i.feature}_available`]=String("available"===i.available[".tag"]);else for(const i of Object.keys(e.featureGates))t[`feature_gate_${i}_available`]=String(e.featureGates[i]);if(e.userSettings){for(const i of e.userSettings.dismissed_prompts)t[`is_${i[".tag"]}_prompt_dismissed`]="true";for(const i of e.userSettings.preferred_services)t[`preferred_${i.permission_type[".tag"]}_service`]=i.service_type[".tag"]}return t}function EE(e,t){return function(e,t){return vE(e,{extra:t})}(e,SE(t))}var wE,bE,yE,TE,IE,CE,AE;function ME(e,t){return function(i,a,n={},r={}){let{featureName:o,serviceType:s,extra:l={}}=n;return function(...n){return r.toExtraDict&&(l=r.toExtraDict(l,...n)),r.toServiceType&&(s=r.toServiceType(...n)||s),e({event_name:i,feature_name:o||t,service_type:s,extra:l}),a?a(...n):void 0}}}function OE(e,i,a,n={},r={}){return e(t.InstrEventType.UserClick,a,n,Object.assign(Object.assign({},r),{toExtraDict(e){const t=r.toExtraDict?r.toExtraDict(e):e;return Object.assign(Object.assign({},t),{action:i})}}))}t.InstrFeatureType=void 0,(wE=t.InstrFeatureType||(t.InstrFeatureType={})).ConnectedApps="connected_apps",wE.ConnectedServices="connected_apps.connected_services",wE.ZoomSettings="connected_apps.zoom_settings",wE.SlackSettings="connected_apps.slack_settings",wE.MultiAccountSettings="connected_apps.multi_account_settings",wE.ProfileCard="profile_card",wE.CalendarSection="profile_card.calendar_section",wE.ChatSection="profile_card.chat_section",wE.FileLinkTokenInChatSection="profile_card.chat_section.file_link_token",wE.AppStoreLite="app_store_lite",wE.SendToSlack="send_to_slack",wE.PresentToZoom="present_to_zoom",wE.ShareToTrello="share_to_trello",wE.ShareToTrelloCardDetails="share_to_trello.card_details",wE.SignaturesTabOnShare="bt_signatures_tab_on_share",wE.TosWithRecipientsInfo="bt_hs_tos_modal_redesign",wE.SignaturesHub="bt_signatures_hub",wE.TeamAdminSettings="team_admin_settings",wE.TrelloPreview="trello_powerup.file_preview",wE.TrelloFileAttachments="trello_powerup.file_attachments",wE.TrelloFolderAttachments="trello_powerup.folder_attachments",wE.TrelloOAuth="trello_powerup.oauth",wE.TrelloSharedLinkFolderEntries="trello_powerup.shared_link_folder_entries",wE.TrelloSharedLinkMetadata="trello_powerup.shared_link_metadata",wE.TrelloLinkUnfurl="trello_powerup.link_unfurl",wE.TrelloActivityFeed="trello_activity_feed",wE.ZoomFileViewerExtension="zoom_file_viewer_extension",wE.ZoomFileViewerExtensionHomeView="zoom_file_viewer_extension.home_view",wE.ZoomFileViewerExtensionCreateMeetingView="zoom_file_viewer_extension.create_meeting_view",wE.ZoomFileViewerExtensionMeetingDetailView="zoom_file_viewer_extension.meeting_detail_view",wE.ZoomFileViewerExtensionUnlinkedView="zoom_file_viewer_extension.unlinked_view",wE.ZoomFileViewerExtensionErrorView="zoom_file_viewer_extension.error_view",wE.HelloSignDeepIntegrationTOS="hellosign_deep_integration_tos",wE.HelloSignDeepIntegration="hellosign_deep_integration",wE.HelloSignDeepIntegrationSafariFixDisabled="hellosign_deep_integration_safari_fix_disabled",wE.IntegratedTasks="integrated_tasks",t.InstrEventType=void 0,(bE=t.InstrEventType||(t.InstrEventType={})).UserClick="user_click",bE.UserInput="user_input",bE.RenderedFeature="rendered_feature",bE.ManualRenderedFeature="manual_rendered_feature",bE.ServiceConnectionFlowStart="service_connection_flow_start",bE.ServiceConnectionFlowEnd="service_connection_flow_end",bE.Success="success",bE.Retry="retry",bE.Failure="failure",bE.MakeZoomMeetingComplete="make_zoom_meeting_complete",bE.SendMessageComplete="send_message_complete",bE.TeamAdminSaveComplete="team_admin_save_complete",bE.ReceivedUserSetting="received_user_setting",bE.SelectAction="select_action",bE.UpdateFile="update_file",bE.SendForSignatureComplete="send_for_signature_complete",bE.SelfSignComplete="self_sign_complete",bE.CreateOrEditTemplateComplete="create_or_edit_template_complete",bE.UseTemplateComplete="use_template_complete",bE.ActionTaken="action_taken",bE.APITrace="api_trace",t.InstrActionType=void 0,(yE=t.InstrActionType||(t.InstrActionType={})).DismissLastSentMessageNotification="dismiss_last_sent_message_notification",yE.OpenChatServiceProviders="open_chat_service_providers",yE.ChangeChatService="change_chat_service",yE.OpenManageApps="open_manage_apps",yE.CloseModal="close_modal",yE.DismissPrompt="dismiss_prompt",yE.OpenExternalLink="open_external_link",yE.MakeZoomMeeting="make_zoom_meeting",yE.ConnectService="connect_service",yE.ReconnectService="reconnect_service",yE.DisconnectService="disconnect_service",yE.DisconnectServiceAbort="disconnect_service_abort",yE.DisconnectServiceConfirm="disconnect_service_confirm",yE.ModifyServiceSettings="modify_service_settings",yE.ModifyServiceSettingsAbort="modify_service_settings_abort",yE.ModifyServiceSettingsConfirm="modify_service_settings_confirm",yE.OpenConnectCalendarDropdown="open_connect_calendar_dropdown",yE.DismissToast="dismiss_toast",yE.LearnMore="learn_more",yE.SendMessage="send_message",yE.CancelMessage="cancel_message",yE.Search="search",yE.ShareLink="share_link",yE.UndoShareLink="undo_share_link",yE.ErrorTryAgain="error_try_again",yE.PresentFile="present_file",yE.EnterMeetingId="enter_meeting_id",yE.LoadData="load_data",yE.TeamAdminUndo="team_admin_undo",yE.TeamAdminSave="team_admin_save",yE.TeamAdminDisableService="team_admin_disable_service",yE.TeamAdminEnableService="team_admin_enable_service",yE.CloseFileLinkToken="close_file_link_token",yE.PrefetchData="prefetch_data",yE.OpenZoomSideBar="open_zoom_side_bar",yE.ReopenZoomSideBar="reopen_zoom_side_bar",yE.SeeLessMeetings="see_less_meetings",yE.SeeAllMeetings="see_all_meetings",yE.SeeLessParticipants="see_less_participants",yE.SeeAllParticipants="see_all_participants",yE.SelectAllUsers="select_all_users",yE.ClearAllUsers="clear_all_users",yE.AddUser="add_user",yE.SelectUserSuggestion="select_user_suggestion",yE.PlayRecording="play_recording",yE.StartMeeting="start_meeting",yE.JointMeeting="join_meeting",yE.UpdateMeetingTitle="update_meeting_title",yE.CreateMeeting="create_meeting",yE.UpdatePmiSetting="update_pmi_setting",yE.OpenHelpCenter="open_help_center",yE.OpenAccountSetting="open_account_setting",yE.AcceptTOS="accept_tos",yE.StartFlow="start_flow",yE.CancelFlow="cancel_flow",yE.ChooseFile="choose_file",yE.TryDemo="try_demo",yE.Start="start",yE.FeatureDisabled="feature_disabled",yE.SafariUnsupported="safari_unsupported",yE.MSIEUnsupported="msie_unsupported",yE.DocToTemplateDisplayCreateTemplate="doc2template_display_create_template",yE.DocToTemplateLaunchCreateTemplate="doc2template_launch_create_template",yE.HSHomeOpenActionMenu="hshome_open_action_menu",yE.HSHomePreview="hshome_action_preview",yE.HSHomeDownload="hshome_action_download",yE.HSHomeLocate="hshome_action_locate",yE.HSHomeRemind="hshome_action_remind",yE.HSHomeCancel="hshome_action_cancel",yE.HSHomeActivateRequest="hshome_activate_request",yE.HSHomeActivateTabInProgress="hshome_activate_tab_in_progress",yE.HSHomeActivateTabCompleted="hshome_activate_tab_completed",yE.HSHomeSortByTitle="hshome_sort_by_title",yE.HSHomeSortBySigners="hshome_sort_by_signers",yE.HSHomeSortByDate="hshome_sort_by_date",yE.HSHomeSignNow="hshome_sign_now",yE.HSHomeGetInitialSignatureRequests="hshome_get_initial_signature_requests",yE.HSHomeGetSignatureRequests="hshome_get_signature_requests",yE.HSHomeGetTemplates="hshome_get_templates",yE.HSHomeGetTosStatus="hshome_get_tos_status",yE.HSHomeLaunchRequestSignature="hshome_launch_request_signature",yE.HSHomeLaunchCreateTemplate="hshome_launch_create_template",yE.HSHomeLaunchUseTemplate="hshome_launch_use_template",yE.HSHomeLaunchEditTemplate="hshome_launch_edit_template",yE.HSHomeDeleteTemplate="hshome_delete_template",yE.HSHomeTemplateQuotaReached="hshome_template_quota_reached",yE.HSHomeSmartSuggestionDisplayed="hshome_smart_suggestion_displayed",yE.HSHomeSmartSuggestionClicked="hshome_smart_suggestion_clicked",yE.HSHomeGetAccountInfo="hshome_get_account_info",yE.HSHomeSearchStart="hshome_search_start",yE.HSHomeSeePlansClicked="hshome_see_plans_clicked",yE.PrepSendLog="prep_send_log",yE.ViewTerms="view_terms",yE.ViewPrivacyPolicy="view_privacy_policy",yE.SharePageSignatureTabPreview="sharepage_signature_tab_action_preview",yE.SharePageSignatureTabDownload="sharepage_signature_tab_action_download",yE.SharePageSignatureTabRemind="sharepage_signature_tab_action_remind",yE.SharePageSignatureTabSign="sharepage_signature_tab_action_sign",yE.SharePageSignatureTabGetSignatureRequests="sharepage_signature_tab_get_signature_requests",yE.SharePageSignatureTabLaunchRequestSignature="sharepage_signature_tab_launch_request_signature",yE.SharePageSignatureTabSortByTitle="sharepage_signature_tab_sort_by_title",yE.SharePageSignatureTabSortByDate="sharepage_signature_tab_sort_by_date",yE.SharePageSignatureTabSortByStatus="sharepage_signature_tab_sort_by_status",yE.AddSigner="add_signer",yE.ToggleSelfSign="toggle_self_sign",yE.ContinueWithSignersModal="continue_with_signers_modal",yE.SignatureHubPreview="signature_hub_action_preview",yE.SignatureHubDownload="signature_hub_action_download",yE.SignatureHubDownloadIgnored="signature_hub_action_download_ignored",yE.SignatureHubRemind="signature_hub_action_remind",yE.SignatureHubSign="signature_hub_action_sign",yE.SignatureHubCancel="signature_hub_cancel",yE.SignatureHubGetSignatureRequests="signature_hub_get_signature_requests",yE.SignatureHubGetSignatureRequestsInitial="signature_hub_get_signature_requests_initial",yE.SignatureHubGetTemplates="signature_hub_get_templates",yE.SignatureHubGetTosStatus="signature_hub_get_tos_status",yE.SignatureHubGetAccountInfo="signature_hub_get_account_info",yE.SignatureHubCheckAllowedFeatures="signature_hub_check_allowed_features",yE.SignatureHubCheckApiTokenConditions="signature_hub_check_api_token_conditions",yE.SignatureHubLaunchRequestSignature="signature_hub_launch_request_signature",yE.SignatureHubSortByTitle="signature_hub_sort_by_title",yE.SignatureHubSortByDate="signature_hub_sort_by_date",yE.SignatureHubSortByStatus="signature_hub_sort_by_status",yE.SignatureHubUseTemplate="signature_hub_use_template",yE.SignatureHubEditTemplate="signature_hub_edit_template",yE.SignatureHubDeleteTemplate="signature_hub_delete_template",yE.SignatureHubCreateTemplate="signature_hub_create_template",yE.SignatureHubSenderFilter="signature_hub_sender_filter",yE.SetDefaultWorkspace="set_default_workspace",function(e){e.OpenMoreCalendarEvents="open_more_calendar_events",e.OpenCalendarEvent="open_calendar_event",e.OpenZoomConference="open_zoom_conference_link",e.OpenMailto="open_mailto",e.OpenMessageDeepLink="open_message_deep_link"}(TE||(TE={})),function(e){e.CalendarError="calendar_error",e.ZoomMakeMeeting="zoom_make_meeting",e.LastSentMessage="last_sent_message"}(IE||(IE={})),t.InstrConnectServiceFlowOutcome=void 0,(CE=t.InstrConnectServiceFlowOutcome||(t.InstrConnectServiceFlowOutcome={})).Connected="connected",CE.Disconnected="disconnected",CE.Abort="abort",CE.Error="error",function(e){e.Mounted="mounted",e.Loaded="loaded",e.Interactive="interactive",e.Updated="updated"}(AE||(AE={}));class PE{constructor(e){this.perfTimer=e,this.startMs=null,this.endMs=null,this.restart()}restart(){this.startMs=this.perfTimer.now(),this.endMs=null}mark(){return this.endMs=this.perfTimer.now(),this.endMs-this.startMs}duration(){return null===this.endMs?-1:this.endMs-this.startMs}}class xE extends te.Component{constructor(e){super(e),this.deltaMeasurementFrom="constructed",this.isDoneLoading=!1,this.isInteractive=!1,this.timer=new PE(e.performanceTimer)}componentDidMount(){this.arePropsLoaded(this.props)?this.logRenderedFeature(AE.Interactive):this.logRenderedFeature(AE.Mounted)}UNSAFE_componentWillReceiveProps(e){this.isDoneLoading||0===this.getAllAsyncProps(e).length||this.arePropsLoaded(e)&&this.logRenderedFeature(AE.Loaded,e)}componentDidUpdate(e){this.isDoneLoading&&!this.isInteractive&&this.logRenderedFeature(AE.Interactive)}getAllAsyncProps(e){const t=[];return e.criticalAsyncProps&&t.push(...e.criticalAsyncProps),e.nonCriticalAsyncProps&&t.push(...e.nonCriticalAsyncProps),t}arePropsLoaded(e){return this.getAllAsyncProps(e).reduce(((e,t)=>e&&!!t&&"pending"!==t.state),!0)}hadRejectedAsyncProp(e){return this.getAllAsyncProps(e).reduce(((e,t)=>t&&"rejected"===t.state||e),!1)}hadCriticalRejectedAsyncProp(e){return!!e.criticalAsyncProps&&e.criticalAsyncProps.reduce(((e,t)=>t&&"rejected"===t.state||e),!1)}logRenderedFeature(e,i){const a={};i||(i=this.props);const n=this.hadRejectedAsyncProp(i),r=this.hadCriticalRejectedAsyncProp(i);switch(e){case AE.Interactive:if(this.isInteractive)return;this.isInteractive=!0,this.isDoneLoading=!0,a.had_rejected_async_prop=String(n),a.was_successful=String(!r);break;case AE.Loaded:if(this.isDoneLoading)return;this.isDoneLoading=!0,a.had_rejected_async_prop=String(n),a.was_successful=String(!r)}this.props.logEvent({event_name:t.InstrEventType.RenderedFeature,extra:Object.assign(Object.assign({},a),{rendered_feature_stage:e,rendered_feature_delta_ms:String(this.timer.mark()),rendered_feature_delta_from:this.deltaMeasurementFrom})})}render(){return this.props.children}}xE.displayName="InstrFeatureComponent";a.injectInternalStyle("/static/typescript/component_libraries/deep-integrations/src/link/index.module.out-vflO2085W.css",(e=>":root{--color-stone:#d0d0d3;--color-stone-light:#6a7c8f;--color-stone-dark:#536170}._link_1h1pt_8,._link-button_1h1pt_17{background-color:transparent;border:none;cursor:pointer;outline:none;padding:0}._link-button_1h1pt_17{border-radius:4px;vertical-align:bottom}._link-button_1h1pt_17:focus{box-shadow:var(--token_boxshadow_focusring)}._link-button_1h1pt_17._color-sapphire_1h1pt_33{color:var(--color_sapphire_100)}._link-button_1h1pt_17._color-sapphire_1h1pt_33:hover{color:var(--color_sapphire_90)}._link-button_1h1pt_17._color-sapphire_1h1pt_33:active{color:var(--color_sapphire_110)}._link-button_1h1pt_17._color-text-secondary_1h1pt_45{color:var(--color-stone)}._link-button_1h1pt_17._color-text-secondary_1h1pt_45:hover{color:var(--color-stone-light)}._link-button_1h1pt_17._color-text-secondary_1h1pt_45:active{color:var(--color-stone-dark)}._link-button_1h1pt_17._disabled_1h1pt_57{cursor:default;opacity:.4}"));const DE={link:"_link_1h1pt_8",linkButton:"_link-button_1h1pt_17",colorSapphire:"_color-sapphire_1h1pt_33",colorTextSecondary:"_color-text-secondary_1h1pt_45",disabled:"_disabled_1h1pt_57"},RE=(e,t,i,a)=>{if(e.startsWith("/"))t(e);else if(e.startsWith("mailto:")){a({to:e.slice(7)})}else i(e)};function NE(e,t,i,a){return class extends te.Component{constructor(){super(...arguments),this.onClick=()=>{RE(this.props.href,e,t,i)}}render(){const{children:e,className:t,instrAction:i,instrDetails:n}=this.props,r=this.props["aria-label"];return te.createElement("button",{className:`${DE.link} ${t}`,role:"link","aria-label":r,onClick:OE(a,i,this.onClick,n)},e)}}}const kE={now:()=>Date.now()};a.injectInternalStyle("/static/typescript/component_libraries/deep-integrations/src/profile_card/sections/seen_state_section.module.out-vflUK_yZD.css",(e=>"._profile-card-seen-state-section_1i0xs_1{align-items:center;padding:12px 16px}._profile-intro_1i0xs_6{display:flex}._info-container_1i0xs_10{display:flex;flex-direction:column;margin-left:12px;min-width:0}._email-link_1i0xs_21,._seen-state_1i0xs_17{margin-top:4px}._email-link_1i0xs_21{color:var(--color_text_default);width:100%}._email-link_1i0xs_21:hover{color:var(--color_blue)}._block_1i0xs_31{display:block}._avatar-container_1i0xs_35>._avatar_1i0xs_35{font-size:var(--type__title__standard--fontsize);height:56px;width:56px}"));const LE="_profile-card-seen-state-section_1i0xs_1",FE="_profile-intro_1i0xs_6",UE="_info-container_1i0xs_10",VE="_email-link_1i0xs_21",jE="_seen-state_1i0xs_17",BE="_block_1i0xs_31",HE="_avatar-container_1i0xs_35",KE="_avatar_1i0xs_35";class zE extends te.Component{render(){const{seenState:e,avatarColor:i,isActive:n,initials:r,photoUrl:o,useGuestAvatar:s,targetUser:l,intl:c,Link:d}=this.props,u=s?{isGuest:!0}:{src:o,children:r},{email:_}=l;return te.createElement("div",{className:LE},te.createElement("div",{className:FE},te.createElement("div",{className:HE},te.createElement(a.Avatar,Object.assign({size:"large"},u,{backgroundColor:i,isInactive:!n,className:KE}))),te.createElement("div",{className:UE},te.createElement(nE,{color:"text",size:"medium",fontWeight:"medium",className:BE,ellipsis:!0},l.display_name),e&&e.trim().length>0?te.createElement(nE,{color:"text-secondary",size:"small",fontWeight:"normal",className:a.cx(BE,jE)},e):null,_?te.createElement(a.Tooltip,{title:c.formatMessage({id:"ctNPP6",defaultMessage:"Send Email"})},te.createElement(d,{href:`mailto:${_}`,"aria-label":c.formatMessage({id:"M5GM60",defaultMessage:"Send Email to {email}"},{email:_}),className:a.cx(BE,VE),instrAction:t.InstrActionType.OpenExternalLink,instrDetails:{extra:{external_link_reason:TE.OpenMailto}}},te.createElement(nE,{color:"text-secondary",size:"small",fontWeight:"normal",className:BE,ellipsis:!0},_))):null)))}}zE.displayName="SeenStateSection";a.injectInternalStyle("/static/typescript/component_libraries/deep-integrations/src/profile_card/profile_card.module.out-vflS1RfXp.css",(e=>"._profile-card-content_f2991_1{font-family:var(--font_stack);width:264px}._profile-card_f2991_1{background-color:#fff;border:1px solid #e6e8eb;border-radius:5px;box-shadow:0 8px 16px rgba(27,39,51,.08);text-align:left;white-space:nowrap}._section-container_f2991_19{border-bottom:1px solid #e8e8e8}._section-container_f2991_19:last-child{border-bottom:0}._profile-card-wrapper_f2991_30{display:flex;justify-content:center;width:100%}._seen-state-banner_f2991_37{border-radius:4px 4px 0 0;height:8px}"));const WE="_profile-card-content_f2991_1",GE="_profile-card_f2991_1",qE="_section-container_f2991_19",QE="_profile-card-wrapper_f2991_30",YE="_seen-state-banner_f2991_37";class $E extends te.Component{constructor(){super(...arguments),this.profileCardSessionID=m.generateUUID(t.InstrFeatureType.ProfileCard)}render(){const e=vE(this.props.sectionBaseProps.logEvent,{feature_name:t.InstrFeatureType.ProfileCard,extra:Object.assign({profile_card_session_id:this.profileCardSessionID},this.props.sectionBaseProps.entryPoint&&{entry_point:this.props.sectionBaseProps.entryPoint})});return te.createElement(xE,{criticalAsyncProps:void 0,logEvent:e,performanceTimer:this.props.sectionBaseProps.performanceTimer},te.createElement(ZE,Object.assign({},this.props,{sectionBaseProps:Object.assign(Object.assign({},this.props.sectionBaseProps),{logEvent:e})})))}}$E.displayName="ProfileCard";class ZE extends te.Component{render(){const{sectionBaseProps:e,seenStateProps:t,teamExpandProps:i}=this.props,a=[te.createElement(zE,Object.assign({key:"seen_state_action"},e,t,{logEvent:e.logEvent}))];return i&&a.push(te.createElement(mE,Object.assign({key:"team_invite_section"},e,i,{logEvent:e.logEvent}))),te.createElement("div",{className:WE},te.createElement("div",{className:YE,style:{backgroundColor:this.props.seenStateProps.avatarColor}}),a.map(((e,t)=>te.createElement("div",{key:`profile-card-section-${t}`,className:qE},e))))}}ZE.displayName="ProfileCardImpl";const XE=e=>{const t=te.useMemo((()=>function(e){const{featureGates:t}=e,i=EE(e.logEvent,{featureGates:t}),a=ME(i,"profile_card"),n={targetUser:e.targetUser,intl:e.intl,featureGates:t,entryPoint:e.entryPoint,Link:NE(e.openDropboxUrl,e.openExternalUrl,e.openEmailLink,a),logEvent:i,performanceTimer:e.performanceTimer||kE,reportError:e.reportError,notify:e.notify};return Object.assign({sectionBaseProps:n,seenStateProps:{seenState:e.seenState,avatarColor:e.avatarColor,isActive:e.isActive,initials:e.initials,photoUrl:e.photoUrl,useGuestAvatar:e.useGuestAvatar}},function(e){if(e.teamExpandButtonHandler&&e.teamExpandButtonText&&e.teamExpandPrimaryText)return{teamExpandProps:{teamExpandButtonHandler:e.teamExpandButtonHandler,teamExpandButtonText:e.teamExpandButtonText,teamExpandPrimaryText:e.teamExpandPrimaryText,teamExpandReasonsText:e.teamExpandReasonsText,showCompanyIcon:e.showCompanyIcon,isTeamExpandButtonDisabled:e.isTeamExpandButtonDisabled}};return{}}(e))}(e)),[e]);return te.createElement(hE,{intl:t.sectionBaseProps.intl,notify:t.sectionBaseProps.notify,reportError:t.sectionBaseProps.reportError},te.createElement("div",{className:QE},te.createElement("div",{className:GE},te.createElement($E,Object.assign({},t)))))};XE.displayName="ProfileCardWithWrapper";const JE=e=>{a.open_mail(`mailto:${e.to||""}`)},ew={showError(e){a.Snackbar$1.fail(e)}};class tw extends te.default.Component{constructor(e){super(e)}render(){const e=this.props,{userInfo:t}=e,i=n.__rest(e,["userInfo"]);let r="dbx_user";return t.isViewer?r="viewer":-1!==t.key.indexOf("@")?r="unverified_email":t.key.startsWith("dbafvid:")&&(r="guest"),te.default.createElement(XE,Object.assign({targetUser:{account_id:t.key,display_name:t.displayName,type:r,email:t.email},intl:l.intl,seenState:jS(t),isActive:t.isActive,initials:a.getInitials(t.displayName),photoUrl:t.photoUrl,useGuestAvatar:t.is_guest||!t.same_team,platform:"web",openDropboxUrl:a.open_tab,openExternalUrl:a.unsafe_open_tab,openEmailLink:JE,notify:ew,featureGates:{}},i))}}tw.displayName="ProfileCardPopover";a.injectInternalStyle("/static/metaserver/static/js/pass/avatars.module.out-vflZm5Hhm.css",(e=>"._rich-facepile-tooltip-content--passive_1vzpm_1{border-radius:5px;padding:6px 0}._rich-facepile-tooltip-content--active_1vzpm_6{margin-top:-1px}"));const iw="_rich-facepile-tooltip-content--active_1vzpm_6";class aw extends te.default.Component{render(){const{colorSeed:e,logEvent:t,performanceTimer:i,reportError:n,userInfo:r,teamExpandButtonText:o,teamExpandPrimaryText:s,teamExpandReasonsText:l,teamExpandButtonHandler:c,showCompanyIcon:d,isTeamExpandButtonDisabled:u}=this.props;return te.default.createElement("div",{className:iw},te.default.createElement(tw,{userInfo:r,avatarColor:a.avatarColorPalette(e).background,logEvent:t,entryPoint:"file_preview",performanceTimer:i,reportError:n,teamExpandPrimaryText:s,teamExpandReasonsText:l,teamExpandButtonText:o,teamExpandButtonHandler:c,showCompanyIcon:d,isTeamExpandButtonDisabled:u}))}}aw.displayName="UserAvatarActiveTooltipContent";const nw=new v.EventEmitter;a.injectInternalStyle("/static/metaserver/static/js/pass/seen_state_facepile.module.out-vflmXtkVg.css",(e=>'._react-pass__facepile_efszx_1{display:flex;flex-direction:row-reverse}._react-pass__facepile_efszx_1._react-pass__facepile--empty_efszx_7{display:none}._react-pass__facepile_efszx_1 .c-avatar{box-shadow:0 0 0 2px var(--color__standard__background)}._react-pass__facepile_efszx_1 .c-avatar--inactive img{filter:grayscale(1);opacity:.5}._react-pass__facepile_efszx_1 .c-avatar-initials-wrapper{background-color:var(--color__standard__background);border-radius:1000px;display:inline-block}._react-pass__facepile_efszx_1 .c-avatar-initials-wrapper:before{border-radius:1000px;bottom:0;box-shadow:0 0 0 2px var(--color__standard__background);content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}._react-pass__facepile_efszx_1 .c-avatar-initials-wrapper--square{background-color:var(--color__standard__background);border-radius:3px;display:inline-block}._react-pass__facepile_efszx_1 .c-avatar-initials-wrapper--square:before{border-radius:3px;bottom:0;box-shadow:0 0 0 2px var(--color__standard__background);content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}._react-pass__facepile_efszx_1 .c-avatar-initials-wrapper .c-avatar--inactive,._react-pass__facepile_efszx_1 .c-avatar-initials-wrapper--square .c-avatar--inactive{box-shadow:none;filter:grayscale(1);opacity:.5}._react-pass__facepile_efszx_1 .react-pass__face-container{display:inline-block;margin-left:-6px}aside ._react-pass__facepile_efszx_1{margin-left:6px}._react-pass__facepile_efszx_1 .react-pass__face-no-display{display:none}._react-pass__facepile_efszx_1 .pass-facepile-avatar{background-color:transparent;cursor:pointer;margin:0;padding:0;vertical-align:middle}._react-pass__facepile_efszx_1 .pass-facepile-avatar::-moz-focus-inner{border:0;padding:0}'));const rw="_react-pass__facepile_efszx_1",ow="_react-pass__facepile--empty_efszx_7",sw=({presenceComplete:e})=>{const t=a.cx(rw,ow,{[a.PRESENCE_RECEIVED_CLASSNAME]:e});return te.default.createElement("div",{className:t})};sw.displayName="EmptySeenStateFacepile";const lw=e=>{var{backgroundColor:t,className:i,tooltipContent:r}=e,o=n.__rest(e,["backgroundColor","className","tooltipContent"]);const s=a.cx("mc-facepile-tooltip-content-container",i);return te.createElement("div",Object.assign({className:s},o),te.createElement("div",{className:"mc-facepile-tooltip-content-arrow",style:{borderBottomColor:t}}),te.createElement("div",{className:"mc-facepile-tooltip-content",style:{backgroundColor:t}},r))};lw.displayName="FacepileTooltipContent";a.injectInternalStyle("/static/js/comments2/components/rich_facepile/index.module.out-vfl3gZkPG.css",(e=>"._sc-rich-facepile-tooltip-content-container_189sa_3 .mc-facepile-tooltip-content{padding:0}._sc-rich-facepile-overflow-tooltip-content_189sa_11{color:var(--color__inverse__standard__text);padding:6px 8px}._offset-facepile_189sa_17._sc-rich-facepile-tooltip-content-container_189sa_3{transform:translateX(-100px)}._offset-facepile_189sa_17._sc-rich-facepile-tooltip-content-container_189sa_3 .mc-facepile-tooltip-content-arrow{transform:translateX(100px)}"));const cw="_sc-rich-facepile-tooltip-content-container_189sa_3",dw="_sc-rich-facepile-overflow-tooltip-content_189sa_11",uw="_offset-facepile_189sa_17",_w="overflow";var pw;!function(e){e[e.Auto=1]="Auto",e[e.ForceShow=2]="ForceShow",e[e.ForceHide=3]="ForceHide",e[e.Hover=4]="Hover"}(pw||(pw={}));class gw extends te.PureComponent{constructor(e){super(e),this.tooltipDirection="below",this.hidePortal=()=>{const e=this.portalRef.current;e&&e.hidePortal.call(e)},this.handlePortalMouseout=e=>{const{displayMode:t}=this.props;t===pw.Hover&&this.hasLeftIntoTooltip(e)&&e.stopPropagation()},this.onContentMouseLeave=()=>{this.props.displayMode===pw.Hover&&this.hidePortal()},this.renderContent=()=>{var e,t;const{avatarColor:i,tooltipContent:n,source:r}=this.props;return null===n?null:te.createElement(lw,{backgroundColor:i,className:a.cx(cw,{[uw]:"fileViewer"===r&&(n.props.colorSeed||(null===(t=null===(e=n.props.children)||void 0===e?void 0:e.props)||void 0===t?void 0:t.colorSeed))}),tooltipContent:n,onMouseLeave:this.onContentMouseLeave})},this.portalRef=te.createRef()}componentDidUpdate({displayMode:e}){const{displayMode:t}=this.props,{current:i}=this.portalRef;i&&t!==e&&(t===pw.ForceShow?(this.hidePortal(),window.setTimeout((()=>i.showPortal.call(i)),0)):i.state.isShown&&this.hidePortal())}hasLeftIntoTooltip(e){const t=e.target.getBoundingClientRect(),i=Math.abs(t.top-e.pageY),a=Math.abs(t.bottom-e.pageY),n=Math.abs(t.left-e.pageX),r=Math.abs(t.right-e.pageX);switch(Math.min(i,a,n,r)){case i:return"above"===this.tooltipDirection;case a:return"below"===this.tooltipDirection;case n:return"left"===this.tooltipDirection;default:return"right"===this.tooltipDirection}}render(){const{avatar:e,onTooltipShown:t,onTooltipHidden:i,displayMode:a=pw.Auto}=this.props,n=a===pw.Hover?te.createElement("div",{onMouseLeave:this.handlePortalMouseout},e):e;return te.createElement(W.PositionedPortal,{renderContent:this.renderContent,onDidShow:t,onWillClose:i,isShowInitially:a===pw.ForceShow,positioning:this.tooltipDirection,ref:this.portalRef,showOnMouseMove:a===pw.Auto||a===pw.Hover,closeOnBlur:a===pw.Auto||a===pw.Hover},n)}}gw.displayName="UtilTooltip";const fw=({active:e,"aria-label":t,"aria-describedby":i,avatarColorSeed:n,photoUrl:r,onClick:o,onMouseEnter:s,onMouseLeave:l,onMouseOver:c,tabIndex:d,initials:u,useGuestAvatar:_})=>{const p=a.avatarColorPalette(n).background,g=_?{isGuest:!0}:{src:r,children:u};return te.createElement(a.Facepile.Item,{...g,isInactive:!e,backgroundColor:p,"aria-label":t,"aria-describedby":i,onClick:o,onMouseEnter:s,onMouseLeave:l,onMouseOver:c,tabIndex:d,cursor:"pointer",circular:!0})};fw.displayName="FacepileItem";const mw=te.createContext({signalClick:()=>{}});class hw extends te.Component{constructor(){super(...arguments),this.state={},this.documentClickListener=e=>{const t=e.target;void 0===this.state.activeTooltipIndex||this.closest(t,"mc-facepile-container")||this.setActiveTooltipIndex(void 0)},this.leaveActiveMode=()=>{this.setActiveTooltipIndex(void 0)},this.bindN=e=>{const t=[];for(let i=0;i<5;i++)t.push((()=>e(i)));return t},this.onTooltipShownForIndex=e=>{if(this.activeMode)return;const{onTooltipChange:t}=this.props,i=this.infoFromIndex(e);if(t&&null!==i){const a=this.avatarRectForIndex(e,i);t({activeMode:this.activeMode,displayInfo:null},{activeMode:this.activeMode,displayInfo:i,avatarRect:a})}},this.onTooltipHiddenForIndex=e=>{if(this.activeMode)return;const{onTooltipChange:t}=this.props,i=this.infoFromIndex(e);t&&null!==i&&t({activeMode:this.activeMode,displayInfo:i},{activeMode:this.activeMode,displayInfo:null})},this.onAvatarClickForIndex=e=>{const{becomePassiveOnOverflowAvatarClick:t,onAvatarClick:i}=this.props,a=this.infoFromIndex(e),n=t&&a===_w;n||this.activeMode||this.setActiveTooltipIndex(e),n&&this.activeMode&&this.setActiveTooltipIndex(void 0),a&&i&&i(a)},this.onAvatarMouseOverForIndex=e=>{this.activeMode&&this.setActiveTooltipIndex(e)},this.onAvatarMouseEnterForIndex=e=>{if(this.props.onAvatarMouseEnter){const t=this.infoFromIndex(e),i=this.avatarRectForIndex(e,t);this.props.onAvatarMouseEnter({activeMode:this.activeMode,displayInfo:t,avatarRect:i})}},this.onAvatarFocusForIndex=e=>{this.onAvatarMouseEnterForIndex(e),this.onAvatarMouseOverForIndex(e)},this.onTooltipShown=this.bindN(this.onTooltipShownForIndex),this.onTooltipHidden=this.bindN(this.onTooltipHiddenForIndex),this.onAvatarClick=this.bindN(this.onAvatarClickForIndex),this.onAvatarMouseOver=this.bindN(this.onAvatarMouseOverForIndex),this.onAvatarMouseEnter=this.bindN(this.onAvatarMouseEnterForIndex),this.onAvatarFocus=this.bindN(this.onAvatarFocusForIndex),this.avatarDivRefs=Array(5).fill(0).map((e=>te.createRef()))}componentDidMount(){document.addEventListener("click",this.documentClickListener,!0),window.addEventListener("resize",this.leaveActiveMode,!0)}componentWillUnmount(){document.removeEventListener("click",this.documentClickListener,!0),window.removeEventListener("resize",this.leaveActiveMode,!0)}closest(e,t){for(;e;e=e.parentElement)if(e.classList.contains(t))return e;return null}get activeMode(){return void 0!==this.state.activeTooltipIndex}setActiveTooltipIndex(e){const{activeTooltipIndex:t}=this.state,{onTooltipChange:i}=this.props;if(i&&t!==e){const{activeMode:a}=this,n=void 0!==e,r=n?this.infoFromIndex(e):null;i({activeMode:a,displayInfo:a?this.infoFromIndex(t):r},{activeMode:n,displayInfo:r,avatarRect:n?this.avatarRectForIndex(e,r):void 0})}this.setState({activeTooltipIndex:e})}displayModeForIndex(e){const{activeTooltipIndex:t}=this.state,i=this.props.passiveShowOnHover?pw.Hover:pw.Auto;return void 0===t?i:t===e?pw.ForceShow:pw.ForceHide}infoFromIndex(e){const{avatarInfoList:t,avatarInfoList:{length:i},overflowRemainderCount:a}=this.props;return a&&e===i?_w:e>=i?null:t[e]}getBoundingClientRectForRef({current:e}){return e?e.getBoundingClientRect():{left:-1,top:-1,width:0,height:0,right:-1,bottom:-1}}avatarRectForIndex(e,t){if(void 0===t&&(t=this.infoFromIndex(e)),!t)return;const{left:i,top:a,width:n,height:r}=this.getBoundingClientRectForRef(this.avatarDivRefs[e]);return{origin:{x:i,y:a},size:{width:n,height:r}}}render(){const{avatarInfoList:e,overflowRemainderCount:t,source:i,intl:n}=this.props,r=e.map(((e,t)=>{const{present:n,avatarColorSeed:r,displayName:o,initials:s,memberKey:l,passiveTooltipContent:c,photoUrl:d,useGuestAvatar:u}=e,_=r||o,p=te.createElement("div",{onFocusCapture:this.onAvatarFocus[t],ref:this.avatarDivRefs[t]},te.createElement(fw,{active:n,"aria-label":o,avatarColorSeed:_,initials:s,onClick:this.onAvatarClick[t],onMouseEnter:this.onAvatarMouseEnter[t],onMouseOver:this.onAvatarMouseOver[t],photoUrl:d,useGuestAvatar:u}));let g=c;return this.activeMode&&null!==g&&(g=te.createElement(mw.Provider,{value:{signalClick:this.leaveActiveMode}},g)),te.createElement(gw,{avatar:p,source:i,displayMode:this.displayModeForIndex(t),tooltipContent:g,avatarColor:a.avatarColorPalette(_).background,onTooltipShown:this.onTooltipShown[t],onTooltipHidden:this.onTooltipHidden[t],key:l,useGuestAvatar:u})}));if(t){const o=n.formatMessage({id:"tkBGME",defaultMessage:"99+"}),s=t>=99?o:t,l=e.length,c=te.createElement("div",{onFocusCapture:this.onAvatarMouseOver[l],ref:this.avatarDivRefs[l]},te.createElement(a.Facepile.Item,{isInactive:!0,onClick:this.onAvatarClick[l],onMouseOver:this.onAvatarMouseOver[l],cursor:"pointer"},s)),d=n.formatMessage({id:"U34Aor",defaultMessage:"{count, plural, one {# other} other {# others}}"},{count:t});r.push(te.createElement(gw,{source:i,avatar:c,displayMode:this.displayModeForIndex(l),tooltipContent:te.createElement("div",{className:dw},d),avatarColor:"var(--dig-color__secondary__base--state-1)",onTooltipShown:this.onTooltipShown[l],onTooltipHidden:this.onTooltipHidden[l],key:_w}))}return te.createElement(te.Fragment,null,r.reverse())}}hw.displayName="Avatars";const vw=te.memo((e=>{const{avatarInfoList:t,becomePassiveOnOverflowAvatarClick:i,onAvatarClick:n,onTooltipChange:r,onAvatarMouseEnter:o,overflowBasis:s,onlyShowOverflow:l,source:c,passiveShowOnHover:d,intl:u}=e,_=Math.max(s,t.length),p=l?1:4;let g,f;return"fileViewer"===e.source&&window.innerWidth<768?(f=t.length-1,g=t):_<=p?(g=t,f=void 0):(g=t.slice(0,p-1),f=_-g.length),te.createElement(a.Facepile,{size:"medium"},te.createElement(hw,{intl:u,onAvatarClick:n,onTooltipChange:r,onAvatarMouseEnter:o,avatarInfoList:g,becomePassiveOnOverflowAvatarClick:i,passiveShowOnHover:d,overflowRemainderCount:f,source:c}))}));var Sw;vw.displayName="RichFacepile",function(e){e.NumCollaborators="NUM_COLLABORATORS",e.NumSharedFolders="NUM_SHARED_FOLDERS",e.NumSharedFiles="NUM_SHARED_FILES",e.TopCollaborator="TOP_COLLABORATOR",e.SameDomain="SAME_DOMAIN"}(Sw||(Sw={}));const Ew=(e,t)=>{const i=ww[e];return l.intl.formatMessage(i,{value:t})},ww=a.defineMessages({[Sw.NumCollaborators]:{id:"QeEkkz",defaultMessage:"{value, plural, one{1 member works with them} other{{value} members work with them}}"},[Sw.NumSharedFolders]:{id:"156+gh",defaultMessage:"{value, plural, one{1 folder shared with your team} other{{value} folders shared with your team}}"},[Sw.NumSharedFiles]:{id:"CX5lnx",defaultMessage:"{value, plural, one{1 file shared with your team} other{{value} files shared with your team}}"},[Sw.TopCollaborator]:{id:"/t9NTF",defaultMessage:"{value} regularly works with them"},[Sw.SameDomain]:{id:"vQ0ZP6",defaultMessage:"Their email is {value}"}}),bw=()=>{const e=a.useIntl().formatMessage({id:"pQM2jx",defaultMessage:"Only you have access"});return te.default.createElement(a.Text,{color:"faint"},e)};bw.displayName="SoloAccessText";const yw=({isPassPermissionsPending:e})=>te.default.createElement(sw,{presenceComplete:!e});yw.displayName="EmptyFacepile";class Tw extends te.default.Component{constructor(){super(...arguments),this.state={newPresentUserIds:[]},this.hasPassShownBeenLogged=!1,this.onAvatarHover=e=>{this.logPassEvent(a.EventTypes.PASS_HOVER),e!==_w&&this.hasTeamExpandInfo(e.memberKey)&&a.TeamsWebActionsLogger.log("team_expand_info_shown",{user_id:e.memberKey})},this.hasTeamExpandInfo=e=>{const{fetchUserJoinableTeam:t,user:i,userToJoinableTeam:a}=this.props;i.is_team||(null==a?void 0:a.find((t=>t.userId===e)))||!t||t(e);const n=this.getUserInfoList().find((({key:t})=>t===e));return Boolean(n&&this.getTeamExpandForUserInfo(n).teamExpandButtonText)},this.openShareModal=()=>{ZS(this.props.file,o.Viewer.get_viewer().get_user_by_id(this.props.user.id),this.props.url||null,{origin:a.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_FACEPILE})},this.onAvatarClick=e=>{this.logPassEvent(a.EventTypes.PASS_CLICK);const t=this.context.getIntegrationStore(),i=this.getPromptsToDismiss(t);i.length>0&&a.wrapDispatch(t.dispatch)(a.dismissPrompts(i)),e===_w&&this.openShareModal()},this.onTooltipChange=({activeMode:e,displayInfo:t},{activeMode:i,displayInfo:a})=>{null!==a&&t!==a&&this.onAvatarHover(a)},this.canShowPASS=()=>{const{isPassPermissionsPending:e,passFetchingStatus:t,passPermissions:i}=this.props;return!e&&t!==a.PassFetchingStatus.ERROR&&null!==i&&(i.canReadPresence||i.canReadSeenState)},this.canShowMembershipInfo=()=>{const{sharingStorePassInfo:e}=this.props;return e.isLoaded&&null!==e.data&&e.data.users.length>0},this.getTeamExpandForUserInfo=i=>{var r;const{joinableTeams:s,joinTeamHandler:c,user:d,userToJoinableTeam:u,suggestMembersEnabled:_}=this.props,p=o.Viewer.get_viewer();let g=[];if(this.props.userTeamInteractionInfo&&i.userId in this.props.userTeamInteractionInfo){const e=this.props.userTeamInteractionInfo[i.userId];if(null!==e){const t=((e,t,i)=>{const a=[],{num_collaborators:n,num_shared_folders:r,num_shared_files:o,top_collaborator:s,same_domain:l}=e;if(n>0&&a.push([Sw.NumCollaborators,n]),r>0&&a.push([Sw.NumSharedFolders,r]),o>0&&a.push([Sw.NumSharedFiles,o]),l){s&&a.push([Sw.TopCollaborator,s.name]);const e="@"+t.split("@")[1];a.push([Sw.SameDomain,e])}return i?a.slice(0,i):a})(e,i.email,3);for(const[e,i]of t)g.push(Ew(e,i))}else g=(e=>{const t=[];return e&&(t.push(l.intl.formatMessage({id:"jDD++i",defaultMessage:"Content stays within the team"})),t.push(l.intl.formatMessage({id:"/a4H7F",defaultMessage:"They’ll get instant access to files"})),t.push(l.intl.formatMessage({id:"LL9D7n",defaultMessage:"Enough space to do their work"}))),t})(i)}if(d.is_team_admin&&!1===i.same_team&&!1===i.is_guest)return Object.assign(Object.assign({},((i,r,o)=>{const{team_name:s,team_id:c}=o;return{teamExpandPrimaryText:l.intl.formatMessage(BS,{teamname:s}),teamExpandButtonText:HS,teamExpandButtonHandler:()=>n.__awaiter(void 0,void 0,void 0,(function*(){window.dispatchEvent(new Event("resize")),i.email&&(yield new Promise((function(t,i){e(["./c_invite_modals_invite_confirmation_modal"],t,i)})).then((({showInviteConfirmationModal:e})=>{i.email&&e({emailsToInvite:[i.email],origin:t.Source.PASS_INVITE})}))),a.TeamsWebActionsLogger.log("pass_invite_user",{user_id:r.id,team_id:c})}))}})(i,d,p)),{teamExpandReasonsText:g});if(d.is_team&&!1===i.same_team&&!1===i.is_guest&&_)return Object.assign(Object.assign({},((e,t,i)=>{const{team_id:n,team_type:r,team_name:o,work_user:s}=i;return{teamExpandPrimaryText:l.intl.formatMessage(BS,{teamname:o}),teamExpandButtonText:HS,teamExpandButtonHandler:()=>{n&&r?(window.dispatchEvent(new Event("resize")),a.Modal$1.showInstance(te.default.createElement(VS,{user:s,open:!0,onClose:()=>a.Modal$1.close(),prepopulatedEmails:e.email?[e.email]:[],source:"pass",isSuggestionMode:!0}))):a.navigateToSuggestModal(e.email?[e.email]:[]),a.TeamsWebActionsLogger.log("pass_suggested_user",{user_id:t.id,team_id:n,team_type:r})}}})(i,d,p)),{teamExpandReasonsText:g});if(!d.is_team&&s&&c&&u){const e=null===(r=u.find((e=>e.userId===i.userId)))||void 0===r?void 0:r.teamId,t=s.find((e=>e.requestState===sv.PendingApproval)),n=(void 0!==t?[t]:s).find((t=>t.dbxTeamId===e));return((e,t,i,n)=>{if(!i)return{};const r=i.requestState;return{teamExpandPrimaryText:l.intl.formatMessage(zS,{teamname:i.name}),teamExpandButtonText:r?r===sv.Sending?WS:r===sv.PendingApproval?GS:qS:KS,teamExpandButtonHandler:()=>{window.dispatchEvent(new Event("resize")),n(i),a.TeamsWebActionsLogger.log("pass_requested_access_to_team",{user_id:t.id,team_id:i.id})},showCompanyIcon:!0,isTeamExpandButtonDisabled:r===sv.PendingApproval||r===sv.Sending||r===sv.Joined}})(0,d,n,c)}return{}}}UNSAFE_componentWillMount(){this.resetLogging(),YS.listenTo(nw)}componentDidMount(){this.logFacepileShownEvents()}UNSAFE_componentWillReceiveProps(e){if(a.areFilesEqual(this.props.file,e.file)){if(null==e.presence||null==this.props.presence)return;const t=w.difference(e.presence,this.props.presence),i=w.difference(this.props.presence,e.presence);this.updateNewPresentUserIds(t,i)}else this.setState({newPresentUserIds:[]}),this.resetLogging()}componentDidUpdate(e){this.logFacepileShownEvents()}componentWillUnmount(){YS.unlistenTo(nw)}updateNewPresentUserIds(e,t){const i=w.filter(this.state.newPresentUserIds,(e=>-1===t.indexOf(e)));this.setState({newPresentUserIds:[...e,...i]})}computeOverflowBasis(e){if(!this.props.uniqueMemberCountInfo.data)return e.length;let t=this.props.uniqueMemberCountInfo.data;return e.forEach((e=>{e.incrementOverflowBasis&&++t})),Math.max(t,e.length)}resetLogging(){this.hasPassShownBeenLogged=!1}logFacepileShownEvents(){if(!this.hasPassShownBeenLogged&&this.dataSufficientForLoggingHasLoaded()){const e=this.getUserInfoList();this.haveSeenStateDataToShow(e)&&(this.logPassEvent(a.EventTypes.PASS_SHOWN,e),this.hasPassShownBeenLogged=!0)}}logPassEvent(e,t){const{anonymousPresenceInfo:{length:i},file:a,passSessionId:n,passPermissions:r}=this.props,{numViewers:o,numInTeamEditors:s,numInTeamViewers:l,numNonTeamEditors:c,numNonTeamViewers:d}=this.getViewerCountByAccessLevel(),u=this.computeOverflowBasis(t||this.getUserInfoList());return nw.emit(e,!1,a,{numAccessors:u,numViewers:o,numCurrentViewers:this.getNumCurrentViewers(),canSeeViewerHistory:r&&r.canReadSeenState,numGuests:i,numInTeamEditors:s,numInTeamViewers:l,numNonTeamEditors:c,numNonTeamViewers:d},n)}getViewerCountByAccessLevel(){var e,t;let i,a,n=0,r=0,o=0,s=0;if(this.shouldHardcodeCurrentViewer()){a=this.seenStateDataWithViewerFiltered(this.getSeenStates());const e=this.getSeenStates().filter((e=>e.seen_state_user.user_id===this.props.user.account_id));if(e.length>0){i=0;const t=e[0];t.when_last_seen=1,a.push(t)}else i=1,n++}else i=0,a=this.getSeenStates();for(const l of a)if(null!=l.when_last_seen){i++;const a=l.seen_state_user;a.in_owners_team?"edit_member_access"===(null===(e=a.sharing_access_type)||void 0===e?void 0:e[".tag"])?n++:r++:"edit_member_access"===(null===(t=a.sharing_access_type)||void 0===t?void 0:t[".tag"])?o++:s++}return{numViewers:i,numInTeamEditors:n,numInTeamViewers:r,numNonTeamEditors:o,numNonTeamViewers:s}}getNumCurrentViewers(){if(!this.props.presence)return 0;if(this.shouldHardcodeCurrentViewer()){return 1+this.props.presence.filter((e=>e!==this.props.user.account_id)).map((e=>e)).length}return this.props.presence.length}userIsAnonymous(e){return w.map(this.props.anonymousPresenceInfo,(e=>e.seen_state_user.user_id)).indexOf(e.user_id)>=0}userIsOnline(e){return null!=this.props.presence&&this.props.presence.indexOf(e.user_id)>=0}buildUserInfo(e){const{platform_type:t,seen_state_user:i,seen_state_user:{access_level:n,display_name:r,email:o,photo_circle_url:s,sharing_access_type:l,user_id:c,same_team:d},when_last_seen:u}=e,_=c||r,p=a.shouldIncrementOverflowBasisForAccessType(l),g=this.userIsAnonymous(i);return new Eh(_,r,this.userIsOnline(i),!1,p,o,n,u,s,c,t,d,g)}seenStateDataWithViewerFiltered(e){return w.filter(e,(e=>e.seen_state_user.user_id!==this.props.user.account_id))}partitionUserInfoLists(e){const t=[],i=[],a=[],n=[],r=[],o={};for(const t of e){const e=this.buildUserInfo(t);this.userIsOnline(t.seen_state_user)?this.isNewPresentUser(e)?o[e.key]=e:this.userIsAnonymous(t.seen_state_user)?a.push(e):i.push(e):null!=t.when_last_seen?n.push(e):r.push(e)}for(const e of this.state.newPresentUserIds){const i=o[e];i&&t.push(i)}return{newPresentUserInfoList:t,presentUserInfoList:i,anonymousUserInfoList:a,offlineUserInfoList:n,neverViewedUserInfoList:r}}getUserInfoList(){let e;const t=[],i=this.getMergedSeenStateData();if(this.shouldHardcodeCurrentViewer()){e=this.seenStateDataWithViewerFiltered(i);const n=this.props.user.account_id,r=e.length<i.length&&this.getSeenStates().some((({seen_state_user:e})=>e.user_id===n&&a.shouldIncrementOverflowBasisForAccessType(e.sharing_access_type))),s=o.Viewer.get_viewer().get_user_by_id(this.props.user.id);t.push(new Eh(this.props.user.account_id,s.display_name,this.canShowPASS(),!0,r,s.email,void 0,void 0,s.photo_url,this.props.user.account_id,void 0,!0,!1))}else e=i;const n=this.partitionUserInfoLists(e),{newPresentUserInfoList:r,presentUserInfoList:s,anonymousUserInfoList:l,offlineUserInfoList:c,neverViewedUserInfoList:d}=n;return s.sort(((e,t)=>e.displayName.toLowerCase().localeCompare(t.displayName.toLowerCase()))),d.sort(((e,t)=>e.displayName.toLowerCase().localeCompare(t.displayName.toLowerCase()))),[...t,...r,...s,...l,...c,...d]}isNewPresentUser(e){return this.state.newPresentUserIds.indexOf(e.key)>=0}getMergedSeenStateData(){const e=this.getSeenStates(),t=e.map((e=>e.seen_state_user.user_id));if(this.props.sharingStorePassInfo.data){for(const i of this.props.sharingStorePassInfo.data.users){const a=i.seen_state_user.user_id;-1!==t.indexOf(a)||a===this.props.user.account_id&&this.shouldHardcodeCurrentViewer()||e.push(i)}return[...e,...this.props.anonymousPresenceInfo,...this.props.sharingStorePassInfo.data.invitees]}return[...e,...this.props.anonymousPresenceInfo]}shouldHardcodeCurrentViewer(){const e=!o.Viewer.get_viewer().is_assume_user_session,t=null!=this.props.presence&&this.props.presence.indexOf(this.props.user.account_id)>=0;return e||t}getSeenStates(){return this.props.identifiedSeenStateInfo&&this.props.identifiedSeenStateInfo.seen_states?[...this.props.identifiedSeenStateInfo.seen_states]:[]}haveSeenStateDataToShow(e){const t=e.length;return t>=2||1===t&&e[0].key!==this.props.user.account_id}dataSufficientForLoggingHasLoaded(){return this.sharingAndCountInfoHasLoaded()&&a.fetchingStatusCanLogAsShown(this.props.passFetchingStatus)}dataSufficientForDisplayHasLoaded(){return this.sharingAndCountInfoHasLoaded()&&a.fetchingStatusSeenStateIsComplete(this.props.passFetchingStatus)}sharingAndCountInfoHasLoaded(){const{sharingStorePassInfo:e,uniqueMemberCountInfo:t}=this.props;return e.isLoaded&&t.isLoaded}getPromptsToDismiss(e){return[{".tag":"tooltip_click_for_more"},{".tag":"tooltip_click_for_more_auto_display"}].filter((t=>!a.isPromptDismissed(e.getState(),t[".tag"])))}render(){const{source:e,onlyShowOverflow:t}=this.props;if(!this.canShowPASS()&&!this.canShowMembershipInfo())return te.default.createElement(yw,{isPassPermissionsPending:this.props.isPassPermissionsPending});if(!this.dataSufficientForDisplayHasLoaded())return te.default.createElement("div",null);const i=this.getUserInfoList();if(this.haveSeenStateDataToShow(i)){const a=this.computeOverflowBasis(i),n=l.intl.formatMessage({id:"6Caba5",defaultMessage:"Shared with"});return te.default.createElement("div",{className:this.facepileClassName(),"aria-label":n},te.default.createElement(vw,{avatarInfoList:this.computeAvatarInfos(i),becomePassiveOnOverflowAvatarClick:!0,passiveShowOnHover:!0,intl:l.intl,onAvatarClick:this.onAvatarClick,onTooltipChange:this.onTooltipChange,source:e,overflowBasis:a,onlyShowOverflow:t}))}return te.default.createElement(bw,null)}facepileClassName(){return a.cx(rw,{[a.PRESENCE_RECEIVED_CLASSNAME]:!this.props.isPassPermissionsPending})}computeAvatarInfos(e){if(0===e.length)return[];const t=this.context.logEvent(),i=this.context.performanceTimer(),n=this.context.reportError();return e.slice(0,5).map((e=>{const{colorSeed:r,initials:o}=function({userId:e,displayName:t}){return e&&a.AnonymousViewerUtils.isAnonymousUserId(e)?{colorSeed:e,initials:a.AnonymousViewerUtils.getAnonymousViewerInitials(t)}:{colorSeed:t,initials:a.getInitials(t)}}(e),{isActive:s,displayName:l,key:c,userId:d,photoUrl:u,same_team:_,is_guest:p}=e,g=this.hasTeamExpandInfo(e.key)?this.getTeamExpandForUserInfo(e):{};return{present:s,displayName:l,avatarColorSeed:r,initials:o,memberKey:c,photoUrl:u||void 0,userId:d,passiveTooltipContent:te.default.createElement(aw,Object.assign({colorSeed:r,logEvent:t,performanceTimer:i,reportError:n,userInfo:e},g)),useGuestAvatar:p||!_}}))}}Tw.contextTypes={getIntegrationStore:a.PropTypes.func,logEvent:a.PropTypes.func,performanceTimer:a.PropTypes.func,reportError:a.PropTypes.func},Tw.displayName="SeenStateFacepile";const Iw=a.getStoreAndRegisterReducers({[a.TEAM_DISCOVERY_NAMESPACE_KEY]:bv}),Cw=new class{getTeamDiscoveryStoreState(e){const t=a.getStateAtNamespace(e,a.TEAM_DISCOVERY_NAMESPACE_KEY);if(void 0===t)throw Error("State in Store is undefined!");return t}},Aw=new class{constructor(e,t,i,a,n,r=!1){this.apiClient=e,this.logger=t,this.selector=i,this.contUrl=a||"/install",this.signupTag=n,this.isViralFlow=r}redirectAndNotify(e,t){const i=()=>a.redirect(this.contUrl);e?j.Notify.success(l.intl.formatMessage({id:"5lxkC0",defaultMessage:"Your request to join the team was sent successfully! Redirecting..."}),t,i):j.Notify.error(l.intl.formatMessage({id:"ZPbWOT",defaultMessage:"Something went wrong with your team join request. Redirecting..."}),t,i)}joinTeamAction(e,t,i,n=!0,r,o,s=3){return(l,c)=>{l({type:Sv.UpdateRequestState,payload:{teamId:e.id,requestState:sv.Sending}});const d=hv.New;return av(this.apiClient).rpc("joinable_teams/join",{team_id:e.id,source:t,extra:{design:d,origin:t,signup_tag:void 0===this.signupTag?"":this.signupTag,preselect_team_id:void 0===o?"":o.toString()}},{subjectUserId:i}).then((i=>{let u,_;const p=i?i.result[".tag"]:void 0;switch(p){case nv.RequestSent:l({type:Sv.AskToJoinTeam}),u="ask_to_join",_="request_sent",l({type:Sv.UpdateRequestState,payload:{teamId:e.id,requestState:sv.PendingApproval}}),n?this.redirectAndNotify(!0,s):Ev({title:cv(_),variant:"complete"});break;case nv.RequestNotSent:_=i.result.reason[".tag"],_===ov.Conflict?(l({type:Sv.AskToJoinTeam}),u="ask_to_join",n?this.redirectAndNotify(!0,s):Ev({title:cv(_),variant:"fail"})):(this.logger.logAskToJoinErrorEvent(e.id,this.selector.getTeamDiscoveryStoreState(c()).userId,p||"unknown",_||"unknown",t),n?this.redirectAndNotify(!1,s):Ev({title:cv(_),variant:"fail"})),l({type:Sv.UpdateRequestState,payload:{teamId:e.id}});break;case nv.CanJoin:u="can_auto_join",_="can_join",n?this.isViralFlow?this.redirectAndNotify(!0,s):a.redirect(i.result.url):Ev({title:"Joined team",variant:"complete"}),l({type:Sv.UpdateRequestState,payload:{teamId:e.id,requestState:sv.Joined}});break;default:this.logger.logAskToJoinErrorEvent(e.id,this.selector.getTeamDiscoveryStoreState(c()).userId,"unknown","other",t),l({type:Sv.UpdateRequestState,payload:{teamId:e.id}}),n?this.redirectAndNotify(!1,s):Ev({title:cv("other"),variant:"fail"})}this.logger.logAskToJoinEvent({teamId:e.id,userId:this.selector.getTeamDiscoveryStoreState(c()).userId,joinState:u,reason:_,origin:t,team_index:r,url:"team/discover/suggest",design:d,signupTag:this.signupTag,preselectTeamId:o})}))}}fetchInitialData(e,t=5,i=!0,n=""){return(r,o)=>(r({type:Sv.PopulateServerProps,payload:{userEmail:e.userEmail,userId:e.userId}}),av(this.apiClient).rpc("joinable_teams/list",{member_to_fetch_limit:t,sharer_dbx_team_id:e.sharerDbxTeamId,include_user_collab_teams:!0,include_rejections:!i},{subjectUserId:e.userId}).then((a=>{var n,s,l;const c=w.map(a.values,dv);i&&this.logger.logExposedToSETOnSignupPage(this.selector.getTeamDiscoveryStoreState(o()).userId,e.origin,e.signupTag,c.length,null===(n=function(e,t,i){const a=e[0],n=1===e.length,r=t&&i&&a&&a.dbxTeamId===i;return n||r?a:void 0}(c,e.sharerName,e.sharerDbxTeamId))||void 0===n?void 0:n.id,t,null===(s=c[0])||void 0===s?void 0:s.isSameDomain,null===(l=c[0])||void 0===l?void 0:l.isCollaborator),r({type:Sv.FetchInitData,payload:{joinableTeams:c,domainName:a.domain_name}})})).catch((e=>{if(!n)throw e;{const e=l.intl.formatMessage({id:"/uOUwu",defaultMessage:"We encountered an error trying to fetch teams for you to join. Redirecting to the next page..."}),t=3;j.Notify.error(e,t,(()=>a.redirect(n)))}})))}fetchUserData(e,t){return(i,a)=>av(this.apiClient).rpc("joinable_teams/user",{dbx_account_id:t},{subjectUserId:e}).then((e=>{i({type:Sv.LoadUserData,payload:{userId:t,teamId:e.dbx_team_id}})}))}fetchCurrentAccount(e){return(t,i)=>a.GetUsersRoutes(this.apiClient).rpc("get_current_account",void 0,{subjectUserId:e}).then((e=>{var i;t({type:Sv.LoadCurrentAccountData,payload:{suggestMembersEnabled:!!(null===(i=e.team)||void 0===i?void 0:i.team_user_permissions.suggest_members_enabled)}})}))}continueToNextPage(e,t){return(i,n)=>{e.preventDefault(),this.logger.logContinueToInstallEvent(this.selector.getTeamDiscoveryStoreState(n()).userId,t),e.metaKey?a.open_tab(this.contUrl):a.redirect(this.contUrl)}}}(new o.UserApiV2Client,new class{logAskToJoinEvent(e){const{teamId:t,userId:i,joinState:n,reason:r,origin:o,team_index:s,url:l,design:c,signupTag:d,preselectTeamId:u,numAskToJoin:_,numAutoJoin:p}=e;a.TeamsWebActionsLogger.log(fv,{team_id:t,user_id:i,url:l,join_state:n,reason:r,origin:o,design:c,signup_tag:d,preselect_team_id:u,team_index:s+1,num_ask_to_join:_,num_auto_join:p})}logAskToJoinErrorEvent(e,t,i,n,r){a.TeamsWebActionsLogger.log("requested_access_to_team_error",{team_id:e,user_id:t,url:"team/discover/suggest",join_state:i,reason:n,origin:r})}logAcceptInvitation(e){gv(S.TeamJoinerLoggerEvents.CLICKED_ACCEPT_INVITE,"team_discovery_page",{team_id:e})}logTeamDiscoveryPageSeen(e,t,i){let n={};const r=[],o=[],s=[],l=[];for(const t of e)"request_approved"===t.joinTeamRequestState[".tag"]?r.push(t):"waiting_for_approval"===t.joinTeamRequestState[".tag"]?o.push(t):"can_auto_join"===t.joinTeamRequestState[".tag"]?s.push(t):"approval_required"===t.joinTeamRequestState[".tag"]&&l.push(t);n={has_pending_invite:!!t,has_outstanding_request:o.length>0,has_approved_request:r.length>0,num_auto_join:s.length,num_ask_to_join:l.length,verified:i,_tk:a.get_pathname(),url:a.get_uri().toString()},a.TeamsWebActionsLogger.log_for_category(S.TeamJoinerLoggerEvents.SAW_TEAM_PROMO_PAGE,a.TeamsWebActionsLogger.LOG_CATEGORY.PROMO_TEAMS,n),gv(S.TeamJoinerLoggerEvents.SAW_TEAM_PROMO_PAGE,"team_discovery_page",n,!1)}logClickCancelJoinRequest(e,t){a.TeamsWebActionsLogger.log("cancel_request_to_join",{num_team_members:t,origin:mv.TeamDiscoveryPageRefresh,source:"team_discovery_page",team_id:e})}logClickStartNewTeamLink(){a.TeamsWebActionsLogger.log("clicked_create_team_cta")}logEmailVerificationModalShown(e,t){a.TeamsWebActionsLogger.log("email_verification_modal_shown",{user_id:e,team_id:t})}logEmailVerifiedSnackbarShown(e){a.TeamsWebActionsLogger.log("email_verified_snackbar_shown",{user_id:e})}logContinueToInstallEvent(e,t=!1){a.TeamsWebActionsLogger.log("surface_existing_team_continue_to_install",{user_id:e,url:"team/discover/suggest",is_cancel:t},(()=>{}),e)}logExposedToSETOnPreviewEvent(e,t,i,n,r,o,s){a.TeamsWebActionsLogger.log("exposed_to_set_on_preview",{team_id:r,user_id:e,url:"scl/fi/:sckey/:file_name",is_cdm_member:t,user_root_permissions:i,team_member_count:o,saw_ask_to_join:n,is_new_user:s},(()=>{}),e)}logClickedRequestToJoinEvent(e,t,i,n){a.TeamsWebActionsLogger.log(fv,{team_id:e,user_id:t,url:"scl/fi/:sckey/:file_name",origin:i,is_new_user:n},(()=>{}),t)}logExposedToSETOnSignupPage(e,t,i,n,r,o,s,l){a.TeamsWebActionsLogger.log("exposed_to_set_on_signup_page",{design:hv.New,origin:t,signup_tag:i,number_of_teams:n,preselect_team_id:r,member_to_fetch_limit:o,first_team_same_domain:s,first_team_tc:l},(()=>{}),e)}logExposedToSETOnSignupPageLoadingScreen(e,t){a.TeamsWebActionsLogger.log("exposed_to_set_on_signup_page_loading",{origin:t},(()=>{}),e)}logUserSelectedJoinableTeam(e,t,i,a,n){this._logUserJoinableTeamChoice("user_selected_joinable_team",e,t,i,a,n)}logUserUnselectedJoinableTeam(e,t,i,a,n){this._logUserJoinableTeamChoice("user_unselected_joinable_team",e,t,i,a,n)}_logUserJoinableTeamChoice(e,t,i,n,r,o){a.TeamsWebActionsLogger.log(e,{team_id:t,design:hv.New,origin:n,signup_tag:r,preselect_team_id:o},(()=>{}),i)}},Cw);class Mw extends te.default.Component{constructor(e){super(e),this.onUpdateFromStore=()=>{this.setState(this.getStateFromStore())},this.state=this.getStateFromStore(),this.passSessionId=e.passSessionId||qo()}UNSAFE_componentWillMount(){const{featureConfig:e,user:t}=this.props;tv.add_change_listener(this.onUpdateFromStore),qh.add_change_listener(this.onUpdateFromStore),this.teamDiscoveryStoreUnsubscribe=Iw.subscribe(this.onUpdateFromStore),Xh.setup({user:t,passSessionId:this.passSessionId,fileData:this.getPassFileData(),skipSharingEndpoints:!1,prevFileData:null,maxMembersSizeLimit:2,featureConfig:e}),t&&(Iw.dispatch(Aw.fetchInitialData({origin:mv.Pass,userId:t.id,userEmail:t.email},100,!1)),Iw.dispatch(Aw.fetchCurrentAccount(t.id)))}UNSAFE_componentWillReceiveProps(e){a.areFilesEqual(e.file,this.props.file)||this.setState({passInfo:{anonymousPresence:null,isPassPermissionsPending:!0,passFetchingStatus:a.PassFetchingStatus.FETCHING,passPermissions:null,presence:null,identifiedSeenStateInfo:null,userIdsWithoutSeenStateInfo:[]},sharingInfo:void 0})}UNSAFE_componentWillUpdate(e,t){const i=t.passInfo;if(i.userIdsWithoutSeenStateInfo.length>0&&a.fetchingStatusIsSuccessful(i.passFetchingStatus)&&e.user){const t=e.file,a=this.urlFromProps(e);_h.fetchSeenStateUsers(e.user.id,i.identifiedSeenStateInfo,i.userIdsWithoutSeenStateInfo,t.file_id,a,this.passSessionId)}const r=t.teamExpandInfo;var s,l,c,d;r&&r.userIdsWithoutTeamInteractionInfo.length>0&&null!==i.identifiedSeenStateInfo&&a.fetchingStatusIsSuccessful(i.passFetchingStatus)&&e.user&&(s=r.userIdsWithoutTeamInteractionInfo,l=i.identifiedSeenStateInfo,c=r.userTeamInteractionInfo,d=e.file.file_id,n.__awaiter(void 0,void 0,void 0,(function*(){const e=o.Viewer.get_viewer();if(!e.work_user||0===s.length)return;const t=[];for(const e of s){if(e in c)continue;const i=l.seen_states.map((e=>e.seen_state_user)).find((t=>t.user_id===e));i&&!i.same_team&&t.push(e)}if(0===t.length)return;const i=(new o.UserApiV2Client).ns("user_to_team");yield i.rpc("get_interaction_info",{dbx_account_ids:t,team_id:e.team_id},{subjectUserId:e.work_user.id}).then((e=>{const t={};if(!e||0===e.result.length)throw Error();for(const i of e.result)t[i.dbx_account_id]=i;Km.updateUserTeamInteractionInfo(d,t)})).catch((e=>{const i={};for(const e of t)i[e]=null;Km.updateUserTeamInteractionInfo(d,i)}))})))}componentDidUpdate(e){if(!a.areFilesEqual(this.props.file,e.file)){const t={file:e.file,url:this.urlFromProps(e)};this.passSessionId=qo(),Xh.setup({user:this.props.user,passSessionId:this.passSessionId,fileData:this.getPassFileData(),skipSharingEndpoints:!1,prevFileData:t,maxMembersSizeLimit:2,featureConfig:this.props.featureConfig})}}componentWillUnmount(){tv.remove_change_listener(this.onUpdateFromStore),qh.remove_change_listener(this.onUpdateFromStore),this.teamDiscoveryStoreUnsubscribe&&this.teamDiscoveryStoreUnsubscribe(),Xh.teardown({user:this.props.user,fileData:this.getPassFileData(),async:!0})}getStateFromStore(){const{user:e,file:{file_id:t}}=this.props;return{passInfo:{anonymousPresence:tv.anonymousPresence(t),isPassPermissionsPending:tv.isPassPermissionsPending(t),passFetchingStatus:tv.passFetchingStatus(t),passPermissions:tv.getPassPermissions(t),presence:tv.presence(t),identifiedSeenStateInfo:tv.identifiedSeenStateInfo(t),userIdsWithoutSeenStateInfo:tv.userIdsWithoutSeenStateInfo(t)},sharingInfo:e&&qh.getSharingInfo(e.id,t)||void 0,teamExpandInfo:e&&this.getTeamExpandInfo(e.id,t)||void 0}}getTeamExpandInfo(e,t){const{joinableTeams:i,userToJoinableTeam:a,suggestMembersEnabled:n}=Cw.getTeamDiscoveryStoreState(Iw.getState());return{joinableTeams:i,userToJoinableTeam:a,joinTeamHandler:t=>{Iw.dispatch(Aw.joinTeamAction(t,mv.Pass,e,!1,i.indexOf(t)))},fetchUserJoinableTeam:t=>{Iw.dispatch(Aw.fetchUserData(e,t))},userIdsWithoutTeamInteractionInfo:tv.userIdsWithoutTeamInteractionInfo(t),userTeamInteractionInfo:tv.userTeamInteractionInfo(t),suggestMembersEnabled:!!n}}getAnonymousPassInfo(){return null==this.state.passInfo.anonymousPresence?[]:this.state.passInfo.anonymousPresence.map((function(e){return{seen_state_user:{user_id:e,display_name:l.intl.formatMessage({id:"+s6D7j",defaultMessage:"Guest"})},seen_events:[]}}))}getMemberInfosInPassFormat(e){const t=e.members();return{invitees:t?this.getInviteeMemberInfos(t):[],users:t?this.getUserMemberInfos(t):[]}}getUserMemberInfos(e){return e.users.valueSeq().toArray().reduce((function(e,t){return t.account&&e.push({seen_state_user:{user_id:t.account_id,display_name:t.account.display_name,email:t.email(),photo_circle_url:t.account.profile_photo_url||void 0,access_level:t.access_type,same_team:t.same_team},seen_events:[]}),e}),[])}getInviteeMemberInfos(e){return e.invitees.valueSeq().toArray().map((function(e){return{seen_state_user:{display_name:e.contact,access_level:e.access_type},seen_events:[]}}))}getPassFileData(){return{file:this.props.file,url:this.urlFromProps()}}urlFromProps(e=this.props){return e.sharedLinkInfo?e.sharedLinkInfo.url:void 0}getPropsFromPassInfo(){return{anonymousPresenceInfo:this.getAnonymousPassInfo(),isPassPermissionsPending:this.state.passInfo.isPassPermissionsPending,passFetchingStatus:this.state.passInfo.passFetchingStatus,passPermissions:this.state.passInfo.passPermissions,presence:this.state.passInfo.presence,identifiedSeenStateInfo:this.state.passInfo.identifiedSeenStateInfo}}getPropsFromSharingInfo(){const e={uniqueMemberCountInfo:wh.createNotLoaded(),sharingStorePassInfo:wh.createNotLoaded()};return this.state.sharingInfo?(null!=this.state.sharingInfo.memberCounts()&&(e.uniqueMemberCountInfo=wh.create(this.state.sharingInfo.memberCounts().total_unique_users)),this.state.sharingInfo.hasDisplayableMembers()&&(e.sharingStorePassInfo=wh.create(this.getMemberInfosInPassFormat(this.state.sharingInfo))),e):e}render(){const{user:e,source:t,onlyShowOverflow:i,file:a}=this.props,n=this.getPropsFromPassInfo();return null==e?te.default.createElement(sw,{presenceComplete:!n.isPassPermissionsPending}):te.default.createElement(iv,{user:e},te.default.createElement(Tw,Object.assign({},n,this.getPropsFromSharingInfo(),this.state.teamExpandInfo,{file:a,url:this.urlFromProps(),user:e,passSessionId:this.passSessionId,source:t,onlyShowOverflow:i})))}}Mw.displayName="SeenStateFacepileController";const Ow=({activePreviewFile:e,enablePassUi:t,passSessionId:i,user:n,onlyShowOverflow:r})=>{var o;const{featureConfig:s}=u.useFileViewerContext(),l=e.file.file_id,c=null===(o=e.sharedLinkInfo)||void 0===o?void 0:o.url,d=null!=n?n:null;return te.useEffect((()=>(vh.transmitBeaconData({prevBeaconFileData:null,beaconFileData:new bh(l,c),user:d,passSessionId:void 0,featureConfig:s}),a.logStormcrowExposure("pass_transmitter_token_prefetch",s.pass_transmitter_token_prefetch?"ON":"CONTROL"),()=>vh.shutdown({beaconFileData:new bh(l,c),user:d,async:!0}))),[d,l,c,s]),t?te.createElement("div",{className:"_pass_1wgu7_1","data-testid":"pass"},te.createElement(Mw,{user:n||null,file:e.file,passSessionId:i,source:"fileViewer",sharedLinkInfo:e.sharedLinkInfo,onlyShowOverflow:r,featureConfig:s})):null};Ow.displayName="TitleBarPassUi";const Pw=()=>{const{titleBarPassUi:e}=Cs();return te.default.useMemo((()=>e?(e=>t=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(e,Object.assign({},t))))(e):Ow),[e])};a.injectInternalStyle("/static/metaserver/static/js/previews/ui/sharing_plugin/share_button.module.out-vflwTjN-Q.css",(e=>'._disabled-share-button_1svg2_1{display:"inline-block";margin-left:var(--dig-spacing__micro__large)}._share-actions_1svg2_6{display:flex;gap:var(--dig-spacing__micro__large)}._share-button-container_1svg2_11{display:flex}'));var xw;!function(e){e[e.NO_TOOLTIP=0]="NO_TOOLTIP",e[e.BIG_ONBOARDING_TOOLTIP=1]="BIG_ONBOARDING_TOOLTIP",e[e.SMALL_TOOLTIP=2]="SMALL_TOOLTIP"}(xw||(xw={}));class Dw{constructor(e){this.category="web-app_actions_telemetry",this.user_id=null,this.session_id=null,this.request_id=null,this.url=null,this.telemetry_session_id=e.telemetry_session_id,this.event_name=e.event_name,this.event_start_ts=e.event_start_ts,this.event_extras=e.event_extras,Object.seal(this)}}class Rw{static generateRandomId(){return Math.random().toString(36).substring(2)}static getCurrentTimestamp(){return(new Date).getTime()}constructor(e,t){this.logger=e,this.context=t,this.sessionId=Rw.generateRandomId()}event(e,t){const i=Rw.getCurrentTimestamp(),a=Object.assign(Object.assign({},this.context),t),n=new Dw({telemetry_session_id:this.sessionId,event_name:e,event_start_ts:i,event_extras:JSON.stringify(a)});this.logger.log(n)}}class Nw{constructor(e,t){this.logger=e,this.context=t||{}}session(e){const t=Object.assign(Object.assign({},this.context),e);return new Rw(this.logger,t)}}const kw=new a.HiveLogger;function Lw(e){return new Nw(kw,e)}const Fw=function(e){const t={};for(const i of e)t[i]=!0;return t}(["",".doc",".docx",".pdf",".dwg",".png",".jpg",".jpeg",".tiff",".m4v",".wmv",".mpg",".pptx",".xlsx",".pages",".numbers",".key"]);function Uw(e){return Fw[e]?e:"__REDACTED__"}function Vw(e){return function(e){return void 0!==e.ext}(e)?e.ext:function(e){return void 0!==e.fq_path}(e)?"."+a.file_extension(a.filename(e.fq_path)):function(e){return void 0!==e.filename}(e)?"."+a.file_extension(e.filename):void 0}function jw(e){return!!e.is_in_vault_folder}class Bw{constructor(e,t){this.start=()=>{this.isRunning=!0;const e=this.thunk,t=this.fps;let i=-1,a=-1;const n=1e3/t,r=(e,t)=>{const i=Date.now(),o=i-(t||0);return o>n&&(e(),t=i-o%n),a=requestAnimationFrame((()=>r(e,t))),a};i=requestAnimationFrame((()=>r(e))),this.cleanup=()=>{cancelAnimationFrame(i),cancelAnimationFrame(a)}},this.stop=()=>{this.isRunning=!1,this.cleanup()},this.thunk=e,this.fps=t,this.cleanup=()=>{},this.isRunning=!1}}const Hw={bottom:0,height:0,left:0,right:0,top:-1e3,width:0};class Kw extends te.default.Component{constructor(e){super(e),this.isActive=!1,this.container=te.default.createRef()}activateElementObserver(){this.isActive=!0,this.updateRect(!0),this.startRectUpdateLoop()}deactivateElementObserver(){this.stopRectUpdateLoop(),this.isActive=!1,this.activeRect=Hw}componentDidMount(){G.UEClient.on(a.UEEffectChannel,this.handleUpdate,this),G.UEClient.send(a.UEEffectChannel,{type:a.UEEffectEventType.EffectReady,containerName:this.props.containerName,elementName:this.props.name}),G.UEClient.sendEvent(this.props.containerName,`${this.props.name}.componentDidMount`,{})}componentDidUpdate(){this.updateRect(!0)}shouldUpdateActiveRect(e){if(!this.activeRect)return!0;return!(this.activeRect.top===e.top&&this.activeRect.bottom===e.bottom&&this.activeRect.left===e.left&&this.activeRect.right===e.right&&this.activeRect.width===e.width&&this.activeRect.height===e.height)}updateRect(e){if(this.isActive&&this.container&&this.container.current instanceof Element){const t=this.container.current.getBoundingClientRect();t&&(e||this.shouldUpdateActiveRect(t))&&(this.activeRect=t,this.notifyRectUpdate())}}notifyRectUpdate(){this.isActive&&G.UEClient.send(a.UEEffectChannel,{type:a.UEEffectEventType.UpdateRect,containerName:this.props.containerName,elementName:this.props.name,rect:this.activeRect})}componentWillUnmount(){this.isActive&&(this.activeRect=Object.assign({},Hw),this.notifyRectUpdate(),this.deactivateElementObserver()),G.UEClient.removeListener(a.UEEffectChannel,this.handleUpdate,this)}startRectUpdateLoop(){this.sizeObserver||(this.sizeObserver=new Bw(this.updateRect.bind(this),Kw.RectUpdateFrequencyPerSec)),this.sizeObserver.isRunning||this.sizeObserver.start()}stopRectUpdateLoop(){this.sizeObserver&&this.sizeObserver.stop()}handleUpdate(e){e.containerName===this.props.containerName&&e.elementName===this.props.name&&(e.type===a.UEEffectEventType.Activate?this.activateElementObserver():e.type===a.UEEffectEventType.Deactivate&&this.deactivateElementObserver())}render(){const e="ue-effect-container uee-"+this.props.containerName+"-"+this.props.name;return this.props.useSpan?te.default.createElement("span",{ref:this.container,className:e},this.props.children):te.default.createElement("div",{ref:this.container,className:e},this.props.children)}}Kw.displayName="UserEducationEffect",Kw.RectUpdateFrequencyPerSec=15;a.injectInternalStyle("/static/metaserver/static/js/extensions/split_share_button_component.module.out-vfl1eXjvm.css",(e=>"._docsend_tooltip_image_1qud6_1{height:98px;width:157px}._docsend_lightbulb_icon_1qud6_6{color:var(--color__attention__text);height:14px;width:16px}._docsend_badge_1qud6_12{background:var(--color__attention__background);height:18px;width:26px}._button-wrapper_1qud6_18{display:flex;white-space:nowrap}._button-wrapper_1qud6_18._invisible_1qud6_23{display:none}._share-fake-split-button-single-file_1qud6_28>.extensions-split-share__share-button,._share-fake-split-button_1qud6_27>.extensions-split-share__share-button{margin-right:1px}._share-fake-split-button-single-file_1qud6_28>.extensions-split-share__share-button{border-bottom-right-radius:0;border-top-right-radius:0}._share-fake-split-button-single-file_1qud6_28 .extensions-split-share-menu__trigger{border-bottom-left-radius:0;border-top-left-radius:0}._unportaled-menu_1qud6_45{white-space:nowrap}"));const zw={docsendTooltipImage:"_docsend_tooltip_image_1qud6_1",docsendLightbulbIcon:"_docsend_lightbulb_icon_1qud6_6",docsendBadge:"_docsend_badge_1qud6_12",buttonWrapper:"_button-wrapper_1qud6_18",invisible:"_invisible_1qud6_23",shareFakeSplitButtonSingleFile:"_share-fake-split-button-single-file_1qud6_28",shareFakeSplitButton:"_share-fake-split-button_1qud6_27",unportaledMenu:"_unportaled-menu_1qud6_45"},Ww="fp_app_id:dropbox_transfer",Gw="fp_app_id:slack_dropbox",qw="fp_app_id:trello",Qw="fp_app_id:zoom",Yw=e=>a.getStateAtNamespace(e,a.EXTENSIONS_NAMESPACE_KEY)||a.defaultExtensionsState,$w=e=>Yw(e).featureFlags,Zw=e=>Yw(e).actions;function Xw(e,t){return!(e.length>1&&!t.multiselect_enabled)&&e.every((e=>function(e,t){return void 0===t.filters||t.filters.every((t=>"matcher_any"===t[".tag"]&&!!t.matcher_any.some((t=>{if("extension"===t[".tag"]){const i=Vw(e);return t.extension===i}return"max_size_bytes"===t[".tag"]?e.bytes<=t.max_size_bytes:"is_file"===t[".tag"]?e.is_dir!==t.is_file:"is_cloud_doc"!==t[".tag"]||function(e){return!!e.is_cloud_doc}(e)===t.is_cloud_doc}))))}(e,t)))}function Jw(e){var t;const i=e.is_dir,a=jw(e),n=null===(t=e.per_node_metadata)||void 0===t?void 0:t.link_node;return!(i||a||n)}function eb(e){const t=e.per_node_metadata;return!(jw(e)||(null==t?void 0:t.link_node)||(null==t?void 0:t.suppress_ns_partition)||(null==t?void 0:t.suppress_shared_link))}function tb(e,t){return function(e,t){return e.every(Jw)?t.filter((t=>Xw(e,t))):[]}(t,Zw(e))}function ib(e,t){return t.every(eb)?tb(e,t).filter((e=>nb(e)&&![Gw,Qw,qw].includes(e.app_id))):[]}function ab(e,t){return tb(e,[t]).filter((e=>!nb(e)))}function nb(e){return"share_menu"===e.menu_alignment[".tag"]}const rb=()=>"V2"===q.BROWSE_SHARE_ENTRYPOINTS_REVAMP||"V3"===q.BROWSE_SHARE_ENTRYPOINTS_REVAMP||"V3_CONTROL"===q.BROWSE_SHARE_ENTRYPOINTS_REVAMP||"V4"===q.BROWSE_SHARE_ENTRYPOINTS_REVAMP,ob=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{PopoverItems:t}=yield new Promise((function(t,i){e(["./c_extensions_split_share_button"],t,i)}));return{default:t}}))));ob.displayName="LazyPopoverItems";const sb=()=>{const e=l.intl.formatMessage({id:"DsCb47",defaultMessage:"Loading modal"});return te.default.createElement(a.Menu.Segment,null,te.default.createElement(a.Menu.Row,null,te.default.createElement(a.Spinner,{key:"spinner",size:"small","aria-valuetext":e})))};a.getStore();const lb=a.requireCssWithComponent((t=>{const i={isVisible:!0,disabled:!1,shareButtonLabel:l.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"}),triggerType:a.TriggerType.PrimaryButton,variant:"opacity"},{user:r,files:o,context:s,isVisible:d,disabled:u,shareButtonLabel:_,triggerType:g,shouldUsePortalPopover:f,showLeftDigIcon:m,variant:h,renderMenuOnly:v,onShowShare:S,logShareButtonClick:E,onDropdownOpen:b,onDropdownClose:y,actionSurface:T,isLoading:I,size:C,showEduTooltip:A,previewsLogUserAction:M,currentFolderOnly:O,fileActionLoggingFn:P}=Object.assign(Object.assign({},i),t),x=o[0],D=o.map((e=>Object.assign(Object.assign({},e),{bytes:0}))),R=1===o.length,N=a.useSelector((e=>ib(e,D))),k=a.useSelector((e=>$w(e))),L=te.default.createRef(),F=te.default.createRef(),U=te.default.useMemo((()=>Lw(Object.assign({component:"split-share-btn"},s))),[s]),j=te.default.useMemo((()=>{if(s)return U.session({ext:Uw(x?"."+a.file_extension(a.filename(x.fq_path)):"")})}),[s,U,x]),B=a.cx("extensions-split-share__share-button",{"primary-action-menu__button":g===a.TriggerType.SidebarPrimaryButton,[a.OAPulsarPrimaryButton]:!rb()||g===a.TriggerType.ContextualRibbonPrimaryButton}),H=te.default.useMemo((()=>R&&"DEEP_INTEGRATION"===(null==k?void 0:k.hellosignDeepIntegration)&&V.isHellosignFileByExtension(Vw(Object.assign(Object.assign({},x),{bytes:0})))&&!c.is_supported_mobile_browser()),[k,R,x]),[K,z]=te.default.useState(xw.NO_TOOLTIP),W=a.useAfterDisplayModule({importer:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return{default:yield new Promise((function(t,i){e(["./c_extensions_split_share_button"],t,i)}))}}))});te.default.useEffect((()=>{A&&k&&((e,t,i,a)=>{n.__awaiter(void 0,void 0,void 0,(function*(){W&&"split_share_edu"===(yield W.getTooltipState(e,t,i,a))&&z(xw.BIG_ONBOARDING_TOOLTIP)}))})(r,x,N,k)}),[W]);const G=te.default.useCallback((e=>{e.preventDefault(),S(),null==P||P("share"),E&&E(v?a.ActionSourceValue.OVERFLOW_MENU:a.ActionSourceValue.SPLIT_SHARE),null==M||M(a.UserAction.Share,a.UserActionContext.PreviewTopNav),j&&j.event("click_share",{trigger_type:g}),e.stopPropagation()}),[S,E,j,v,g,M]),q=te.default.useCallback((()=>{j&&j.event("share_hover",{trigger_type:g})}),[j,g]),Q=te.default.useCallback((()=>{j&&j.event("popover_trigger_hover",{trigger_type:g})}),[j,g]),Y=a.useAfterDisplayPassthroughCallback({importer:()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{markTooltipViewed:t}=yield new Promise((function(t,i){e(["./c_extensions_apis"],t,i)}));return{default:{fn:t}}}))}),$=te.default.useCallback((e=>{if(e.preventDefault(),K===xw.BIG_ONBOARDING_TOOLTIP&&(Y.fn(r.id,"split_share_edu"),z(xw.NO_TOOLTIP)),e.stopPropagation(),"digClickOutsideisActiveLayer"===e.target.dataset.testid&&"click"===e.type){const e=new Event("click");document.dispatchEvent(e)}}),[K,Y,r.id]),Z=te.default.useCallback((({isOpen:e})=>{e&&b?b():!e&&y&&y(),j&&j.event(e?"open_popover":"close_popover",{trigger_type:g}),T===a.ActionSurfaceLogValue.PREVIEW_TITLEBAR&&e?null==M||M(a.UserAction.ShareMenu,a.UserActionContext.PreviewTopNav):a.UDCL.logEvent({class:"previews",action:"select",object:"share_menu",properties:{actionSurface:"browse_screen",actionElement:p.getActionElementForPAP(T)}})}),[T,j,y,b,g,M]),X={"aria-label":_,className:B,onClick:G,tabIndex:d?void 0:-1,onMouseEnter:q},J=e=>Object.assign({className:a.cx("extensions-split-share-menu__trigger"),tabIndex:d?void 0:-1,onMouseEnter:Q,"aria-label":l.intl.formatMessage({id:"5MpLpV",defaultMessage:"Expand share menu"}),"data-testid":"share-menu-dropdown"},e),ee=!!rb()&&g===a.TriggerType.ContextualRibbonPrimaryButton;return v?te.default.createElement(te.default.Suspense,{fallback:te.default.createElement(sb,null)},te.default.createElement(ob,Object.assign({},t,{currentSession:j}))):te.default.createElement("div",{className:a.cx(zw.buttonWrapper,"extensions-split-share-btn",{[zw.invisible]:!d,"hellosign-available":H,[zw.shareFakeSplitButton]:!w.isEmpty(N),[zw.shareFakeSplitButtonSingleFile]:R,[a.OAPulsarAction.SHARE_DO]:ee,[a.OAPulsarAction.UNIVERSAL_PATHWAY_SHARE]:ee}),ref:L},R&&te.default.createElement(a.Button,Object.assign({},X,{withIconLeft:m&&te.default.createElement(a.UIIcon,{src:a.ShareArrowLine,className:"extensions-split-share--icon"}),variant:h,"data-testid":"share-button",disabled:u||I,size:C}),I?te.default.createElement(a.Spinner,{size:"small","aria-valuetext":_}):te.default.createElement(Kw,{containerName:"SplitShareButton",name:"ShareButtonLabel",useSpan:!0},O?l.intl.formatMessage(Se):g===a.TriggerType.ContextualRibbonPrimaryButton?l.intl.formatMessage(Ee):_)),te.default.createElement(a.Menu.Wrapper,{className:a.cx("extensions-split-share__popover",{"hellosign-available-dropdown":H,[zw.unportaledMenu]:!f,"down-arrow-share-button-prompt-select":!0}),onClick:$,onDoubleClick:$,onSelection:e=>{e.handler()},onToggle:Z,closeOnSelection:!0,isPortaled:f,"data-tooltip":"split-share-menu",ref:F},(({getContentProps:e,getTriggerProps:i})=>te.default.createElement(te.default.Fragment,null,R?te.default.createElement(a.Button,Object.assign({},J(i()),{variant:h,disabled:u,withDropdownIcon:!0,_hasSquaredSize:!0,size:C})):te.default.createElement(a.Button,Object.assign({disabled:u},J(i()),{withIconLeft:te.default.createElement(a.UIIcon,{src:a.ShareArrowLine,className:"extensions-split-share--icon"}),variant:h,withDropdownIcon:!0,size:C}),l.intl.formatMessage({id:"DHK0zq",defaultMessage:"Share all selected"})),te.default.createElement(a.Menu.Content,Object.assign({placement:"bottom-end",className:"rc-action-bar-submenu-content"},e()),te.default.createElement(te.default.Suspense,{fallback:te.default.createElement(sb,null)},te.default.createElement(ob,Object.assign({},t,{currentSession:j,menuTriggerRef:F}))))))))}),["/static/metaserver/static/css/app_actions/index-vflCAz_2f.css"]);a.injectInternalStyle("/static/metaserver/static/js/previews/ui/sharing_plugin/copy_link_button.module.out-vflC6OV75.css",(e=>"._copy-link-button_17vqe_1{padding:0 var(--dig-spacing__micro__small)}._copy-link-button-container_17vqe_5{align-self:center}._simple-copy-link-button-success_17vqe_9{color:var(--dig-color__text__subtle)}._copy_link_icon_only_17vqe_13{width:40px}"));const cb="_copy-link-button_17vqe_1",db="_simple-copy-link-button-success_17vqe_9",ub=l.intl.formatMessage({id:"Kb7u3s",defaultMessage:"Copy link"}),_b=l.intl.formatMessage({id:"DsCb47",defaultMessage:"Loading modal"}),pb=l.intl.formatMessage({id:"Vxze7Q",defaultMessage:"Share"}),gb=l.intl.formatMessage({id:"FYZVZV",defaultMessage:"Link Copied!"}),fb=l.intl.formatMessage({id:"t0CNN+",defaultMessage:"Copied!"}),mb=t=>{const{featureConfig:r,logUserAction:o}=u.useFileViewerContext(),s="V3"===r.vish_copy_link_file_preview?pb:"V4"===r.vish_copy_link_file_preview||"V2"===r.vish_copy_link_file_preview?ub:void 0,[l,d]=i.useState(s),_="V3"===r.vish_copy_link_file_preview?te.default.createElement(a.UIIcon,{src:a.ShareArrowLine}):"V4"===r.vish_copy_link_file_preview||"V1"===r.vish_copy_link_file_preview||"V2"===r.vish_copy_link_file_preview?te.default.createElement(a.UIIcon,{src:a.LinkLine}):void 0,[p,g]=i.useState(_),[f,m]=i.useState(!1);i.useEffect((()=>{if(f){const e=setTimeout((()=>{d(s),g(_),m(!1)}),3e3);return()=>{clearTimeout(e)}}return()=>{}}),[f]);const h=te.default.useCallback((()=>{a.logPAPCreateSharedLinkEvent({eventState:"start",actionSurface:a.ActionSurfaceLogValue.PREVIEW_TITLEBAR,requestedAccessLevel:"viewer",fileIdOrPath:t.fileId}),o(a.UserAction.CopyLink,a.UserActionContext.PreviewTopNav);const e=a.isSharedLinkAttributionTrackingEnabled()?a.vendSenderTrackey():"";a.copyToClipboard(a.isSharedLinkAttributionTrackingEnabled()?a.appendTrackeyToSharedLinkAndSortParams(window.location.href,e):window.location.href),m(!0),"V3"===r.vish_copy_link_file_preview?d(gb):d(fb),g(te.default.createElement(a.UIIcon,{src:a.CheckmarkCircleLine}));const i=c.get_browser_info();a.logPAPCreateSharedLinkEvent({eventState:"success",actionSurface:a.ActionSurfaceLogValue.PREVIEW_TITLEBAR,requestedAccessLevel:"viewer",fileIdOrPath:t.fileId});const n={file_id:t.fileId,fq_path:t.filePath,browser:i.browser,browser_version:i.version,sender_trackey:a.isSharedLinkAttributionTrackingEnabled()?e:void 0};t.user?a.ShareTibEventLogger.log(t.user.id,a.TiburonEventName.CopySharedLink,a.SHARE_ACTION_ORIGIN_TYPE.SIMPLE_COPY_LINK_FILE_PREVIEW,n):a.ShareTibEventLogger.log_unauth(a.TiburonEventName.CopySharedLink,a.SHARE_ACTION_ORIGIN_TYPE.SIMPLE_COPY_LINK_FILE_PREVIEW,n)}),[]),v=a.useAfterDisplayPassthroughCallback({importer:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return new Promise((function(t,i){e(["./c_views_copy_link_mini_modal"],t,i)})).then((({CopyLinkMiniModal:e})=>({default:{fn:e.show}})))}))}),S=te.default.useCallback((()=>{if(!t.user)return;o(a.UserAction.CopyLink,a.UserActionContext.PreviewTopNav);const e={browseFile:t.file,user:t.user,filePath:t.fileId,setIsCreatingSharedLink:()=>{},anchorRef:t.anchorRef,userActionSurfaceLogValue:a.ActionSurfaceLogValue.PREVIEW_TITLEBAR,zIndexOverride:500,yOffsetDistance:8};v.fn(e)}),[t,v]),E=te.default.createElement(a.Tooltip,{title:ub},te.default.createElement(a.IconButton,{className:cb,variant:"borderless",size:"large",onClick:S,"aria-label":ub,"data-testid":"copy-link-button",disabled:v.status===a.MafLoadAfterDisplayStatus.Loading},v.status===a.MafLoadAfterDisplayStatus.Loading?te.default.createElement(a.Spinner,{size:"small","aria-valuetext":_b}):te.default.createElement(a.UIIcon,{src:a.LinkLine}))),w=te.default.createElement("div",{className:"_copy-link-button-container_17vqe_5"},te.default.createElement(a.Tooltip,{title:void 0===l?ub:l},te.default.createElement(a.Button,{variant:"V1"!==r.vish_copy_link_file_preview||f?"transparent":"borderless",size:"large",onClick:h,"aria-label":ub,"data-testid":"copy-link-button",withIconStart:p,className:a.cx({[db]:f,[cb]:!("V1"===r.vish_copy_link_file_preview&&!f),_copy_link_icon_only_17vqe_13:"V1"===r.vish_copy_link_file_preview&&!f})},te.default.createElement(a.Text,{className:a.cx({[db]:f}),style:{fontWeight:"500",fontSize:"14px",lineHeight:"18px"}},l))));return!t.file&&t.showSimpleCopyLinkButton?w:E};mb.displayName="RedesignedCopyLinkButton";const hb=o.createApiv2Query({nsClient:a.GetSharingRoutes,rpc:"alpha/get_file_metadata"}),vb=a.defineMessage({id:"VzQ1nj",defaultMessage:"Ask the owner of this file for permission to share it with others"}),Sb=a.defineMessage({id:"JDi0M8",defaultMessage:"Share"}),Eb=()=>{const e=a.useIntl(),t=e.formatMessage(Sb),i=e.formatMessage(vb),n=te.default.createElement(a.UIIcon,{src:a.ShareArrowLine});return te.default.createElement(a.Tooltip,{title:i,placement:"left"},te.default.createElement("span",{className:"_disabled-share-button_1svg2_1",tabIndex:0},te.default.createElement(a.SplitButton,{variant:"primary",size:"large",disabled:!0,renderMenu:({buttonProps:e})=>te.default.createElement(a.Menu.Wrapper,null,(({getTriggerProps:t,getContentProps:i})=>te.default.createElement(te.default.Fragment,null,te.default.createElement(a.Button,Object.assign({"aria-label":"Show options"},e,t(),{disabled:!0})),te.default.createElement(a.Menu.Content,Object.assign({},i(),{placement:"bottom-end"})))))},n,t)))};Eb.displayName="DisabledShareButton";const wb=t=>{const{previewSurface:i,activeFile:r,user:o}=t,s=te.default.useRef(null),l=te.default.useMemo((()=>a.getStore()),[]),{pluginContext:c,featureConfig:d}=u.useFileViewerContext(),_=i===a.SDKPreviewSurface.SHARED_CONTENT_LINK||i===a.SDKPreviewSurface.SHARED_LINK||i===a.SDKPreviewSurface.INBAND_SHARE,p=a.isSharedFile(r),g=a.isEncryptedFile(r),f=i===a.SDKPreviewSurface.BROWSE&&o&&a.isBrowseFile(r),m=xs(),h=a.useEmitter$1(),v=(i===a.SDKPreviewSurface.SHARED_LINK||i===a.SDKPreviewSurface.SHARED_CONTENT_LINK&&a.rlKeyExists())&&"OFF"!==d.vish_copy_link_file_preview&&"CONTROL"!==d.vish_copy_link_file_preview;te.default.useEffect((()=>{(i===a.SDKPreviewSurface.SHARED_LINK||i===a.SDKPreviewSurface.SHARED_CONTENT_LINK&&a.rlKeyExists())&&"OFF"!==d.vish_copy_link_file_preview&&a.logStormcrowExposure("acq_vish_copy_link_file_preview",d.vish_copy_link_file_preview)}),[d,i]),te.default.useEffect((()=>{["ON","CONTROL"].includes(a.fileViewerFeatureExperiments.flexibleSharingEntrypointM1)&&h.select(a.SHOW_SHARE_BUTTON_ON_FILE_PREVIEWS).emit({variant:a.fileViewerFeatureExperiments.flexibleSharingEntrypointM1,file:r})}),[h,r]);const S=a.useAfterDisplayPassthroughCallback({importer:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return new Promise((function(t,i){e(["./c_integrations_hellosign_deep_integration_util"],t,i)})).then((({openSendForSignatureOnPreviews:e})=>({default:{fn:e}})))}))}),E=a.useAfterDisplayModule({importer:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return{default:yield new Promise((function(t,i){e(["./c_sharing_flexible-share-entry-point_index"],t,i)}))}}))}),w=go(),b=te.default.useCallback(((e,t,i)=>n.__awaiter(void 0,void 0,void 0,(function*(){return yield S.fn(e,w,o,m,t,i)}))),[S,w,o,m]),y=a.useAfterDisplayPassthroughCallback({importer:()=>new Promise((function(t,i){e(["./c_file_viewer_common_share_helpers"],t,i)})).then((e=>({default:{fn:e.share}})))}),[T,I]=te.default.useState(!1),C=te.default.useMemo((()=>({origin:_?a.SHARE_ACTION_ORIGIN_TYPE.SHARING_PREVIEW_PAGE:a.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,docsendAnalyticsAddOn:a.fileViewerFeatureExperiments.docsendAnalyticsAddOn,flexibleSharingEntrypoint:a.fileViewerFeatureExperiments.flexibleSharingEntrypointM1})),[_]),A=te.default.useCallback((()=>{o&&("CONTROL"!==C.flexibleSharingEntrypoint&&"ON"!==C.flexibleSharingEntrypoint||(R.logExposure({feature:"flexible_sharing_entrypoint_m1",variant:C.flexibleSharingEntrypoint}),a.logVariantExposure("flexible_sharing_entrypoint_m1",C.flexibleSharingEntrypoint),h.select(a.CLICK_SHARE_BUTTON_ON_FILE_PREVIEWS).emit({variant:a.fileViewerFeatureExperiments.flexibleSharingEntrypointM1,file:r})),"ON"!==C.flexibleSharingEntrypoint?y.fn(r,o,null,C):I(!0))}),[r,o,C,y]),M=te.default.useMemo((()=>{return Object.assign(Object.assign({},r),{icon:a.isBrowseFile(r)?r.icon:"",fq_path:a.isBrowseFile(r)?r.fq_path:"",is_cloud_doc:dt(r),type:(e=r,"type"in e?e.type:a.FileTypes.FILE)});var e}),[r]),O=!g,P=!_&&!g;return!o&&"OFF"===d.vish_copy_link_file_preview||i===a.SDKPreviewSurface.VERSION_HISTORY?null:te.default.createElement(te.default.Fragment,null,te.default.createElement("div",{className:"_share-actions_1svg2_6",ref:s},O&&!v&&f&&te.default.createElement(yb,Object.assign({showShareButton:P,modalRef:s,showSimpleCopyLinkButton:!1},t)),O&&!v&&!f&&te.default.createElement(bb,Object.assign({showShareButton:P,modalRef:s,isSharing:p},t)),O&&v&&!f&&te.default.createElement(yb,Object.assign({showShareButton:P,modalRef:s,showSimpleCopyLinkButton:!0},t)),P&&o&&te.default.createElement(a.Provider,{store:l},te.default.createElement(lb,{files:[M],user:o,variant:"primary",onShowShare:A,previewsLogUserAction:c.logUserAction,onSendForSignature:b,size:"large",isLoading:S.status===a.MafLoadAfterDisplayStatus.Loading||y.status===a.MafLoadAfterDisplayStatus.Loading,actionSurface:a.ActionSurfaceLogValue.PREVIEW_TITLEBAR}))),"ON"===C.flexibleSharingEntrypoint&&T&&E&&null!==s.current&&o&&te.default.createElement(a.Provider,{store:u.getStoreForBrowse()},te.default.createElement(E.FlexibleShareEntryPoint,{fileOrFolder:r,user:o,shareModalExtras:C,modalRef:s,isOpen:T,onRequestClose:()=>I(!1),actionSurface:"previews",actionElement:"split_share_menu"})))};wb.displayName="RedesignedShareButton";const bb=e=>{var t;const i=hb.useQuery({apiArg:{file:e.activeFile.file_id}}),n=(null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.apiData)?a.fileMetadataApiToRecord(i.data.apiData):void 0,r=n&&[a.ACCESS_LEVEL.WRITER,a.ACCESS_LEVEL.OWNER].includes(n.access_type);return e.isSharing&&!r&&n?te.default.createElement(Eb,null):r?te.default.createElement(yb,Object.assign({},e)):null};bb.displayName="CopyLinkButtonMetadataWrapper";const yb=({activeFile:e,user:t,showShareButton:i,modalRef:n,showSimpleCopyLinkButton:r})=>te.default.createElement("div",{className:"_share-button-container_1svg2_11"},te.default.createElement(mb,{file:a.isBrowseFile(e)?e:void 0,fileId:e.file_id,user:t,variant:i?"opacity":"primary",anchorRef:n,showSimpleCopyLinkButton:r}));yb.displayName="CopyLinkButtonComponent";const Tb=[a.SDKPreviewSurface.BACKUP,a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.SHARED_LINK_EMBED,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.TRANSFER,a.SDKPreviewSurface.UNKNOWN,a.SDKPreviewSurface.VERSION_HISTORY,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.VIDEO_SYNTHESIS],Ib=(e,t)=>!a.isSharedFile(e)||!!t&&a.isDownloadAllowed(t),Cb={filterValidFile:e=>!st(e)||ct(e)||dt(e)?void 0:e,filterValidUser:e=>({user:e}),shouldShowForPreviewSurface:Bd(Tb),shouldShowForPreviewType:Fd};a.injectInternalStyle("/static/metaserver/static/js/file_viewer/action_plugins/titlebar_button.module.out-vflQnPhVm.css",(e=>"._icon-button_3liva_1{line-height:normal;padding:0 var(--dig-spacing__micro__small)}"));const Ab=({label:e,showLabel:i,action:n,icon:r,disabled:o={disabled:!1},expanded:s,dataTooltip:l=""})=>{const c=Js(),d=a.useIntl(),u=!i||c!==t.FileViewerBreakpoint.LG,_=d.formatMessage(e),p={onClick:n,disabled:o.disabled,tabIndex:0,"aria-label":_,"aria-expanded":s},g=u?te.default.createElement(a.IconButton,Object.assign({variant:"borderless",size:"large"},p,{className:"_icon-button_3liva_1"}),r):te.default.createElement(a.Button,Object.assign({variant:"borderless",withIconLeft:r},p),_);let f=null;return o.disabled&&o.tooltipMessage?f={title:d.formatMessage(o.tooltipMessage)}:u&&(f={title:_}),f?te.default.createElement(a.Tooltip,Object.assign({maxWidth:320},f),te.default.createElement("span",{"data-tooltip":l},g)):te.default.createElement("span",{"data-tooltip":l},g)};Ab.displayName="TitlebarButton";const Mb=t=>{const{file:i}=t.getActiveFile();return{label:re,icon:a.DownloadLine,userAction:a.UserAction.Download,action:{type:"click",handler:()=>new Promise((function(t,i){e(["./c_action_plugins_download_action_action"],t,i)})).then((({downloadActionWrapper:e})=>e(t)))},disabled:Ib(i,t.sharePermission)?{disabled:!1}:{disabled:!0,tooltipMessage:oe}}},Ob=t=>({label:se,userAction:a.UserAction.SaveToDropbox,icon:a.DropboxLine,action:{type:"click",handler:()=>new Promise((function(t,i){e(["./c_action_plugins_download_action_action"],t,i)})).then((({sharedCopyActionWrapper:e})=>e(t)))},disabled:t.sharePermission&&a.isDownloadAllowed(t.sharePermission)?{disabled:!1}:{disabled:!0,tooltipMessage:le},dataTooltip:mm.SaveACopy}),Pb=kd(Cb,((e,t,i,n,r,o,s,l,c,d)=>{const u={getActiveFile:t,context:i,fileContentMetadata:n,previewSurface:r,user:e.user,shareToken:o,sharePermission:s,encryptionOptions:l,authModalKind:c,fileName:d};return a.isSharedFile(e.file)?[Ob(u),Mb(u)]:[Mb(u)]}),[]),xb=te.default.memo((e=>{const t=(({getActiveFile:e,context:t,fileContentMetadata:i,fileName:a,previewSurface:n,user:r,shareToken:o,sharePermission:s,encryptionOptions:l,authModalKind:c,outOfQuota:d,userActionContext:u})=>t?{getActiveFile:e,context:t,fileContentMetadata:i,fileName:a,previewSurface:n,user:r,shareToken:o,sharePermission:s,encryptionOptions:l,authModalKind:c,outOfQuota:d,userActionContext:u}:void 0)(e);return t?te.default.createElement(Db,Object.assign({},t,{userActionContext:a.UserActionContext.PreviewTopNav})):null}));xb.displayName="DownloadActionButton";const Db=({getActiveFile:t,context:i,fileContentMetadata:n,fileName:r,previewSurface:o,user:s,shareToken:l,sharePermission:d,encryptionOptions:_,authModalKind:p,outOfQuota:g,videoEditEligible:f,userActionContext:m})=>{const{featureConfig:h,isLoggedIn:v,logUserAction:S}=u.useFileViewerContext(),E="V2"===(null==h?void 0:h.vish_oob_download_prompt_variant)&&!v&&!c.is_mobile_or_tablet(),w=Ib(t().file,d),b=te.default.useMemo((()=>w?{disabled:!1}:{disabled:!0,tooltipMessage:oe}),[w]),y=te.default.useCallback((()=>(S(a.UserAction.Download,m),new Promise((function(t,i){e(["./c_action_plugins_download_action_action"],t,i)})).then((({downloadActionWrapper:e})=>e({getActiveFile:t,context:i,fileContentMetadata:n,fileName:r,previewSurface:o,user:s,shareToken:l,sharePermission:d,encryptionOptions:_,authModalKind:p,outOfQuota:g,videoEditEligible:f,userActionContext:m}))))),[p,i,_,n,r,t,S,g,o,d,l,s,m,f]);return te.default.createElement(Ab,{label:re,icon:te.default.createElement(a.UIIcon,{src:a.DownloadLine}),action:y,disabled:b,showLabel:E})};Db.displayName="DownloadActionButtonImpl";const Rb=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.SHARED_COLLECTION,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.SHARED_LINK_EMBED,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.TRANSFER,a.SDKPreviewSurface.UNKNOWN,a.SDKPreviewSurface.VERSION_HISTORY,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.VIDEO_SYNTHESIS,a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],Nb={filterValidFile:Ld,filterValidUser:Ud,shouldShowForPreviewSurface:Bd(Rb),shouldShowForPreviewType:Fd},kb=e=>{const t=oo(p.FILE_ACTIVITY_PLUGIN_ID,a.UserActionContext.FileMenu);return te.default.useMemo((()=>Lb(e,t)),[e,t])},Lb=kd(Nb,((e,t)=>({userAction:void 0,icon:T.FileHistoryLine,label:Ne,accessibleLabel:ke,action:{type:"click",handler:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return t()}))},disabled:{disabled:!1}})),void 0),Fb=({previewSurface:e,user:t,activePreviewFile:i,canRestoreRevision:n})=>te.default.createElement(Ub,{userActionContext:a.UserActionContext.PreviewTopNav,previewSurface:e,user:t,activePreviewFile:i,canRestoreRevision:n});Fb.displayName="FileActivityIconButton";const Ub=({userActionContext:e,previewSurface:t,user:i,activePreviewFile:n,canRestoreRevision:r})=>{var o;const{fileViewerId:s,logUserAction:l}=u.useFileViewerContext(),c=$r(ao,s),d=$r(jn,s),_=null!==(o=_r().previewType)&&void 0!==o?o:a.PreviewType.Loading,g=n.file,f=n.sharePermission,m=te.default.useMemo((()=>({file:g,user:i,previewSurface:t,previewType:_,sharePermission:f,previewKey:d,canRestoreRevision:r})),[g,r,d,t,_,f,i]),h=kb(m),v=(null==h?void 0:h.disabled)?h.disabled:{disabled:!0,tooltipMessage:oe},S=ro(p.FILE_ACTIVITY_PLUGIN_ID,e),E=te.default.useCallback((()=>new Promise((()=>{c===p.FILE_ACTIVITY_PLUGIN_ID?S():h&&((e=>{const{action:t,disabled:i}=e;"click"!==t.type||i.disabled||t.handler()})(h),l(a.UserAction.FileActivity,e))}))),[c,h,S,l,e]);return te.default.createElement("div",{className:"file-activity-title-bar-button"},te.default.createElement(Ab,{label:Ne,icon:te.default.createElement(a.UIIcon,{src:x.AnalyticsLine}),disabled:v,action:E}))};Ub.displayName="FileActivityIconButtonImpl";a.injectInternalStyle("/static/js/file_viewer/titlebar/editor_actions.module.out-vflVp6gai.css",(e=>"._titleBarActionButtons_s9sre_1{display:flex}._titleBarActionButtons_s9sre_1>*{margin-left:var(--dig-spacing__micro__small)}"));var Vb;!function(e){e.SAVE_COPY="SAVE_COPY",e.REPLACE_ORIGINAL="REPLACE_ORIGINAL"}(Vb||(Vb={}));const jb=a.defineMessage({id:"wKJF7t",defaultMessage:"Save a copy"}),Bb=a.defineMessage({id:"3bimYD",defaultMessage:"Replace original"}),Hb=a.defineMessage({id:"bCvfFu",defaultMessage:"Save"}),Kb=a.defineMessage({id:"H9szIK",defaultMessage:"Cancel"}),zb=({titleBarActionGetters:e,canEdit:t,size:i})=>{const n=a.useIntl(),{onSaveReplace:r,isEditorReady:o,onCancel:s,onSaveCopy:l,hasEditorChanges:c,editorCanSave:d}=e,u=!o||!c||!d;return te.createElement("div",{className:"_titleBarActionButtons_s9sre_1"},te.createElement(a.Button,{variant:"opacity",size:i,onClick:s},n.formatMessage(Kb)),t?te.createElement(a.Menu.Wrapper,{onSelection:e=>{switch(e){case Vb.REPLACE_ORIGINAL:null==r||r();break;case Vb.SAVE_COPY:null==l||l()}}},(({getTriggerProps:e,getContentProps:t})=>te.createElement(te.Fragment,null,te.createElement(a.Button,Object.assign({variant:"primary",size:i,withDropdownIcon:!0},e(),{disabled:u}),n.formatMessage(Hb)),te.createElement(a.Menu.Content,Object.assign({},t()),te.createElement(a.Menu.Segment,null,te.createElement(a.Menu.ActionItem,{value:Vb.SAVE_COPY},n.formatMessage(jb)),te.createElement(a.Menu.ActionItem,{value:Vb.REPLACE_ORIGINAL},n.formatMessage(Bb))))))):te.createElement(a.Button,{variant:"primary",size:i,onClick:l,disabled:u},n.formatMessage(jb)))};zb.displayName="TitleBarEditorActionButtons";const Wb=a.defineMessage({id:"f9nEyK",defaultMessage:"Unsaved changes"}),Gb=a.defineMessage({id:"jr0/mV",defaultMessage:"No changes made"}),qb=({onLogInOrSignUp:e,editorCanSave:t=!0})=>te.createElement(a.Text,{color:"faint"},te.createElement(a.FormattedMessage,{id:"3UzzHS",defaultMessage:"<btn>Log in</btn> or <btn>Sign up</btn> to save",values:{btn:i=>te.createElement(a.Box,{as:a.Button,variant:"transparent",onClick:e,fontFamily:"Text",disabled:!t},i)}}));qb.displayName="LoggedOutChangesLabel";const Qb=({hasEditorChanges:e,isEditorReady:t,editorCanSave:i,onLogInOrSignUp:n,color:r,showLoggedOutLabel:o})=>{const s=a.useIntl(),l=e?Wb:Gb;return t?te.createElement(a.Box,{display:"flex",flexDirection:"column",borderWidth:"1",borderColor:"Border Subtle",borderRight:"Solid",paddingRight:"Micro Large"},te.createElement(a.Text,{color:r},s.formatMessage(l)),o&&te.createElement(qb,{onLogInOrSignUp:n,editorCanSave:i})):null};Qb.displayName="TitleBarEditorChangesDisplay";const Yb=e=>{var t,i;const{fileViewerId:a}=u.useFileViewerContext(),n=(null===(i=null===(t=$r(to,a))||void 0===t?void 0:t.sidebarPlugins)||void 0===i?void 0:i.right)===p.COMMENTS_PLUGIN_ID,r=ro(p.COMMENTS_PLUGIN_ID,e),o=so(p.COMMENTS_PLUGIN_ID,e),s=te.default.useCallback((()=>{n?r():o()}),[n,r,o]);return{isRightSidebarComments:n,handleClick:s}},$b=kd({shouldShowForPreviewType:e=>e!==a.PreviewType.CloudDoc,filterValidFile:e=>dt(e)?void 0:e,filterValidUser:e=>({user:e}),shouldShowForPreviewSurface:e=>e!==a.SDKPreviewSurface.BACKUP},((e,t,i)=>({label:t?De:Pe,accessibleLabel:t?Re:xe,userAction:void 0,icon:a.CommentLine,action:{type:"click",handler:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return i()}))},disabled:{disabled:!1}})),void 0),Zb=({activePreviewFile:e,commentIconWithUnreadCount:t})=>{var i;const{isRightSidebarComments:r,handleClick:o}=Yb(a.UserActionContext.PreviewTopNav);if(dt(e.file))return null;const s=t;return te.default.createElement(Ab,{label:Oe,icon:te.default.createElement(s,{fileId:e.file.file_id,sharedLinkURL:null===(i=e.sharedLinkInfo)||void 0===i?void 0:i.url}),action:()=>n.__awaiter(void 0,void 0,void 0,(function*(){return o()})),expanded:r,dataTooltip:mm.TitleBarRightSectionComments})};Zb.displayName="CommentTitleBarRightSectionButton";a.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/shared/login_signup_buttons.module.out-vflt_j1I4.css",(e=>"._auth_gvztu_1>:not(:last-child){margin-right:8px}"));const Xb=({showAuthModal:e,activePreviewFile:t,className:i})=>{var n;const r=a.useIntl(),o=r.formatMessage({id:"VbukJp",defaultMessage:"Log in"}),s=t.sharedLinkInfo&&(null===(n=t.sharePermission)||void 0===n?void 0:n.isSharedFolder)?"outofband_folder_share":"outofband_file_share";return te.createElement("div",{className:a.cx("_auth_gvztu_1",i)},te.createElement(a.Button,{onClick:()=>e({mode:a.AuthMode.LOGIN,kind:a.LoginOrRegisterKind.SIDEBAR,webSignInTag:s,loggingExtra:{signup_source:"nav_signin_cta"},authDialogPreviousElement:a.AuthDialogPreviousElementTag.LOG_IN,sharedLinkInfo:t.sharedLinkInfo}),"aria-label":r.formatMessage({id:"Cg3xuN",defaultMessage:"Button to trigger login dialog"}),variant:"opacity",size:"large"},o),te.createElement(a.Button,{className:"previews_campaign_slot_sign_up",onClick:()=>e({mode:a.AuthMode.REGISTER,kind:a.LoginOrRegisterKind.SIDEBAR,webSignInTag:s,loggingExtra:{signup_source:"nav_signup_cta"},authDialogPreviousElement:a.AuthDialogPreviousElementTag.SIGN_UP,sharedLinkInfo:t.sharedLinkInfo}),"aria-label":r.formatMessage({id:"B9J0l9",defaultMessage:"Button to trigger sign up dialog"}),variant:"primary",size:"large"},r.formatMessage({id:"5KEf7W",defaultMessage:"Sign up"})))};Xb.displayName="LoginSignupButtons";const Jb=({breakpoint:e})=>e===t.FileViewerBreakpoint.LG?te.createElement("div",{className:"_separator_1rs6t_43"}):null;Jb.displayName="TitleBarSeparator";const ey=a.defineMessage({id:"ZcVVjw",defaultMessage:"{file_number} of {file_count}"}),ty=a.defineMessage({id:"FRXiLI",defaultMessage:"{file_number} of many"}),iy=a.defineMessage({id:"4EnS68",defaultMessage:"Navigate to the previous file"}),ay=a.defineMessage({id:"IqM7nt",defaultMessage:"Navigate to the next file"}),ny=({fileCollectionContext:e})=>{const t=a.useIntl(),{featureConfig:i,pluginNavigation:n}=u.useFileViewerContext();if(!e||0===e.parent_files_count)return null;const r=e.file_index,o=e.parent_files_count,s=e.parent_files_count<1e3?t.formatMessage(ey,{file_number:r+1,file_count:o}):t.formatMessage(ty,{file_number:r+1}),l=!!i.file_flipping&&o>1;return te.createElement("div",{className:"_titleBarFileCounterContainer_1rs6t_33"},l&&te.createElement(a.IconButton,{"aria-label":t.formatMessage(iy),disabled:0===r,onClick:()=>{var e;null===(e=n.fileFlipping)||void 0===e||e.flipToPreviousFile(a.UserActionContext.PreviewTopNav)},size:"small",variant:"borderless"},te.createElement(a.UIIcon,{src:T.ArrowLeftLine,width:"20px",height:"20px"})),te.createElement(a.Text,{className:"_titleBarFileCounter_1rs6t_33","data-testid":"title-bar-file-counter",size:"small"},s),l&&te.createElement(a.IconButton,{"aria-label":t.formatMessage(ay),disabled:r===o-1,onClick:()=>{var e;return null===(e=n.fileFlipping)||void 0===e?void 0:e.flipToNextFile(a.UserActionContext.PreviewTopNav)},size:"small",variant:"borderless"},te.createElement(a.UIIcon,{src:D.ArrowRightLine,width:"20px",height:"20px"})))};ny.displayName="TitleBarFileCounter";const ry=({previewSurface:e,activePreviewFile:t,commentIconWithUnreadCount:i,user:n,showAuthModal:r,breakpoint:o,canRestoreRevision:s})=>{var l;const{pluginArgs:c}=Mm(),{fileViewerId:d,pluginContext:_,pluginNavigation:p}=u.useFileViewerContext(),g=!n,f=e!==a.SDKPreviewSurface.BACKUP&&e!==a.SDKPreviewSurface.SHARED_COLLECTION&&e!==a.SDKPreviewSurface.VERSION_HISTORY&&e!==a.SDKPreviewSurface.DESKTOP_PREVIEW&&e!==a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW&&e!==a.SDKPreviewSurface.POLLUX_DESKTOP_PREVIEW,m=Os(),{data:h}=cu(m),v=null===(l=null==h?void 0:h.apiData)||void 0===l?void 0:l.metadata,S="V1"===a.fileViewerFeatureExperiments.fileActivityDiscoverability;return te.createElement("div",{className:"_titleBarActionButtons_1rs6t_24","data-tooltip":"title-bar-right-section"},S&&te.createElement(Fb,{previewSurface:e,user:n,activePreviewFile:t,canRestoreRevision:s}),!!i&&te.createElement(Zb,{fileViewerId:d,activePreviewFile:t,navigation:p,commentIconWithUnreadCount:i}),te.createElement(xb,Object.assign({context:_,previewSurface:e,fileContentMetadata:v},c,{fileName:null==m?void 0:m.name})),f&&te.createElement(wb,{activeFile:t.file,previewSurface:e,user:n}),g&&te.createElement(te.Fragment,null,te.createElement(Jb,{breakpoint:o}),te.createElement(Xb,{showAuthModal:r,activePreviewFile:t})))};ry.displayName="TitleBarActionButtons";const oy=e=>{const{previewSurface:i,passSessionId:n,pluginArgs:r,fileConfig:o}=Mm(),{fileViewerId:s,isLoggedIn:l}=u.useFileViewerContext(),c=$r(io,s),d=Qr(s),_=Yr(d),p=null==_?void 0:_.file_collection_context,g=Ms(),f=Pw(),m=g===a.PreviewType.Image&&"ON"===a.fileViewerFeatureExperiments.previewsExpUngateImageEdit&&!l;if(!r)return null;const{user:h,canRestoreRevision:v,getActiveFile:S}=r,E=S(),w=g===a.PreviewType.Video||g===a.PreviewType.Audio?o.canEdit:g!==a.PreviewType.Image||h&&a.isBrowseFile(E.file)&&!E.file.read_only,b=a.canWatermarkFile({file:E.file,user:h}),y=(({activePreviewFile:{file:e,sharePermission:t},previewSurface:i})=>a.isSharedFile(e)?!!t&&t.canViewMetadataRoles.length>0:i!==a.SDKPreviewSurface.VERSION_HISTORY)({previewSurface:i,activePreviewFile:E})&&e.breakpoint!==t.FileViewerBreakpoint.SM,T=e.breakpoint===t.FileViewerBreakpoint.MD;return te.createElement("div",{className:"_titleBarRightSection_1rs6t_1"},c?te.createElement("div",{className:"_editorActions_1rs6t_18"},te.createElement(Qb,{hasEditorChanges:e.titleBarActionGetters.hasEditorChanges,isEditorReady:e.titleBarActionGetters.isEditorReady,editorCanSave:e.titleBarActionGetters.editorCanSave,onLogInOrSignUp:()=>{var t,i;null===(i=(t=e.titleBarActionGetters).onSaveCopy)||void 0===i||i.call(t),e.showAuthModal(Hu({action:"edit"},g,void 0))},color:"faint",showLoggedOutLabel:m}),te.createElement(zb,{titleBarActionGetters:e.titleBarActionGetters,canEdit:w||b,size:"large"})):te.createElement(te.Fragment,null,te.createElement("div",{className:"_titleBarRightSectionTopRow_1rs6t_9"},te.createElement(te.Fragment,null,te.createElement(f,{activePreviewFile:E,passSessionId:n,enablePassUi:y,user:h,onlyShowOverflow:T}),y&&te.createElement(Jb,{breakpoint:e.breakpoint})),p&&e.breakpoint===t.FileViewerBreakpoint.LG&&te.createElement(te.Fragment,null,te.createElement(ny,{fileCollectionContext:p}),te.createElement(Jb,{breakpoint:e.breakpoint})),te.createElement(ry,Object.assign({commentIconWithUnreadCount:e.commentIconWithUnreadCount,showAuthModal:e.showAuthModal,breakpoint:e.breakpoint,canRestoreRevision:v||!1},{activePreviewFile:E,user:h,previewSurface:i})))))};oy.displayName="TitleBarRightSection";const sy=te.memo((({titleBarActionGetters:e,commentIconWithUnreadCount:i,file:n,showAuthModal:r})=>{a.useMarkTimingEventOnMount(a.PreviewsTimingEvents.FVSDK_TITLE_BAR_MOUNT);const{fileViewerId:o,canCloseViewer:s,featureConfig:l}=u.useFileViewerContext(),c=Js(),d=l.titlebar_logo_config.base_url,_=c===t.FileViewerBreakpoint.SM,p=Eo(o),g=$r(io,o),f=p||g,m="bright"===a.useTheme().mode,h=wm(),v=$r(Yn,o);return v?te.createElement("div",{className:Tm},te.createElement("header",{className:a.cx(Im,{_fullscreen_ij09q_23:m&&v}),"data-testid":u.TITLE_BAR_TEST_ID},te.createElement("div",{className:Cm},te.createElement(Bm,{inEditMode:f,file:n,breakpoint:c})),te.createElement(al,{fileViewerId:o}))):te.createElement("div",{className:Tm},te.createElement("header",{className:a.cx(Im,{_editMode_ij09q_19:e.isEditorReady}),"data-testid":u.TITLE_BAR_TEST_ID},te.createElement(ym,{fileViewerId:o,baseUrl:d,canCloseViewer:s,inEditMode:f,titleBarActionGetters:e,breakpoint:c}),te.createElement("div",{className:Cm},te.createElement(Bm,{inEditMode:f,file:n,breakpoint:c}),f||c===t.FileViewerBreakpoint.SM?null:te.createElement(h,null)),!_&&te.createElement(oy,{titleBarActionGetters:e,commentIconWithUnreadCount:i,showAuthModal:r,breakpoint:c})))}));sy.displayName="TitleBar",sy.displayName="TitleBar";a.injectInternalStyle("/static/metaserver/static/js/file_viewer/sidebar/sidebar.module.out-vfluv4A75.css",(e=>"._sidebar-content_jgsyc_1._comment-content_jgsyc_1{padding:0}._sidebar-content_jgsyc_1._transcript-content_jgsyc_5{box-sizing:border-box;padding:0;padding-top:var(--dig-spacing__micro__medium)}"));a.injectInternalStyle("/static/typescript/component_libraries/files_components/src/sidebar/sidebar.module.out-vflo20QzF.css",(e=>"._sidebar-content_g0g9o_1{box-sizing:border-box;height:100%;padding:var(--spacing__unit--2)}._sidebar-content-icon-container_g0g9o_7{color:var(--dig-color__text__base);display:flex}._sidebar-title_g0g9o_13{margin:0}._sidebar-background_g0g9o_17{background-color:var(--dig-color__background__raised)}"));const ly="_sidebar-content_g0g9o_1",cy="_sidebar-content-icon-container_g0g9o_7",dy="_sidebar-title_g0g9o_13",uy="_sidebar-background_g0g9o_17",_y=({icon:e,title:t,titleAccessory:i,content:n,handleClose:r,closeLabel:o,contentClassName:s})=>{const l=a.cx(ly,s);return te.createElement(a.Drawer.Container,{"data-testid":"side-bar-container"},te.createElement(a.Drawer.Header,{className:uy},te.createElement(a.Drawer.Layout,null,te.createElement(a.Drawer.LayoutItem,null,te.createElement("div",{className:cy},e)),te.createElement(a.Drawer.LayoutItem,{width:"fill"},te.createElement(a.Text,{isBold:!0,variant:"label",tagName:"h2",className:dy},t)),te.createElement(a.Drawer.LayoutItem,null,i),te.createElement(a.Drawer.LayoutItem,null,te.createElement(a.IconButton,{onClick:r,variant:"transparent"},te.createElement(a.UIIcon,{"aria-label":o,src:a.CloseLine}))))),te.createElement(a.Drawer.Body,{className:uy},te.createElement("div",{className:l},n)))};_y.displayName="Sidebar";const py=te.memo((({sidebarPluginId:e,sidebarPlugin:t})=>{const{Title:i,TitleAccessory:n,Content:r,Icon:o}=t.sidebarUI,s=a.useIntl(),l=ro(e,a.UserActionContext.Sidebar),c=a.cx("_sidebar-content_jgsyc_1",{"_comment-content_jgsyc_1":e===p.COMMENTS_PLUGIN_ID,"_transcript-content_jgsyc_5":e===p.TRANSCRIPT_BLADE_PLUGIN_ID}),d=function(e){return p.leftSidebarPluginIds.includes(e)}(e)?s.formatMessage({id:"EOUTqG",defaultMessage:"Close left sidebar"}):s.formatMessage({id:"TZJGo/",defaultMessage:"Close right sidebar"});return te.createElement(_y,{icon:te.createElement(o,null),title:te.createElement(i,null),titleAccessory:n&&te.createElement(n,null),content:te.createElement(r,null),handleClose:l,closeLabel:d,contentClassName:c})}));py.displayName="SidebarContent";const gy=e=>{const t=y.isSupportedMobileBrowser(),i=((e,t)=>te.default.useMemo((()=>i=>te.default.createElement(sy,Object.assign({},i,{file:e,showAuthModal:t}))),[e,t]))(e.activePreviewFile.file,e.showAuthModal),n=te.default.useMemo((()=>py),[]),r=((e,t,i,a,n,r,o,s,l,c)=>te.default.useMemo((()=>()=>te.default.createElement(Wf,{file:e,sharePermission:i,shareToken:a,user:n,previewSurface:t,hasOpenInActions:r,userHasDmtConflict:o,isSendForSignatureEnabled:s,encryptionOptions:l})),[e,i,a,n,t,r,o,s,l]))(e.activePreviewFile.file,e.previewSurface,e.activePreviewFile.sharePermission,e.shareToken,e.user,e.hasOpenInActions,e.userHasDmtConflict,e.isSendForSignatureEnabled,e.activePreviewFile.encryptionOptions,e.sharedLinkInfo),o=(e=>{var t;return e.showTour?[a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.SHARED_CONTENT_LINK].includes(e.previewSurface)?te.default.createElement(Yf,{file:e.activePreviewFile.file,shareToken:e.shareToken,user:e.user,linkOwnerName:null===(t=e.sharedLinkInfo)||void 0===t?void 0:t.ownerName}):te.default.createElement(qf,{file:e.activePreviewFile.file,sharePermission:e.activePreviewFile.sharePermission,user:e.user,skipModal:e.skipPreviewTourModal,previewTourVariant:e.previewTourVariant}):null})(e);return t||e.previewContentOnly?{titlebar:{},sidebarContent:{},toolbar:void 0,previewTour:void 0}:{titlebar:{component:i},sidebarContent:{component:n},toolbar:r,previewTour:o}},fy={0:{displayName:l.intl.formatMessage({id:"wYkgel",defaultMessage:"DEFAULT"})},1:{displayName:l.intl.formatMessage({id:"EMXHTJ",defaultMessage:"Send for signature"}),developerDescription:l.intl.formatMessage({id:"EMXHTJ",defaultMessage:"Send for signature"})},2:{displayName:l.intl.formatMessage({id:"aIQiHy",defaultMessage:"PDF Editing"}),developerDescription:l.intl.formatMessage({id:"fG5ZbA",defaultMessage:"PDF editing"})},3:{displayName:l.intl.formatMessage({id:"e6EJBF",defaultMessage:"View or Edit"}),developerDescription:l.intl.formatMessage({id:"p+tBI0",defaultMessage:"View or edit"})},4:{displayName:l.intl.formatMessage({id:"gN/zWT",defaultMessage:"Image Editing"}),developerDescription:l.intl.formatMessage({id:"KQT2xh",defaultMessage:"Image editing"})},5:{displayName:l.intl.formatMessage({id:"miE3lp",defaultMessage:"Video comment"}),developerDescription:l.intl.formatMessage({id:"miE3lp",defaultMessage:"Video comment"})},6:{displayName:l.intl.formatMessage({id:"Mcwc+5",defaultMessage:"Send fax"}),developerDescription:l.intl.formatMessage({id:"Mcwc+5",defaultMessage:"Send fax"})},8:{displayName:l.intl.formatMessage({id:"UwFkjc",defaultMessage:"Edit"}),developerDescription:l.intl.formatMessage({id:"RBrgq4",defaultMessage:"Video Editing"})},9:{displayName:l.intl.formatMessage({id:"Ufb68N",defaultMessage:"Send with"}),developerDescription:l.intl.formatMessage({id:"tBDUcB",defaultMessage:"Send Files"})},10:{displayName:l.intl.formatMessage({id:"sDGta5",defaultMessage:"Cloud Editors"}),developerDescription:l.intl.formatMessage({id:"sDGta5",defaultMessage:"Cloud Editors"})},11:{displayName:l.intl.formatMessage({id:"gffk/L",defaultMessage:"Send to notary"}),developerDescription:l.intl.formatMessage({id:"O/A0V6",defaultMessage:"Notarize"})},12:{displayName:l.intl.formatMessage({id:"oNuOaL",defaultMessage:"Expense"}),developerDescription:l.intl.formatMessage({id:"oNuOaL",defaultMessage:"Expense"})},13:{displayName:l.intl.formatMessage({id:"VlZABW",defaultMessage:"Publish"}),developerDescription:l.intl.formatMessage({id:"itZX4g",defaultMessage:"Publish Video"})},14:{displayName:l.intl.formatMessage({id:"E0v6mC",defaultMessage:"Share with"}),developerDescription:l.intl.formatMessage({id:"uukIVm",defaultMessage:"Share a file"})}};var my;function hy(e,t,i){e&&e.event(t,i)}function vy(e){return e.link_state[".tag"].indexOf("_linked")>=0}function Sy(e,t){if(e.priority&&t.priority){const i=t.priority-e.priority;return 0!==i?i:e.description<t.description?-1:e.description>t.description?1:0}return e.priority?-1:t.priority?1:e.description<t.description?-1:e.description>t.description?1:0}function Ey(e,t=0){const i=[],a=[],n=[],r=[],o=[];return e.sort(Sy).forEach((e=>{e.category===my.CLOUD_EDITORS?i.push(e):e.app_id===Ww?a.push(e):vy(e)||function(e){return"oauth_prelinked"===e.link_state[".tag"]}(e)?n.push(e):void 0!==e.priority&&e.priority>0&&r.length<t?r.push(e):o.push(e)})),{cloudEditors:i,transferActions:a,installedActions:n,promotedActions:r,unpromotedActions:o}}!function(e){function t(e){return fy[e]||null}e.DEFAULT=0,e.ESIGNATURE=1,e.PDF_EDITING=2,e.VIEW_OR_EDIT=3,e.IMAGE_EDITING=4,e.VIDEO_COMMENT=5,e.SEND_FAX=6,e.OPEN_WITH_CLOUD_DOC=7,e.VIDEO_EDITING=8,e.SEND_WITH=9,e.CLOUD_EDITORS=10,e.SEND_TO_NOTARY=11,e.EXPENSE=12,e.PUBLISH=13,e.SHARE_WITH=14,e.getDisplayName=function(e){const i=t(e);return i&&i.displayName},e.getDeveloperDescription=function(e){const i=t(e);return i&&i.developerDescription||null}}(my||(my={}));class wy{static is_cached_and_locally_available(e,t){const i=this._cache[p.UnityFeatures.server_path(e,t)];return null!=i&&i.is_locally_available}static get(e,t){return this._cache[p.UnityFeatures.server_path(e,t)]}static set(e,t){this._cache[e]=t}static set_batch(e){Object.assign(this._cache,e)}static clear(){this._cache={}}}wy._cache={};let by=wy;p.UnityFeatures.isUnitySupported()||(by=void 0);var yy=by;function Ty(e,t){p.UnityFeatures.file_browser_display_name((function(i){e.file_browser_display_name=i,t(e)}),(()=>t(e)))}const Iy={isUnityEnabled:function(){return p.UnityFeatures.isUnitySupported()},isFileInUnityCache:function(e,t){return!!yy.is_cached_and_locally_available(e,t)},clientSupportsOpenInFileBrowser:function(){return p.UnityFeatures.client_supports_open_in_file_browser()},getFileInfoFromUnityCache:function(e,t){return yy.get(e,t)},fetchUnityFileInfo:function(e,t,i,a,n){p.UnityFeatures.check_file(e,t,i,(e=>{e.is_locally_available?Ty(e,a):a(e)}),n)},getUnityFileInfo:function(e,t,i,a,n){if(Iy.isFileInUnityCache(e,t)){const i=Iy.getFileInfoFromUnityCache(e,t);i.is_locally_available&&null==i.file_browser_display_name?Ty(i,a):a(i)}else Iy.fetchUnityFileInfo(e,t,i,a,n)},openFile:function(e,t,i,a){p.UnityFeatures.open_file(e,t,i,p.UnityFeatures.standard_open_file_handler,(()=>p.UnityFeatures.standard_open_file_handler(!1)),a)},isUnityFolderSupported:function(e){return null!=e&&(!!e.is_locally_available||!!e.is_infinite_placeholder)&&Iy.clientSupportsOpenInFileBrowser()},isUnityFileSupported:function(e){return null!=e&&!!e.is_locally_available&&!1!==e.can_open_directly}},Cy=(e,t,i)=>{const[n,r]=te.default.useState(),o=te.default.useCallback((()=>{r({local_path:null,resolved_local_path:null,can_open_directly:!1,is_locally_available:!1,is_infinite_placeholder:!1,open_application_identifier:null,open_application_name:null,path_is_dir:!1,error_message:null})}),[]);return te.default.useEffect((()=>{!(i||e instanceof F.FileSharedWithMe)&&a.isBrowseFile(e)&&t&&Iy.isUnityEnabled()&&Iy.getUnityFileInfo(e.ns_id,e.ns_path,t.id,r,o)}),[o,e,t,i]),n},Ay=e=>(e=>a.AUDIO_EXTS.includes(e))(e)||(e=>a.TRANSCODE_VIDEO_EXTS.includes(e))(e)||(e=>a.IMAGE_EXIF_EXTS.includes(e))(e),My=(e,t)=>{const i=`.${a.getExtension$1(e)}`,n=Ay(i);return"ON"===t.replay_allow_ga_access&&!(e instanceof F.FileSharedWithMe)&&st(e)&&a.isBrowseFile(e)&&!a.isEncryptedFile(e)&&!lt(e)&&n},Oy=({file:e,user:t,shareToken:i,featureConfig:n,sourceContext:r})=>{var o;const s=a.useSelector((t=>ab(t,e)),a.shallowEqual),l=te.default.useMemo((()=>Ey(s).cloudEditors),[s]),c=r===a.SourceContext.EdisonDesktopPreview,d=Cy(e,t,c);if(r===a.SourceContext.EdisonDesktopPreview)return!1;if(My(e,{replay_allow_ga_access:null!==(o=n.replay_allow_ga_access)&&void 0!==o?o:""}))return!0;if(a.isSharedFile(e)){if(0===l.length)return!1;if((e=>(null==e?void 0:e.linkType)===a.SharedLinkType.Shmodel)(i))return!1}return 0!==s.length||!!d&&Iy.isUnityFileSupported(d)},Py="rrc_tooltip_tour",xy=()=>{const e=JSON.stringify((new Date).getTime()+1728e5);window.localStorage.setItem(Py,e)},Dy=e=>{const t=(e=>{const t=window.localStorage.getItem(e);return t?JSON.parse(t):null})(e);if(!t)return xy(),!0;const i=(new Date).getTime()>t;return i&&xy(),i},Ry=e=>{var t;const i=null!==(t=Ly())&&void 0!==t?t:e.fileViewerFeatureExperiments.hasSeenPreviewTooltipTour;if([a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.HOME,a.SDKPreviewSurface.HELLOSIGN,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.RECENTS,a.SDKPreviewSurface.STARRED,a.SDKPreviewSurface.STANDALONE_PREVIEW,a.SDKPreviewSurface.PHOTOS,a.SDKPreviewSurface.FILE_LOCKING,a.SDKPreviewSurface.VIDEO_HOME,a.SDKPreviewSurface.INBAND_SHARE,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.SHARED_CONTENT_LINK].includes(e.previewSurface)&&!e.previewContentOnly&&!e.isMobile&&!e.isEditMode&&e.sourceContext!==a.SourceContext.UngatedEditor){if(e.previewSurface===a.SDKPreviewSurface.INBAND_SHARE)return!i;if([a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.SHARED_CONTENT_LINK].includes(e.previewSurface))return((e,t)=>{const i=!e.user&&Dy(Py),a=e.user&&"true"!==window.localStorage.getItem("rrc_tooltip_tour_engaged")&&!t;return!(!i&&!a)&&(e.logExposure&&Ny("shaq_rrc_tooltip_tour_oob",e.fileViewerFeatureExperiments.rrcTooltipTourOutOfBandVariant),"V1"===e.fileViewerFeatureExperiments.rrcTooltipTourOutOfBandVariant)})(e,i);if(!i)return e.logExposure&&Ny("preview_tooltip_tour",e.fileViewerFeatureExperiments.previewTooltipTourVariant),"V1"===e.fileViewerFeatureExperiments.previewTooltipTourVariant}return!1};function Ny(e,t){const i={stormcrowVariantInfo:{feature:e,variant:t}};Q.getGatingClientSingleton().logExposure(i)}let ky;const Ly=()=>ky,Fy=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{ErrorPage:t}=yield new Promise((function(t,i){e(["./c_layout_error-page_error_page"],t,i)}));return{default:t}})))),Uy=["home","work","personal"],Vy=()=>{const e=a.useRouteError(),t=a.useIntl();return te.default.useEffect((()=>{const t=window.location.pathname.split("/")[1],i=Uy.includes(t)?"browse":t;h.reportException({severity:"critical",err:Object.assign(Object.assign({},e instanceof Error?Object.assign(Object.assign({},e),{message:e.message,stack:e.stack}):new Error("string"==typeof e?e.toString():"unknown error")),{severity:"critical",tags:["error_element",i]})})}),[e]),te.default.createElement(Fy,{intl:t,errorMessage:a.unsafeIsOfficeIp()&&(e instanceof Error||"string"==typeof e)?e.toString():void 0})};Vy.displayName="_ErrorElement";const jy=a.requireCssWithComponent(Vy,["/static/metaserver/static/css/dig-components/index.web-vflzskH5s.css"]);function By(e){for(const t of e)t.errorElement||(t.errorElement=te.default.createElement(jy,null)),t.children&&By(t.children)}const Hy=e=>({logStormcrowExposure:(t,i)=>a.logStormcrowExposure(t,i,null==e?void 0:e.id)}),Ky={layerUI:{Layer:()=>null},editUI:{},allowTitleBar:!0};a.injectInternalStyle("/static/typescript/component_libraries/photo-editor/src/components/loading.module.out-vflJk0JYG.css",(e=>"._loading_t585w_1{background-color:#000}._loading_t585w_1,._loading--integrated-editor_t585w_11{align-items:center;display:flex;flex-direction:column;height:100%;justify-content:center;width:100%}._loading--integrated-editor_t585w_11{background:var(--dig-color__background__subtle)}"));function zy({integratedEditor:e}){const{loadingAriaLabel:t}={loadingAriaLabel:a.useIntl().formatMessage({id:"I2tb5f",defaultMessage:"Loading"})};return te.default.createElement("div",{className:e?"_loading--integrated-editor_t585w_11":"_loading_t585w_1"},te.default.createElement(a.Spinner,{"aria-valuetext":t,size:"standard"}))}const Wy=a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{PhotoEditor:t}=yield new Promise((function(t,i){e(["./c_photo-editor_layout_photo_editor"],t,i)}));return{default:t}}))));class Gy{constructor(e,t,i){this.user=e,this.onImageChanged=t,this.encryptionOption=i,this.integratedEditor=!1}}class qy extends Gy{constructor(e,t,n){super(e,t,n),this.user=e,this.onImageChanged=t,this.encryptionOptions=n,this.layerUI={Layer:({titleBarActionSetters:e,activationParams:t})=>{const{pluginNavigation:n,featureConfig:r,logUserAction:o}=u.useFileViewerContext(),s={colorCorrect:!(!this.user||"ON"!==r.previews_image_enhancements_color_correct),upscale:!(!this.user||"ON"!==r.previews_image_enhancements_upscale),autoStraighten:!(!this.user||"ON"!==r.previews_image_enhancements_auto_straighten),filter:!(!this.user||"ON"!==r.previews_image_enhancements_filter)},l=Os(),c=As();Ou("#edit"),Pu(["edit",Ru]);const d=Ps(),_=te.default.useCallback(((e,t,i)=>{o(e,t,Object.assign({actionSurface:"image_edit"},i))}),[o]),p=te.default.useMemo((()=>this.onImageChanged||(()=>{})),[]),g=po(),f=i.useMemo((()=>({exit:g,onImageChanged:p,updatePreviewMetadata:n.updatePreviewMetadata,logUserAction:_,redirectToFile:(e,t)=>{a.redirect(a.preview_uri_for_fq_path(this.user,e,t))},closeViewer:()=>n.closeViewer(a.UserActionContext.Editor)})),[g,p,n,_]),m=te.default.useMemo((()=>performance.now()),[]);return e&&l?te.default.createElement(i.Suspense,{fallback:te.default.createElement(zy,{integratedEditor:this.integratedEditor})},te.default.createElement(Wy,{user:this.user,imageFile:l,imagePreviewUrl:c.preview_url,pluginApi:f,sharedLinkInfo:d,integratedEditor:this.integratedEditor,editorInitializationTimeMs:m,logPreviewsUserAction:_,titleBarActionSetters:e,activationParams:t,logUserAction:_,entryPoint:xu.PREVIEWS,previewsImageEnhancements:s,isLoggedOutImageEditEnabled:"ON"===r.previews_exp_ungate_image_edit,encryptionOption:this.encryptionOption})):null}},this.editUI={},this.shouldReplacePreview=!0,this.allowTitleBar=!0,this.integratedEditor=!0}}function Qy(e){const t=Ln(e);if(null==t)return null;return{scaleFactor:qn(t)}}const Yy=e=>{var t,i;const a=e&&Qy(e);if(null==a)return;const n=null!==(i=null===(t=Nn(e))||void 0===t?void 0:t.currentPageIndex)&&void 0!==i?i:null;return null!=n?{fitScaleFactor:a.scaleFactor,currentPageIndex:n}:void 0},$y=e=>{const t=e&&Qy(e);if(null!=t)return{fitScaleFactor:t.scaleFactor}},Zy=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=$r(zn,e);return Yy(t)},Xy=()=>{const{fileViewerId:e}=u.useFileViewerContext();return(e=>{const t=kn(e);if(null==t)return;const{currentTimestamp:i,isPlaying:a,isDefaultAudioTrackSelected:n}=t;return{currentTimestamp:i,isPlaying:a,isDefaultAudioTrackSelected:n}})($r(zn,e))};function Jy(e){return(t,i,a)=>({type:e,payload:t,meta:i,error:a})}function eT(e){return function(t){return({dispatch:i})=>a=>r=>n.__awaiter(this,void 0,void 0,(function*(){let n,o=a(r);const s=e[r.type];if(s){try{n=s.action({arg:r.payload.arg,result:yield t.rpc(s.endpoint,r.payload.arg,r.payload.params||{})},r.meta)}catch(e){n=s.action({arg:r.payload.arg,params:r.payload.params},r.meta,e)}return i(n)}return o}))}}const tT="@@apiv2_redux/file_viewer/watermarking/watermark_file",iT="@@apiv2_redux/file_viewer/watermarking/watermark_file_result",aT=Jy(tT),nT=eT({[tT]:{endpoint:"watermarking/watermark_file",action:Jy(iT)}});const rT=(e,t)=>{const{mode:i,textWatermarkOptions:a,imageWatermarkOptions:n}=t;return"image"===i[e]?n[e]:a[e]},oT=e=>e.toDataURL().split(",",2).pop(),sT=({dispatch:e,getState:t})=>i=>a=>{if("ApplyWatermark"===a.type){const{fileViewerId:i,file:n,overwrite:r}=a.payload,{mode:o,textWatermarkOptions:s,imageWatermarkOptions:l}=t(),c=o[i],d=s[i],u=l[i],_=rT(i,t()),{position:p,marginX:g,marginY:f}=_,m={path:n.fileId,overwrite:r};if("REPEAT"===p){const{canvas:e,distanceX:t,distanceY:i,startX:a,startY:n,offsetXPerRow:r,offsetYPerCol:o}=Y.tilingFunc({scale:d.scale,mode:c,textWatermarkOptions:d,imageWatermarkOptions:u}),s=oT(e);if(null==s)return;m.tiled_image={image:s,distance_x:Math.round(t),distance_y:Math.round(i),start_x:Math.round(a),start_y:Math.round(n),offset_x_per_row:Math.round(r),offset_y_per_col:Math.round(o)}}else{let e;if("text"===c){const{text:t,size:i,scale:a,fontFamily:n,color:r,opacity:o,angle:s}=d;e=Y.drawTextTile({text:t,size:i*a,fontFamily:n,color:r,opacity:o,angle:s}).canvas}else{const{image:t,size:i,scale:a,opacity:n,angle:r}=u;if(null==t)return;e=Y.drawImageTile({image:t,scale:i*a,opacity:n,angle:r}).canvas}const t=oT(e);if(null==t)return;m.image_watermark={image:t,position:p,margin_x:Math.round(g),margin_y:Math.round(f)}}e(aT({arg:m},{fileViewerId:i,fqPath:n.fqPath}))}i(a)},lT=e=>e===a.PreviewType.SsrDoc?300/72:1,cT={status:(e={},t)=>{var i;if(t.type===iT){const a=null===(i=t.meta)||void 0===i?void 0:i.fileViewerId;if(null!=a){if(t.error)return Object.assign(Object.assign({},e),{[a]:{state:"errored",error:t.error}});if(t.payload)return Object.assign(Object.assign({},e),{[a]:{state:"loaded",data:t.payload}})}return e}return"ApplyWatermark"===t.type?Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:{state:"pending"}}):"InitializeWatermarkPlugin"===t.type||"SetStatusReady"===t.type?Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:{state:"ready"}}):e},mode:(e={},t)=>"SetMode"===t.type?Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:t.payload.mode}):"InitializeWatermarkPlugin"===t.type?Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:"text"}):e,imageWatermarkOptions:(e={},t)=>{if("SetImageWatermarkOptions"===t.type){const{fileViewerId:i,options:a}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),a)})}if("InitializeWatermarkPlugin"===t.type){const{fileViewerId:i,previewType:a}=t.payload;return Object.assign(Object.assign({},e),{[i]:{image:void 0,position:"REPEAT",angle:45,angleStep:15,opacity:.3,size:.0464,marginX:40,marginY:40,scale:lT(a),minSize:.2,maxSize:5}})}return e},textWatermarkOptions:(e={},t)=>{if("SetTextWatermarkOptions"===t.type){const{fileViewerId:i,options:a}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),a)})}if("InitializeWatermarkPlugin"===t.type){const{fileViewerId:i,previewType:a}=t.payload;return Object.assign(Object.assign({},e),{[i]:{text:"DRAFT",color:"dark",position:"REPEAT",angle:45,angleStep:15,opacity:.3,size:20,lineHeight:3,fontFamily:"Helvetica, sans-serif",marginX:40,marginY:40,scale:lT(a),minSize:5,maxSize:200}})}return e}},dT=({apiv2ClientBase:e,onWatermarkingSuccessHandler:t})=>{const i=a.combineReducers(cT),n=[sT,nT((r=e,r.ns("file_viewer")))];var r;return t&&n.push((e=>({})=>t=>i=>{var a;if(i.type===iT&&!i.error&&i.payload.result){const n=t(i),r=i.payload.result.fq_path||(null===(a=i.meta)||void 0===a?void 0:a.fqPath);return e({fqPath:r,overwrite:i.payload.arg.overwrite}),n}return t(i)})(t)),a.createStore(i,a.applyMiddleware(...n))},uT=a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{WatermarkingPane:t}=yield new Promise((function(t,i){e(["./c_plugin_components_watermarking_pane"],t,i)}));return{default:t}})))),_T=e=>te.default.createElement(te.default.Suspense,{fallback:te.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},te.default.createElement(a.Spinner,null))},te.default.createElement(uT,Object.assign({},e)));_T.displayName="AsyncWatermarkingPane";const pT=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{WatermarkingLayer:t}=yield new Promise((function(t,i){e(["./c_plugin_components_watermarking_layer"],t,i)}));return{default:t}})))),gT=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(pT,Object.assign({},e)));gT.displayName="AsyncWatermarkingLayer";class fT{constructor(e,i){this.getStore=()=>(this.storePromise||(this.storePromise=new Promise((e=>{e(dT({apiv2ClientBase:this.apiV2Client,onWatermarkingSuccessHandler:this.onWatermarkingSuccessHandler}))}))),this.storePromise),this.layerUI={Layer:e=>{const{pluginContext:t}=u.useFileViewerContext(),[i,n]=te.default.useState(null);return te.default.useEffect((()=>{this.getStore().then(n)}),[]),!i||e.previewType!==a.PreviewType.Image&&e.previewType!==a.PreviewType.SsrDoc&&e.previewType!==a.PreviewType.CloudDoc?null:te.default.createElement(a.Provider,{store:i},te.default.createElement(gT,Object.assign({context:t},e)))}},this.useCurrentDocFirstPageDimensions=e=>{const t=$r(jn,e),i=_r(),a=jr(t,i),n=null==a?void 0:a[0].dimension[0],r=null==a?void 0:a[0].dimension[1];if(n&&r)return{width:n,height:r}},this.editUI={Sidebar:e=>{const i=a.useIntl(),{fileViewerId:n,pluginContext:r}=u.useFileViewerContext(),o=Ms(),[s,l]=te.default.useState(null);te.default.useEffect((()=>{this.getStore().then(l)}),[]),te.default.useEffect((()=>{null==s||s.dispatch((({fileViewerId:e,previewType:t})=>({type:"InitializeWatermarkPlugin",payload:{fileViewerId:e,previewType:t}}))({fileViewerId:n,previewType:o})),r.logUserAction(t.WorkflowsEvent.WatermarkStart,"top_nav_meatball_menu")}),[n,o,r,s]);const c=this.useCurrentDocFirstPageDimensions(n),d=Zy(),_=(()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=$r(zn,e);return $y(t)})(),p=Os(),g=po();return s&&p?te.default.createElement(a.Provider,{store:s},te.default.createElement(_T,Object.assign({file:p,previewType:o,intl:i,fileViewerId:n,exitEditModeCallback:g,currentDocFirstPageDimensions:c,docUi:d,imageUi:_},e))):null}},this.mode={type:"edit"},this.allowTitleBar=!0,this.apiV2Client=e,this.onWatermarkingSuccessHandler=i,this.storePromise=void 0}}const mT=a.styled.div`
  display: flex;
  align-items: center;
  justify-content: center;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
`,hT=()=>te.default.createElement(mT,null,te.default.createElement(a.Spinner,{size:"standard"}));function vT(){const e=new Uint8Array(16);window.crypto.getRandomValues(e);return`a${Array.from(e).map((e=>e.toString(16).padStart(2,"0"))).join("")}`}hT.displayName="LoadingScreen";const ST=a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{Layer:t}=yield new Promise((function(t,i){e(["./c_pdf_editor_plugin_layer"],t,i)}));return{default:t}}))));class ET{constructor(e,t,i,n,r){this.fullscreenLayer=({activationParams:e})=>{const t=a.useIntl(),{apiV2Client:i}=u.useFileViewerContext(),n=Os();return te.default.useEffect((()=>(this.setIsPdfEditorActive(!0),()=>this.setIsPdfEditorActive(!1))),[]),te.default.useEffect((()=>{this.user&&d.markModuleAsCompleted(this.user.id,"edit_pdf_milestone",i)}),[i]),n?te.default.createElement(te.default.Suspense,{fallback:te.default.createElement(hT,null)},te.default.createElement(ST,{file:n,intl:t,user:this.user,nonce:this.nonce,activationParams:e,encryptionOptions:this.encryptionOptions,readOnly:this.readOnly,sharedLinkInfo:this.sharedLinkInfo})):null},this.nonce=vT(),this.readOnly=e,this.user=i,this.setIsPdfEditorActive=n,this.encryptionOptions=r,this.sharedLinkInfo=t}}const wT=()=>{},bT=({user:e,file:t,sharePermission:i,featureConfig:n,previewSurface:r,setIsPdfEditorActive:o,onFileChanged:s=wT,apiV2Client:l,encryptionOptions:d,sharedLinkInfo:u})=>{const _=!e&&"ON"===n.previews_exp_ungate_image_edit,g=[a.SDKPreviewSurface.VERSION_HISTORY,a.SDKPreviewSurface.VIDEO_SYNTHESIS,a.SDKPreviewSurface.BACKUP,a.SDKPreviewSurface.SHARED_LINK_EMBED,a.SDKPreviewSurface.TRANSFER,a.SDKPreviewSurface.SHARED_COLLECTION,a.SDKPreviewSurface.UNKNOWN,a.SDKPreviewSurface.DESKTOP_PREVIEW,a.SDKPreviewSurface.POLLUX_DESKTOP_PREVIEW].includes(r),f=zg({featureConfig:n,file:t,sharePermission:i,user:e}),m=te.default.useMemo((()=>f?Ky:void 0),[f]),h=a.canWatermarkFile({file:t,user:e}),v=te.default.useMemo((()=>h?((e,t,i)=>new fT(t,(({fqPath:t,overwrite:n})=>{n&&i===a.SDKPreviewSurface.BROWSE||(t&&e?a.replace_location(a.preview_uri_for_fq_path(e,t,{context:a.SourceContext.Workflow})):a.reload())})))(e,l,r):void 0),[l,r,h,e]),S=(e||_)&&Ya(t,i),E=te.default.useMemo((()=>S?new qy(e,s,d):void 0),[d,s,S,e]),w=qa(t,i,a.fileViewerFeatureExperiments.signNonPdfInPdfEditorVariant),b=a.isBrowseFile(t)&&!!t.read_only,y=te.default.useMemo((()=>{const t="ON"===a.fileViewerFeatureExperiments.previewsExpUngatePdfEdit&&!e;return r!==a.SDKPreviewSurface.FSS_DESKTOP_PREVIEW&&(e||t)&&w?new ET(b,u,e,o,d):void 0}),[d,b,w,r,o,u,e]);return te.default.useMemo((()=>g||c.is_supported_mobile_browser()?{}:{[p.VIDEO_EDITOR_PLUGIN_ID]:m,[xg]:v,[p.PHOTO_EDITOR_PLUGIN_ID]:E,[p.PDF_EDITOR_PLUGIN_ID]:y}),[g,y,E,m,v])};const yT="stickers:get_stickers",TT=e=>o.createGenericQuery({queryRouteFilter:["apiv2",yT],queryFn:()=>async()=>{var t;return{apiData:await(t=e,t.ns("stickers")).rpc("get_stickers",void 0,{}),pkgData:null}},getQueryKey:o.getGenericQueryKey("apiv2",yT)}),IT=(e,t,i,a,n,r)=>{((e,t,i)=>{if(!e.file_id)return;const a={file_path_or_id:e.file_id,url:e.url};lu(t).prefetchQuery(i,{apiArg:a,pkgArg:null})})(e,t,i),void 0===a&&((e,t,i,a,n,r)=>{if(!e)return;const o={files:e,include_dimensions:t};dr(i).prefetchQuery(a,{apiArg:o,pkgArg:{fileName:n,fileSize:r}})})([e],!0,t,i,n,r)},CT=({userId:e,queryClient:t,featureConfig:i,apiV2Client:n,filename:r,bytes:o,initializeOpts:s,logger:l})=>{const{previewMetadata:c,fileInfo:d,sharedLinkInfo:u}=s;var _,p;Uc(i,c,t,d,l),IT(d,n,t,c,r,o),e&&((e,t,i,n,r)=>{e.previews_pass_facepile_prefetch&&(a.prefetchFileMemberCounts(r,t,{file:i.file_id,limit:105,count_groups_as_members:!1,run_viewer_info_checks:!0,url:n?n.url:void 0}),a.prefetchFileMembers(r,t,{file:i.file_id,actions:[{".tag":"leave_a_copy"},{".tag":"make_editor"},{".tag":"make_owner"},{".tag":"make_viewer"},{".tag":"make_viewer_no_comment"},{".tag":"remove"}],include_inherited:!0,limit:2,url:n?n.url:void 0,include_seen_state:!1},!0))})(i,t,d,u,n),i.pass_transmitter_token_prefetch&&ph(e).prefetchQuery(t,{apiArg:{file_info:(_=d.file_id,p=null==u?void 0:u.url,p?{".tag":"shared_link_details",url:p}:{".tag":"file_identifier",file_identifier:_})}}),(async(e,t)=>{const i=TT(e);await i.prefetchQuery(t,{})})(n,t)};a.injectInternalStyle("/static/js/file_viewer/components/highlight_action_bar_button.module.out-vflc93YdQ.css",(e=>"._highlight-action-bar-button_1ygwc_1{background-color:var(--color__elevated__background);pointer-events:all}"));const AT=e=>{var{icon:t,label:i}=e,r=n.__rest(e,["icon","label"]);return te.default.createElement(a.IconButton,Object.assign({className:"_highlight-action-bar-button_1ygwc_1","aria-label":i,variant:"outline"},r),te.default.createElement(a.UIIcon,{src:t}))};AT.displayName="HighlightActionBarButton";const MT=a.defineMessage({id:"q9vhxH",defaultMessage:"Copy to clipboard"}),OT=a.defineMessage({id:"fl7Vhq",defaultMessage:"Copied!"}),PT=a.defineMessage({id:"29mCZP",defaultMessage:"Like"}),xT=a.defineMessage({id:"tYu9ZH",defaultMessage:"Dislike"}),DT=a.defineMessage({id:"j2CH0+",defaultMessage:"Close"}),RT=a.defineMessage({id:"ffJ6O4",defaultMessage:"Translation failed."}),NT=a.defineMessage({id:"333LUp",defaultMessage:"Couldn’t translate text. Try again in a few minutes."}),kT=a.defineMessage({id:"yViBz2",defaultMessage:"Couldn’t detect language."}),LT=a.defineMessage({id:"1qW8mJ",defaultMessage:"Language not supported."}),FT=a.defineMessage({id:"uQTi4D",defaultMessage:"Translate text"}),UT=a.defineMessage({id:"F0VYqA",defaultMessage:"Translate: {maxLength}-character limit"}),VT=a.defineMessage({id:"K8efmc",defaultMessage:"It looks like this text is already in {language_display_name}."}),jT=a.defineMessage({id:"hx632L",defaultMessage:"How does this work? {link}"}),BT=a.defineMessage({id:"lXbWtY",defaultMessage:"Learn more"}),HT=te.createContext(null);const KT=(e,t,n)=>{const{metric:r,memTags:o}=((e,t)=>({metric:i.useMemo((()=>(e=>({ns:"component_visually_complete",name:`web/${e}`}))(e)),[e]),memTags:i.useMemo((()=>t),[JSON.stringify(t)])}))(e,n),s=i.useCallback((i=>{((e,t,i)=>{v.getMetricsReporter().createStats(e,Object.assign({navigation_type:t.detail.navigationType},i)).recordDuration(t.duration,c.TimeUnit.MILLISECONDS)})(r,i,o),a.logEvent({class:"ux_analytics",action:"report",object:"visually_complete",properties:{componentName:e,actionSurface:t,eventState:"success",timeToCompletionMs:i.duration}})}),[r,o,e,t]);return s},zT=(e,t,r,o)=>{const s=i.useRef(null),{getIsAjaxNavigation:l,getPageRenderStart:c,getStartTime:d,registerCvcMeasurement:u}=te.useContext(HT)||{getIsAjaxNavigation:void 0,getPageRenderStart:void 0,getStartTime:void 0,registerCvcMeasurement:void 0},_=(p=e,i.useCallback((e=>{a.UDCL$1.measure("maf.region.time_to_first_page_render",{start:performance.timeOrigin,end:performance.timeOrigin+e.pageRenderStart,detail:{region_id:p,navigation_type:e.navigationType,edison_page_name:n.getPageName()||"dne",tags:g}}),a.UDCL$1.measure("maf.region.time_to_first_render",{start:performance.timeOrigin+e.pageRenderStart,end:performance.timeOrigin+e.pageRenderStart+e.pageRenderDelayDuration,detail:{region_id:p,navigation_type:e.navigationType,edison_page_name:n.getPageName()||"dne",tags:g}})}),[p,g]));var p,g;const f=JSON.stringify(o),m=i.useMemo((()=>u?u(e,s,r,o):null),[u,e,r,f]),h=i.useCallback((()=>{e&&t&&window.requestAnimationFrame((()=>{const i=!l||l(),a=c?c():0,{startTime:n,isInitialStart:r}=d?d(e,t):{startTime:void 0,isInitialStart:!1};!i&&r&&n&&_({navigationType:G.getNavigationType(),pageRenderStart:a,pageRenderDelayDuration:n-a}),null==m||m.start(i,n,a)}))}),[l,c,_,d,e,t,m]);return{trackedElementRef:s,startCvcMeasurement:h}},WT=({componentKey:e,measurementKey:t,onCvc:i,trigger:a,triggerWhenFalsy:n,options:r,children:o})=>{const{trackedElementRef:s,startCvcMeasurement:l}=zT(e,t,i,Object.assign({measurementTimeout:3e4},r));return te.default.useEffect((()=>{(a||n)&&l()}),[l,a,n]),te.default.createElement("div",{ref:s},o)};WT.displayName="WithCvc";const GT=e=>{const{componentKey:t,actionSurface:i,tags:a}=e,n=KT(t,i,a);return te.default.createElement(WT,Object.assign({},Object.assign(Object.assign({},e),{onCvc:n})))};function qT(e,t=0,i=1){return Math.min(Math.max(t,e),i)}function QT(e,t,i){const a=i?i.x:e.left-t.left,n=i?i.y:e.top-t.top;return function({x:e,y:t,width:i,height:a}){return{x:qT(e),y:qT(t),width:qT(i),height:qT(a)}}({x:a/t.width,y:n/t.height,width:e.width/t.width,height:e.height/t.height})}GT.displayName="WithCvcPapLogger";a.injectInternalStyle("/static/metaserver/static/js/dropbox_ai_translations/file_viewer_plugin/translation.module.out-vflLCFLKZ.css",(e=>"._translation-overlay-container_19rhv_1{background-color:var(--dig-color__background__raised);position:absolute}._translation-overlay-header_19rhv_6{display:flex}._translation-overlay-language-selector_19rhv_10{flex-grow:1;margin:var(--spacing__unit--2) 0 0 var(--spacing__unit--2)}._translation-overlay-close-button_19rhv_15{margin:var(--spacing__unit--2) var(--spacing__unit--2) var(--spacing__unit--2) 0}._translation-overlay-language-banner_19rhv_23._translation-overlay-language-banner_19rhv_23{margin:0 var(--spacing__unit--2)}._translation-overlay-error-container_19rhv_27._translation-overlay-error-container_19rhv_27{margin:0 var(--spacing__unit--2) var(--spacing__unit--2) var(--spacing__unit--2)}._translation-overlay-language-selection-container_19rhv_33,._translation-overlay-loading-container_19rhv_32,._translation-overlay-text-container_19rhv_31{background-color:var(--dig-color__opacity__surface);border-radius:var(--spacing__unit--1);margin:var(--spacing__unit--1) var(--spacing__unit--2) var(--spacing__unit--2) var(--spacing__unit--2);min-height:55px;overflow-y:auto;padding:var(--spacing__unit--2)}._translation-overlay-error-icon_19rhv_48{margin-right:var(--spacing__unit--1);min-width:var(--spacing__unit--2_5)}._translation-overlay-language-selection-container_19rhv_33{max-height:357px}._translation-overlay-language-selection-label_19rhv_57{margin-bottom:var(--spacing__unit--0_5);margin-top:var(--spacing__unit--0_5)}._translation-overlay-language-selection_19rhv_33{height:auto;width:100%}._translation-overlay-language-selection_19rhv_33>span{height:auto}._translation-overlay-language-selection-inner_19rhv_71{align-items:center;display:flex;flex-grow:1;justify-content:left}._translation-overlay-language-name_19rhv_78{flex-grow:1;text-align:left;white-space:break-spaces}._translation-overlay-translated-text_19rhv_84{margin-bottom:var(--spacing__unit--0_5);margin-top:var(--spacing__unit--0_5)}._translation-overlay-text-footer_19rhv_89{align-items:center;display:flex;flex-direction:row;justify-content:space-between;margin-top:var(--spacing__unit--2)}._translation-reaction-container_19rhv_97{flex-grow:1}._translation-reaction-button_19rhv_101._translation-reaction-button_19rhv_101:disabled{color:var(--dig-color__selection__base)}._translation-overlay-disclaimer_19rhv_105{align-items:center;display:flex;flex-direction:row;margin:var(--spacing__unit--1) var(--spacing__unit--2) var(--spacing__unit--2) var(--spacing__unit--2)}._translation-overlay-disclaimer-text_19rhv_113{align-items:center;display:flex;flex-direction:row;justify-content:left}._translation-overlay-disclaimer-text_19rhv_113._translation-overlay-disclaimer-text_19rhv_113{margin-right:0}"));const YT={translationOverlayContainer:"_translation-overlay-container_19rhv_1",translationOverlayHeader:"_translation-overlay-header_19rhv_6",translationOverlayLanguageSelector:"_translation-overlay-language-selector_19rhv_10",translationOverlayCloseButton:"_translation-overlay-close-button_19rhv_15",translationOverlayLanguageBanner:"_translation-overlay-language-banner_19rhv_23",translationOverlayErrorContainer:"_translation-overlay-error-container_19rhv_27",translationOverlayLanguageSelectionContainer:"_translation-overlay-language-selection-container_19rhv_33",translationOverlayLoadingContainer:"_translation-overlay-loading-container_19rhv_32",translationOverlayTextContainer:"_translation-overlay-text-container_19rhv_31",translationOverlayErrorIcon:"_translation-overlay-error-icon_19rhv_48",translationOverlayLanguageSelectionLabel:"_translation-overlay-language-selection-label_19rhv_57",translationOverlayLanguageSelection:"_translation-overlay-language-selection_19rhv_33",translationOverlayLanguageSelectionInner:"_translation-overlay-language-selection-inner_19rhv_71",translationOverlayLanguageName:"_translation-overlay-language-name_19rhv_78",translationOverlayTranslatedText:"_translation-overlay-translated-text_19rhv_84",translationOverlayTextFooter:"_translation-overlay-text-footer_19rhv_89",translationReactionContainer:"_translation-reaction-container_19rhv_97",translationReactionButton:"_translation-reaction-button_19rhv_101",translationOverlayDisclaimer:"_translation-overlay-disclaimer_19rhv_105",translationOverlayDisclaimerText:"_translation-overlay-disclaimer-text_19rhv_113"};var $T;t.TranslatableLanguageCode=void 0,($T=t.TranslatableLanguageCode||(t.TranslatableLanguageCode={})).En="en",$T.DaDk="da_dk",$T.De="de",$T.Es="es",$T.Fr="fr",$T.Id="id",$T.It="it",$T.Ja="ja",$T.Ko="ko",$T.Ms="ms",$T.NbNo="nb_no",$T.NlNl="nl_nl",$T.Pl="pl",$T.PtBr="pt_br",$T.Ru="ru",$T.SvSe="sv_se",$T.ThTh="th_th",$T.UkUa="uk_ua",$T.ZhCn="zh_cn",$T.ZhTw="zh_tw";const ZT=[t.TranslatableLanguageCode.En,t.TranslatableLanguageCode.DaDk,t.TranslatableLanguageCode.De,t.TranslatableLanguageCode.Es,t.TranslatableLanguageCode.Fr,t.TranslatableLanguageCode.Id,t.TranslatableLanguageCode.It,t.TranslatableLanguageCode.Ja,t.TranslatableLanguageCode.Ko,t.TranslatableLanguageCode.Ms,t.TranslatableLanguageCode.NbNo,t.TranslatableLanguageCode.NlNl,t.TranslatableLanguageCode.Pl,t.TranslatableLanguageCode.PtBr,t.TranslatableLanguageCode.Ru,t.TranslatableLanguageCode.SvSe,t.TranslatableLanguageCode.ThTh,t.TranslatableLanguageCode.UkUa,t.TranslatableLanguageCode.ZhCn,t.TranslatableLanguageCode.ZhTw];var XT;t.TranslationError=void 0,(XT=t.TranslationError||(t.TranslationError={})).LimitExceeded="limit_exceeded_error",XT.InvalidLocale="invalid_locale",XT.UnknownLocale="unknown_locale",XT.Other="other";const JT=ae.LIST_OF_LOCALES_WITHOUT_INTERNAL.reduce(((e,t)=>{const i=t.localeCode.toLowerCase();return a=i,ZT.includes(a)?[...e,Object.assign(Object.assign({},t),{localeCode:i})]:e;var a}),[]),eI=JT.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.localeCode]:t})),{}),tI=({languageKey:e,isSelectingLanguage:t,toggleLanguageSelection:i,disabled:n})=>te.default.createElement("div",{className:YT.translationOverlayLanguageSelector},t?te.default.createElement(a.Button,{variant:"borderless",onClick:i,withIconStart:te.default.createElement(a.UIIcon,{src:a.ChevronLeftLine}),disabled:n},eI[e].localeName):te.default.createElement(a.Button,{variant:"borderless",onClick:i,withIconStart:te.default.createElement(a.UIIcon,{src:x.GlobeLine}),withIconEnd:te.default.createElement(a.UIIcon,{src:a.ChevronRightLine}),disabled:n,autoFocus:!0},eI[e].localeName));tI.displayName="LanguageHeader";const iI=({language:e,setLanguage:t})=>{const i=a.useIntl();return te.default.createElement("div",{className:YT.translationOverlayLanguageSelectionContainer},te.default.createElement("div",{className:YT.translationOverlayLanguageSelectionLabel},te.default.createElement(a.Text,{size:"small"},i.formatMessage({id:"93SOWe",defaultMessage:"Choose language:"}))),JT.map((i=>te.default.createElement(a.Button,{key:i.localeCode,variant:"borderless",onClick:()=>t(i.localeCode),className:YT.translationOverlayLanguageSelection},te.default.createElement("div",{className:YT.translationOverlayLanguageSelectionInner},te.default.createElement(a.Text,{className:YT.translationOverlayLanguageName},i.localeName),i.localeCode===e&&te.default.createElement(a.UIIcon,{src:a.CheckmarkLine}))))))};iI.displayName="LanguageSelection";const aI=n.getPageLocale().toLowerCase(),nI=()=>{},rI=({layer:e,previewType:t,selectedText:i,onClose:n,languageKey:r,isSelectingLanguage:o,setIsSelectingLanguage:s,setBodyRef:l=nI,overlayHeight:c,children:d})=>{const u=a.useIntl(),_=((e,t,i,a)=>{if(!e||!t||!i)return{x:0,y:0};const n=QT(e,t),r=(n.x+n.width)*t.width+16,o=Math.max(0,0,r+315+24+(i.width-t.width)/2-i.width),s=n.y*t.height;return{x:r-o,y:s-Math.max(0,s+(null!=a?a:300)-t.height)}})(null==i?void 0:i.selectionBounds,null==i?void 0:i.page.bounds,null==i?void 0:i.viewport,c),p=t===a.PreviewType.SsrDoc?e.pageIndex:void 0;if(!(null==i?void 0:i.text)||!i.selectionBounds||i.page.pageNumber!==p)return null;const g=[Oo({key:a.Key_enum.Key.Escape,callback:n})];return te.default.createElement(a.ClickOutside,{onClickOutside:n,shouldPropagateMouseEvents:!0,isActive:!0},te.default.createElement(Do,{name:"translation_overlay",keyboardBindings:g}),te.default.createElement(a.CardNamespace,{className:YT.translationOverlayContainer,style:{left:`${_.x}px`,top:`${_.y}px`},role:"dialog"},te.default.createElement(a.CardNamespace.Section,null,te.default.createElement("div",{style:{width:"315px"},ref:l},te.default.createElement("div",{className:YT.translationOverlayHeader},te.default.createElement(tI,{languageKey:r,isSelectingLanguage:o,toggleLanguageSelection:()=>null==s?void 0:s(!o),disabled:!s}),te.default.createElement("div",{className:YT.translationOverlayCloseButton},te.default.createElement(a.IconButton,{variant:"transparent","aria-label":u.formatMessage(DT),onClick:n},te.default.createElement(a.UIIcon,{src:a.CloseLine})))),d))))};rI.displayName="TranslationOverlaySkeleton";const oI="translation-loading-skeleton",sI=()=>te.default.createElement("div",{className:YT.translationOverlayLoadingContainer},te.default.createElement(A.Skeleton.Text,{"data-testid":oI,withBorderRadius:"xsmall",size:"large"}),te.default.createElement(A.Skeleton.Text,{"data-testid":oI,withBorderRadius:"xsmall",size:"large"}),te.default.createElement(A.Skeleton.Text,{"data-testid":oI,withBorderRadius:"xsmall",size:"large"}),te.default.createElement(A.Skeleton.Text,{"data-testid":oI,withBorderRadius:"xsmall",size:"large"}),te.default.createElement(A.Skeleton.Text,{"data-testid":oI,withBorderRadius:"xsmall",size:"large"}),te.default.createElement(A.Skeleton.Text,{"data-testid":oI,withBorderRadius:"xsmall",size:"large"}));sI.displayName="TranslationLoadingSection";const lI={[t.TranslationError.UnknownLocale]:kT,[t.TranslationError.InvalidLocale]:LT,[t.TranslationError.LimitExceeded]:NT,[t.TranslationError.Other]:RT},cI=({errorStatus:e=t.TranslationError.Other})=>{const i=a.useIntl();return te.default.createElement(a.Banner,{type:"alert",withLeftIcon:!1,className:YT.translationOverlayErrorContainer},te.default.createElement(a.Banner.Message,null,te.default.createElement(a.Text,null,i.formatMessage(lI[e]))))};cI.displayName="TranslationErrorSection";const dI=ZT.includes(aI)?aI:t.TranslatableLanguageCode.En,uI=e=>te.default.createElement(rI,Object.assign({},e,{languageKey:dI,isSelectingLanguage:!1}),te.default.createElement(sI,null));uI.displayName="LoadingTranslationOverlaySkeleton";const _I=e=>te.default.createElement(rI,Object.assign({},e,{languageKey:dI,isSelectingLanguage:!1}),te.default.createElement(cI,null));_I.displayName="ErrorTranslationOverlaySkeleton";const pI=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{TranslationOverlay:t}=yield new Promise((function(t,i){e(["./c_dropbox_ai_translations_file_viewer_plugin_translation_overlay"],t,i)}));return{default:t}})))),gI=e=>{var t,i,n,r;const o=e.previewType===a.PreviewType.SsrDoc?e.layer.pageIndex:void 0,s=(null!==(i=null===(t=e.selectedText)||void 0===t?void 0:t.page.pageNumber)&&void 0!==i?i:0)===o;return te.default.createElement(te.default.Suspense,{fallback:te.default.createElement(uI,Object.assign({},e))},te.default.createElement(GT,{componentKey:"translation_overlay",measurementKey:null!==(r=null===(n=e.selectedText)||void 0===n?void 0:n.text)&&void 0!==r?r:"",trigger:null,triggerWhenFalsy:s,actionSurface:"previews",options:{reportOnNoChange:!1}},te.default.createElement(pI,Object.assign({},e))))};gI.displayName="LazyAsyncTranslationOverlay";class fI{constructor(){this.layerUI={Layer:e=>{const t=lo(void 0,a.UserActionContext.Default),[i,n]=te.default.useState(0);return this.forceUpdateLayer=()=>n(i+1),e.previewType!==a.PreviewType.SsrDoc?null:te.default.createElement(gI,Object.assign({onClose:t,selectedText:this.selectedText},e))}},this.shouldReplacePreview=!1,this.allowTitleBar=!0,this.highlightMenuOption=({selectedText:e})=>{const t=a.useIntl(),i=lo(p.TRANSLATION_PLUGIN_ID,a.UserActionContext.TextHighlightMenu),n=e.text.length,r=e.page.pageNumber+1,o=te.default.useCallback((()=>{var t;this.selectedText=e,i(),null===(t=this.forceUpdateLayer)||void 0===t||t.call(this),a.UDCL.logEvent({class:"dropbox_ai",action:"click",object:"translate_action",properties:{selectionLength:n,pageNum:r}})}),[e,n,r,i]);te.default.useEffect((()=>{a.UDCL.logEvent({class:"dropbox_ai",action:"shown",object:"translate_action",properties:{selectionLength:n,pageNum:r}})}),[n,r]);const s=n<=1e3,l=s?t.formatMessage(FT):t.formatMessage(UT,{maxLength:t.formatNumber(1e3,{style:"decimal"})});return te.default.createElement(a.Tooltip,{title:l},te.default.createElement("div",null,te.default.createElement(AT,{label:l,icon:x.GlobeLine,onClick:o,disabled:!s})))}}}const mI=({featureConfig:e,file:t,user:i,comments:n})=>{const r=((e,t,i)=>{const n=e.file_viewer_translation_variant,r=a.getExtension$1(t);return n&&"OFF"!==n&&u.resolvePreviewTypeFromExtension(`.${r}`)===a.PreviewType.SsrDoc&&a.logStormcrowExposure("previews_ai_translation",n,null==i?void 0:i.id),["TEST","ON","V1_INTL","V1_DOMESTIC"].includes(null!=n?n:"OFF")})(e,t,i),o=te.default.useMemo((()=>r?new fI:void 0),[r]);return te.default.useMemo((()=>c.is_supported_mobile_browser()?void 0:{[p.TRANSLATION_PLUGIN_ID]:o,[p.COMMENTS_PLUGIN_ID]:n}),[n,o])};const hI={GetActivityStream:"@@apiv2_redux/file_activity_stream/get_activity_stream",GetActivityStreamResult:"@@apiv2_redux/file_activity_stream/get_activity_stream_result",GetActivityStreamBatch:"@@apiv2_redux/file_activity_stream/get_activity_stream_batch",GetActivityStreamBatchResult:"@@apiv2_redux/file_activity_stream/get_activity_stream_batch_result",GetFileActivityState:"@@apiv2_redux/file_activity_stream/get_file_activity_state",GetFileActivityStateResult:"@@apiv2_redux/file_activity_stream/get_file_activity_state_result",RecentFilesWithLatestEvents:"@@apiv2_redux/file_activity_stream/recent_files_with_latest_events",RecentFilesWithLatestEventsResult:"@@apiv2_redux/file_activity_stream/recent_files_with_latest_events_result"},vI=Jy(hI.GetActivityStream),SI=Jy(hI.GetActivityStreamResult),EI=Jy(hI.GetActivityStreamBatchResult),wI=Jy(hI.GetFileActivityStateResult),bI=Jy(hI.RecentFilesWithLatestEventsResult),yI=eT({[hI.GetActivityStream]:{endpoint:"get_activity_stream",action:SI},[hI.GetActivityStreamBatch]:{endpoint:"get_activity_stream_batch",action:EI},[hI.GetFileActivityState]:{endpoint:"get_file_activity_state",action:wI},[hI.RecentFilesWithLatestEvents]:{endpoint:"recent_files_with_latest_events",action:bI}}),TI="file_activity_blade_state";var II,CI;t.EventState=void 0,(II=t.EventState||(t.EventState={})).loading="loading",II.error="error",II.loaded="loaded",t.FilterType=void 0,(CI=t.FilterType||(t.FilterType={})).added="added",CI.viewed="viewed",CI.moved="moved",CI.renamed="renamed",CI.edited="edited",CI.shared="shared",CI.commented="commented";const AI=[t.FilterType.added,t.FilterType.viewed,t.FilterType.moved,t.FilterType.renamed,t.FilterType.edited,t.FilterType.shared,t.FilterType.commented],MI={filter:{},eventHistory:{}};function OI(e=MI,i){switch(i.type){case hI.GetActivityStream:return Object.assign(Object.assign({},e),{eventHistory:Object.assign(Object.assign({},e.eventHistory),{[i.payload.arg.file_path_or_id]:{status:t.EventState.loading}})});case hI.GetActivityStreamResult:return function(e,i){var a,n,r;const o=i.payload.arg.file_path_or_id;return i.error?Object.assign(Object.assign({},e),{eventHistory:Object.assign(Object.assign({},e.eventHistory),{[o]:{status:t.EventState.error,errorString:(null===(a=i.error)||void 0===a?void 0:a.message)||""}})}):Object.assign(Object.assign({},e),{eventHistory:Object.assign(Object.assign({},e.eventHistory),{[o]:{status:t.EventState.loaded,activity:(s=null!==(r=null===(n=i.payload.result)||void 0===n?void 0:n.activity_group)&&void 0!==r?r:[],s.reduce(((e,t)=>e.concat(t.activities)),[]))}})});var s}(e,i);case t.FileActivityActionTypes.SET_FILTER:return Object.assign(Object.assign({},e),{filter:i.filter});default:return e}}t.FileActivityActionTypes=void 0,(t.FileActivityActionTypes||(t.FileActivityActionTypes={})).SET_FILTER="FILE_ACTIVITY/SET_FILTER";const PI=a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{FileActivity:t}=yield new Promise((function(t,i){e(["./c_file_activity_component_file_activity"],t,i)}));return{default:t}})))),xI=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(PI,Object.assign({},e)));xI.displayName="AsyncFileActivity",a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{FileActivityBlade:t}=yield new Promise((function(t,i){e(["./c_file_activity_component_file_activity_blade"],t,i)}));return{default:t}})))),a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{CollapsedFileActivityBladeButton:t}=yield new Promise((function(t,i){e(["./c_file_activity_component_file_activity_blade"],t,i)}));return{default:t}}))));const DI=a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{VersionHistoryMenu:t}=yield new Promise((function(t,i){e(["./c_file_activity_component_version_history_menu"],t,i)}));return{default:t}})))),RI=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(DI,Object.assign({},e)));RI.displayName="AsyncVersionHistoryMenu";const NI=({user:e,onOpenVersionHistory:t,upsellBanner:n})=>{let r;const o=e=>(r||(r=new Promise((t=>{const i=function({apiV2Client:e}){const t=a.combineReducers({[TI]:OI});return a.createStore(t,a.applyMiddleware(yI(e.ns("file_activity_stream"))))}({apiV2Client:e});t(i)}))),r);return{sidebarUI:{Icon:()=>te.default.createElement(a.UIIcon,{src:T.FileHistoryLine}),Title:()=>{const e=a.useIntl();return te.default.createElement(te.default.Fragment,null,e.formatMessage({id:"g4fiTc",defaultMessage:"File Activity"}))},TitleAccessory:()=>{const{logUserAction:e}=u.useFileViewerContext(),n=i.useMemo((()=>t?{enabled:!0,onVersionHistoryClicked:()=>{t(),e(a.UserAction.VersionHistory,a.UserActionContext.PreviewSidebar)}}:{enabled:!1}),[e]);return n&&n.enabled?te.default.createElement(RI,{onVersionHistoryClicked:n.onVersionHistoryClicked,iconSize:"standard"}):null},Content:()=>{const{fileViewerId:t,logUserAction:i,apiV2Client:r}=u.useFileViewerContext(),s=$r(ao,t),[l,c]=te.default.useState(null);te.default.useEffect((()=>{o(r).then(c)}),[r]),Ss(t,a.PreviewsTimer.SidebarContentsMount,{bladeId:p.FILE_ACTIVITY_PLUGIN_ID},s===p.FILE_ACTIVITY_PLUGIN_ID);const d=Os();return d&&l?te.default.createElement(a.Provider,{store:l},te.default.createElement(xI,{fileId:d.fileId,user:e,logUserAction:i,upsellBanner:null==n?void 0:n()})):null}}}};a.injectInternalStyle("/static/typescript/component_libraries/files_components/src/right-rail/index.module.out-vflV10oEC.css",(e=>"._rc-expanded-right-rail-container_x3imz_1{background-color:var(--dig-color__background__base);display:flex;flex-direction:column;height:100%;width:328px}._rc-right-rail-title-container_x3imz_11{align-items:center;display:flex;min-height:56px}._rc-collapsed-right-rail-container_x3imz_17>._rc-right-rail-title-container_x3imz_11{padding-left:var(--spacing__unit--1_5);padding-right:var(--spacing__unit--1_5)}._rc-expanded-right-rail-container_x3imz_1>._rc-right-rail-title-container_x3imz_11{padding-left:var(--spacing__unit--2);padding-right:var(--spacing__unit--1_5)}._rc-right-rail-title-container--title_x3imz_27{flex-grow:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}._rc-right-rail-title-container--collapse-button_x3imz_34{flex-shrink:0;padding-left:var(--spacing__unit--1_5)}._rc-right-rail-header-container_x3imz_39{display:flex;padding:0 var(--spacing__unit--2)}._rc-right-rail-content-container_x3imz_44{display:flex}._rc-collapsed-right-rail-container_x3imz_17{background-color:var(--dig-color__background__base);display:flex;flex-direction:column;height:100%;width:56px}._rc-collapsed-blade--container_x3imz_58{height:100%}._rc-collapsed-blade-icons-container_x3imz_62{align-items:center;border-top:1px solid var(--dig-color__border__base);display:flex;flex-direction:column;height:100%;min-height:0;padding-top:var(--spacing__unit--0_5)}._rc-collapsed-blade-icon_x3imz_62{margin-top:var(--spacing__unit--2);position:relative}._rc-right-rail-compact-content-wrapper_x3imz_77,._rc-right-rail-content-wrapper_x3imz_78{flex-grow:1;height:100%}._rc-right-rail-compact-content-menu-wrapper_x3imz_84,._rc-right-rail-compact-content-menu-wrapper_x3imz_84>div,._rc-right-rail-compact-content-wrapper_x3imz_77{height:100%;min-height:0;width:100%}._rc-right-rail-compact-content-wrapper_x3imz_77 ._rc-right-rail-content-wrapper_x3imz_78 ._rc-right-rail-compact-header_x3imz_93{cursor:pointer}._rc-right-rail-compact-menu_x3imz_97{margin-left:16px}._rc-collapsed-blade-icon--notification-badge_x3imz_101{left:16px;position:absolute;top:-2px}"));const kI="_rc-expanded-right-rail-container_x3imz_1",LI="_rc-right-rail-title-container_x3imz_11",FI="_rc-collapsed-right-rail-container_x3imz_17",UI="_rc-right-rail-title-container--title_x3imz_27",VI="_rc-right-rail-title-container--collapse-button_x3imz_34",jI="_rc-right-rail-header-container_x3imz_39",BI="_rc-collapsed-blade--container_x3imz_58",HI="_rc-collapsed-blade-icons-container_x3imz_62",KI="_rc-collapsed-blade-icon_x3imz_62",zI="_rc-right-rail-compact-content-wrapper_x3imz_77",WI="_rc-right-rail-content-wrapper_x3imz_78",GI="_rc-right-rail-compact-content-menu-wrapper_x3imz_84",qI="_rc-right-rail-compact-header_x3imz_93",QI="_rc-right-rail-compact-menu_x3imz_97",YI="_rc-collapsed-blade-icon--notification-badge_x3imz_101",$I=({className:e,children:t})=>te.createElement("div",{className:a.cx(jI,e)},t);$I.displayName="Header",$I.displayName="Header";const ZI={expandedPanels:new Set([]),variant:"standard"},XI=te.createContext(ZI),JI=te.createContext({id:"",isActive:!1}),eC=e=>{var{className:t,children:i}=e,r=n.__rest(e,["className","children"]);return te.createElement(XI.Provider,{value:{expandedPanels:"blades"===r.variant?new Set([r.expandedPanel]):new Set(r.expandedPanels),variant:r.variant}},te.createElement("div",{className:a.cx("exp-dig-AccordionWrapper",t,{"exp-dig-AccordionWrapper--blades":"blades"===r.variant,"exp-dig-AccordionWrapper--standard":"standard"===r.variant})},i))};eC.displayName="Wrapper";const tC=({id:e,children:t})=>{const{expandedPanels:i}=te.useContext(XI),n=i.has(e),r=te.useMemo((()=>({id:e,isActive:n})),[e,n]);return te.createElement(JI.Provider,{value:r},te.createElement("div",{className:a.cx("exp-dig-AccordionItem",{"exp-dig-AccordionItem--active":n})},t))};tC.displayName="Item";const iC=({children:e,spacing:t="standard",className:i})=>te.createElement("div",{className:a.cx("exp-dig-AccordionPanel",{"exp-dig-AccordionPanel-spacing--small":"small"===t,"exp-dig-AccordionPanel-spacing--standard":"standard"===t,"exp-dig-AccordionPanel-spacing--large":"large"===t},i)},e);iC.displayName="Panel";const aC=({withTitle:e,withLeftAccessory:t,withTitleRightAccessory:i,withSubtitle:n,size:r="standard",spacing:o="standard",onClick:s,className:l})=>{const{id:c,isActive:d}=te.useContext(JI),{variant:u}=te.useContext(XI),_=te.useCallback((()=>{s&&s(c)}),[s,c]),p=te.useCallback((e=>{!s||13!==e.keyCode&&32!==e.keyCode||s(c)}),[s,c]);return te.createElement("div",{className:a.cx("exp-dig-AccordionHeader",{"exp-dig-AccordionHeader-spacing--standard":"standard"===o,"exp-dig-AccordionHeader-spacing--small":"small"===o,"exp-dig-AccordionHeader-spacing--large":"large"===o},l),onClick:_,onKeyDown:p,role:"button",tabIndex:0,"aria-expanded":d,"aria-disabled":d},t&&te.createElement("div",{className:"exp-dig-AccordionHeader-left-accessory"},t),te.createElement("div",{className:"exp-dig-AccordionHeader-title-container"},te.createElement("div",{className:"exp-dig-AccordionHeader-title-badge-container"},te.createElement(a.Text,{isBold:!0,size:r,variant:"label",className:"exp-dig-AccordionHeader-title"},e),i&&te.createElement("div",{className:"exp-dig-AccordionHeader-title-right-accessory"},i)),te.createElement(a.Text,{size:r,color:"faint",variant:"label"},n)),"standard"===u&&te.createElement("div",{className:"exp-dig-AccordionHeader-chevron"},te.createElement(a.UIIcon,{src:d?D.ChevronUpLine:a.ChevronDownLine,size:"small"})))};aC.displayName="Header";const nC=eC,rC=tC,oC=aC,sC=iC,lC=te.createContext({expandedBlade:""});const cC=te.createContext({isMenuItem:!1}),dC=te.createContext(void 0),uC=({className:e,children:t})=>{const{expandedBlade:n,onExpandBlade:r}=te.useContext(lC),[o,s]=function(){const e=i.useRef(null),t=i.useRef(),[a,n]=i.useState(),r=i.useCallback((()=>{t.current=new Z.index((e=>n(e[0]))),(null==e?void 0:e.current)&&t.current.observe(e.current)}),[e.current]);return i.useLayoutEffect((()=>(r(),()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.disconnect()})),[r]),[e,a]}(),l=s&&s.contentRect.height<344,c=te.useCallback((e=>{r&&r(e)}),[r]);return te.createElement("div",{ref:o,className:zI,"data-testid":"rc-right-rail-compact-content-wrapper",style:{height:"100%",minHeight:"0"}},l?te.createElement(a.Menu.Wrapper,{isBlock:!0,onSelection:c,className:GI},(({getTriggerProps:i,getContentProps:r})=>te.createElement(nC,{variant:"blades",expandedPanel:n||"",className:a.cx(WI,e)},te.createElement(dC.Provider,{value:{getTriggerProps:i}},t),te.createElement(a.Menu.Content,Object.assign({},r(),{className:QI}),te.createElement(a.Menu.Segment,null,te.createElement(cC.Provider,{value:{isMenuItem:!0}},t)))))):te.createElement(nC,{variant:"blades",expandedPanel:n||"",className:a.cx(WI,e)},t))};uC.displayName="Content",uC.displayName="Content";const _C=({id:e,withTitle:t,withIcon:i,withTitleRightAccessory:n,headerTooltipDataAttribute:r,bladePanelClassname:o,children:s})=>{const{onExpandBlade:l,expandedBlade:c}=te.useContext(lC),{isMenuItem:d}=te.useContext(cC),u=te.useContext(dC),_=te.useCallback((()=>{l&&l(e)}),[e,l]),p=c===e;return d?te.createElement(a.Menu.SelectItem,{key:e,value:e,selected:p,withRightAccessory:i},t):u&&!p?null:te.createElement(rC,{id:e},te.createElement("div",Object.assign({},null==u?void 0:u.getTriggerProps(),{"data-tooltip":r}),te.createElement(oC,{withTitle:t,withLeftAccessory:i,onClick:_,withTitleRightAccessory:te.createElement(te.Fragment,null,u?te.createElement(a.UIIcon,{src:a.ChevronDownLine,size:"small"}):void 0,n),className:u&&qI})),te.createElement(sC,{className:a.cx(BI,o)},p?s:null))};_C.displayName="Blade",_C.displayName="Blade";const pC=({id:e,withIcon:t,withNotificationBadge:i=0,tooltip:n,buttonTooltipDataAttribute:r})=>{const{onExpandBlade:o}=te.useContext(lC),s=te.useCallback((()=>{o&&o(e)}),[o,e]);return te.createElement("div",{className:KI,"data-tooltip":r},te.createElement(a.Tooltip,{title:n,placement:"left"},te.createElement(a.IconButton,{variant:"transparent",onClick:s},t)),i>0&&te.createElement(X.NotificationBadge,{className:YI,status:"attention"},i))};pC.displayName="CollapsedBladeIcon",pC.displayName="CollapsedBladeIcon";const gC=({isExpanded:e,withTitle:t,expandedBlade:i,onCollapse:n,onExpandBlade:r,onExpand:o,header:s,expandedChildren:l,collapsedChildren:c,className:d,isCollapsible:u=!0,tooltipProps:_})=>{const p=_||{placement:"top",openDelay:500},g=a.useIntl(),f=e?g.formatMessage({id:"BgMbCS",defaultMessage:"Close details pane"}):g.formatMessage({id:"J5TC1D",defaultMessage:"Open details pane"});return te.createElement(te.Fragment,null,te.createElement(lC.Provider,{value:{onExpandBlade:r,expandedBlade:i}},te.createElement("div",{className:a.cx(d,{[kI]:e,[FI]:!e})},te.createElement("div",{className:LI,"data-testid":"rc-right-rail-title-container","data-tooltip":"right-rail-title"},e&&te.createElement("div",{className:UI,"data-testid":"rc-right-rail-title-container--title"},te.createElement(a.Text,{isBold:!0,role:"heading","aria-level":2},te.createElement(a.Truncate,{location:.5,tooltipControlProps:p},t))),te.createElement("div",{className:a.cx({[VI]:e}),"data-testid":e?"rc-right-rail-title-container--collapse-button":void 0},u&&te.createElement(a.Tooltip,{title:f,placement:"left"},te.createElement(a.IconButton,{onClick:e?n:o,variant:"transparent"},te.createElement(a.UIIcon,{src:e?T.CollapseRightLine:T.ExpandLeftLine,"aria-label":f}))))),e?te.createElement(te.Fragment,null,s&&te.createElement($I,null,s),te.createElement(uC,null,l)):te.createElement("div",{className:HI},c))))};gC.displayName="RightRailWrapper",gC.displayName="RightRailWrapper";const fC={Header:$I,Blade:_C,Content:uC,CollapsedBladeIcon:pC,RightRailWrapper:gC};te.memo((({id:e,intl:t,children:i})=>te.createElement(l.Provider,{value:t},te.createElement(fC.Blade,{withIcon:te.createElement(a.UIIcon,{src:a.InfoLine}),withTitle:t.formatMessage({id:"pehNW7",defaultMessage:"Info"}),id:e},i)))).displayName="InfoBlade";te.memo((({id:e,intl:t})=>te.createElement(l.Provider,{value:t},te.createElement(fC.CollapsedBladeIcon,{withIcon:te.createElement(a.UIIcon,{src:a.InfoLine,"aria-label":t.formatMessage({id:"Jf5mVf",defaultMessage:"Open info panel"})}),id:e,tooltip:t.formatMessage({id:"+PrmmG",defaultMessage:"Info"})})))).displayName="InfoBladeCollapsedBladeButton";a.injectInternalStyle("/static/typescript/component_libraries/files_components/src/blades/info_blade/index.module.out-vfl8DHoZN.css",(e=>"._info-blade--metadata-row_8xw62_1{display:flex}._info-blade--metadata-title_8xw62_9{display:flex;width:92px}._info-blade--metadata-data_8xw62_14{flex:1 1 0;margin-left:var(--spacing__unit--2);min-width:0}._info-blade--basic-metadata-container_8xw62_21{display:flex;flex-direction:column}._info-blade--file-breadcrumb-link_8xw62_26>span{color:var(--dig-color__text__base)}._info-blade--pathbar_8xw62_30 a{color:var(--dig-color__text__subtle)}._info-blade--expand-fields-button_8xw62_34{margin-top:var(--spacing__base_unit)}"));const mC="_info-blade--metadata-row_8xw62_1",hC="_info-blade--metadata-title_8xw62_9",vC="_info-blade--metadata-data_8xw62_14",SC="_info-blade--basic-metadata-container_8xw62_21",EC="_info-blade--file-breadcrumb-link_8xw62_26",wC="_info-blade--pathbar_8xw62_30",bC="_info-blade--expand-fields-button_8xw62_34",yC=te.memo((e=>{var{path:t,size:i="small",openPath:r,accountRootName:o,browseRoot:s}=e,l=n.__rest(e,["path","size","openPath","accountRootName","browseRoot"]);const c=Pm(t),d=o,u=km(c).reverse();u.unshift("");const _=e=>{if(s)return e.startsWith("/")||(e="/"+e),s.startsWith("/")||(s="/"+s),`https://www.dropbox.com${s}${e}`};return te.createElement(a.Breadcrumb,Object.assign({size:i,isRootOverflow:!0},l),u.map((e=>te.createElement(a.Breadcrumb.Link,{key:xm(e,d),href:_(e),onClick:()=>r(e),isCurrentPath:!1,className:EC},xm(e,d)))))}));yC.displayName="FileBreadcrumb";const TC={BINDER:["binder"],PAPER:["paper"],PAPER_TEMPLATE:["papert"],IMAGE:["3fr","arw","bmp","cr2","crw","dcr","dcs","dng","erf","gif","heic","j2c","j2k","jp2","jpc","jpeg","jpf","jpg","jpg2","jpm","jpx","kdc","mef","mos","mrw","nef","nrw","orf","pef","png","ppm","psd","r3d","raf","rw2","rwl","sr2","svg","svgz","tga","tif","tiff","wbmp","web","webp","x3f","ico","heif"],VIDEO:["3gp","3gpp","3gpp2","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpeg","mpg","mts","mxf","ts","vob","wmv"],AUDIO:["aif","flac","m4a","m4p","mp3","ogg","wav","wma"],DOCUMENT:["ai","cdr","csv","doc","docx","docm","eps","fla","gdoc","gsheet","gslides","indd","keynote","numbers","otf","pages","pdf","ppt","pptx","pptm","pps","ppsx","ppsm","ps","rtf","swf","txt","wpd","xls","xlsx","xlsm"],COMPRESSED_FILE:["7z","bz2","gz","gzip","rar","tar","zip"],CODE:["as","as3","asm","aspx","bat","c","cc","cmake","coffee","cpp","cs","css","cxx","diff","erb","erl","groovy","gry","h","haml","hh","hpp","html","htm","hxx","java","js","json","jsx","less","lst","m","make","mk","ml","mm","msg","out","patch","php","pl","pm","plist","properties","py","rb","sass","scala","scm","script","scss","sh","sml","sql","vb","vi","vim","xhtml","xml","xsd","xsl","y","yaml","yml","yxx"],DISK_IMAGE:["dmg","iso"],EXECUTABLE:["exe"],SHORTCUT:["lnk","web"],LINK:["url","webloc"],FONT:["ttf"]},IC={};for(const e of Object.keys(TC)){const t=TC[e];for(const i of t)IC[i]=e}const CC={FILE:e=>e.formatMessage({id:"v4Shkr",defaultMessage:"File"}),IMAGE:e=>e.formatMessage({id:"taNwEu",defaultMessage:"Image"}),VIDEO:e=>e.formatMessage({id:"0oGQrb",defaultMessage:"Video"}),AUDIO:e=>e.formatMessage({id:"sRcbgl",defaultMessage:"Audio"}),DOCUMENT:e=>e.formatMessage({id:"Fc5K7b",defaultMessage:"Document"}),COMPRESSED_FILE:e=>e.formatMessage({id:"etyvLK",defaultMessage:"Archive"}),CODE:e=>e.formatMessage({id:"+XtI3U",defaultMessage:"Code"}),DISK_IMAGE:e=>e.formatMessage({id:"1ibhRZ",defaultMessage:"Disk image"}),EXECUTABLE:e=>e.formatMessage({id:"AcUuht",defaultMessage:"Executable"}),SHORTCUT:e=>e.formatMessage({id:"JOimvX",defaultMessage:"Shortcut"}),LINK:e=>e.formatMessage({id:"g8rKMf",defaultMessage:"Link"}),FONT:e=>e.formatMessage({id:"1xtVFj",defaultMessage:"Font"}),PAPER:e=>e.formatMessage({id:"ONHPlw",defaultMessage:"Paper doc"}),PAPER_TEMPLATE:e=>e.formatMessage({id:"TfIt0w",defaultMessage:"Paper template"}),BINDER:e=>e.formatMessage({id:"3Tt6Qx",defaultMessage:"Binder"})},AC=(e,t)=>(0,CC[IC[e]||"FILE"])(t);function MC(){const[e,t]=te.useState("top"),i=te.useCallback((e=>{t(e)}),[t]);return{placement:e,onChangePlacement:i}}const OC=({title:e,data:t})=>{const{placement:i,onChangePlacement:n}=MC();return te.createElement("div",{className:mC,role:"row"},te.createElement("div",{className:hC,role:"rowheader"},te.createElement(a.Text,{size:"small",variant:"paragraph",color:"faint",style:{overflow:"hidden"}},te.createElement(a.Truncate,{tooltipControlProps:{placement:i,openDelay:500,onChangePlacement:n,maxWidth:210}},e))),te.createElement("div",{className:vC,role:"cell"},t))};OC.displayName="InfoBladeMetadataRow";const PC=({title:e,data:t})=>{const{placement:i,onChangePlacement:n}=MC();return te.createElement(OC,{title:e,data:te.createElement(a.Text,{variant:"paragraph",size:"small"},te.createElement(a.Truncate,{tooltipControlProps:{placement:i,openDelay:500,auto:!0,maxWidth:210,onChangePlacement:n},lines:3},t))})};PC.displayName="InfoBladeTextMetadataRow";function xC(e,t,i=2,a=!0,n=!0,r=!0){t=r?parseFloat(t):Math.max(0,parseFloat(t));const o=Math.abs(t);let s,l;o<1024?(i=0,s=t,l=e.formatMessage({id:"se/5fs",defaultMessage:"{count, plural, one{byte} other{bytes}}"},{count:t}),a=!0):o<921600?(s=t/1024,l=e.formatMessage({id:"fcOrPH",defaultMessage:"KB"})):o<943718400?(s=t/1048576,l=e.formatMessage({id:"UFZYVH",defaultMessage:"MB"})):o<966367641600||0===i&&t<1099511627776?(s=t/1073741824,l=e.formatMessage({id:"5nCO1R",defaultMessage:"GB"})):(s=t/1099511627776,l=e.formatMessage({id:"4rrpQj",defaultMessage:"TB"}));return`${e.formatNumber(s,{maximumFractionDigits:i,minimumFractionDigits:n?0:i})}${a?" ":""}${l}`}const DC=te.memo((({file:e,pathBar:t,accountRootName:i="Dropbox",browseRoot:n})=>{const{lastModifiedMs:r,size:o,name:s,fqPath:l}=e,c=a.useIntl();return te.createElement("div",{className:SC},l&&(null==t?void 0:t.enabled)&&te.createElement(OC,{title:c.formatMessage({id:"vRjK3h",defaultMessage:"Saved in"}),data:te.createElement(yC,{className:wC,size:"small",path:l,accountRootName:i,openPath:t.openPath,browseRoot:n})}),void 0!==o&&te.createElement(OC,{title:c.formatMessage({id:"7+ns4J",defaultMessage:"Size"}),data:te.createElement(a.Text,{variant:"paragraph",size:"small"},xC(c,o))}),r&&te.createElement(OC,{title:c.formatMessage({id:"3TwhnG",defaultMessage:"Modified"}),data:te.createElement(a.Text,{variant:"paragraph",size:"small"},c.formatTime(new Date(r),{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}))}),s&&te.createElement(OC,{title:c.formatMessage({id:"VPGq/B",defaultMessage:"Type"}),data:te.createElement(a.Text,{variant:"paragraph",size:"small"},AC(Rm(s),c))}))}));DC.displayName="BasicFileMetadata";const RC=1e3,NC=60*RC,kC=60*NC;function LC(e,t){if(!e)return;if(isNaN(e)||e<=0)return;const i=Math.floor(e/kC),a=Math.floor(e%kC/NC),n=Math.floor(e%NC/RC),r=Math.floor(e%RC),o=0==i&&0==a&&n<15,s=i>0||a>=10,l={hours:t.formatNumber(i,{minimumIntegerDigits:2,maximumFractionDigits:0}),minutes:t.formatNumber(a,{minimumIntegerDigits:2,maximumFractionDigits:0}),seconds:t.formatNumber(n,{minimumIntegerDigits:2,maximumFractionDigits:0}),millis:String(r).padStart(3,"0")};return o?t.formatMessage({id:"tgiBzN",defaultMessage:"{minutes}:{seconds}.{millis}"},l):s?t.formatMessage({id:"Y2LnVt",defaultMessage:"{hours}:{minutes}:{seconds}"},l):t.formatMessage({id:"eHQbup",defaultMessage:"{minutes}:{seconds}"},l)}function FC(e,t){if(e.audio_freq){if(e.audio_chan_layout){const i=+e.audio_chan_layout;if(!isNaN(i))return t.formatMessage({id:"ZFfsQG",defaultMessage:"{audio_freq} kHz {audio_chan_layout}"},{audio_freq:t.formatNumber(e.audio_freq/1e3),audio_chan_layout:t.formatNumber(i/100)})}return t.formatMessage({id:"o1Wy7v",defaultMessage:"{audio_freq} kHz"},{audio_freq:t.formatNumber(e.audio_freq/1e3)})}}const UC=1e3,VC=60*UC,jC=60*VC,BC=24*jC,HC=7*BC,KC=30*BC,zC=365*BC;function WC(e,t){if(e&&!(isNaN(e)||e<=0))return e<VC?t.formatMessage({id:"XJTRCn",defaultMessage:"{value, plural, one{# second} other{# seconds}}"},{value:Math.round(e/UC)}):e<jC?t.formatMessage({id:"hYCfnh",defaultMessage:"{value, plural, one{# minute} other{# minutes}}"},{value:Math.round(e/VC)}):e<BC?t.formatMessage({id:"5vUoeT",defaultMessage:"{value, plural, one{# hour} other{# hours}}"},{value:Math.round(e/jC)}):e<HC?t.formatMessage({id:"VUIAfM",defaultMessage:"{value, plural, one{# day} other{# days}}"},{value:Math.round(e/BC)}):e<KC?t.formatMessage({id:"0wIJlM",defaultMessage:"{value, plural, one{# week} other{# weeks}}"},{value:Math.round(e/HC)}):e<zC?t.formatMessage({id:"MPX3Ow",defaultMessage:"{value, plural, one{# month} other{# months}}"},{value:Math.round(e/KC)}):t.formatMessage({id:"toXz6N",defaultMessage:"{value, plural, one{# year} other{# years}}"},{value:Math.round(e/zC)})}var GC,qC,QC,YC,$C,ZC;!function(e){e[e.Unknown=0]="Unknown",e[e.Average=1]="Average",e[e.CenterWeightedAverage=2]="CenterWeightedAverage",e[e.Spot=3]="Spot",e[e.MultiSpot=4]="MultiSpot",e[e.MultiSegment=5]="MultiSegment",e[e.Partial=6]="Partial",e[e.Other=7]="Other"}(GC||(GC={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoFlash=1]="NoFlash",e[e.Fired=2]="Fired",e[e.FiredReturnNotDetected=3]="FiredReturnNotDetected",e[e.FiredReturnDetected=4]="FiredReturnDetected",e[e.OnDidNotFire=5]="OnDidNotFire",e[e.OnFired=6]="OnFired",e[e.OnReturnNotDetected=7]="OnReturnNotDetected",e[e.OnReturnDetected=8]="OnReturnDetected",e[e.OffDidNotFire=9]="OffDidNotFire",e[e.OffDidNotFireReturnNotDetected=10]="OffDidNotFireReturnNotDetected",e[e.AutoDidNotFire=11]="AutoDidNotFire",e[e.AutoFired=12]="AutoFired",e[e.AutoFiredReturnNotDetected=13]="AutoFiredReturnNotDetected",e[e.AutoFiredReturnDetected=14]="AutoFiredReturnDetected",e[e.NoFlashFunction=15]="NoFlashFunction",e[e.OffNoFlashFunction=16]="OffNoFlashFunction",e[e.FiredRedEyeReduction=17]="FiredRedEyeReduction",e[e.FiredRedEyeReductionReturnNotDetected=18]="FiredRedEyeReductionReturnNotDetected",e[e.FiredRedEyeReductionReturnDetected=19]="FiredRedEyeReductionReturnDetected",e[e.OnRedEyeReduction=20]="OnRedEyeReduction",e[e.OnRedEyeReductionReturnNotDetected=21]="OnRedEyeReductionReturnNotDetected",e[e.OnRedEyeReductionReturnDetected=22]="OnRedEyeReductionReturnDetected",e[e.OffRedEyeReduction=23]="OffRedEyeReduction",e[e.AutoDidNotFireRedEyeReduction=24]="AutoDidNotFireRedEyeReduction",e[e.AutoFiredRedEyeReduction=25]="AutoFiredRedEyeReduction",e[e.AutoFiredRedEyeReductionReturnNotDetected=26]="AutoFiredRedEyeReductionReturnNotDetected",e[e.AutoFiredRedEyeReductionReturnDetected=27]="AutoFiredRedEyeReductionReturnDetected",e[e.Other=28]="Other"}(qC||(qC={})),function(e){e[e.Unknown=0]="Unknown",e[e.Auto=1]="Auto",e[e.Manual=2]="Manual",e[e.Other=3]="Other"}(QC||(QC={})),function(e){e[e.Unknown=0]="Unknown",e[e.SRgb=1]="SRgb",e[e.AdobeRgb=2]="AdobeRgb",e[e.WideGamutRgb=3]="WideGamutRgb",e[e.IccProfile=4]="IccProfile",e[e.Uncalibrated=5]="Uncalibrated",e[e.Other=6]="Other"}(YC||(YC={})),function(e){e[e.UnknownOrientation=0]="UnknownOrientation",e[e.Horizontal=1]="Horizontal",e[e.MirrorHorizontal=2]="MirrorHorizontal",e[e.Rotate180=3]="Rotate180",e[e.MirrorVertical=4]="MirrorVertical",e[e.MirrorHorizontalRotate270Cw=5]="MirrorHorizontalRotate270Cw",e[e.Rotate90Cw=6]="Rotate90Cw",e[e.MirrorHorizontalRotate90Cw=7]="MirrorHorizontalRotate90Cw",e[e.Rotate270Cw=8]="Rotate270Cw"}($C||($C={})),function(e){e[e.UnknownResolutionUnit=0]="UnknownResolutionUnit",e[e.Inch=1]="Inch",e[e.CM=2]="CM"}(ZC||(ZC={}));const XC=e=>({[QC.Unknown]:e.formatMessage({id:"vHgZs0",defaultMessage:"Unknown"}),[QC.Auto]:e.formatMessage({id:"xhS6fE",defaultMessage:"Auto"}),[QC.Manual]:e.formatMessage({id:"ToNv3C",defaultMessage:"Manual"}),[QC.Other]:e.formatMessage({id:"bmpvII",defaultMessage:"Other"})}),JC=e=>({[YC.Unknown]:e.formatMessage({id:"vHgZs0",defaultMessage:"Unknown"}),[YC.SRgb]:e.formatMessage({id:"a0wUgp",defaultMessage:"sRGB"}),[YC.AdobeRgb]:e.formatMessage({id:"B28Q5y",defaultMessage:"Adobe RGB"}),[YC.WideGamutRgb]:e.formatMessage({id:"Kh3t+h",defaultMessage:"Wide Gamut RGB"}),[YC.IccProfile]:e.formatMessage({id:"h4Q5SZ",defaultMessage:"ICC Profile"}),[YC.Uncalibrated]:e.formatMessage({id:"/7omh+",defaultMessage:"Uncalibrated"}),[YC.Other]:e.formatMessage({id:"bmpvII",defaultMessage:"Other"})}),eA=e=>({[qC.Unknown]:e.formatMessage({id:"vHgZs0",defaultMessage:"Unknown"}),[qC.NoFlash]:e.formatMessage({id:"CMxZBg",defaultMessage:"No flash"}),[qC.Fired]:e.formatMessage({id:"GxXK+Z",defaultMessage:"Fired"}),[qC.FiredReturnNotDetected]:e.formatMessage({id:"1aQhV4",defaultMessage:"Fired, return not detected"}),[qC.FiredReturnDetected]:e.formatMessage({id:"mxTse0",defaultMessage:"Fired, return detected"}),[qC.OnDidNotFire]:e.formatMessage({id:"VAQlMV",defaultMessage:"On, did not fire"}),[qC.OnFired]:e.formatMessage({id:"IfNe4i",defaultMessage:"On, fired"}),[qC.OnReturnNotDetected]:e.formatMessage({id:"xb3nZ7",defaultMessage:"On, return not detected"}),[qC.OnReturnDetected]:e.formatMessage({id:"GIkKlb",defaultMessage:"On, return detected"}),[qC.OffDidNotFire]:e.formatMessage({id:"hvSCzd",defaultMessage:"Off, did not fire"}),[qC.OffDidNotFireReturnNotDetected]:e.formatMessage({id:"O8+FbV",defaultMessage:"Off, did not fire, return not detected"}),[qC.AutoDidNotFire]:e.formatMessage({id:"KSJ3BI",defaultMessage:"Auto, did not fire"}),[qC.AutoFired]:e.formatMessage({id:"F0TcTd",defaultMessage:"Auto, fired"}),[qC.AutoFiredReturnNotDetected]:e.formatMessage({id:"rLeBiG",defaultMessage:"Auto, fired, return not detected"}),[qC.AutoFiredReturnDetected]:e.formatMessage({id:"qJftjl",defaultMessage:"Auto, fired, return detected"}),[qC.NoFlashFunction]:e.formatMessage({id:"jdWze8",defaultMessage:"No flash function"}),[qC.OffNoFlashFunction]:e.formatMessage({id:"THu+Iw",defaultMessage:"Off, no flash function"}),[qC.FiredRedEyeReduction]:e.formatMessage({id:"B0ZoP1",defaultMessage:"Fired, red-eye reduction"}),[qC.FiredRedEyeReductionReturnNotDetected]:e.formatMessage({id:"XrGwwy",defaultMessage:"Fired, red-eye reduction, return not detected"}),[qC.FiredRedEyeReductionReturnDetected]:e.formatMessage({id:"piA/mD",defaultMessage:"Fired, red-eye reduction, return detected"}),[qC.OnRedEyeReduction]:e.formatMessage({id:"VgJqkZ",defaultMessage:"On, red-eye reduction"}),[qC.OnRedEyeReductionReturnNotDetected]:e.formatMessage({id:"+TI9qg",defaultMessage:"On, red-eye reduction, return not detected"}),[qC.OnRedEyeReductionReturnDetected]:e.formatMessage({id:"j8jQAQ",defaultMessage:"On, red-eye reduction, return detected"}),[qC.OffRedEyeReduction]:e.formatMessage({id:"QLLQth",defaultMessage:"Off, red-eye reduction"}),[qC.AutoDidNotFireRedEyeReduction]:e.formatMessage({id:"AhpZjQ",defaultMessage:"Auto, did not fire, red-eye reduction"}),[qC.AutoFiredRedEyeReduction]:e.formatMessage({id:"Qv2qrm",defaultMessage:"Auto, fired, red-eye reduction"}),[qC.AutoFiredRedEyeReductionReturnNotDetected]:e.formatMessage({id:"gTPkua",defaultMessage:"Auto, fired, red-eye reduction, return not detected"}),[qC.AutoFiredRedEyeReductionReturnDetected]:e.formatMessage({id:"4Ty2Bk",defaultMessage:"Auto, fired, red-eye reduction, return detected"}),[qC.Other]:e.formatMessage({id:"bmpvII",defaultMessage:"Other"})}),tA=e=>({[GC.Unknown]:e.formatMessage({id:"vHgZs0",defaultMessage:"Unknown"}),[GC.Average]:e.formatMessage({id:"FfhsBR",defaultMessage:"Average"}),[GC.CenterWeightedAverage]:e.formatMessage({id:"FgYWQc",defaultMessage:"Center-weighted average"}),[GC.Spot]:e.formatMessage({id:"xcW6Wd",defaultMessage:"Spot"}),[GC.MultiSpot]:e.formatMessage({id:"RGJ4oA",defaultMessage:"Multi-spot"}),[GC.MultiSegment]:e.formatMessage({id:"iExd56",defaultMessage:"Multi-segment"}),[GC.Partial]:e.formatMessage({id:"Zd4uKj",defaultMessage:"Partial"}),[GC.Other]:e.formatMessage({id:"bmpvII",defaultMessage:"Other"})}),iA=e=>({[$C.Horizontal]:e.formatMessage({id:"7v6FH2",defaultMessage:"Horizontal (normal)"}),[$C.MirrorHorizontal]:e.formatMessage({id:"s1wRj/",defaultMessage:"Mirror horizontal"}),[$C.Rotate180]:e.formatMessage({id:"YxttK0",defaultMessage:"Rotate 180"}),[$C.MirrorVertical]:e.formatMessage({id:"ykfmPa",defaultMessage:"Mirror vertical"}),[$C.MirrorHorizontalRotate270Cw]:e.formatMessage({id:"GSAufA",defaultMessage:"Mirror horizontal and rotate 270 CW"}),[$C.Rotate90Cw]:e.formatMessage({id:"RUtOD3",defaultMessage:"Rotate 90 CW"}),[$C.MirrorHorizontalRotate90Cw]:e.formatMessage({id:"PzCdEi",defaultMessage:"Mirror horizontal and rotate 90 CW"}),[$C.Rotate270Cw]:e.formatMessage({id:"g6rS8+",defaultMessage:"Rotate 270 CW"})}),aA=(e,t,i)=>{if(void 0!==e&&void 0!==t)return i.formatMessage({id:"P63UMO",defaultMessage:"{width} x {height}"},{width:e,height:t})},nA=(e,t,i)=>{if(void 0!==e&&void 0!==t)return i.formatMessage({id:"6A4kNh",defaultMessage:"{width} x {height}"},{width:e,height:t})},rA=(e,t)=>{if(!e)return;let i=e;if(-1===e.indexOf("/")){const a=parseFloat(e);if(isNaN(a))return;i=a<1?t.formatNumber(a,{minimumFractionDigits:2,maximumFractionDigits:2}):t.formatNumber(a,{minimumFractionDigits:1,maximumFractionDigits:1})}return t.formatMessage({id:"ZbTwYS",defaultMessage:"{exposure_time} s"},{exposure_time:i})},oA=(e,t)=>{if(e){const i=t.formatNumber(e,{minimumFractionDigits:1,maximumFractionDigits:1});return t.formatMessage({id:"WOwRDU",defaultMessage:"f/{aperture}"},{aperture:i})}},sA=(e,t)=>{if(!e)return;const i=parseFloat(e);if(isNaN(i))return;const a=t.formatNumber(i,{minimumFractionDigits:1,maximumFractionDigits:1});return t.formatMessage({id:"BTHLkw",defaultMessage:"{focal_length} mm"},{focal_length:a})},lA=(e,t)=>{if(e){const i=new Date(e);return t.formatDate(i,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",timeZone:"UTC",hourCycle:"h12"})}};const cA=({metadata:e,onShowMore:t})=>{const[n,r]=i.useState(!1),o=a.useIntl(),s=te.default.useMemo((()=>dA(e,o).filter((e=>!!e.value))),[e,o]),l=te.default.useMemo((()=>n?s:s.slice(0,8)),[s,n]),c=i.useCallback((()=>{null==t||t(!n),r(!n)}),[n,t]),d=o.formatMessage({id:"+kc9n+",defaultMessage:"Show all"}),u=o.formatMessage({id:"5tvWhA",defaultMessage:"Hide"}),_=s.length>8;return te.default.createElement("div",null,l.map((e=>te.default.createElement(PC,{key:`content-metadata-${e.name}`,title:e.name,data:e.value}))),_&&te.default.createElement(a.Button,{className:bC,variant:"transparent",size:"small",onClick:c,fullWidth:!1},te.default.createElement(a.Text,{className:"expand-fields-button--context-text",size:"small",isBold:!0},n?u:d)))};cA.displayName="FileContentMetadataUI";const dA=(e,t)=>{switch(e[".tag"]){case"image":return function(e,t){const i=(e=>({captureDate:e.formatMessage({id:"54B7+u",defaultMessage:"Date taken"}),createDate:e.formatMessage({id:"+OuHm4",defaultMessage:"Date created"}),credits:e.formatMessage({id:"WU02lX",defaultMessage:"Credits"}),dimensions:e.formatMessage({id:"5fgW0C",defaultMessage:"Dimensions"}),resolution:e.formatMessage({id:"wscUVd",defaultMessage:"Dots per inch"}),resolution_in_cm:e.formatMessage({id:"P23mCt",defaultMessage:"Dots per CM"}),colorSpace:e.formatMessage({id:"SHDDoj",defaultMessage:"Color profile"}),deviceMake:e.formatMessage({id:"GkqUJK",defaultMessage:"Camera brand"}),deviceModel:e.formatMessage({id:"EPx9jS",defaultMessage:"Camera model"}),lensModel:e.formatMessage({id:"8+mL18",defaultMessage:"Lens"}),apertureValue:e.formatMessage({id:"Hv/B/8",defaultMessage:"Aperture"}),exposureTime:e.formatMessage({id:"5JRhFM",defaultMessage:"Shutter speed"}),focalLength:e.formatMessage({id:"hKz/tt",defaultMessage:"Focal length"}),isoSpeed:e.formatMessage({id:"c7J2CV",defaultMessage:"ISO"}),flash:e.formatMessage({id:"WIBZO6",defaultMessage:"Flash"}),meteringMode:e.formatMessage({id:"WbVH1z",defaultMessage:"Metering"}),whiteBalance:e.formatMessage({id:"USKkbD",defaultMessage:"White balance"}),copyright:e.formatMessage({id:"qQhzrN",defaultMessage:"Copyright"}),keywords:e.formatMessage({id:"jNkBVA",defaultMessage:"Keywords"}),title:e.formatMessage({id:"YyhVRN",defaultMessage:"Title"}),caption:e.formatMessage({id:"1vHwyl",defaultMessage:"Caption"}),creator:e.formatMessage({id:"Z5ApwP",defaultMessage:"Creator"}),artist:e.formatMessage({id:"2mALcS",defaultMessage:"Artist"}),description:e.formatMessage({id:"6hvXWm",defaultMessage:"Description"}),headline:e.formatMessage({id:"1Y0IbU",defaultMessage:"Headline"}),licensorUrl:e.formatMessage({id:"j6C1Hk",defaultMessage:"Licensor URL"}),orientation:e.formatMessage({id:"oDAo/S",defaultMessage:"Orientation"}),usageRights:e.formatMessage({id:"VUwfxH",defaultMessage:"Usage rights"}),category:e.formatMessage({id:"KP48oN",defaultMessage:"PS category"}),userComments:e.formatMessage({id:"tcqDgZ",defaultMessage:"User comments"})}))(t);return[{name:i.description,value:e.description},{name:i.copyright,value:e.copyright},{name:i.keywords,value:e.keywords},{name:i.captureDate,value:lA(e.date_time_original,t)},{name:i.createDate,value:lA(e.create_date,t)},{name:i.dimensions,value:aA(e.image_width,e.image_height,t)},{name:i.resolution,value:e.resolution_unit!==ZC.CM?nA(e.x_resolution,e.y_resolution,t):void 0},{name:i.resolution_in_cm,value:e.resolution_unit===ZC.CM?nA(e.x_resolution,e.y_resolution,t):void 0},{name:i.colorSpace,value:void 0!==e.colorspace?JC(t)[e.colorspace]:void 0},{name:i.orientation,value:void 0!==e.orientation?iA(t)[e.orientation]:void 0},{name:i.title,value:e.title},{name:i.caption,value:e.caption},{name:i.creator,value:e.creator},{name:i.artist,value:e.credit},{name:i.headline,value:e.headline},{name:i.credits,value:e.credits},{name:i.licensorUrl,value:e.licensor_url},{name:i.usageRights,value:e.rights_usage_terms},{name:i.category,value:e.category},{name:i.userComments,value:e.user_comments},{name:i.deviceMake,value:e.camera_make},{name:i.deviceModel,value:e.camera_model},{name:i.lensModel,value:e.lens_model},{name:i.focalLength,value:sA(e.focal_length,t)},{name:i.exposureTime,value:rA(e.exposure_time,t)},{name:i.apertureValue,value:oA(e.aperture_value,t)},{name:i.isoSpeed,value:void 0!==e.iso_speed?String(e.iso_speed):void 0},{name:i.meteringMode,value:void 0!==e.metering_mode?tA(t)[e.metering_mode]:void 0},{name:i.flash,value:void 0!==e.flash?eA(t)[e.flash]:void 0},{name:i.whiteBalance,value:void 0!==e.white_balance?XC(t)[e.white_balance]:void 0}].filter((e=>!!e.value))}(e,t);case"ms_office":return function(e,t){return[{name:t.formatMessage({id:"Ed/RQ2",defaultMessage:"Title"}),value:e.title},{name:t.formatMessage({id:"TpJn8o",defaultMessage:"Owner"}),value:e.creator},{name:t.formatMessage({id:"WRzvI1",defaultMessage:"Company"}),value:e.company},{name:t.formatMessage({id:"NL8ygk",defaultMessage:"Subject"}),value:e.subject},{name:t.formatMessage({id:"a8+LVV",defaultMessage:"Keywords"}),value:e.keywords},{name:t.formatMessage({id:"yGgaIu",defaultMessage:"Description"}),value:e.description},{name:t.formatMessage({id:"BLmrgy",defaultMessage:"Total edit time"}),value:e.total_edit_time_minutes?WC(60*e.total_edit_time_minutes*1e3,t):void 0},{name:t.formatMessage({id:"nvGUhf",defaultMessage:"Revision Number"}),value:e.revision_number},{name:t.formatMessage({id:"EF/17d",defaultMessage:"Pages"}),value:e.pages?t.formatNumber(e.pages,{maximumFractionDigits:0}):void 0},{name:t.formatMessage({id:"RLrbhp",defaultMessage:"Words"}),value:e.words?t.formatNumber(e.words,{maximumFractionDigits:0}):void 0},{name:t.formatMessage({id:"2dpvY4",defaultMessage:"Slides"}),value:e.slides?t.formatNumber(e.slides,{maximumFractionDigits:0}):void 0}].filter((e=>!!e.value))}(e,t);case"pdf":return function(e,t){return[{name:t.formatMessage({id:"EF/17d",defaultMessage:"Pages"}),value:e.pages},{name:t.formatMessage({id:"MeqvVX",defaultMessage:"Dimensions"}),value:e.width&&e.height?t.formatMessage({id:"JEE1p9",defaultMessage:"{width} x {height}"},{width:t.formatNumber(e.width),height:t.formatNumber(e.height)}):void 0}].filter((e=>!!e.value))}(e,t);case"video":return function(e,t){return[{name:t.formatMessage({id:"u68XIJ",defaultMessage:"Creation Time"}),value:e.capture_date?t.formatTime(new Date(e.capture_date),{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}):void 0},{name:t.formatMessage({id:"3RkPzL",defaultMessage:"Capturing Device"}),value:e.device},{name:t.formatMessage({id:"R+6yXm",defaultMessage:"Resolution"}),value:`${e.resolution_width}x${e.resolution_height}`},{name:t.formatMessage({id:"RaCxiO",defaultMessage:"Aspect Ratio"}),value:e.aspect_ratio},{name:t.formatMessage({id:"A4boBS",defaultMessage:"Duration"}),value:e.duration_precise?LC(e.duration_precise*RC,t):void 0},{name:t.formatMessage({id:"c9FloK",defaultMessage:"Frame Rate"}),value:`${e.frame_rate} fps`},{name:t.formatMessage({id:"y7aJQC",defaultMessage:"Color Space"}),value:e.color_space},{name:t.formatMessage({id:"TtPMcl",defaultMessage:"Bit Rate"}),value:e.bit_rate?t.formatMessage({id:"/xb44b",defaultMessage:"{bit_rate} kb/s"},{bit_rate:Math.floor(e.bit_rate/1e3)}):void 0},{name:t.formatMessage({id:"C1kd1L",defaultMessage:"Audio"}),value:FC(e,t)},{name:t.formatMessage({id:"yq3RyE",defaultMessage:"Codec"}),value:e.codec}]}(e,t);case"audio":return function(e,t){return[{name:t.formatMessage({id:"yq3RyE",defaultMessage:"Codec"}),value:e.codec},{name:t.formatMessage({id:"Cwkfdc",defaultMessage:"Sampling Rate"}),value:Number(e.sampling_rate)/1e3+" kHz"},{name:t.formatMessage({id:"A4boBS",defaultMessage:"Duration"}),value:e.duration_precise?LC(e.duration_precise*RC,t):void 0},{name:t.formatMessage({id:"0Fq1H6",defaultMessage:"Channels"}),value:e.channels},{name:t.formatMessage({id:"TtPMcl",defaultMessage:"Bit Rate"}),value:String(Math.floor(e.bit_rate/1e3))+" kb/s"}]}(e,t);default:return[]}},uA=({fileId:e,sharedLinkURL:t,onShowMore:i,apiV2Client:a})=>{var n;const r=null===(n=((e,t)=>{var i,a;return null===(a=null===(i=te.useMemo((()=>lu(e)),[e]).useQuery({apiArg:t,pkgArg:null}))||void 0===i?void 0:i.data)||void 0===a?void 0:a.apiData})(a,{file_path_or_id:e,url:t}))||void 0===n?void 0:n.metadata;return r?te.default.createElement(cA,{metadata:r,onShowMore:i}):null};uA.displayName="FileContentMetadata";const _A=te.default.memo((({ownerTeamName:e,ownerName:t})=>{const i=a.useIntl();let n="";return t&&e?n=i.formatMessage({id:"r8Mpyq",defaultMessage:"{owner_name} ({owner_team_name})"},{owner_name:t,owner_team_name:e}):e&&(n=e),n?te.default.createElement(PC,{key:`content-metadata-${e}`,title:i.formatMessage({id:"qfF5dJ",defaultMessage:"From"}),data:n}):null}));_A.displayName="SharedLinkMetadata";const pA=te.default.memo((({uploadInfo:e})=>{const t=a.useIntl(),i=[{title:t.formatMessage({id:"bD4kqG",defaultMessage:"Uploaded by"}),data:e.display_name},{title:t.formatMessage({id:"KMbzWs",defaultMessage:"Date uploaded"}),data:t.formatTime(new Date(e.uploaded),{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})}];return te.default.createElement(te.default.Fragment,null,i.map((e=>e.data&&te.default.createElement(PC,{title:e.title,data:e.data,key:e.title}))))}));pA.displayName="UploadInfoMetadataUI";const gA="files:get_upload_info",fA=(e,t)=>{var i,r;return null===(r=null===(i=te.default.useMemo((()=>{return t=e,o.createGenericQuery({queryRouteFilter:["apiv2",gA],queryFn:({apiArg:e})=>()=>n.__awaiter(void 0,void 0,void 0,(function*(){return{apiData:yield a.GetFilesRoutes(t).rpc("get_upload_info",e,{}),pkgData:null}})),getQueryKey:o.getGenericQueryKey("apiv2",gA)});var t}),[e]).useQuery({apiArg:t,pkgArg:void 0}))||void 0===i?void 0:i.data)||void 0===r?void 0:r.apiData},mA=({apiV2Client:e,fileId:t,sharedLinkURL:i})=>{const a=fA(e,{file_path_or_id:t,url:i});return a?te.default.createElement(pA,{uploadInfo:a}):null};mA.displayName="UploadMetadata";const hA=a.lazyAfterDisplay((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{FileActivityUpsellBanner:t}=yield new Promise((function(t,i){e(["./c_docsend_hub_send_and_track_file_activity_upsell_banner"],t,i)}));return{default:t}})))),vA=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(hA,Object.assign({},e)));function SA(e){return e.ns("previews_ai")}vA.displayName="AsyncUpsellBanner";const EA="ai_blade_consent";var wA,bA,yA;t.AIBladePages=void 0,(wA=t.AIBladePages||(t.AIBladePages={})).BROWSE="BROWSE",wA.PREVIEWS="PREVIEWS",t.CheckFileStatus=void 0,(bA=t.CheckFileStatus||(t.CheckFileStatus={})).Passed="passed",bA.Failed="failed",bA.Removed="removed",bA.Loading="loading",t.AIBladeActions=void 0,(yA=t.AIBladeActions||(t.AIBladeActions={})).SET_CURRENT_QUERY="SET_CURRENT_QUERY",yA.SET_IS_LOADING="SET_IS_LOADING",yA.SET_RESULT="SET_RESULT",yA.START_GET_SUMMARY="START_GET_SUMMARY",yA.START_GET_ANSWER="START_GET_ANSWER",yA.RESET_STATE="RESET_STATE",yA.SET_SHOW_CONSENT_MODAL="SET_SHOW_CONSENT_MODAL",yA.SET_HAS_CONSENTED="SET_HAS_CONSENTED",yA.SET_SHOW_AICC_BANNER="SET_SHOW_AICC_BANNER",yA.SET_CHECK_FILE_STATUS="SET_CHECK_FILE_STATUS";const TA=(e,i)=>{var a;switch(i.type){case t.AIBladeActions.SET_CURRENT_QUERY:return Object.assign(Object.assign({},e),{currentQuery:i.payload.currentQuery});case t.AIBladeActions.SET_IS_LOADING:return Object.assign(Object.assign({},e),{isLoading:i.payload.isLoading});case t.AIBladeActions.SET_RESULT:return Object.assign(Object.assign({},e),{result:i.payload.result,isLoading:!1});case t.AIBladeActions.START_GET_SUMMARY:return Object.assign(Object.assign({},e),{currentQuery:{type:"SUMMARY"},result:void 0});case t.AIBladeActions.START_GET_ANSWER:return Object.assign(Object.assign({},e),{currentQuery:{type:"ANSWER",query:i.payload.query},result:void 0});case t.AIBladeActions.RESET_STATE:return Object.assign(Object.assign({},e),{isLoading:!1,currentQuery:void 0,result:void 0,checkFileStatus:{}});case t.AIBladeActions.SET_SHOW_CONSENT_MODAL:return Object.assign(Object.assign({},e),{showConsentModal:i.payload.showConsentModal});case t.AIBladeActions.SET_HAS_CONSENTED:return Object.assign(Object.assign({},e),{hasConsented:i.payload.hasConsented});case t.AIBladeActions.SET_SHOW_AICC_BANNER:return Object.assign(Object.assign({},e),{showAiccBanner:i.payload.showAiccBanner});case t.AIBladeActions.SET_CHECK_FILE_STATUS:return Object.assign(Object.assign({},e),{checkFileStatus:Object.assign(Object.assign({},e.checkFileStatus),{[i.payload.fileName]:{status:i.payload.status,error:null===(a=i.payload)||void 0===a?void 0:a.error}})});default:return e}},IA=te.default.createContext(void 0),CA=te.default.createContext(void 0),AA=({children:e,userId:t})=>{const i=tf();let n=!1;t?n=a.UserLocalStorage.get(t,EA):i||(n=!0);const[r,o]=te.default.useReducer(TA,{currentQuery:void 0,isLoading:!1,result:void 0,hasConsented:n,showConsentModal:!1,showAiccBanner:!0,checkFileStatus:{}});return te.default.createElement(IA.Provider,{value:r},te.default.createElement(CA.Provider,{value:o},e))};AA.displayName="AIBladeProvider";const MA=()=>{const e=te.default.useContext(IA);if(void 0===e)throw new Error("useAIBladestate must be used within a AIBladeProvider");return e},OA=te.default.createContext(void 0),PA=({children:e,previewType:n,isSharedLink:r})=>{const{currentQuery:o}=MA(),{logUserAction:s}=u.useFileViewerContext(),l=i.useRef(o);l.current=o;const d=tf(),_=m.useStabilizedCallback(((e,i={})=>{var o,c;s(e,a.UserActionContext.PreviewSidebar,Object.assign(Object.assign({},i),{preview_type:n,query_type:null!==(c=null===(o=l.current)||void 0===o?void 0:o.type)&&void 0!==c?c:"unknown",page:t.AIBladePages.PREVIEWS,is_logged_in:d?"true":"false",is_shared_link_page:r?"true":"false",is_browse_page:"false"}))})),p=m.useStabilizedCallback(((e,i={})=>{var a,r;v.getMetricsReporter().createStats({ns:"web_ai_blade",name:e},Object.assign({preview_type:n,query_type:null!==(r=null===(a=l.current)||void 0===a?void 0:a.type)&&void 0!==r?r:"unknown",page:t.AIBladePages.PREVIEWS},i)).record(1)})),g=m.useStabilizedCallback(((e,i,a={})=>{var r,o;v.getMetricsReporter().createStats({ns:"web_ai_blade",name:e},Object.assign({preview_type:n,query_type:null!==(o=null===(r=l.current)||void 0===r?void 0:r.type)&&void 0!==o?o:"unknown",page:t.AIBladePages.PREVIEWS},a)).recordDuration(i,c.TimeUnit.MILLISECONDS)})),f=i.useMemo((()=>({logUserAction:_,recordToAMIS:p,recordDurationToAMIS:g})),[_,p,g]);return te.default.createElement(OA.Provider,{value:f},e)};PA.displayName="AIBladeLoggingProvider";const xA="error_boundary";const DA=e=>{var{componentTag:t,exceptionTags:i=[],exceptionSeverity:a=h.SEVERITY.CRITICAL,reportMetrics:r=!1,reportMultiple:o=!1,onError:s}=e,l=n.__rest(e,["componentTag","exceptionTags","exceptionSeverity","reportMetrics","reportMultiple","onError"]);const{recordRenderMetric:c,recordRenderErrorMetric:d}=te.default.useMemo((()=>{let e=()=>{},i=()=>{};if(r){const a=v.getMetricsReporter().child({component:t}),n=a.createSet({ns:xA,name:"render"}),r=a.createSet({ns:xA,name:"render_error"});e=()=>n.observeOriginId(),i=()=>r.observeOriginId()}return{recordRenderMetric:e,recordRenderErrorMetric:i}}),[r,t]),u=te.default.useRef(!1),_=te.default.useMemo((()=>function(e=h.SEVERITY.CRITICAL,t=[],i,a,n,r){return(o,s)=>{i(),!n&&a.current||h.reportException({err:o,exc_extra:{component_stacktrace:s},severity:e,tags:[...t,"error-boundary:exception"],force:!0}),a.current=!0,"function"==typeof r&&r(o,s)}}(a,[`error-boundary-component:${t}`,...i],d,u,o,s)),[t,a,i,d,o,s]);return te.default.useEffect(c,[c]),te.default.createElement(J.ErrorBoundary,Object.assign({FallbackComponent:RA},l,{onError:_,onResetKeysChange:c}))};DA.displayName="ErrorBoundary";const RA=()=>null;RA.displayName="NullRenderFallbackComponent";const NA=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{AIBlade:t}=yield new Promise((function(t,i){e(["./c_dropbox_ai_assistant_file_viewer_plugin_ai_blade"],t,i)}));return{default:t}})))),kA=()=>te.default.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},te.default.createElement(a.Spinner,null));kA.displayName="LazyBladeSpinner";const LA=()=>{const e=a.useIntl();return te.default.createElement("div",{style:{width:"100%",height:"100%",padding:"0 16px"}},te.default.createElement(a.Text,{color:"error",isBold:!0},e.formatMessage({id:"ciK24m",defaultMessage:"Sorry, there was a problem"})))};LA.displayName="AIPluginErrorFallback";const FA=e=>te.default.createElement(te.default.Suspense,{fallback:te.default.createElement(kA,null)},te.default.createElement(NA,Object.assign({},e)));FA.displayName="LazyAsyncAIBlade";class UA{constructor(e,t,i,n,r){var o;this.layerUI={},this.sidebarUI={Icon:()=>te.default.createElement(a.UIIcon,{src:a.Twinkle2Line}),Title:()=>te.default.createElement("div",null,"Dropbox AI"," ",te.default.createElement(X.AccessoryBadge,null,"Alpha")),Content:()=>{var e;const t=Os(),i=Ms(),{fileViewerId:a}=u.useFileViewerContext(),n=Boolean(this.user&&this.user.id);return t&&Jg(t.name,Boolean(this.user))&&(n||$g())?te.default.createElement(AA,{userId:this.user?this.user.id:void 0},te.default.createElement(DA,{componentTag:"previews-ai-blade",reportMetrics:!0,fallback:te.default.createElement(LA,null)},te.default.createElement(PA,{previewType:i,isSharedLink:Boolean(null===(e=null==this?void 0:this.sharedLinkInfo)||void 0===e?void 0:e.url)},te.default.createElement(FA,{fileViewerId:a,apiV2Client:this.apiV2Client,userId:this.user?this.user.id:void 0,isTeamAdmin:!!this.user&&this.user.is_team_admin,checkFileWithCache:this.checkFileWithCache,callerId:n?"dropbox_web/previews":"dropbox_web/previews_ungated_dropbox_ai",fileHref:this.fileHref,sharedLinkInfo:this.sharedLinkInfo})))):null}},this.apiV2Client=e,this.user=t,this.fileHref=i,this.sharedLinkInfo=r,this.checkFileWithCache=(()=>{const e={};return(t,i,n)=>{var r,o;const s=n?{link_info:{url:n,encrypted_grant_book:af(n)},file:t}:{file:t};return e[t]=i?null!==(o=e[t])&&void 0!==o?o:SA(this.apiV2Client).rpc("check_file",s,{}):null!==(r=e[t])&&void 0!==r?r:SA(this.apiV2Client).rpc("check_file_logged_out",Object.assign(Object.assign({},s),{ungated_variant:a.fileViewerFeatureExperiments.acqSusiUngatedDropboxAiVariant}),{}),e[t]}})();const s=Boolean(this.user&&this.user.id);this.checkFileWithCache(n,s,null===(o=null==this?void 0:this.sharedLinkInfo)||void 0===o?void 0:o.url)}}const VA=(e,t=!1)=>{if(!e||0===e.length)return;const i=w.flatten(e.map((({text:e,startTime:i})=>t?[i,e]:[e]))).join("\r\n");navigator.clipboard.writeText(i)},jA=e=>"video"===(null==e?void 0:e[".tag"])||"audio"===(null==e?void 0:e[".tag"])?e.transcript_permission:{".tag":"ineligible"};a.injectInternalStyle("/static/js/file_viewer/transcript_blade/transcript_blade.module.out-vfl1YntlF.css",(e=>":root{--transcript-search-height:52px}._transcriptBlade_poiak_10{display:flex;flex-direction:column;overflow:hidden;padding:0}._transcriptBladeContentWrapper_poiak_17{height:100%;width:100%}._transcriptSearchWrapper_poiak_22{height:52px}._transcriptHeaderOptionMenuWrapper_poiak_28{display:flex;justify-content:flex-end;width:100%}._transcriptSegmentListContentWrapper_poiak_34{height:calc(100% - var(--transcript-search-height));outline:none;overflow:hidden;position:relative;width:100%}._transcriptErrorInfo_poiak_42{align-items:center;display:flex;gap:8px;padding:12px 16px}._transcriptLoadingScreen_poiak_49{box-sizing:border-box;height:100%;padding:0 16px}._transcriptLoadingScreen_poiak_49,._transcriptProgressBarWrapper_poiak_61{align-items:center;display:flex;flex-direction:column;justify-content:center;text-align:center;width:100%}._transcriptProgressBar_poiak_61{margin-bottom:16px;width:100%}._transcriptSearchWrapper_poiak_22{box-sizing:border-box;height:var(--transcript-search-height);padding:4px 16px 16px}._transcriptSearchMatchFoundText_poiak_81{margin-top:2px;white-space:nowrap}._transcriptSearchNavigatorWrapper_poiak_86{align-items:center;display:inline-flex}._transcriptCaptionText_poiak_91{cursor:text}._currentSearchMatch_poiak_95{background-color:var(--color__highlight__yellow__permanent)}._resumeAutoScrollButton_poiak_99{bottom:0;left:50%;opacity:0;position:absolute;transform:translate(-50%,100%);transition:all var(--duration__micro-fast) var(--easing__leave)}._resumeAutoScrollButton_poiak_99._showing_poiak_108{bottom:8px;opacity:100%;transform:translate(-50%);transition-timing-function:var(--easing__enter)}"));const BA=te.default.memo((({showLoadingMessage:e=!0})=>{const t=a.useIntl(),[i,n]=te.default.useState(!1),r=te.default.useRef(null);return te.default.useEffect((()=>{if(e)return r.current=window.setTimeout((()=>{n(!0),r.current=null}),7e3),()=>{null!=r.current&&window.clearTimeout(r.current)}}),[e]),te.default.createElement("div",{className:"_transcriptLoadingScreen_poiak_49"},te.default.createElement(a.ProgressBar,{className:"_transcriptProgressBar_poiak_61",value:0,in:!0,isIndeterminate:!0}),i&&te.default.createElement(a.Text,{variant:"label",size:"small",color:"standard"},t.formatMessage({id:"PwXEwf",defaultMessage:"We’re transcribing this file. Feel free to do other things while we work."})))}));BA.displayName="TranscriptProgressBar";const HA=te.memo((({segments:e,isDefaultAudioTrackSelected:t,previewType:i,onMenuSelection:n,showTranscriptionDetails:r,iconSize:o})=>{const s=a.useIntl();return!e||0===e.length||!t&&i===a.PreviewType.Video?null:te.createElement("div",{className:"_transcriptHeaderOptionMenuWrapper_poiak_28"},te.createElement(a.Menu.Wrapper,{onSelection:n,shouldPropagateClickOutsideMouseEvents:!0},(({getContentProps:e,getTriggerProps:t})=>te.createElement(te.Fragment,null,te.createElement(a.IconButton,Object.assign({},t(),{variant:"transparent",size:"small","data-testid":"transcript-settings-menu"}),te.createElement(a.UIIcon,{src:a.MoreHorizontalLine,size:null!=o?o:"small"})),te.createElement(a.Menu.Content,Object.assign({id:"parent"},e()),te.createElement(a.Menu.Segment,null,te.createElement(a.Menu.ActionItem,{key:"toggle_transcript_details",value:"toggle_transcript_details"},r?s.formatMessage({id:"6YJBBm",defaultMessage:"Hide transcript details"}):s.formatMessage({id:"T6egx/",defaultMessage:"Show transcript details"})),te.createElement(a.Menu.ActionItem,{key:"copy_transcript",value:"copy_transcript"},s.formatMessage({id:"L//QR/",defaultMessage:"Copy transcript"}))))))))}));HA.displayName="TranscriptTitleAccessory";const KA=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{TranscriptBladeContent:t}=yield new Promise((function(t,i){e(["./c_transcript_blade_components_transcript_blade_content"],t,i)}));return{default:t}})))),zA=({fileViewerId:e,previewKey:t,previewMetadata:i,logUserAction:n,showTranscriptionDetails:r,permission:o,setIsTranscriptShowing:s,isDefaultAudioTrackSelected:l,previewType:c})=>{const d=$r(no,e),_=Ml(t,i);return Ss(e,a.PreviewsTimer.SidebarContentsMount,{bladeId:p.TRANSCRIPT_BLADE_PLUGIN_ID},d===p.TRANSCRIPT_BLADE_PLUGIN_ID&&(_.isSuccess||_.isError&&_.error.statusCode!==u.RivieraStatus.NotFound)),te.default.createElement(te.default.Suspense,{fallback:te.default.createElement(BA,{showLoadingMessage:!1})},te.default.createElement(KA,{previewType:c,previewKey:t,previewMetadata:i,showTranscriptionDetails:r,permission:o,logUserAction:n,setIsTranscriptShowing:s,isDefaultAudioTrackSelected:l}))};zA.displayName="TranscriptContent";function WA(e,t){return function(e,t){const i={};return i._subject_uid=String(t),e.updateQuery(i)}(new r.URI({path:"/history"+e}),t.id)}const GA=[a.PreviewType.Archive,a.PreviewType.Audio,a.PreviewType.CloudDoc,a.PreviewType.Excel,a.PreviewType.HTML,a.PreviewType.Image,a.PreviewType.Linkfile,a.PreviewType.Other,a.PreviewType.SsrDoc,a.PreviewType.RawHTML,a.PreviewType.Restricted,a.PreviewType.Video,a.PreviewType.Doc,a.PreviewType.Photo,a.PreviewType.Text],qA=(e,t,i)=>{const n=t!==a.SDKPreviewSurface.VERSION_HISTORY&&a.isBrowseFile(i)?i.fq_path:void 0,r=te.default.useMemo((()=>n&&e?()=>function(e,t){a.UserActivityLogger.log("web","view_version_history");const i=WA(e,t);a.redirect(i.toString())}(n,e):void 0),[e,n]);return te.default.useMemo((()=>e&&t!==a.SDKPreviewSurface.BACKUP&&t!==a.SDKPreviewSurface.SHARED_COLLECTION?NI({user:e,onOpenVersionHistory:r,upsellBanner:()=>te.default.createElement(vA,{user:e,fileId:i.file_id})}):void 0),[i.file_id,r,t,e])},QA=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{TagsSectionPreview:t}=yield new Promise((function(t,i){e(["./c_components_section_tags_section_preview"],t,i)}));return{default:t}})))),YA=(e,t)=>{const n=a.fileViewerFeatureExperiments.tagsSectionVariant,r=n&&"ON"===n;n&&"OFF"!==n&&a.logStormcrowExposure("tags_in_previews",n,null==e?void 0:e.id);const s=te.default.useRef(t);s.current=t;const l=te.default.useCallback((({context:t})=>{const i=s.current;return r&&e&&a.isBrowseFile(i)&&i.ns_path?te.default.createElement(a.LazySuspense,{fallback:null},te.default.createElement(QA,{files:[F.File.fromAnyFileObject(i)],user:e,context:t})):null}),[r,e]);let c="";return e&&a.isBrowseFile(t)&&(c=a.get_browse_root(e,t)),te.default.useMemo((()=>(({userId:e,rootName:t,tagSection:n,browseRoot:r})=>({sidebarUI:{Icon:()=>te.default.createElement(a.UIIcon,{src:a.InfoLine}),Title:()=>{const e=a.useIntl();return te.default.createElement(te.default.Fragment,null,e.formatMessage({id:"pehNW7",defaultMessage:"Info"}))},Content:()=>{const{fileViewerId:o,apiV2Client:s,optionalIOClients:{urlClient:l}}=u.useFileViewerContext(),c=$r(ao,o);Ss(o,a.PreviewsTimer.SidebarContentsMount,{bladeId:p.INFO_BLADE_PLUGIN_ID},c===p.INFO_BLADE_PLUGIN_ID);const d=Os(),_=Ps(),g=a.useIntl(),f=i.useMemo((()=>{if(!d)return null;const{fqPath:e,name:t,lastModifiedDate:i,size:a}=d;return{fqPath:e,size:a,name:t,lastModifiedMs:i?new Date(i).getTime():void 0}}),[d]),m=i.useMemo((()=>({enabled:!0,openPath:e=>null==l?void 0:l.openFile(e,void 0)})),[l]),{logUserAction:h}=u.useFileViewerContext(),v=i.useCallback((e=>{h(e?a.UserAction.InfoShowMoreMetadata:a.UserAction.InfoHideMoreMetadata,a.UserActionContext.PreviewSidebar)}),[h]);return Ss(o,a.PreviewsTimer.SidebarContentsMount,{bladeId:p.INFO_BLADE_PLUGIN_ID},c===p.INFO_BLADE_PLUGIN_ID),d&&f?te.default.createElement(te.default.Fragment,null,n&&te.default.createElement(n,{context:a.UserActionContext.PreviewSidebar,key:f.fqPath}),te.default.createElement(a.Text,{variant:"paragraph",size:"small",isBold:!0},g.formatMessage({id:"bNnicH",defaultMessage:"Properties"})),te.default.createElement("div",{role:"table"},te.default.createElement(DC,{file:f,pathBar:m,accountRootName:t,browseRoot:r}),te.default.createElement(_A,Object.assign({},_)),te.default.createElement(mA,{fileId:d.fileId,sharedLinkURL:d.url,apiV2Client:s}),e&&te.default.createElement(uA,{fileId:d.fileId,sharedLinkURL:d.url,onShowMore:v,apiV2Client:s}))):null}}}))({userId:e&&String(e.id),rootName:e&&o.Viewer.get_root_name(e),tagSection:r?l:void 0,browseRoot:c})),[c,r,l,e])},$A=(e,t,i,a,n,r)=>{const o=((e,t)=>sf.shouldShowForPreviewSurface(e)&&!!sf.filterValidUser(t))(t,i)&&nf(a,n,r);return te.default.useMemo((()=>o?new UA(e,i,a.href,a.file_id,r):void 0),[e,a.file_id,a.href,r,o,i])},ZA=(e,t)=>{var i;const n=Xi(a.isBrowseFile(t)&&null!==(i=t.browse_preview)&&void 0!==i?i:t.preview),r=jg.includes(e)&&Bg.includes(n);return te.default.useMemo((()=>r?(()=>{let e,t=!0;return{sidebarUI:{Icon:()=>te.default.createElement(a.UIIcon,{src:T.ClosedCaptionsLine}),Title:()=>{const e=a.useIntl();return te.default.createElement(te.default.Fragment,null,e.formatMessage({id:"NIbdgH",defaultMessage:"Transcript"}))},TitleAccessory:()=>{var i,n;const r=As(),{logUserAction:o,fileViewerId:s}=u.useFileViewerContext(),l=$r(jn,s),c=Xy(),d=null!==(i=null==c?void 0:c.isDefaultAudioTrackSelected)&&void 0!==i&&i,{data:_}=Ml(l,r),p=null===(n=null==_?void 0:_.apiData)||void 0===n?void 0:n.segments,[g,f]=te.default.useState(t),m=te.default.useCallback((()=>{f((e=>!e)),t=!t,null==e||e()}),[]),h=r.previewType,v=te.default.useCallback((e=>{"toggle_transcript_details"===e?m():"copy_transcript"===e&&(VA(p),o(a.UserAction.TranscriptCopyAllClick,a.UserActionContext.PreviewSidebar,{previewType:h}))}),[m,p,o,h]);return te.default.createElement(HA,{segments:p,isDefaultAudioTrackSelected:d,previewType:h,onMenuSelection:v,showTranscriptionDetails:g,iconSize:"standard"})},Content:()=>{var i,n;const[r,o]=te.default.useState(0);e=()=>o(r+1);const{fileViewerId:s,logUserAction:l}=u.useFileViewerContext(),c=As(),d=c.previewType,_=null===(i=Os())||void 0===i?void 0:i.fileId,p=$r(jn,s),{mutate:g}=Ol(p,c),f=Gg(p,c),m=$r(er,s),h=jA(c.content),v=Xy(),S=null!==(n=null==v?void 0:v.isDefaultAudioTrackSelected)&&void 0!==n&&n;te.default.useEffect((()=>{f&&g({previewKey:p,previewMetadata:c,fileId:_,sharedLinkUrl:null==m?void 0:m.url})}),[_,g,p,c,null==m?void 0:m.url,f]);const E=fo(),w=d===a.PreviewType.Video,b=d===a.PreviewType.Audio;return h&&(w||b)?te.default.createElement(zA,{fileViewerId:s,previewKey:p,previewMetadata:c,logUserAction:l,showTranscriptionDetails:t,permission:h,setIsTranscriptShowing:E,isDefaultAudioTrackSelected:S,previewType:d}):null}}}})():void 0),[r])};const XA=i.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){yield a.waitForTTI();const{OAPulsarEffect:t}=yield new Promise((function(t,i){e(["./c_onboarding_survey_components_oa_pulsar_effect"],t,i)}));return{default:t}})))),JA=e=>te.default.createElement(i.Suspense,{fallback:null},te.default.createElement(XA,Object.assign({},e)));JA.displayName="AsyncOAPulsarEffect";const eM=({user:e,file:t})=>{const[i,n]=te.useState(!1);te.useEffect((()=>{a.getQueryArgs().from_previews_auto_save&&(a.UDCL.logEvent({class:"onboard",action:"shown",object:"previews_auto_saved_file",properties:{fileId:t.file_id,timestamp:Date.now(),itemCount:1}}),n(!0),a.DBHistory.remove_query_param(a.BrowseQueryArg.from_previews_auto_save))}),[t]);return te.useMemo((()=>i&&e?te.createElement(JA,{campaign:a.OAPulsarCampaign.PREVIEWS_AUTO_SAVE_V2,userId:e.id}):te.createElement(te.Fragment,null)),[i,e])};eM.displayName="PreviewAutoSaveTooltip";const tM="@@apiv2_redux/comments2/add_comment",iM="@@apiv2_redux/comments2/add_comment_result",aM="@@apiv2_redux/comments2/check_onboarding_status",nM="@@apiv2_redux/comments2/check_onboarding_status_result",rM="@@apiv2_redux/comments2/delete_comment",oM="@@apiv2_redux/comments2/delete_comment_result",sM="@@apiv2_redux/comments2/disable_commenting",lM="@@apiv2_redux/comments2/disable_commenting_result",cM="@@apiv2_redux/comments2/edit_comment",dM="@@apiv2_redux/comments2/edit_comment_result",uM="@@apiv2_redux/comments2/enable_commenting",_M="@@apiv2_redux/comments2/enable_commenting_result",pM="@@apiv2_redux/comments2/get_folder_live_updating_info",gM="@@apiv2_redux/comments2/get_folder_live_updating_info_result",fM="@@apiv2_redux/comments2/list_comments",mM="@@apiv2_redux/comments2/list_comments_result",hM="@@apiv2_redux/comments2/list_comments_batch",vM="@@apiv2_redux/comments2/list_comments_batch_result",SM="@@apiv2_redux/comments2/list_threads_batch_paginated",EM="@@apiv2_redux/comments2/list_threads_batch_paginated_result",wM="@@apiv2_redux/comments2/list_threads_paginated",bM="@@apiv2_redux/comments2/list_threads_paginated_result",yM="@@apiv2_redux/comments2/log_event",TM="@@apiv2_redux/comments2/log_event_result",IM="@@apiv2_redux/comments2/log_perf_event",CM="@@apiv2_redux/comments2/log_perf_event_result",AM="@@apiv2_redux/comments2/logged_out/add_comment",MM="@@apiv2_redux/comments2/logged_out/add_comment_result",OM="@@apiv2_redux/comments2/logged_out/list_comments",PM="@@apiv2_redux/comments2/logged_out/list_comments_result",xM="@@apiv2_redux/comments2/mark_has_onboarded",DM="@@apiv2_redux/comments2/mark_has_onboarded_result",RM="@@apiv2_redux/comments2/mark_thread_read",NM="@@apiv2_redux/comments2/mark_thread_read_result",kM="@@apiv2_redux/comments2/mark_thread_unread",LM="@@apiv2_redux/comments2/mark_thread_unread_result",FM="@@apiv2_redux/comments2/resolve_thread",UM="@@apiv2_redux/comments2/resolve_thread_result",VM="@@apiv2_redux/comments2/subscribe",jM="@@apiv2_redux/comments2/subscribe_result",BM="@@apiv2_redux/comments2/unresolve_thread",HM="@@apiv2_redux/comments2/unresolve_thread_result",KM="@@apiv2_redux/comments2/unsubscribe",zM="@@apiv2_redux/comments2/unsubscribe_result",WM=Jy(tM),GM=Jy(iM),qM=Jy(nM),QM=Jy(rM),YM=Jy(oM),$M=Jy(sM),ZM=Jy(lM),XM=Jy(cM),JM=Jy(dM),eO=Jy(uM),tO=Jy(_M),iO=Jy(gM),aO=Jy(fM),nO=Jy(mM),rO=Jy(vM),oO=Jy(EM),sO=Jy(bM),lO=Jy(yM),cO=Jy(TM),dO=Jy(CM),uO=Jy(MM),_O=Jy(OM),pO=Jy(PM),gO=Jy(DM),fO=Jy(RM),mO=Jy(NM),hO=Jy(kM),vO=Jy(LM),SO=Jy(FM),EO=Jy(UM),wO=Jy(VM),bO=Jy(jM),yO=Jy(BM),TO=Jy(HM),IO=Jy(KM),CO=Jy(zM),AO=eT({[tM]:{endpoint:"add_comment",action:GM},[aM]:{endpoint:"check_onboarding_status",action:qM},[rM]:{endpoint:"delete_comment",action:YM},[sM]:{endpoint:"disable_commenting",action:ZM},[cM]:{endpoint:"edit_comment",action:JM},[uM]:{endpoint:"enable_commenting",action:tO},[pM]:{endpoint:"get_folder_live_updating_info",action:iO},[fM]:{endpoint:"list_comments",action:nO},[hM]:{endpoint:"list_comments_batch",action:rO},[SM]:{endpoint:"list_threads_batch_paginated",action:oO},[wM]:{endpoint:"list_threads_paginated",action:sO},[yM]:{endpoint:"log_event",action:cO},[IM]:{endpoint:"log_perf_event",action:dO},[AM]:{endpoint:"logged_out/add_comment",action:uO},[OM]:{endpoint:"logged_out/list_comments",action:pO},[xM]:{endpoint:"mark_has_onboarded",action:gO},[RM]:{endpoint:"mark_thread_read",action:mO},[kM]:{endpoint:"mark_thread_unread",action:vO},[FM]:{endpoint:"resolve_thread",action:EO},[VM]:{endpoint:"subscribe",action:bO},[BM]:{endpoint:"unresolve_thread",action:TO},[KM]:{endpoint:"unsubscribe",action:CO}});var MO;t.SortType=void 0,(MO=t.SortType||(t.SortType={})).newest="newest",MO.oldest="oldest",MO.unread="unread",MO.timestamp="timestamp",MO.page="page";const OO=[t.SortType.newest,t.SortType.oldest,t.SortType.unread,t.SortType.page,t.SortType.timestamp],PO=[t.SortType.newest,t.SortType.oldest,t.SortType.unread],xO=[...PO,t.SortType.timestamp],DO=[...PO,t.SortType.page];function RO(e,t){for(const i of e){const e=i.comments;for(const a of e)if(a.id===t)return{comment:a,thread:i}}return null}var NO;function kO(e){return{type:NO.ActivateThread,payload:e}}function LO(e){return{type:NO.DeactivateAllThreads,payload:e}}function FO(e,t){return{type:NO.ConfirmDraftAnnotation,payload:{fileViewerId:e,annotationType:t}}}function UO(e){return{type:NO.CancelAnnotating,payload:{fileViewerId:e}}}function VO(e){return{type:NO.ResolveNavigationToActiveThreadAnnotation,payload:{fileViewerId:e}}}t.CommentsEventName=void 0,function(e){e.ADD_COMMENT="add_comment",e.POST_COMMENT="post_comment",e.DELETE_COMMENT="delete_comment",e.REPLY_COMMENT="reply_comment",e.START_EDIT_COMMENT="start_edit_comment",e.EDIT_COMMENT="edit_comment",e.RESOLVE_COMMENT="resolve_comment",e.UNRESOLVE_COMMENT="unresolve_comment",e.SUBSCRIBE_COMMENTS="subscribe_comments",e.UNSUBSCRIBE_COMMENTS="unsubscribe_comments",e.DISABLE_COMMENTS="disable_comments",e.ENABLE_COMMENTS="enable_comments",e.SHOW_RESOLVED_COMMENTS="show_resolved_comments",e.HIDE_RESOLVED_COMMENTS="hide_resolved_comments",e.SORT_COMMENTS="sort_comments",e.ENABLE_CONTINUOUS_ANNOTATIONS="enable_continuous_annotations",e.DISABLE_CONTINUOUS_ANNOTATIONS="disable_continuous_annotations",e.ENABLE_CONTINUOUS_COMMENTING="enable_continuous_commenting",e.DISABLE_CONTINUOUS_COMMENTING="disable_continuous_commenting",e.ADD_COMMENT_START="add_comment_start",e.ADD_COMMENT_CANCEL="add_comment_cancel",e.REPLY_COMMENT_START="reply_comment_start",e.REPLY_COMMENT_CANCEL="reply_comment_cancel",e.MARK_THREAD_READ="mark_thread_read",e.MARK_THREAD_UNREAD="mark_thread_unread",e.START_ANNOTATION_RECT="start_annotation_rect",e.COMMENT_ON_A_SECTION="comment_on_a_section",e.START_ANNOTATION_TIMESTAMP="start_annotation_timestamp",e.START_ANNOTATION_HIGHLIGHT="start_annotation_highlight",e.STICKER_START="sticker_start",e.ADD_EMOJI="add_emoji",e.STICKER_SUCCESS="sticker_success",e.STICKER_CANCELED="sticker_canceled",e.TAG_SOMEONE="tag_someone",e.MENTION_START="mention_start",e.MENTION_SUCCESS="mention_success",e.MENTION_CANCELED="mention_canceled",e.SAVE_EDIT_COMMENT="save_edit_comment",e.CANCEL_COMMENT="cancel_comment",e.VIEW_COMMENTS="view_comments"}(t.CommentsEventName||(t.CommentsEventName={})),function(e){e.ActivateThread="@@comments/activateThread",e.DeactivateAllThreads="@@comments/deactivateThread",e.FocusThread="@@comments/focusThread",e.HoverThread="@@comments/hoverThread",e.BoltSubscribe="@@comments/bolt/subscribe",e.BoltUnsubscribe="@@comments/bolt/unsubscribe",e.UpdateDraftAnnotation="@@comments/updateDraftAnnotation",e.ClearDraftAnnotation="@@comments/clearDraftAnnotation",e.FocusEditor="@@comments/focusEditor",e.EditorDidFocus="@@comments/editorDidFocus",e.ResolveNavigationToActiveThreadAnnotation="@@comments/resolveNavigationToActiveThreadAnnotation",e.UpdateShowResolvedComments="@@comments/updateShowResolvedComments",e.UpdateAnnotationMode="@@comments/UpdateCurrentAnnotationMode",e.StartAnnotating="@@comments/startAnnotating",e.ConfirmDraftAnnotation="@@comments/confirmDraftAnnotation",e.CancelAnnotating="@@comments/cancelAnnotating",e.SortComments="@@comments/sortComments"}(NO||(NO={}));const jO="@@apiv2_redux/files/add_content_references",BO="@@apiv2_redux/files/add_content_references_result",HO="@@apiv2_redux/files/add_content_references_to_path",KO="@@apiv2_redux/files/add_content_references_to_path_result",zO="@@apiv2_redux/files/alpha/get_metadata",WO="@@apiv2_redux/files/alpha/get_metadata_result",GO="@@apiv2_redux/files/alpha/upload",qO="@@apiv2_redux/files/alpha/upload_result",QO="@@apiv2_redux/files/browse",YO="@@apiv2_redux/files/browse_result",$O="@@apiv2_redux/files/browse_continue",ZO="@@apiv2_redux/files/browse_continue_result",XO="@@apiv2_redux/files/content_tiles_metadata_v2",JO="@@apiv2_redux/files/content_tiles_metadata_v2_result",eP="@@apiv2_redux/files/copy_v2",tP="@@apiv2_redux/files/copy_v2_result",iP="@@apiv2_redux/files/copy",aP="@@apiv2_redux/files/copy_result",nP="@@apiv2_redux/files/copy_batch_v2",rP="@@apiv2_redux/files/copy_batch_v2_result",oP="@@apiv2_redux/files/copy_batch",sP="@@apiv2_redux/files/copy_batch_result",lP="@@apiv2_redux/files/copy_batch/check_v2",cP="@@apiv2_redux/files/copy_batch/check_v2_result",dP="@@apiv2_redux/files/copy_batch/check",uP="@@apiv2_redux/files/copy_batch/check_result",_P="@@apiv2_redux/files/copy_batch_sync",pP="@@apiv2_redux/files/copy_batch_sync_result",gP="@@apiv2_redux/files/copy_reference/get",fP="@@apiv2_redux/files/copy_reference/get_result",mP="@@apiv2_redux/files/copy_reference/save",hP="@@apiv2_redux/files/copy_reference/save_result",vP="@@apiv2_redux/files/create_folder_v2",SP="@@apiv2_redux/files/create_folder_v2_result",EP="@@apiv2_redux/files/create_folder",wP="@@apiv2_redux/files/create_folder_result",bP="@@apiv2_redux/files/create_folder_batch",yP="@@apiv2_redux/files/create_folder_batch_result",TP="@@apiv2_redux/files/create_folder_batch/check",IP="@@apiv2_redux/files/create_folder_batch/check_result",CP="@@apiv2_redux/files/delete_v2",AP="@@apiv2_redux/files/delete_v2_result",MP="@@apiv2_redux/files/delete",OP="@@apiv2_redux/files/delete_result",PP="@@apiv2_redux/files/delete_batch",xP="@@apiv2_redux/files/delete_batch_result",DP="@@apiv2_redux/files/delete_batch/check",RP="@@apiv2_redux/files/delete_batch/check_result",NP="@@apiv2_redux/files/delete_batch_with_changeset_sync",kP="@@apiv2_redux/files/delete_batch_with_changeset_sync_result",LP="@@apiv2_redux/files/delete_with_changeset",FP="@@apiv2_redux/files/delete_with_changeset_result",UP="@@apiv2_redux/files/download",VP="@@apiv2_redux/files/download_result",jP="@@apiv2_redux/files/download_zip",BP="@@apiv2_redux/files/download_zip_result",HP="@@apiv2_redux/files/export",KP="@@apiv2_redux/files/export_result",zP="@@apiv2_redux/files/get_browse_bolt_data",WP="@@apiv2_redux/files/get_browse_bolt_data_result",GP="@@apiv2_redux/files/get_content_references_info",qP="@@apiv2_redux/files/get_content_references_info_result",QP="@@apiv2_redux/files/get_description_batch",YP="@@apiv2_redux/files/get_description_batch_result",$P="@@apiv2_redux/files/get_file_content_metadata",ZP="@@apiv2_redux/files/get_file_content_metadata_result",XP="@@apiv2_redux/files/get_file_info",JP="@@apiv2_redux/files/get_file_info_result",ex="@@apiv2_redux/files/get_file_lock_batch",tx="@@apiv2_redux/files/get_file_lock_batch_result",ix="@@apiv2_redux/files/get_metadata",ax="@@apiv2_redux/files/get_metadata_result",nx="@@apiv2_redux/files/get_metadata_batch",rx="@@apiv2_redux/files/get_metadata_batch_result",ox="@@apiv2_redux/files/get_preview_v2",sx="@@apiv2_redux/files/get_preview_v2_result",lx="@@apiv2_redux/files/get_preview_v3",cx="@@apiv2_redux/files/get_preview_v3_result",dx="@@apiv2_redux/files/get_preview",ux="@@apiv2_redux/files/get_preview_result",_x="@@apiv2_redux/files/get_previewable_extensions",px="@@apiv2_redux/files/get_previewable_extensions_result",gx="@@apiv2_redux/files/get_query_suggestions",fx="@@apiv2_redux/files/get_query_suggestions_result",mx="@@apiv2_redux/files/get_temporary_link",hx="@@apiv2_redux/files/get_temporary_link_result",vx="@@apiv2_redux/files/get_temporary_upload_link",Sx="@@apiv2_redux/files/get_temporary_upload_link_result",Ex="@@apiv2_redux/files/get_thumbnail",wx="@@apiv2_redux/files/get_thumbnail_result",bx="@@apiv2_redux/files/get_thumbnail_v2",yx="@@apiv2_redux/files/get_thumbnail_v2_result",Tx="@@apiv2_redux/files/get_thumbnail_batch",Ix="@@apiv2_redux/files/get_thumbnail_batch_result",Cx="@@apiv2_redux/files/get_thumbnail_batch_link",Ax="@@apiv2_redux/files/get_thumbnail_batch_link_result",Mx="@@apiv2_redux/files/get_upload_info",Ox="@@apiv2_redux/files/get_upload_info_result",Px="@@apiv2_redux/files/has_folder_access",xx="@@apiv2_redux/files/has_folder_access_result",Dx="@@apiv2_redux/files/list_folder",Rx="@@apiv2_redux/files/list_folder_result",Nx="@@apiv2_redux/files/list_folder/continue",kx="@@apiv2_redux/files/list_folder/continue_result",Lx="@@apiv2_redux/files/list_folder/get_latest_cursor",Fx="@@apiv2_redux/files/list_folder/get_latest_cursor_result",Ux="@@apiv2_redux/files/list_folder/get_mount_info",Vx="@@apiv2_redux/files/list_folder/get_mount_info_result",jx="@@apiv2_redux/files/list_revisions",Bx="@@apiv2_redux/files/list_revisions_result",Hx="@@apiv2_redux/files/list_subfolders",Kx="@@apiv2_redux/files/list_subfolders_result",zx="@@apiv2_redux/files/lock_file_batch",Wx="@@apiv2_redux/files/lock_file_batch_result",Gx="@@apiv2_redux/files/media_transcode",qx="@@apiv2_redux/files/media_transcode_result",Qx="@@apiv2_redux/files/move_v2",Yx="@@apiv2_redux/files/move_v2_result",$x="@@apiv2_redux/files/move",Zx="@@apiv2_redux/files/move_result",Xx="@@apiv2_redux/files/move_batch_v2",Jx="@@apiv2_redux/files/move_batch_v2_result",eD="@@apiv2_redux/files/move_batch",tD="@@apiv2_redux/files/move_batch_result",iD="@@apiv2_redux/files/move_batch/check_v2",aD="@@apiv2_redux/files/move_batch/check_v2_result",nD="@@apiv2_redux/files/move_batch/check",rD="@@apiv2_redux/files/move_batch/check_result",oD="@@apiv2_redux/files/move_batch_sync",sD="@@apiv2_redux/files/move_batch_sync_result",lD="@@apiv2_redux/files/paper/create",cD="@@apiv2_redux/files/paper/create_result",dD="@@apiv2_redux/files/paper/update",uD="@@apiv2_redux/files/paper/update_result",_D="@@apiv2_redux/files/permanently_delete",pD="@@apiv2_redux/files/permanently_delete_result",gD="@@apiv2_redux/files/properties/add",fD="@@apiv2_redux/files/properties/add_result",mD="@@apiv2_redux/files/properties/overwrite",hD="@@apiv2_redux/files/properties/overwrite_result",vD="@@apiv2_redux/files/properties/remove",SD="@@apiv2_redux/files/properties/remove_result",ED="@@apiv2_redux/files/properties/template/get",wD="@@apiv2_redux/files/properties/template/get_result",bD="@@apiv2_redux/files/properties/template/list",yD="@@apiv2_redux/files/properties/template/list_result",TD="@@apiv2_redux/files/properties/update",ID="@@apiv2_redux/files/properties/update_result",CD="@@apiv2_redux/files/recents_v2",AD="@@apiv2_redux/files/recents_v2_result",MD="@@apiv2_redux/files/remove_content_references",OD="@@apiv2_redux/files/remove_content_references_result",PD="@@apiv2_redux/files/request_unlock_file_batch",xD="@@apiv2_redux/files/request_unlock_file_batch_result",DD="@@apiv2_redux/files/restore",RD="@@apiv2_redux/files/restore_result",ND="@@apiv2_redux/files/restore_path_batch_sync",kD="@@apiv2_redux/files/restore_path_batch_sync_result",LD="@@apiv2_redux/files/save_url",FD="@@apiv2_redux/files/save_url_result",UD="@@apiv2_redux/files/save_url/check_job_status",VD="@@apiv2_redux/files/save_url/check_job_status_result",jD="@@apiv2_redux/files/search",BD="@@apiv2_redux/files/search_result",HD="@@apiv2_redux/files/search_v2",KD="@@apiv2_redux/files/search_v2_result",zD="@@apiv2_redux/files/search/continue_v2",WD="@@apiv2_redux/files/search/continue_v2_result",GD="@@apiv2_redux/files/search_ex",qD="@@apiv2_redux/files/search_ex_result",QD="@@apiv2_redux/files/set_description",YD="@@apiv2_redux/files/set_description_result",$D="@@apiv2_redux/files/set_user_sort_preference",ZD="@@apiv2_redux/files/set_user_sort_preference_result",XD="@@apiv2_redux/files/starred_v2",JD="@@apiv2_redux/files/starred_v2_result",eR="@@apiv2_redux/files/tags/add",tR="@@apiv2_redux/files/tags/add_result",iR="@@apiv2_redux/files/tags/get",aR="@@apiv2_redux/files/tags/get_result",nR="@@apiv2_redux/files/tags/remove",rR="@@apiv2_redux/files/tags/remove_result",oR="@@apiv2_redux/files/team_folder/copy",sR="@@apiv2_redux/files/team_folder/copy_result",lR="@@apiv2_redux/files/team_folder/copy/check",cR="@@apiv2_redux/files/team_folder/copy/check_result",dR="@@apiv2_redux/files/team_folder/create",uR="@@apiv2_redux/files/team_folder/create_result",_R="@@apiv2_redux/files/team_folder/create/check",pR="@@apiv2_redux/files/team_folder/create/check_result",gR="@@apiv2_redux/files/team_folder/delete",fR="@@apiv2_redux/files/team_folder/delete_result",mR="@@apiv2_redux/files/team_folder/rename",hR="@@apiv2_redux/files/team_folder/rename_result",vR="@@apiv2_redux/files/tree_view_folders",SR="@@apiv2_redux/files/tree_view_folders_result",ER="@@apiv2_redux/files/undo_batch",wR="@@apiv2_redux/files/undo_batch_result",bR="@@apiv2_redux/files/unlock_file_batch",yR="@@apiv2_redux/files/unlock_file_batch_result",TR="@@apiv2_redux/files/upload_v2",IR="@@apiv2_redux/files/upload_v2_result",CR="@@apiv2_redux/files/upload",AR="@@apiv2_redux/files/upload_result",MR="@@apiv2_redux/files/upload_session/append_v2",OR="@@apiv2_redux/files/upload_session/append_v2_result",PR="@@apiv2_redux/files/upload_session/append",xR="@@apiv2_redux/files/upload_session/append_result",DR="@@apiv2_redux/files/upload_session/append_batch",RR="@@apiv2_redux/files/upload_session/append_batch_result",NR="@@apiv2_redux/files/upload_session/check_finish_batch_job_status",kR="@@apiv2_redux/files/upload_session/check_finish_batch_job_status_result",LR="@@apiv2_redux/files/upload_session/finish_v2",FR="@@apiv2_redux/files/upload_session/finish_v2_result",UR="@@apiv2_redux/files/upload_session/finish",VR="@@apiv2_redux/files/upload_session/finish_result",jR="@@apiv2_redux/files/upload_session/finish_batch",BR="@@apiv2_redux/files/upload_session/finish_batch_result",HR="@@apiv2_redux/files/upload_session/finish_batch_v2",KR="@@apiv2_redux/files/upload_session/finish_batch_v2_result",zR="@@apiv2_redux/files/upload_session/finish_batch/check",WR="@@apiv2_redux/files/upload_session/finish_batch/check_result",GR="@@apiv2_redux/files/upload_session/finish_processed",qR="@@apiv2_redux/files/upload_session/finish_processed_result",QR="@@apiv2_redux/files/upload_session/finish_processed/check",YR="@@apiv2_redux/files/upload_session/finish_processed/check_result",$R="@@apiv2_redux/files/upload_session/start",ZR="@@apiv2_redux/files/upload_session/start_result",XR="@@apiv2_redux/files/upload_session/start_batch",JR="@@apiv2_redux/files/upload_session/start_batch_result",eN="@@apiv2_redux/files/validate_upload",tN="@@apiv2_redux/files/validate_upload_result",iN=eT({[jO]:{endpoint:"add_content_references",action:Jy(BO)},[HO]:{endpoint:"add_content_references_to_path",action:Jy(KO)},[zO]:{endpoint:"alpha/get_metadata",action:Jy(WO)},[GO]:{endpoint:"alpha/upload",action:Jy(qO)},[QO]:{endpoint:"browse",action:Jy(YO)},[$O]:{endpoint:"browse_continue",action:Jy(ZO)},[XO]:{endpoint:"content_tiles_metadata_v2",action:Jy(JO)},[eP]:{endpoint:"copy_v2",action:Jy(tP)},[iP]:{endpoint:"copy",action:Jy(aP)},[nP]:{endpoint:"copy_batch_v2",action:Jy(rP)},[oP]:{endpoint:"copy_batch",action:Jy(sP)},[lP]:{endpoint:"copy_batch/check_v2",action:Jy(cP)},[dP]:{endpoint:"copy_batch/check",action:Jy(uP)},[_P]:{endpoint:"copy_batch_sync",action:Jy(pP)},[gP]:{endpoint:"copy_reference/get",action:Jy(fP)},[mP]:{endpoint:"copy_reference/save",action:Jy(hP)},[vP]:{endpoint:"create_folder_v2",action:Jy(SP)},[EP]:{endpoint:"create_folder",action:Jy(wP)},[bP]:{endpoint:"create_folder_batch",action:Jy(yP)},[TP]:{endpoint:"create_folder_batch/check",action:Jy(IP)},[CP]:{endpoint:"delete_v2",action:Jy(AP)},[MP]:{endpoint:"delete",action:Jy(OP)},[PP]:{endpoint:"delete_batch",action:Jy(xP)},[DP]:{endpoint:"delete_batch/check",action:Jy(RP)},[NP]:{endpoint:"delete_batch_with_changeset_sync",action:Jy(kP)},[LP]:{endpoint:"delete_with_changeset",action:Jy(FP)},[UP]:{endpoint:"download",action:Jy(VP)},[jP]:{endpoint:"download_zip",action:Jy(BP)},[HP]:{endpoint:"export",action:Jy(KP)},[zP]:{endpoint:"get_browse_bolt_data",action:Jy(WP)},[GP]:{endpoint:"get_content_references_info",action:Jy(qP)},[QP]:{endpoint:"get_description_batch",action:Jy(YP)},[$P]:{endpoint:"get_file_content_metadata",action:Jy(ZP)},[XP]:{endpoint:"get_file_info",action:Jy(JP)},[ex]:{endpoint:"get_file_lock_batch",action:Jy(tx)},[ix]:{endpoint:"get_metadata",action:Jy(ax)},[nx]:{endpoint:"get_metadata_batch",action:Jy(rx)},[ox]:{endpoint:"get_preview_v2",action:Jy(sx)},[lx]:{endpoint:"get_preview_v3",action:Jy(cx)},[dx]:{endpoint:"get_preview",action:Jy(ux)},[_x]:{endpoint:"get_previewable_extensions",action:Jy(px)},[gx]:{endpoint:"get_query_suggestions",action:Jy(fx)},[mx]:{endpoint:"get_temporary_link",action:Jy(hx)},[vx]:{endpoint:"get_temporary_upload_link",action:Jy(Sx)},[Ex]:{endpoint:"get_thumbnail",action:Jy(wx)},[bx]:{endpoint:"get_thumbnail_v2",action:Jy(yx)},[Tx]:{endpoint:"get_thumbnail_batch",action:Jy(Ix)},[Cx]:{endpoint:"get_thumbnail_batch_link",action:Jy(Ax)},[Mx]:{endpoint:"get_upload_info",action:Jy(Ox)},[Px]:{endpoint:"has_folder_access",action:Jy(xx)},[Dx]:{endpoint:"list_folder",action:Jy(Rx)},[Nx]:{endpoint:"list_folder/continue",action:Jy(kx)},[Lx]:{endpoint:"list_folder/get_latest_cursor",action:Jy(Fx)},[Ux]:{endpoint:"list_folder/get_mount_info",action:Jy(Vx)},[jx]:{endpoint:"list_revisions",action:Jy(Bx)},[Hx]:{endpoint:"list_subfolders",action:Jy(Kx)},[zx]:{endpoint:"lock_file_batch",action:Jy(Wx)},[Gx]:{endpoint:"media_transcode",action:Jy(qx)},[Qx]:{endpoint:"move_v2",action:Jy(Yx)},[$x]:{endpoint:"move",action:Jy(Zx)},[Xx]:{endpoint:"move_batch_v2",action:Jy(Jx)},[eD]:{endpoint:"move_batch",action:Jy(tD)},[iD]:{endpoint:"move_batch/check_v2",action:Jy(aD)},[nD]:{endpoint:"move_batch/check",action:Jy(rD)},[oD]:{endpoint:"move_batch_sync",action:Jy(sD)},[lD]:{endpoint:"paper/create",action:Jy(cD)},[dD]:{endpoint:"paper/update",action:Jy(uD)},[_D]:{endpoint:"permanently_delete",action:Jy(pD)},[gD]:{endpoint:"properties/add",action:Jy(fD)},[mD]:{endpoint:"properties/overwrite",action:Jy(hD)},[vD]:{endpoint:"properties/remove",action:Jy(SD)},[ED]:{endpoint:"properties/template/get",action:Jy(wD)},[bD]:{endpoint:"properties/template/list",action:Jy(yD)},[TD]:{endpoint:"properties/update",action:Jy(ID)},[CD]:{endpoint:"recents_v2",action:Jy(AD)},[MD]:{endpoint:"remove_content_references",action:Jy(OD)},[PD]:{endpoint:"request_unlock_file_batch",action:Jy(xD)},[DD]:{endpoint:"restore",action:Jy(RD)},[ND]:{endpoint:"restore_path_batch_sync",action:Jy(kD)},[LD]:{endpoint:"save_url",action:Jy(FD)},[UD]:{endpoint:"save_url/check_job_status",action:Jy(VD)},[jD]:{endpoint:"search",action:Jy(BD)},[HD]:{endpoint:"search_v2",action:Jy(KD)},[zD]:{endpoint:"search/continue_v2",action:Jy(WD)},[GD]:{endpoint:"search_ex",action:Jy(qD)},[QD]:{endpoint:"set_description",action:Jy(YD)},[$D]:{endpoint:"set_user_sort_preference",action:Jy(ZD)},[XD]:{endpoint:"starred_v2",action:Jy(JD)},[eR]:{endpoint:"tags/add",action:Jy(tR)},[iR]:{endpoint:"tags/get",action:Jy(aR)},[nR]:{endpoint:"tags/remove",action:Jy(rR)},[oR]:{endpoint:"team_folder/copy",action:Jy(sR)},[lR]:{endpoint:"team_folder/copy/check",action:Jy(cR)},[dR]:{endpoint:"team_folder/create",action:Jy(uR)},[_R]:{endpoint:"team_folder/create/check",action:Jy(pR)},[gR]:{endpoint:"team_folder/delete",action:Jy(fR)},[mR]:{endpoint:"team_folder/rename",action:Jy(hR)},[vR]:{endpoint:"tree_view_folders",action:Jy(SR)},[ER]:{endpoint:"undo_batch",action:Jy(wR)},[bR]:{endpoint:"unlock_file_batch",action:Jy(yR)},[TR]:{endpoint:"upload_v2",action:Jy(IR)},[CR]:{endpoint:"upload",action:Jy(AR)},[MR]:{endpoint:"upload_session/append_v2",action:Jy(OR)},[PR]:{endpoint:"upload_session/append",action:Jy(xR)},[DR]:{endpoint:"upload_session/append_batch",action:Jy(RR)},[NR]:{endpoint:"upload_session/check_finish_batch_job_status",action:Jy(kR)},[LR]:{endpoint:"upload_session/finish_v2",action:Jy(FR)},[UR]:{endpoint:"upload_session/finish",action:Jy(VR)},[jR]:{endpoint:"upload_session/finish_batch",action:Jy(BR)},[HR]:{endpoint:"upload_session/finish_batch_v2",action:Jy(KR)},[zR]:{endpoint:"upload_session/finish_batch/check",action:Jy(WR)},[GR]:{endpoint:"upload_session/finish_processed",action:Jy(qR)},[QR]:{endpoint:"upload_session/finish_processed/check",action:Jy(YR)},[$R]:{endpoint:"upload_session/start",action:Jy(ZR)},[XR]:{endpoint:"upload_session/start_batch",action:Jy(JR)},[eN]:{endpoint:"validate_upload",action:Jy(tN)}});var aN;function nN(e){return({dispatch:t})=>i=>a=>{const n=i(a);if(a.type===aN.SearchContacts){const i=e();try{i.search(a.payload,(e=>{var i;t((i={query:a.payload,result:e[a.payload]},{type:aN.SearchContactsResult,payload:i}))}))}catch(e){}}else a.type===aN.WarmContacts&&e();return n}}!function(e){e.WarmContacts="@@contacts/warm",e.SearchContacts="@@contacts/search",e.SearchContactsResult="@@contacts/searchResult"}(aN||(aN={}));const rN="comments2";function oN(e){return({dispatch:t,getState:i})=>(e.onSignal((e=>{e.updatedChannels.filter((e=>e.channelId.appId===rN)).map((e=>{const a=i().boltInfo.boltUniqueIdToStream[e.channelId.uniqueId];a&&t(aO({arg:{include_permissions:!0,stream:a}}))}))})),t=>i=>{switch(i.type){case NO.BoltSubscribe:e.subscribe(i.payload.map((e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}}))));break;case NO.BoltUnsubscribe:e.unsubscribe(i.payload.map((e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}}))))}return t(i)})}const sN=(()=>{let e,t;const i=[];for(e=0,t=e;e<=255;e++,t=e)i.push((t+256).toString(16).substr(1));return i})();function lN(e){return e.map((e=>sN[e])).join("")}function cN(){const e=function(){const e=new Uint8Array(16);return window.crypto&&window.crypto.getRandomValues(e),e}();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(lN).join("-")}function dN({content:e,threadId:t,author:i}){const a=new Date;return{id:cN(),timestamp:a,threadId:t,author:i,content:e,userPermissions:{canDelete:!1,canEdit:!1},revisionInfo:{isCurrent:!0,timestamp:a}}}function uN(e){return{type:{".tag":"file"},identifier:{".tag":"file_path_or_id",file_path_or_id:e}}}function _N(e,t){return t?function(e){return{type:{".tag":"file"},identifier:{".tag":"shared_link_details",url:e}}}(t):uN(e)}function pN(e,t){return e[".tag"]===t}function gN(e){if(pN(e,"video"))return{type:"video",time:e.time||0,timeSec:e.time_sec||0};if(pN(e,"audio"))return{type:"audio",time:e.time};if(pN(e,"document"))return{type:"document",regionType:e.region_type[".tag"],label:e.label,regions:e.regions};if(pN(e,"image"))return{type:"image",region:e.region,label:e.label};throw new Error("Attempted to convert an annotation type that does not yet exist.")}function fN(e){return"video"===e.type?{".tag":"video",time:e.time,time_sec:e.timeSec}:"audio"===e.type?{".tag":"audio",time:e.time}:"document"===e.type?{".tag":"document",regions:e.regions,region_type:{".tag":e.regionType}}:{".tag":"image",region:{...e.region,page:1}}}function mN(e,t){return e.type===t}function hN(e){return mN(e,"mention")}function vN(e){return mN(e,"style")}function SN(e){return mN(e,"sticker")}function EN(e){return mN(e,"quick_react")}function wN(e){return mN(e,"guest")}function bN(e){return mN(e,"reel")}function yN(e){return mN(e,"hyperlink")}function TN(e){const t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function IN(e){const t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');const i={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:i}}function CN(e){if(e.url&&e.location)return{location:e.location,type:"hyperlink",url:e.url}}function AN(e){const t=[...e.formatting.map(TN),...e.mentions.map(IN)];if(e.sticker){const i=function(e){if(e.url&&e.name&&e.description)return{type:"sticker",id:e.id,url:e.url,name:e.name,description:e.description}}(e.sticker);i&&t.push(i)}if(e.quick_react){const i=function(e){if(e.emoji)return{type:"quick_react",emoji:e.emoji}}(e.quick_react);i&&t.push(i)}if(e.guest){const i=function(e){if(e.first_name||e.last_name)return{type:"guest",first_name:e.first_name,last_name:e.last_name}}(e.guest);i&&t.push(i)}if(e.reel){const i=function(e){if(e.annotation_data)return{type:"reel",annotation_data:e.annotation_data}}(e.reel);i&&t.push(i)}if(e.hyperlinks){const i=e.hyperlinks.map(CN);for(const e of i)e&&yN(e)&&t.push(e)}return t}function MN(e){const t=e.filter(vN).map((e=>({format:{".tag":e.style},location:e.location}))),i=e.filter(hN).map((e=>({user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}))),a=e.find(SN),n=a?{id:a.id}:void 0,r=e.find(EN),o=r?{emoji:r.emoji}:void 0,s=e.find(wN),l=s?{first_name:s.first_name,last_name:s.last_name}:void 0,c=e.find(bN);return{formatting:t,mentions:i,sticker:n,quick_react:o,guest:l,reel:c?{annotation_data:c.annotation_data}:void 0,hyperlinks:e.filter(yN).map((e=>({url:e.url,location:e.location})))}}function ON(e,t){const i=t.timestamp?new Date(t.timestamp):void 0;return{isCurrent:e.ns_id===t.ns_id&&e.sjid===t.sjid,revision:{nsId:t.ns_id,sjId:t.sjid},timestamp:i}}function PN(e){return e&&"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}function xN(e,t){if("resolved_no_details"===e[".tag"])return{type:"no_details"};if(function(e){return"resolved_with_details"===e[".tag"]}(e))return{type:"with_details",resolver:t[e.resolver_id],resolvedTimestamp:new Date(e.resolved_timestamp)};throw new Error("Not a valid type for ResolvedInfo.")}function DN(e,t,i){const a=e.comments.map((a=>function(e,t,i,a){return{author:i[e.author_id],content:{metadata:AN(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),revisionInfo:a&&e.revision?ON(a,e.revision):{isCurrent:!0},userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}}(a,e.id,t,i))),n=e.resolved_info?{resolved:!0,resolvedInfo:xN(e.resolved_info,t)}:{resolved:!1};return{annotation:e.annotation_data?gN(e.annotation_data):void 0,comments:a,id:e.id,read:e.read,readonly:e.readonly,isThirdParty:e.is_third_party,...n,timestamp:a[0].timestamp}}function RN(e,t,i){const a=e.map((e=>DN(e,t,i)));return w.keyBy(a,"id")}function NN(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url}}function kN(e){const t=e.map(NN);return w.keyBy(t,"id")}var LN;t.Status=void 0,(LN=t.Status||(t.Status={}))[LN.Disabled=0]="Disabled",LN[LN.ReadOnly=1]="ReadOnly",LN[LN.FullyEnabled=2]="FullyEnabled";const FN={},UN={fileIdentifierToBoltMap:{},boltUniqueIdToStream:{}},VN={},jN={},BN={},HN={currentQuery:"",result:[]},KN={},zN={},WN={},GN={},qN={},QN={},YN={},$N={},ZN=!1,XN={state:null,mode:t.SectionAnnotationMode.single},JN=e=>{const{payload:{arg:{stream:t}}}=e;return ek(t)};function ek(e){return"file_path_or_id"===e.identifier[".tag"]?e.identifier.file_path_or_id:"shared_link_details"===e.identifier[".tag"]?e.identifier.url:void 0}function tk(e){const{stream:t,id:i}=e.payload.arg;return"file_path_or_id"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.file_path_or_id,threadId:i}:"shared_link_details"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.url,threadId:i}:{}}function ik(e){var t;const{payload:{arg:{id:i,stream:{identifier:a}}}}=e,n=null===(t=e.meta)||void 0===t?void 0:t.threadId;return"file_path_or_id"===a[".tag"]?{fileIdOrUrl:a.file_path_or_id,commentId:i,threadId:n}:"shared_link_details"===a[".tag"]?{fileIdOrUrl:a.url,commentId:i,threadId:n}:{}}function ak(e,t,i,a){return{...e,[t]:i,pending:{action:a,originalValue:e[t],pendingValue:i}}}function nk(e,t,i,a,n){const{comments:r}=e,o=r.findIndex((e=>e.id===t)),s=r[o];if(!s)return e;const l={...s,[i]:a},c=[...r];return c.splice(o,1,l),ak(e,"comments",c,n)}function rk(e,t,i){return{...e,[t]:i?e.pending.originalValue:e[t],pending:void 0}}const ok={boltInfo:(e=UN,t)=>{if(t.type===mM){const{payload:{arg:i,result:a}}=t,n=ek(i.stream);if(n&&a)return{fileIdentifierToBoltMap:{...e.fileIdentifierToBoltMap,[n]:a.bolt_info},boltUniqueIdToStream:{...e.boltUniqueIdToStream,[a.bolt_info.unique_id]:i.stream}}}return e},threads:(e=FN,t)=>{const i=!!t.error;switch(t.type){case tM:return sk(e,t);case iM:return lk(e,t,i);case RM:case kM:return ck(e,t);case NM:case LM:return dk(e,t,i);case FM:case BM:return uk(e,t);case UM:case HM:return _k(e,t,i);case cM:return pk(e,t);case dM:return gk(e,t,i);case rM:return fk(e,t);case oM:return mk(e,t,i);case mM:case PM:return hk(e,t);default:return e}},supportedEnhancements:(e={},t)=>{var i;if(t.type===mM){const{payload:{arg:a,result:n}}=t,r=ek(a.stream);if(null!=r&&null!=n)return{...e,[r]:null!==(i=n.supported_enhancements)&&void 0!==i?i:{}}}return e},activeThreadID:(e=VN,t)=>{switch(t.type){case NO.ActivateThread:return{...e,[t.payload.fileViewerId]:t.payload.threadId};case NO.DeactivateAllThreads:return{...e,[t.payload.fileViewerId]:""};case tM:if(t.meta&&t.meta.tempThreadId)return{...e,[t.meta.fileViewerId]:t.meta.tempThreadId};break;case iM:const{meta:i,payload:{result:a}}=t;if(a&&i&&i.tempThreadId===e[i.fileViewerId])return{...e,[i.fileViewerId]:a.id}}return e},focusedThreadID:(e=jN,{type:t,payload:i})=>{if(t===NO.FocusThread){const t={...e};return null==i.threadId?delete t[i.fileViewerId]:t[i.fileViewerId]=i.threadId,t}return e},hoverThreadID:(e=BN,{type:t,payload:i})=>{if(t===NO.HoverThread){const t={...e};return null==i.threadId?delete t[i.fileViewerId]:t[i.fileViewerId]=i.threadId,t}return e},mentionsSearchResult:(e=HN,t)=>{switch(t.type){case aN.SearchContacts:return{...e,currentQuery:t.payload};case aN.SearchContactsResult:if(t.payload.query===e.currentQuery)return{...e,result:t.payload.result}}return e},permissions:(e=zN,t)=>{if(t.type!==mM&&t.type!==PM)return e;const{payload:{arg:i,result:a}}=t,n=ek(i.stream);if(!n||!a)return e;const r=a.permissions;return{...e,[n]:r}},draftAnnotation:(e=KN,t)=>{switch(t.type){case NO.UpdateDraftAnnotation:{const{fileViewerId:i,annotation:a}=t.payload;return a===e[i]?e:{...e,[i]:a}}case NO.CancelAnnotating:case NO.ClearDraftAnnotation:{const{fileViewerId:i}=t.payload;if(!(i in e))return e;const a={...e};return delete a[i],a}case tM:if(null!=t.meta){const{fileViewerId:i}=t.meta;if(!(i in e))return e;const a={...e};return delete a[i],a}}return e},annotationSettings:(e=XN,i)=>{var a;switch(i.type){case NO.CancelAnnotating:case lM:return{...e,state:null};case tM:return e.mode===t.SectionAnnotationMode.single?{...e,state:null}:{...e,state:"annotating"};case NO.ActivateThread:return null===e.state?{...e,state:"viewing"}:"viewing"!==e.state?{...e,state:null}:e;case NO.DeactivateAllThreads:return"viewing"===e.state?{...e,state:null}:e;case NO.StartAnnotating:return i.payload.accessible?{...e,state:"annotating-ax"}:{...e,state:"annotating"};case NO.UpdateAnnotationMode:return"continuous"===i.payload.updatedAnnotationMode?{mode:i.payload.updatedAnnotationMode,state:null!==(a=e.state)&&void 0!==a?a:"annotating"}:{mode:i.payload.updatedAnnotationMode,state:null};case NO.ConfirmDraftAnnotation:return{...e,state:"commenting"}}return e},editorFocusRequest:(e=WN,{type:t,payload:i})=>{if(t===NO.ConfirmDraftAnnotation&&!e[i.fileViewerId])return{...e,[i.fileViewerId]:!0};if(t===NO.FocusEditor&&!e[i.fileViewerId])return{...e,[i.fileViewerId]:!0};if(t===NO.EditorDidFocus&&e[i.fileViewerId]){const t={...e};return delete t[i.fileViewerId],t}return e},pendingNavigationToActiveThreadAnnotation:(e=GN,{type:t,payload:i})=>{if(t===NO.ActivateThread)return{[i.fileViewerId]:!0,...e};if(t===NO.ResolveNavigationToActiveThreadAnnotation){const t={...e};return delete t[i.fileViewerId],t}return e},status:(e=qN,i)=>{if(i.type===mM){const{payload:{arg:a,result:n}}=i,r=ek(a.stream);if(r&&n)switch(n.status[".tag"]){case"disabled":return{...e,[r]:t.Status.Disabled};case"enabled":return{...e,[r]:t.Status.FullyEnabled};case"readonly":return{...e,[r]:t.Status.ReadOnly}}}if(i.type===PM){const{payload:{arg:a}}=i,n=ek(a.stream);if(n)return{...e,[n]:t.Status.FullyEnabled}}return e},thirdPartySource:(e=QN,t)=>{if(t.type!==mM)return e;const{payload:{arg:i,result:a}}=t,n=ek(i.stream);if(!n||!a)return e;const r=a.supported_enhancements&&a.supported_enhancements.third_party_source;return{...e,[n]:r?(o=r,o[".tag"]):void 0};var o},subscriptionStatus:(e=YN,t)=>{if(t.type!==jM&&t.type!==zM)return e;const i=JN(t);if(void 0===i)return e;switch(t.type){case jM:return{...e,[i]:{isSubscribed:!0,canSubscribe:!0}};case zM:return{...e,[i]:{isSubscribed:!1,canSubscribe:!0}};default:return e}},enableCommentStatus:(e=$N,t)=>{var i;if(t.type!==_M&&t.type!==lM&&t.type!==mM&&t.type!==PM)return e;const a=JN(t);if(void 0===a)return e;switch(t.type){case _M:return{...e,[a]:{commentsEnabled:!0,canEnableCommenting:!0}};case lM:return{...e,[a]:{commentsEnabled:!1,canEnableCommenting:!0}};case mM:case PM:const n=t.payload.result;return n?{...e,[a]:{commentsEnabled:!("disabled"===n.status[".tag"]),canEnableCommenting:!!(null===(i=n.permissions)||void 0===i?void 0:i.can_enable_commenting)}}:e;default:return e}},showResolvedComments:(e=ZN,t)=>t.type===NO.UpdateShowResolvedComments?t.payload.showResolvedComments:e},sk=(e,t)=>{const{payload:{arg:{thread_id:i,stream:a}}}=t,n=ek(a);if(!n||!t.meta)return e;const r=e[n],{content:o,author:s,annotation:l}=t.meta;if(i){const a=r[i],{comments:c}=a,d={...a,comments:[...c,dN({content:o,threadId:i,author:s})],annotation:l||a.annotation};return{...e,[n]:{...r,[i]:{...d,pending:{action:t.type,originalValue:a,newValue:d}}}}}const{tempThreadId:c}=t.meta;if(c){const i=dN({threadId:c,author:s,content:o}),a={id:c,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[i],annotation:l,isThirdParty:!1},d={...a,pending:{action:t.type,originalValue:void 0,pendingValue:a}};return{...e,[n]:{...r,[c]:d}}}return e},lk=(e,t,i)=>{const{payload:{arg:{thread_id:a,stream:n}}}=t,r=ek(n);if(!r||!t.meta)return e;const o=e[r];if(a){const t={...o[a]},{originalValue:n}=t.pending;return t.pending=void 0,{...e,[r]:{...o,[a]:i?n:t}}}const{tempThreadId:s}=t.meta;let l=o;if(!i&&s in o&&t.payload.result){l={...o},delete l[s];const e=o[s],{id:i}=t.payload.result;e.readonly=!1,e.id=i,l[i]={...e,pending:void 0}}return{...e,[r]:l}},ck=(e,t)=>{const{fileIdOrUrl:i,threadId:a}=tk(t);if(!i||!a)return e;const n=e[i];return{...e,[i]:{...n,[a]:ak(n[a],"read",t.type===RM,t.type)}}},dk=(e,t,i)=>{const{fileIdOrUrl:a,threadId:n}=tk(t);if(!a||!n)return e;const r=e[a];return{...e,[a]:{...r,[n]:rk(r[n],"read",i)}}},uk=(e,t)=>{const{fileIdOrUrl:i,threadId:a}=tk(t);if(!i||!a)return e;const n=e[i];return{...e,[i]:{...n,[a]:ak(n[a],"resolved",t.type===FM,t.type)}}},_k=(e,t,i)=>{const{fileIdOrUrl:a,threadId:n}=tk(t);if(!a||!n)return e;const r=e[a];return{...e,[a]:{...r,[n]:rk(r[n],"resolved",i)}}},pk=(e,t)=>{const{fileIdOrUrl:i,threadId:a,commentId:n}=ik(t);if(!(i&&a&&n&&t.meta))return e;const r=e[i],{content:o}=t.meta;return{...e,[i]:{...r,[a]:nk(r[a],n,"content",o,t.type)}}},gk=(e,t,i)=>{const{fileIdOrUrl:a,threadId:n,commentId:r}=ik(t);if(!a||!n||!r)return e;const o=e[a];return{...e,[a]:{...o,[n]:rk(o[n],"comments",i)}}},fk=(e,t)=>{const{fileIdOrUrl:i,threadId:a,commentId:n}=ik(t);if(!i||!a||!n)return e;const r=e[i];return{...e,[i]:{...r,[a]:nk(r[a],n,"deleted",!0,t.type)}}},mk=(e,t,i)=>{const{fileIdOrUrl:a,threadId:n,commentId:r}=ik(t);if(!a||!n||!r)return e;const o=e[a];return{...e,[a]:{...o,[n]:rk(o[n],"comments",i)}}},hk=(e,t)=>{const{payload:{arg:i,result:a}}=t,n=ek(i.stream);return n&&a?{...e,[n]:RN(a.threads,kN(a.users))}:e},vk=a.combineReducers(ok);a.injectInternalStyle("/static/js/file_viewer/comments2/annotations/layer.module.out-vflmBJqSq.css",(e=>"._layer_1p757_1{bottom:0;left:0;pointer-events:none;position:absolute;right:0;top:0}._layer_1p757_1._interactable_1p757_10{pointer-events:auto}"));const Sk="_layer_1p757_1";function Ek(e){return"annotating"===e||"annotating-ax"===e||"commenting"===e}function wk(e){var t;const{data:i}=cu(e),a=null===(t=null==i?void 0:i.apiData)||void 0===t?void 0:t.metadata;if(a)return"video"===a[".tag"]?a.frame_rate:void 0}const bk=a.defineMessage({id:"tgNuiG",defaultMessage:"Currently selecting {timestamp}"}),yk=te.memo((e=>{var t;const{children:i,ui:n,file:r,navigationCallbacks:o}=e,s=a.useIntl(),{fileViewerId:l}=u.useFileViewerContext(),c=null!==(t=wk(r))&&void 0!==t?t:10,d=a.useSelector((e=>e.annotationSettings.state)),_=b.useDispatch(),p=null==o?void 0:o.seekRelative,g=Jr((e=>{"annotating-ax"===d&&("ArrowLeft"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),null!=c&&e.shiftKey?null==p||p(-1/c):null==p||p(-1)),"ArrowRight"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),null!=c&&e.shiftKey?null==p||p(1/c):null==p||p(1)),"Enter"===e.key&&_(FO(l))," "===e.key&&(e.stopImmediatePropagation(),e.preventDefault()))})),f=te.useRef(),m=te.useCallback((e=>{null==e||e.addEventListener("keydown",g),f.current=e||void 0}),[g]),h=te.useRef();te.useEffect((()=>{"annotating-ax"===d&&"annotating-ax"!==h.current&&f.current&&f.current.focus(),h.current=d}),[d]);const v=(e=>{const t=Math.round(e),i=String(Math.round(t%60)).padStart(2,"0"),a=String(Math.floor(t/60)%60).padStart(2,"0"),n=Math.floor(t/3600);return n>0?`${n}:${a}:${i}`:`${a}:${i}`})(n.currentTimestamp),S="annotating-ax"===d?s.formatMessage(bk,{timestamp:v}):"";return te.createElement("div",{className:Sk,ref:m,"aria-label":S,tabIndex:-1},i)}));function Tk(e,t){let i=!0,a=null;function n(){i=!0,null!==a&&(e(...a),a=null)}return function(...r){i?(i=!1,e(...r),setTimeout(n,t)):a=r}}yk.displayName="AudioVideoAnnotationLayer",yk.displayName="AudioVideoAnnotationLayer";a.injectInternalStyle("/static/js/file_viewer/comments2/annotations/conductor_layer/conductor_layer.module.out-vflVaLXx_.css",(e=>"._sc-annotation-conductor-layer_niric_1{bottom:0;cursor:auto;left:0;position:absolute;right:0;top:0}._sc-annotation-conductor-layer__can-create_niric_10{cursor:crosshair;pointer-events:all}._sc-annotation-conductor-layer__can-create_niric_10 img,._sc-annotation-conductor-layer__is-creating-rnd_niric_21{-webkit-user-select:none;user-select:none}"));const Ik="_sc-annotation-conductor-layer_niric_1";var Ck;!function(e){e[e.None=0]="None",e[e.Text=1]="Text",e[e.Link=2]="Link",e[e.Creation=3]="Creation"}(Ck||(Ck={}));const Ak=8;function Mk(e,t,i){const a=i?function(e,t){const i=e.x+e.width-t.width,a=e.y+e.height-t.height;return{x:Math.min(i,t.x),y:Math.min(a,t.y),width:t.width,height:t.height}}(t,e):function(e,t){const i=e.x+e.width,a=e.y+e.height,n=e.x,r=e.y,o={x:qT(t.x,n,i),y:qT(t.y,r,a)},s=qT(t.x+t.width,n,i),l=qT(t.y+t.height,r,a);return{x:o.x,y:o.y,width:s-o.x,height:l-o.y}}(t,e);return function(e,t){let{x:i,y:a,width:n,height:r}=e;const o=i+n,s=a+r,l=t.x+t.width,c=t.y+t.height;return n<=Ak&&o+Ak>l&&(i=o-Ak,n=Ak),r<=Ak&&s+Ak>c&&(a=s-Ak,r=Ak),{x:i,y:a,width:n,height:r}}(a,t)}a.injectInternalStyle("/static/js/file_viewer/comments2/annotations/creation_layer/creation_layer.module.out-vfl3PAEQU.css",(e=>"._highlight-creation-layer_303xa_1{bottom:0;left:0;position:absolute;right:0;top:0}._highlight-creation-layer_303xa_1 a::selection,._highlight-creation-layer_303xa_1 p::selection{background:var(--dig-color__highlight__yellow)}._add-annotation-highlight-button_303xa_14{background-color:var(--color__inverse__elevated__background);box-sizing:border-box;color:var(--color__inverse__standard__text);margin-left:-4px;opacity:0;padding:4px;position:absolute;transition:opacity .1s ease-in-out,margin 0ms ease-in-out .4s;z-index:1000}._add-annotation-highlight-button__visible_303xa_26{margin-left:0;opacity:1;pointer-events:all;transition:opacity .15s ease-in-out,margin .15s ease-in-out}._annotation-rectangle-creation-layer_303xa_33{bottom:0;left:0;position:absolute;right:0;top:0}._annotation-rectangle-creation-draft_303xa_41{border:3px solid var(--color__attention__text);box-sizing:border-box;cursor:all-scroll;height:100px;left:0;pointer-events:all;position:absolute;top:0;width:100px}._annotation-handle-v2_303xa_53{background:var(--color__core__secondary);border:1px solid var(--color__core__accent);border-radius:50%}._annotation-edge_303xa_61,._annotation-handle-v2_303xa_53{background-clip:padding-box;position:absolute}._highlight-segment-draft_303xa_66{background:var(--dig-color__highlight__yellow);box-sizing:border-box;opacity:.5;pointer-events:none;position:absolute}"));function Ok(e){return e+1}const Pk=.02;function xk(e){return 100*e+"%"}function Dk({x:e,y:t,width:i,height:a}){return{top:xk(t),left:xk(e),width:xk(i),height:xk(a)}}class Rk extends te.PureComponent{get className(){return a.cx("_highlight-creation-layer_303xa_1")}render(){const{className:e}=this,{highlight:t}=this.props;return te.createElement("div",{className:e},this.props.children,t&&{highlight:t}.highlight.map(((e,t)=>te.createElement("div",{key:`sc-annotation-highlight-draft-${t}`,style:Dk(e),className:"_highlight-segment-draft_303xa_66"}))))}}Rk.displayName="AnnotationHighlightCreationLayer";class Nk extends te.PureComponent{constructor(e){super(e),this.requestId=null,this.updateStyles=()=>{this.setState(((e,t)=>(this.requestId=null,{style:t.style})))},this.state={style:e.style}}componentWillUnmount(){this.requestId&&cancelAnimationFrame(this.requestId)}componentDidUpdate(){this.requestId||(this.requestId=requestAnimationFrame(this.updateStyles))}render(){return te.Children.only(this.props.children(this.state.style))}}var kk,Lk;Nk.displayName="RafStyle",function(e){e.TopLeft="topLeft",e.TopRight="topRight",e.BottomLeft="bottomLeft",e.BottomRight="bottomRight"}(kk||(kk={})),function(e){e.Top="top",e.Bottom="bottom",e.Left="left",e.Right="right"}(Lk||(Lk={}));const Fk="drag";var Uk;!function(e){e[e.Ignore=0]="Ignore",e[e.NotExceeded=1]="NotExceeded",e[e.Exceeded=2]="Exceeded"}(Uk||(Uk={}));function Vk(e){return 0===e.button}function jk({x:e,y:t,width:i,height:a},{deltaX:n,deltaY:r},o){switch(o){case Fk:return{x:e+n,y:t+r,width:i,height:a};case kk.BottomRight:return{x:n<-i?e+(i+n):e,y:r<-a?t+(a+r):t,width:Math.abs(i+n),height:Math.abs(a+r)};case kk.BottomLeft:return{x:n>i?e+i:e+n,y:r<-a?t+(a+r):t,width:Math.abs(i-n),height:Math.abs(a+r)};case kk.TopRight:return{x:n<-i?e+(i+n):e,y:r>a?t+a:t+r,width:Math.abs(i+n),height:Math.abs(a-r)};case kk.TopLeft:return{x:n>i?e+i:e+n,y:r>a?t+a:t+r,width:Math.abs(i-n),height:Math.abs(a-r)};case Lk.Left:return{x:n>i?e+i:e+n,y:t,width:Math.abs(i-n),height:a};case Lk.Right:return{x:n<-i?e+(i+n):e,y:t,width:Math.abs(i+n),height:a};case Lk.Top:return{x:e,y:r>a?t+a:t+r,width:i,height:Math.abs(a-r)};case Lk.Bottom:return{x:e,y:r<-a?t+(a+r):t,width:i,height:Math.abs(a+r)}}}function Bk(e){const t="-5px",i="6px",a="0",n={bottom:a,top:a,left:a,right:a};switch(e){case Lk.Top:return Object.assign(Object.assign({},n),{top:t,height:i,bottom:void 0,cursor:"n-resize"});case Lk.Left:return Object.assign(Object.assign({},n),{left:t,width:i,right:void 0,cursor:"w-resize"});case Lk.Bottom:return Object.assign(Object.assign({},n),{bottom:t,height:i,top:void 0,cursor:"s-resize"});case Lk.Right:return Object.assign(Object.assign({},n),{right:t,width:i,left:void 0,cursor:"e-resize"})}}function Hk(e){const t={width:"12px",height:"12px"},i="-7px";switch(e){case kk.TopLeft:return Object.assign(Object.assign({},t),{top:i,left:i,cursor:"nw-resize"});case kk.TopRight:return Object.assign(Object.assign({},t),{top:i,right:i,cursor:"ne-resize"});case kk.BottomLeft:return Object.assign(Object.assign({},t),{bottom:i,left:i,cursor:"sw-resize"});case kk.BottomRight:return Object.assign(Object.assign({},t),{bottom:i,right:i,cursor:"se-resize"})}}const Kk="_annotation-handle-v2_303xa_53",zk="_annotation-edge_303xa_61",Wk={[kk.TopLeft]:Kk,[kk.TopRight]:Kk,[kk.BottomLeft]:Kk,[kk.BottomRight]:Kk,[Lk.Top]:zk,[Lk.Right]:zk,[Lk.Bottom]:zk,[Lk.Left]:zk},Gk={[kk.TopLeft]:Hk(kk.TopLeft),[kk.TopRight]:Hk(kk.TopRight),[kk.BottomLeft]:Hk(kk.BottomLeft),[kk.BottomRight]:Hk(kk.BottomRight),[Lk.Top]:Bk(Lk.Top),[Lk.Left]:Bk(Lk.Left),[Lk.Right]:Bk(Lk.Right),[Lk.Bottom]:Bk(Lk.Bottom)};a.injectInternalStyle("/static/js/file_viewer/comments2/annotations/view_layer/view_layer.module.out-vflCiK48s.css",(e=>'._view-layer_a6nvr_1{bottom:0;left:0;pointer-events:none;position:absolute;right:0;top:0}._regular-rectangle-sublayer_a6nvr_11{opacity:.3}._regular-highlight-sublayer_a6nvr_16,._regular-rectangle-sublayer_a6nvr_11{transition:opacity .3s ease-in-out,background-color .3s ease-in-out}._regular-highlight-sublayer_a6nvr_16{opacity:1}._hide-regular-sublayer_a6nvr_21 ._regular-highlight-sublayer_a6nvr_16,._hide-regular-sublayer_a6nvr_21 ._regular-rectangle-sublayer_a6nvr_11{opacity:0}._annotation-rectangle_a6nvr_29{border:3px solid var(--color__inverse__attention__border);box-sizing:border-box;position:absolute}._annotation-rectangle_a6nvr_29._emphasized_a6nvr_35{border:3px solid var(--color__attention__text)}._annotation-rectangle-frame-segment_a6nvr_39{cursor:pointer;pointer-events:auto;position:absolute}._emphasis-sublayer_a6nvr_46 ._annotation-rectangle_a6nvr_29{opacity:0;transition:opacity .3s ease-in-out}._emphasis-sublayer_a6nvr_46 ._emphasized_a6nvr_35{opacity:1}._highlight-segment_a6nvr_56,._highlight-segment_a6nvr_56:after{box-sizing:border-box;position:absolute}._highlight-segment_a6nvr_56:after{background:var(--dig-color__highlight__yellow);bottom:0;content:"";height:2px;left:0;opacity:1;right:0}._emphasis-sublayer_a6nvr_46 ._highlight-segment_a6nvr_56:after{opacity:0}._emphasis-sublayer_a6nvr_46 ._highlight-segment_a6nvr_56:before{background-color:var(--dig-color__highlight__yellow);bottom:2px;content:"";left:0;opacity:0;position:absolute;right:0;top:0;transition:opacity .3s ease-in-out}._emphasis-sublayer_a6nvr_46 ._emphasized_a6nvr_35:before{opacity:.5}'));const qk="_emphasized_a6nvr_35",Qk="_highlight-segment_a6nvr_56";class Yk extends te.PureComponent{render(){const{rectangle:e,isEmphasized:t}=this.props;return te.createElement("div",{style:Dk(e),className:a.cx("_annotation-rectangle_a6nvr_29",{[qk]:t}),"data-testid":"annotation-rectangle"})}}Yk.displayName="AnnotationRectangle";const $k=({x:e,y:t,width:i,height:n})=>te.createElement("div",{style:Dk({x:e,y:t,width:i,height:n}),className:a.cx("_annotation-rectangle-frame-segment_a6nvr_39")});$k.displayName="FrameSegment";const Zk=e=>{const{x:t,y:i,width:a,height:n}=e.rectangle;return te.createElement(te.Fragment,null,te.createElement($k,{x:t-Pk,y:i-Pk,width:a+.04,height:.04}),te.createElement($k,{x:t-Pk,y:i+n-Pk,width:a+.04,height:.04}),te.createElement($k,{x:t-Pk,y:i+Pk,width:.04,height:n-.04}),te.createElement($k,{x:t+a-Pk,y:i+Pk,width:.04,height:n-.04}))};Zk.displayName="AnnotationRectangleFrame";const Xk=({placement:{x:e,y:t,width:i,height:a}})=>te.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%"},te.createElement("mask",{id:"annotation-cutout"},te.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),te.createElement("rect",{x:e+1,y:t+1,width:i-2,height:a-2,fill:"black"})),te.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"black",opacity:"0.4",mask:"url(#annotation-cutout)"}));function Jk(e){const{x:t,y:i,width:a,height:n}=e;return{transform:`translate(${t}px, ${i}px)`,width:a,height:n}}Xk.displayName="AnnotationCutoutOverlay",Xk.displayName="AnnotationCutoutOverlay";const eL=e=>e.preventDefault();class tL extends te.PureComponent{constructor(e){super(e),this.state={clickThreshold:Uk.NotExceeded,internalPlacement:null},this.ref=null,this.rectangleRef=null,this.onDeltaStart=(e,t,i=!1)=>{if(Vk(e)){this.disableDragSelect();const{clientX:a,clientY:n}=e,r=this.rectangleRef,o={x:a,y:n},s=i?Object.assign(Object.assign({},o),{width:0,height:0}):r&&function({top:e,left:t,width:i,height:a}){return{x:t,y:e,width:i,height:a}}(r.getBoundingClientRect());s&&(this.attachListeners(),this.props.onRectChangeStart(i),this.setState({resizeDragMeta:{originPoint:o,deltaMovement:t,originRect:s}}))}},this.onDeltaChange=e=>{const{resizeDragMeta:t,clickThreshold:i}=this.state;if(!t||!this.rectCanChange(e))return;const{clientX:a,clientY:n}=e,{originPoint:r,deltaMovement:o,originRect:s}=t,l=function(e,{x:t,y:i}){return{deltaX:t-e.x,deltaY:i-e.y}}(r,{x:a,y:n});i===Uk.NotExceeded?(this.setState({clickThreshold:Uk.Exceeded}),this.props.onRectChange(jk(s,l,o),"drag"===o,!0)):this.props.onRectChange(jk(s,l,o),"drag"===o)},this.onDeltaEnd=()=>{this.state.clickThreshold===Uk.NotExceeded&&this.props.clearPlacement(),document.removeEventListener("selectstart",eL),this.removeListeners(),this.props.onRectChangeEnd(),this.setState({resizeDragMeta:void 0,clickThreshold:Uk.Ignore})},this.onRectangleMouseDown=e=>{e.currentTarget===e.target&&this.onDeltaStart(e,Fk)},this.setRef=e=>{this.ref=e},this.setRectangleRef=e=>{this.rectangleRef=e},this.onLayerMouseDown=e=>{const t=e.target,i=function(e){const t=e.target.tagName.toUpperCase();return"P"===t||"TEXT"===t}(e)||function(e){return"A"===e.target.tagName}(e),a=this.rectangleRef&&this.rectangleRef.contains(t);i||a||(this.setState({clickThreshold:Uk.NotExceeded}),this.onDeltaStart(e,kk.BottomRight,!0))};this.resizerV2=[Lk.Top,Lk.Left,Lk.Right,Lk.Bottom,kk.TopLeft,kk.TopRight,kk.BottomLeft,kk.BottomRight].map((e=>te.createElement("div",{style:Gk[e],key:e,className:Wk[e],onMouseDown:t=>this.onDeltaStart(t,e)})))}attachListeners(){document.addEventListener("mousemove",this.onDeltaChange,!0),document.addEventListener("mouseup",this.onDeltaEnd)}removeListeners(){document.removeEventListener("mousemove",this.onDeltaChange),document.removeEventListener("mouseup",this.onDeltaEnd)}disableDragSelect(){document.addEventListener("selectstart",eL)}rectCanChange(e){const{resizeDragMeta:t,clickThreshold:i}=this.state;return i!==Uk.NotExceeded||t&&function({x:e,y:t},{clientX:i,clientY:a}){return Math.max(Math.abs(e-i),Math.abs(t-a))>5}(t.originPoint,e)}maybeRenderAnnotationDraft(){const{placement:e}=this.props;return e?te.createElement(Nk,{style:e},(e=>e?te.createElement(te.Fragment,null,te.createElement("div",{ref:this.setRectangleRef,style:Jk(e),className:a.cx("_annotation-rectangle-creation-draft_303xa_41"),onMouseDown:this.onRectangleMouseDown},this.resizerV2),te.createElement(Xk,{placement:e})):null)):null}render(){const{setRef:e,onLayerMouseDown:t}=this;return te.createElement("div",{ref:e,className:"_annotation-rectangle-creation-layer_303xa_33",onMouseDown:t},this.props.children,this.maybeRenderAnnotationDraft())}}function iL(e){const{top:t,left:i,width:a,height:n}=e.currentTarget.getBoundingClientRect(),{clientX:r,clientY:o}=e,[s,l]=[r-i,o-t];return{x:s/a,y:l/n}}function aL(e,t,i,a){const{x:n,y:r,width:o,height:s}=e;return{x:n*t+((null==a?void 0:a.x)||0),y:r*i+((null==a?void 0:a.y)||0),width:o*t,height:s*i}}tL.displayName="AnnotationRectangleCreationLayer";class nL extends te.PureComponent{constructor(e){super(e),this.mouseDownSurface=Ck.None,this.hasMouseMoved=!1,this.layerRef=null,this.onDragStart=e=>{this.props.canCreateRectangle&&e.preventDefault()},this.onKeyDown=e=>{const t=this.state.internalAnnotation;if(!t||"rnd"!==t.type)return;let i=!1;"Enter"===e.key?(this.onRectChangeEnd(),i=!0):"ArrowUp"===e.key?(this.onArrowKey(0,-1,e.shiftKey),i=!0):"ArrowDown"===e.key?(this.onArrowKey(0,1,e.shiftKey),i=!0):"ArrowLeft"===e.key?(this.onArrowKey(-1,0,e.shiftKey),i=!0):"ArrowRight"===e.key&&(this.onArrowKey(1,0,e.shiftKey),i=!0),i&&(e.stopImmediatePropagation(),e.preventDefault())},this.onMouseMove=e=>{const{annotation:t}=this.props,i=0===(void 0!==e.buttons?e.buttons:e.nativeEvent.which);this.hasMouseMoved=!0,!i||t||this.onHoverPointChange(iL(e))},this.onMouseDown=e=>{Vk(e)&&(this.mouseDownSurface=function(e){return function(e){return"A"===e.target.tagName}(e)?Ck.Link:function(e){const t=e.target.tagName.toUpperCase();return"P"===t||"TEXT"===t}(e)?Ck.Text:function(e,t){return e.target.classList.contains(t)}(e,Ik)||function(e){return"IMG"===e.target.tagName}(e)?Ck.Creation:Ck.None}(e),this.hasMouseMoved=!1)},this.onMouseUp=e=>{const{annotation:t,handleClick:i}=this.props;this.hasMouseMoved||this.mouseDownSurface===Ck.None||(t?this.attemptClearAllAnnotations():i&&i(iL(e))),this.mouseDownSurface=Ck.None},this.onHoverPointChange=Tk((e=>{const{onHoverPointChange:t}=this.props;t&&t(e)}),50),this.onMouseLeave=()=>{this.onHoverPointChange(void 0)},this.onRectChangeStart=()=>{const{layerSize:e}=this.props;if(this.layerRef&&e){const{left:t,top:i}=this.layerRef.getBoundingClientRect(),{width:a,height:n}=e,r={x:t,y:i,width:a,height:n};return this.setState({layerRect:r}),r}},this.onRectChange=(e,t,i)=>{const{layerRect:a}=this.state;if(a&&this.props.canCreateRectangle){const n=function(e,t){return QT({left:e.x,top:e.y,width:e.width,height:e.height},{left:t.x,top:t.y,width:t.width,height:t.height})}(Mk(e,a,t),a);i?this.props.onAnnotationChange({type:"rnd",regions:[n]},!0):(this.setState({internalAnnotation:{type:"rnd",regions:[n]}}),this.setLiveFeedback(n,t))}},this.onRectChangeEnd=()=>{var e,t;const{internalAnnotation:i}=this.state;i?(this.props.onAnnotationChange(i,!1),null===(t=(e=this.props).onAnnotationConfirm)||void 0===t||t.call(e)):this.props.canDismiss&&this.props.onAnnotationChange(null,!1),this.setState({layerRect:null})},this.setLayerRef=e=>{e&&(this.layerRef=e,this.layerRef.addEventListener("keydown",this.onKeyDown))},this.attemptClearHighlightPlacement=()=>{this.attemptClearAnnotation("highlight")},this.attemptClearRectanglePlacement=()=>{this.attemptClearAnnotation("rnd")},this.attemptClearAllAnnotations=()=>{this.attemptClearHighlightPlacement(),this.attemptClearRectanglePlacement()},this.attemptClearAnnotation=e=>{const{annotation:t}=this.props;this.annotationIsDismissable&&t&&t.type===e&&this.props.onAnnotationChange(null,!1)},this.state={layerRect:null,internalAnnotation:e.annotation,liveFeedback:""}}get className(){const{canCreateRectangle:e}=this.props;return a.cx(Ik,{"_sc-annotation-conductor-layer__can-create_niric_10":e,"_sc-annotation-conductor-layer__is-creating-rnd_niric_21":this.state.layerRect})}get rectanglePlacement(){const{layerSize:e}=this.props,{internalAnnotation:t}=this.state;if(t&&"rnd"===t.type){return aL(t.regions[0],e.width,e.height)}return null}get highlightPlacement(){const{annotation:e}=this.props;return"highlight"===(null==e?void 0:e.type)?e.regions:null}get annotationIsDismissable(){return null!==this.props.annotation&&this.props.canDismiss}setLiveFeedback(e,t){const i=this.props.intl,a=t?i.formatMessage({id:"Ycv46p",defaultMessage:"Annotation updated with position x: {x}, y: {y}"},{x:Math.round(100*e.x),y:Math.round(100*e.y)}):i.formatMessage({id:"JCBqbG",defaultMessage:"Annotation updated with size width: {width}, height: {height}"},{width:Math.round(100*e.width),height:Math.round(100*e.height)});this.setState({liveFeedback:a})}onArrowKey(e,t,i){const{layerRect:a,internalAnnotation:n}=this.state;if(!a||!n)return;const{x:r,y:o,width:s,height:l}=n.regions[0],{width:c,height:d}=this.props.layerSize,u=.01;let _;_=i?{x:r,y:o,width:s+e*u,height:l+t*u}:{x:r+e*u,y:o+t*u,width:s,height:l};const p=aL(_,c,d,a);this.onRectChange(p,!i)}componentDidUpdate({annotationState:e,annotation:t}){const{annotation:i,annotationState:a,canCreateRectangle:n,onAnnotationChange:r,isActive:o}=this.props;if(null==i&&null!=t)this.setState({internalAnnotation:i});else if(null!=i&&null==t)this.setState({internalAnnotation:i});else if(o&&"annotating-ax"===a&&n&&"annotating-ax"!==e){const e=this.onRectChangeStart();if(e){r({type:"rnd",regions:[{x:0,y:0,width:e.width>500?200/e.width:.2,height:e.height>250?100/e.height:.1}]},!1),this.layerRef.focus()}}}componentWillUnmount(){this.layerRef&&this.layerRef.removeEventListener("keydown",this.onKeyDown)}render(){const{highlightPlacement:e,rectanglePlacement:t,props:i,className:a}=this,{children:n,intl:r,annotationState:o}=i;return te.createElement(l.Provider,{value:r},te.createElement("div",{ref:this.setLayerRef,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseLeave:this.onMouseLeave,onMouseMove:this.onMouseMove,className:a,onDragStart:this.onDragStart,tabIndex:-1},te.createElement(Rk,{highlight:e},te.createElement(tL,{placement:t,clearPlacement:this.attemptClearRectanglePlacement,onRectChangeStart:this.onRectChangeStart,onRectChange:this.onRectChange,onRectChangeEnd:this.onRectChangeEnd,annotationState:o},n))),te.createElement("div",{style:{opacity:0,position:"absolute"},"aria-live":"polite"},this.state.liveFeedback))}}nL.displayName="AnnotationConductorLayer";const rL=e=>{const{dispatch:t,annotationState:i,layer:n,draftAnnotation:r,ui:{fitScaleFactor:o},children:s,isActive:l,handleClick:c,onHoverPointChange:d,handleRegionSelection:_,handleAnnotationConfirm:p}=e,{pluginNavigation:g,fileViewerId:f}=u.useFileViewerContext(),m=te.default.useCallback(((e,t)=>{_(e,t,"pageIndex"in n?n.pageIndex:null)}),[n,_]),h=a.useIntl(),v=Ek(i);if(te.default.useEffect((()=>{if(v)return()=>{t(UO(f))}}),[v,t,g,f]),null==n.dimensions)return te.default.createElement(te.default.Fragment,null,s);const{height:S,width:E}=n.dimensions;return te.default.createElement(te.default.Fragment,null,te.default.createElement(nL,{canCreateRectangle:Ek(i),canDismiss:!0,annotation:r,onAnnotationChange:m,onAnnotationConfirm:p,handleClick:c,onHoverPointChange:d,layerSize:{height:S*o,width:E*o},intl:h,annotationState:i,isActive:l},s))};function oL(e){const{rectangle:t,isEmphasized:i}=e,n=a.cx(Qk,{[qk]:i});return te.createElement("div",{style:Dk(t),className:n,"data-testid":"annotation-highlight-segment"})}function sL(e,t,i,a){return e.map((({id:e,annotation:n})=>{const{type:r,regions:o}=lL(n),s=e===t||e===a||e===i;switch(r){case"rectangle":return te.createElement(te.Fragment,{key:e},te.createElement(Yk,{rectangle:o[0],isEmphasized:s}),te.createElement(Zk,{rectangle:o[0]}));case"highlight":return function(e){const{key:t,highlight:i,isEmphasized:a}=e;return i.map(((e,i)=>te.createElement(oL,{key:`${t}-${i}`,rectangle:e,isEmphasized:a})))}({key:e,highlight:o,isEmphasized:s});case"other":return null}}))}rL.displayName="AnnotationConductor";const lL=e=>"image"===e.type?{type:"rectangle",regions:[e.region]}:{type:e.regionType,regions:e.regions};function cL(e){const{threads:t,activatedThreadId:i,focusedThreadId:n,hoverThreadId:r,hideLayer:o,layerSize:s,handleClick:l,handleHoverPointChange:c}=e,d=o?[]:[i,n,r],u=t.filter((e=>"rectangle"===lL(e.annotation).type)),_=t.filter((e=>"highlight"===lL(e.annotation).type)),p=sL(u,...d),g=sL(_,...d),f=sL([...u,..._],...d);let m;if(s){const e=u.filter((e=>e.id===i));if(e&&1===e.length){m=aL(lL(e[0].annotation).regions[0],s.width,s.height)}}const h=te.useCallback((e=>{null==c||c(iL(e))}),[c]),v=te.useCallback((e=>{null==l||l(iL(e))}),[l]);return te.createElement("div",{className:"_view-layer_a6nvr_1","data-testid":"annotation-view-layer",onMouseMove:h,onClick:v},te.createElement("div",{className:a.cx({"_hide-regular-sublayer_a6nvr_21":o})},te.createElement("div",{className:"_regular-rectangle-sublayer_a6nvr_11"},p),te.createElement("div",{className:"_regular-highlight-sublayer_a6nvr_16"},g)),te.createElement("div",{className:"_emphasis-sublayer_a6nvr_46","data-testid":"annotation-emphasis-sublayer"},f),m&&te.createElement(Xk,{placement:m}))}const dL=({threads:e,activeThreadId:t,layer:{dimensions:i},draftAnnotation:a,ui:{fitScaleFactor:n},focusedThreadId:r,hoverThreadId:o,handleClick:s,handleHoverPointChange:l})=>{if(null==i)return null;const{height:c,width:d}=i;return te.createElement(cL,{threads:e,hideLayer:null!=a,activatedThreadId:t,focusedThreadId:r,hoverThreadId:o,layerSize:{height:c*n,width:d*n},handleClick:s,handleHoverPointChange:l})};dL.displayName="AnnotationHighlights";const uL=t=>{var{children:i}=t,r=n.__rest(t,["children"]);const o=a.useAfterDisplayPassthroughCallback({importer:()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{annotationHandleClick:t}=yield new Promise((function(t,i){e(["./c_comments2_annotations_annotation_layer"],t,i)}));return{default:{fn:t}}}))}),s=a.useAfterDisplayPassthroughCallback({importer:()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{handleHoverPointChange:t}=yield new Promise((function(t,i){e(["./c_comments2_annotations_annotation_layer"],t,i)}));return{default:{fn:t}}}))});return te.createElement("div",{className:Sk},te.createElement(dL,Object.assign({},r,{handleClick:e=>o.fn(e,r),handleHoverPointChange:e=>s.fn(r,e)})),te.createElement(rL,Object.assign({},r,{handleClick:e=>o.fn(e,r),onHoverPointChange:e=>s.fn(r,e)}),i))};uL.displayName="UnconnectedAnnotationLayer";const _L=a.connect(((e,{file:{fileId:t,url:i},fileViewerId:a})=>{const n=e.threads[ga(t,i)]||{},r=Object.values(n).filter((t=>{return null!=(i=t).annotation&&"image"===i.annotation.type&&pL(t,e.showResolvedComments);var i})),o=e.draftAnnotation[a],s=null==o||"image"!==o.type?null:{type:"rnd",regions:[o.region]};return{threads:r,activeThreadId:e.activeThreadID[a],draftAnnotation:s,focusedThreadId:e.focusedThreadID[a],hoverThreadId:e.hoverThreadID[a],annotationState:e.annotationSettings.state}}))(uL);function pL(e,t){return t||!e.resolvedInfo}function gL(e,t){const i=Ok(t);return e.regions.some((e=>e.page===i))}const fL=a.connect(((e,{file:{fileId:t,url:i},fileViewerId:a,layer:{pageIndex:n}})=>{const r=e.threads[ga(t,i)]||{},o=Object.values(r).filter((t=>{return null!=(i=t).annotation&&"document"===i.annotation.type&&pL(t,e.showResolvedComments)&&gL(t.annotation,n);var i})),s=e.draftAnnotation[a],l=null!=s&&"document"===s.type&&gL(s,n)?{type:"rectangle"===s.regionType?"rnd":"highlight",regions:s.regions}:null;return{threads:o,activeThreadId:e.activeThreadID[a],draftAnnotation:l,focusedThreadId:e.focusedThreadID[a],hoverThreadId:e.hoverThreadID[a],annotationState:e.annotationSettings.state}}))(uL),mL=e=>{if(e.previewType===a.PreviewType.Image)return te.createElement(_L,Object.assign({},e,{isActive:!0}));if(e.previewType===a.PreviewType.SsrDoc||e.previewType===a.PreviewType.CloudDoc){const{ui:t,layer:i}=e,a=t.currentPageIndex,n=i.pageIndex;return te.createElement(fL,Object.assign({},e,{isActive:n===a}))}return e.previewType===a.PreviewType.Audio||e.previewType===a.PreviewType.Video?te.createElement(yk,Object.assign({},e)):te.createElement(te.Fragment,null,e.children)};mL.displayName="AnnotationLayer",mL.displayName="AnnotationLayer";a.injectInternalStyle("/static/js/file_viewer/comments2/comments2.module.out-vfl0fhZ4w.css",(e=>"._comments-pane_1304m_1>.sc-comment-stream{width:100%}._comments-pane-blade_1304m_5{height:100%}._disabled-annotations-show-more_1304m_9{color:var(--color__attention__text);cursor:pointer}._annotation-tooltip-container_1304m_14{height:25px;position:absolute;width:30px}._iconContainer_1304m_20{display:flex;position:relative}._iconContainer__visualRefresh_1304m_25{height:24px;position:relative;width:24px}._unreadBadge_1304m_31{color:var(--dig-color__primary__on-base);position:absolute;right:-6px;top:-6px}._commentButton_1304m_38{height:100%;width:100%}"));const hL=e=>a.useSelector((t=>e?((e,t)=>{const i=e.threads[t];return i?Object.values(i).filter((e=>!e.read&&e.comments.some((e=>!e.deleted)))).length:void 0})(t,e):0)),vL=({fileId:e,sharedLinkURL:t,setCommentsSidebar:i})=>{const n=hL(ga(e,t)),{featureConfig:r}=u.useFileViewerContext(),[o,s]=te.default.useState(!0);return te.default.useEffect((()=>{o&&void 0!==n&&i&&(n>0&&"ON"===r.comments_2024_open_sidebar_if_unread&&(null==i||i()),s(!1))}),[n,r.comments_2024_open_sidebar_if_unread,i,o]),te.default.createElement("span",{className:"_iconContainer_1304m_20"},te.default.createElement(a.UIIcon,{src:a.CommentLine,className:"_commentButton_1304m_38"}),!!n&&n>0&&te.default.createElement(X.NotificationBadge,{status:"attention",className:"_unreadBadge_1304m_31"},n))};vL.displayName="CommentIconWithUnreadCount";function SL({event:e,stream:t,thread_id:i,comment_id:a,is_third_party:n,error:r}){return lO({arg:{event:r?{".tag":"comment_error"}:e,stream:t,thread_id:i,comment_id:a,is_third_party:n,oref:"dfv",product_surface:{".tag":"file_preview"},product_surface_context:{".tag":"file_preview"},error_message:r?r.message:void 0}})}const EL=({dispatch:e})=>t=>i=>{const a=t(i);if(i.type===iM)e(SL({event:i.payload.arg.thread_id?{".tag":"reply_to_comment"}:{".tag":"new_comment"},stream:i.payload.arg.stream,thread_id:i.payload.arg.thread_id,error:i.error}));else if(i.type===NM)e(SL({event:{".tag":"mark_thread_as_read"},stream:i.payload.arg.stream,thread_id:i.payload.arg.id,error:i.error}));else if(i.type===LM)e(SL({event:{".tag":"mark_thread_as_unread"},stream:i.payload.arg.stream,thread_id:i.payload.arg.id,error:i.error}));else if(i.type===UM)e(SL({event:{".tag":"resolve_thread"},stream:i.payload.arg.stream,thread_id:i.payload.arg.id,error:i.error}));else if(i.type===HM)e(SL({event:{".tag":"unresolve_thread"},stream:i.payload.arg.stream,thread_id:i.payload.arg.id,error:i.error}));else if(i.type===oM)e(SL({event:{".tag":"delete_comment"},stream:i.payload.arg.stream,thread_id:i.meta?i.meta.threadId:void 0,comment_id:i.payload.arg.id,error:i.error}));else if(i.type===dM)e(SL({event:{".tag":"edit_comment"},stream:i.payload.arg.stream,thread_id:i.meta?i.meta.threadId:void 0,comment_id:i.payload.arg.id,error:i.error}));else if(i.type===NO.ActivateThread){const{fileId:t,isThirdParty:a,threadId:n}=i.payload,r=uN(t);e(SL({event:{".tag":"activate_thread"},stream:r,thread_id:n,is_third_party:a}))}return a},wL=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{CommentsPluginPane:t}=yield new Promise((function(t,i){e(["./c_file_viewer_comments2_plugin_pane"],t,i)}));return{default:t}}))));wL.displayName="LazyCommentsPluginPane";const bL=()=>te.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},te.default.createElement(a.Spinner,{className:"comments-blade-loading-spinner",size:"standard"}));bL.displayName="LoadingIndicator";const yL=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{CommentsMeatball:t}=yield new Promise((function(t,i){e(["./c_file_viewer_comments2_meatball_menu"],t,i)}));return{default:t}}))));yL.displayName="LazyCommentsMeatball";const TL=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{AnnotationBanner:t}=yield new Promise((function(t,i){e(["./c_comments2_annotations_annotation_banner"],t,i)}));return{default:t}}))));TL.displayName="LazyAnnotationBanner";const IL=te.default.lazy((()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{CommentMarkers:t}=yield new Promise((function(t,i){e(["./c_file_viewer_comments2_comment_markers"],t,i)}));return{default:t}}))));IL.displayName="LazyCommentMarkers";const CL=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(yL,Object.assign({},e)));CL.displayName="AsyncCommentsMeatball";const AL=e=>te.default.createElement(te.default.Suspense,{fallback:te.default.createElement(bL,null)},te.default.createElement(wL,Object.assign({},e)));AL.displayName="AsyncCommentsPluginPane";const ML=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(TL,Object.assign({},e)));ML.displayName="AsyncAnnotationBanner";const OL=e=>te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(IL,Object.assign({},e)));OL.displayName="AsyncCommentMarkers";const PL=()=>{const{logUserAction:e}=u.useFileViewerContext();return te.default.useCallback((t=>e(t.event,"right_sidebar",t.extra)),[e])},xL=(e,t,i,a,n)=>{const r=te.default.useRef(!1),o=(null==e?void 0:e.url)||(null==e?void 0:e.fileId),s=te.default.useMemo((()=>Object.values(o&&t&&t.getState().threads[o]||{})),[o,t]);te.default.useEffect((()=>{if(!r.current&&0!==s.length&&e&&t){if(n){const a=RO(s.filter((e=>!!e)),n);a&&(t.dispatch(kO({fileId:e.fileId,sharedLinkURL:e.url,fileViewerId:i,threadId:a.thread.id,isThirdParty:a.thread.isThirdParty})),r.current=!0)}a&&t.dispatch(function(e){return{type:NO.FocusEditor,payload:{fileViewerId:e}}}(i))}}),[n,e,i,a,t,s])},DL=()=>{const e=so("comments",a.UserActionContext.SurfaceGesture),t=co(),i=(()=>{const e=cn().videoPlayer;return Jr((t=>{e&&(0===e.currentTime()&&(e.play(),e.pause()),e.currentTime(e.currentTime()+t),e.pause())}))})(),n=uo(a.UserActionContext.Sidebar),r=(()=>{const e=cn().videoPlayer;return Jr((()=>{e&&e.pause()}))})();return te.default.useMemo((()=>({openCommentSidebar:e,seek:t,seekRelative:i,navigateToPage:n,pause:r})),[n,e,r,t,i])};class RL{constructor({apiV2Client:e,commentsPlatformAdapter:i,user:n,reportException:r,commentsPluginInitialParams:o}){var s;this.shouldFocusComment=!1,this.hasAttemptedFetchingInitialCommentsForFileId=new Set,this.useStore=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=DL(),i=te.default.useCallback((()=>(this.storePromise||(this.storePromise=new Promise((i=>{if(!t)return;const n=((e,t)=>({getState:i,dispatch:a})=>n=>r=>{var o;switch(n(r),r.type){case NO.ResolveNavigationToActiveThreadAnnotation:return;case NO.ActivateThread:{const{fileId:n,sharedLinkURL:s}=r.payload,l=i();for(const i of Object.getOwnPropertyNames(l.pendingNavigationToActiveThreadAnnotation)){if(i===e){const e=ga(n,s),r=l.activeThreadID[i],c=null===(o=l.threads[e])||void 0===o?void 0:o[r];if(c&&c.annotation){const e=c.annotation;"document"===e.type&&t.navigateToPage((e.regions[0].page||1)-1),"audio"!==e.type&&"video"!==e.type||t.seek(e.time),t.openCommentSidebar(),a(VO(i))}}break}break}case NO.ConfirmDraftAnnotation:return void t.openCommentSidebar()}})(e,t);i(function({apiv2ClientBase:e,boltIOClient:t,mentionsIOClient:i},n){const r=[iN(a.GetFilesRoutes(e)),AO((o=e,o.ns("comments2"))),oN(t),({dispatch:e,getState:t})=>i=>async a=>{const n=i(a);if(a.type===NO.ActivateThread){const{threadId:i,fileId:r,sharedLinkURL:o}=a.payload,s=t().threads[ga(r,o)];if(null==s)return n;const l=s[i];if(l&&!l.read&&!l.readonly){const t=_N(r,o);e(fO({arg:{id:l.id,stream:t}}))}}return n}];var o;i&&r.push(nN(i)),n&&r.push(...n);const s=a.applyMiddleware(...r),l=window.__REDUX_DEVTOOLS_EXTENSION__,c=null==l?s:a.compose(s,l({name:"FVSDK Comments2 Plugin"}));return a.createStore(vk,c)}({apiv2ClientBase:this.apiV2Client,boltIOClient:this.commentsPlatformAdapter.boltIOClient,mentionsIOClient:this.commentsPlatformAdapter.mentionsIOClient},[n,EL]))}))),this.storePromise)),[e,t]),[n,r]=te.default.useState(null);return te.default.useEffect((()=>{i().then(r)}),[e,i]),n},this.useKeyboardBindings=()=>{const e=this.useStore(),{fileViewerId:t}=u.useFileViewerContext(),i=te.default.useCallback((()=>{e&&e.getState().annotationSettings.state&&e.dispatch(UO(t))}),[t,e]);return[Oo({key:a.Key_enum.Key.Escape,callback:i})]},this.handleRegionSelection=(e,i,n,r,o,s,l)=>{if(o)return void i.dispatch(function(e){return{type:NO.ClearDraftAnnotation,payload:{fileViewerId:e}}}(e));if(null==r)return void i.dispatch(UO(e));const c=function(e,t,i){if(null==i)return null;const{regions:n,type:r}=i;return e===a.PreviewType.Image?{type:"image",region:n[0]}:e===a.PreviewType.SsrDoc&&null!=t?{type:"document",regionType:"highlight"===r?"highlight":"rectangle",regions:n.map((e=>Object.assign(Object.assign({},e),{page:Ok(t)})))}:null}(l,s,r);null!=c&&(i.dispatch(function(e,t){return{type:NO.UpdateDraftAnnotation,payload:{fileViewerId:e,annotation:t}}}(e,c)),n({event:t.CommentsEventName.START_ANNOTATION_HIGHLIGHT}))},this.handleAnnotationConfirm=(e,i,a)=>{i.dispatch(FO(e)),a({event:t.CommentsEventName.START_ANNOTATION_TIMESTAMP})},this.highlightMenuOption=({selectedText:e})=>{const t=a.useIntl(),i=PL(),n=Ms(),r=this.useStore(),{fileViewerId:o}=u.useFileViewerContext(),s=te.default.useCallback((()=>{r&&(this.handleRegionSelection(o,r,i,{type:"highlight",regions:e.selectionAreas.map((t=>QT(t,e.page.bounds)))},!1,e.page.pageNumber,n),this.handleAnnotationConfirm(o,r,i))}),[o,i,n,e.page.bounds,e.page.pageNumber,e.selectionAreas,r]);return te.default.createElement(AT,{label:t.formatMessage({id:"DwVkLn",defaultMessage:"Comment on text"}),icon:a.CommentLine,onClick:s})},this.layerUI={Layer:e=>{this.useFetchInitialComments();const t=PL(),i=Ms(),n=this.useStore(),{fileViewerId:r}=u.useFileViewerContext(),o=te.default.useCallback((()=>{n&&this.handleAnnotationConfirm(r,n,t)}),[r,t,n]),s=te.default.useCallback(((e,a,o)=>{n&&this.handleRegionSelection(r,n,t,e,a,o,i)}),[r,t,i,n]),l=Os(),c=DL();return l&&n?te.default.createElement(a.Provider,{store:n},te.default.createElement(mL,Object.assign({},e,{fileViewerId:r,navigationCallbacks:c,file:l,handleAnnotationConfirm:o,handleRegionSelection:s}))):null}},this.commentUI={Header:()=>{const e=Ms(),t=PL(),{fileViewerId:i}=u.useFileViewerContext(),n=this.useStore();return n?te.default.createElement(a.Provider,{store:n},te.default.createElement(ML,{fileViewerId:i,previewType:e,logEvent:t})):null},VideoSeekBarLayer:e=>{const t=this.useStore();return t?te.default.createElement(a.Provider,{store:t},te.default.createElement(OL,Object.assign({},e))):null},CommentIconWithUnreadCount:e=>{this.useFetchInitialComments();const t=this.useStore(),i=so(p.COMMENTS_PLUGIN_ID,a.UserActionContext.UnreadComments);return t?te.default.createElement(a.Provider,{store:t},te.default.createElement(vL,{fileId:e.fileId,sharedLinkURL:e.sharedLinkURL,setCommentsSidebar:i})):null},mediaScrubber:{clickOutsideMarkers:e=>{var t;null===(t=this.storePromise)||void 0===t||t.then((t=>t.dispatch(LO({fileViewerId:e}))))}}},this.sidebarUI={Icon:()=>{const e=Os();if(!(null==e?void 0:e.fileId))return null;const t=this.useStore();return t?te.default.createElement(a.Provider,{store:t},te.default.createElement(vL,{fileId:e.fileId,sharedLinkURL:e.url})):null},Title:()=>{const e=a.useIntl();return te.default.createElement(te.default.Fragment,null,e.formatMessage({id:"extqcT",defaultMessage:"Comments"}))},TitleAccessory:()=>{const e=Os(),t=PL(),i=this.useStore();return(null==e?void 0:e.fileId)&&i?te.default.createElement(a.Provider,{store:i},te.default.createElement(CL,{fileId:e.fileId,sharedLinkURL:e.url,size:"standard",logEvent:t})):null},Content:()=>{this.useFetchInitialComments();const{fileViewerId:e}=u.useFileViewerContext(),i=$r(no,e);Ss(e,a.PreviewsTimer.SidebarContentsMount,{bladeId:p.COMMENTS_PLUGIN_ID},i===p.COMMENTS_PLUGIN_ID);const n=Os(),r=this.useStore();xL(n,r,e,this.shouldFocusComment,this.commentId);const o=Ms(),s=Zy(),l=Xy();te.default.useEffect((()=>()=>{null!=(null==r?void 0:r.getState().annotationSettings.state)&&(null==r||r.dispatch(UO(e)))}),[e,r]);const c=this.useKeyboardBindings(),d=PL();te.default.useEffect((()=>{var e;if(o!==a.PreviewType.Error&&o&&n){const i=null!==(e=n.fqPath)&&void 0!==e?e:n.name;d({event:t.CommentsEventName.VIEW_COMMENTS,extra:{previewType:o,filename:n.name,fq_path:i}})}}),[n,o,d]);const _=a.useIntl(),g=DL(),f=Ps();return n&&r?te.default.createElement(a.Provider,{store:r},te.default.createElement(Do,{name:"comment_plugin",keyboardBindings:c}),te.default.createElement(AL,{fileViewerId:e,file:n,previewType:o,docUi:s,audioVideoUi:l,navigationCallbacks:g,user:this.user,intl:_,reportException:this.reportException,logEvent:d,sharedLinkInfo:f})):null}},this.useFetchInitialComments=()=>{var e;const t=Os(),i=Ps(),a=this.useStore(),n=null===(e=this.user)||void 0===e?void 0:e.id,r=te.default.useCallback((()=>{if(!a||!t)return;this.hasAttemptedFetchingInitialCommentsForFileId.add(t.fileId);const e=t.url||(null==i?void 0:i.url)||void 0;if(e){const t={include_permissions:!0,stream:{identifier:{".tag":"shared_link_details",url:e},type:{".tag":"file"}}};n?a.dispatch(aO({arg:t})):a.dispatch(_O({arg:t}))}else a.dispatch(aO({arg:{include_permissions:!0,stream:{identifier:{".tag":"file_path_or_id",file_path_or_id:t.fileId},type:{".tag":"file"}}}}))}),[t,null==i?void 0:i.url,a,n]);te.default.useEffect((()=>{t&&!this.hasAttemptedFetchingInitialCommentsForFileId.has(t.fileId)&&r()}),[r,t])},this.apiV2Client=e,this.user=n,this.reportException=r,this.commentId=null==o?void 0:o.commentId,this.shouldFocusComment=null!==(s=null==o?void 0:o.shouldFocusComment)&&void 0!==s&&s,this.commentsPlatformAdapter=i}}const NL={client:null,subscribe({app_id:e,revision:t,token:i,unique_id:a},n,r){const o=new C.SignedChannelState(e,a,t,i);NL.client?NL.client.update_states([o]):(NL.client=new C.MetaserverBoltClient([o],n,r),NL.client.start())},unsubscribe(){NL.client&&(NL.client.unsubscribe(),NL.client=null)}};function kL(e){return{id:e.dbx_account_id,email:e.email,name:{display:e.name,initials:a.getInitials(e.name),public:a.getShortName(e.name)},photoUrl:e.photo_url||e.avatar_url}}class LL{constructor(e,t=!1){this.cache={},this.filterContact=e=>{const t=!!e.group_id,i=!this.allowMentionSelf&&e.email===this.user.email;return!(t||i)},this.updateCache=(e,t,i)=>{let a;const n=t.map(kL);if(i){a=[...this.cache[e]||[],...n]}else a=n;return this.cache=Object.assign(Object.assign({},this.cache),{[e]:a}),this.cache},this.user=e,this.allowMentionSelf=t,this.dataSource=new IS(e,this.filterContact)}query(e,t,i){this.dataSource.search(e,(i=>{t(this.updateCache(e,i,!1))}),(a=>{(i||t)(this.updateCache(e,a,!0))}))}getMatchesWithStarterSuggestions(){const e=wS.getAll(this.user).filter(this.filterContact).map(kL),t=w.sortBy(e.slice(0,50),(e=>e.name||e.email));return this.cache=Object.assign(Object.assign({},this.cache),{"":t}),this.cache}}function FL(e){let t;if(e){let i=null;const a=()=>{const t=function(e,t){return e?new LL(e,t):{cache:{},query:()=>{},getMatchesWithStarterSuggestions:()=>({})}}(e);return{search(e,i){0!==e.length?t.query(e,i):i(t.getMatchesWithStarterSuggestions())}}};t=()=>(i||(i=a()),i)}return{boltIOClient:(e=>{let t=e=>{};return{subscribe:i=>(i.forEach((i=>{e.subscribe(function({channelId:e,revisionInfo:t}){return{app_id:e.appId,unique_id:e.uniqueId,revision:t.revision.toString(),token:t.token}}(i),t,t)})),Promise.resolve()),unsubscribe:()=>Promise.resolve(e.unsubscribe()),onSignal:e=>{t=t=>{const i=t.map((e=>function(e){var t;return{channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:parseInt(null!==(t=e.revision)&&void 0!==t?t:"",10),token:e.token}}}(e)));e({updatedChannels:i})}}}})(NL),mentionsIOClient:t}}const UL=e=>{h.reportException({err:e,force:!0,tags:["comments-blade-previews"]})},VL=({apiV2Client:e,previewSurface:t,fileName:i,commentsPluginInitialParams:n,user:r})=>{const o=te.default.useMemo((()=>{const i=FL(r),o=r?function(e){return{id:e.account_id,userId:e.id,name:{display:e.display_name,initials:a.getInitials(e.display_name),public:a.getShortName(e.display_name)},photoUrl:e.photo_circle_url}}(r):void 0;if(!c.is_supported_mobile_browser()&&t!==a.SDKPreviewSurface.BACKUP&&t!==a.SDKPreviewSurface.SHARED_COLLECTION)return new RL({apiV2Client:e,commentsPlatformAdapter:i,user:o,reportException:UL,commentsPluginInitialParams:n})}),[e,n,t,r]);return te.default.useMemo((()=>{if(function(e){return u.resolvePreviewTypeFromExtension(u.getFileExtension(e))!==a.PreviewType.CloudDoc}(i))return o}),[o,i])},jL=[a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.SHARED_LINK_EMBED,a.SDKPreviewSurface.SHARED_CONTENT_LINK,a.SDKPreviewSurface.SHARED_COLLECTION,a.SDKPreviewSurface.INBAND_SHARE],BL=(e,i,r,o,d,u,_,p,g,f,m,v,S,E,w,b,y,T,C,A,M,O,P=!1,x=!1,D=!0,R=!1,N,k,L,F,U,V,j,B,H,K,z,W,G)=>{const q=f?()=>{f(),a.isAudioPreview(r().file)?a.UserSurvey.trackEvent("audio_preview_viewed","previews"):a.isVideoPreview(r().file)&&a.UserSurvey.trackEvent("video_preview_viewed","previews")}:void 0,Q=(e,t)=>window.open(e||t,"_blank");let Y={};const $=S?new a.DefaultUserApiV2Client(S):new s.NoAuthApiV2Client;a.UserSurvey.addAttribute("DIGTheme",p),c.is_supported_mobile_browser()||a.UserSurvey.trackEvent("preview_viewed","previews");const Z=r().file;let X;a.isSharedFile(Z)&&setTimeout((()=>{a.trackReceiverUserLeapEvent(a.ReceiverUserLeapEvent.VIEWED_SHARED_FILE)}),5e3);const J=yd($),ee=Wa(Z.revision_id,S),te=a.fileViewerFeatureExperiments.fileActivityDiscoverability;switch(a.UserSurvey.addAttribute("fileActivityDiscoverabilityVariant",te),i){case a.SDKPreviewSurface.BROWSE:case a.SDKPreviewSurface.HOME:case a.SDKPreviewSurface.HELLOSIGN:case a.SDKPreviewSurface.SEARCH:case a.SDKPreviewSurface.RECENTS:case a.SDKPreviewSurface.STARRED:case a.SDKPreviewSurface.STANDALONE_PREVIEW:case a.SDKPreviewSurface.PHOTOS:case a.SDKPreviewSurface.VIDEO_SYNTHESIS:case a.SDKPreviewSurface.FILE_LOCKING:case a.SDKPreviewSurface.BACKUP:case a.SDKPreviewSurface.VIDEO_HOME:if(!S)throw new Error("Must be logged in to browse");X=function(e,t,i,r){return{rename:({newFilename:i,isRenameFromOverflowMenu:o,onRenameSuccess:s,onRenameFailed:l})=>n.__awaiter(this,void 0,void 0,(function*(){const{file:n}=t();if(!a.isBrowseFile(n))return;const o=a.isRenameValid(i,a.getExtension$1(n));let c;if(o&&(ut(a.PREVIEWS_SNACKBAR_ID),c=yield a.renameFile(n.fq_path,i,e.id,{checkFSWs:!0})),!c||c.isError||"success"!==c.result.entries[0][".tag"])return l(),void pt(o?(null==c?void 0:c.isError)?c:a.createUndefinedRpcResult():Object.assign(Object.assign({},a.createUndefinedRpcResult()),{error:{".tag":"to",to:{".tag":"malformed_path",malformed_path:{}}}}),n.fq_path,a.PREVIEWS_SNACKBAR_ID);const d=c.result.entries[0].success;r&&d&&"file"===d[".tag"]&&r(n,{fq_path:d.path_display||n.fq_path,revision_id:d.rev,file_id:d.id}),s(),_t(a.PREVIEWS_SNACKBAR_ID)})),delete:({onDelete:i,onDeleteSuccess:n,onDeleteFailed:o,onDeleteFailedNoPermission:s,onDeleteCancel:c,setDeleteFileModalOpen:d})=>{const{file:u}=t();if(!a.isBrowseFile(u)||ct(u)||!st(u))return;if(i(),u.read_only)return a.Snackbar$1.warn(l.intl.formatMessage({id:"szm+5q",defaultMessage:"You don't have permission to make changes to this file"}),a.PREVIEWS_SNACKBAR_ID),void s();const _={file_id:u.file_id,is_dir:u.is_dir};tt({user:e,filesPath:[_],fq_path:u.fq_path},{onNetworkRequest:()=>at(a.PREVIEWS_SNACKBAR_ID),onSuccess:()=>{nt(a.PREVIEWS_SNACKBAR_ID),r&&r(u),n()},onError:e=>{rt(e,a.PREVIEWS_SNACKBAR_ID),o()},onRequestClose:()=>{c()},setDeleteFileModalOpen:d})}}}(S,r,0,L),Y={fileSystemClient:Ut(S,r,{allowCopyToDropbox:!1,shareToken:d,encryptionOptions:O,authModalKind:k,webSignInTag:K}),fullScreenClient:Gt(T),printClient:qt(),navigationClient:$t(q,w,b,A,Q),fileActionsClient:X,urlClient:ei(S),preferencesClient:ee,flowsClient:J,stormcrowClient:Hy(S)};break;case a.SDKPreviewSurface.VERSION_HISTORY:if(!S)throw Error("user required for version history");Y={fileSystemClient:void 0,fullScreenClient:Gt(T),printClient:qt(),navigationClient:Zt(q,w,b,Q),urlClient:ei(S),preferencesClient:ee,stormcrowClient:Hy(S)};break;case a.SDKPreviewSurface.SHARED_LINK:Y={fullScreenClient:Gt(T),printClient:qt(),navigationClient:Yt(q,w,b,o,Q),urlClient:ei(S),fileSystemClient:Ut(S,r,{allowCopyToDropbox:!0,shareToken:d,encryptionOptions:O,sharePermission:g,authModalKind:k,webSignInTag:K}),preferencesClient:ee,flowsClient:J,stormcrowClient:Hy(S)};break;case a.SDKPreviewSurface.SHARED_LINK_EMBED:case a.SDKPreviewSurface.TRANSFER:Y={fullScreenClient:Gt(T),printClient:qt(),urlClient:ei(S),fileSystemClient:Ut(S,r,{allowCopyToDropbox:!0,shareToken:d,encryptionOptions:O,sharePermission:g,authModalKind:k,webSignInTag:K}),navigationClient:Xt(void 0,void 0,void 0,Q)};break;case a.SDKPreviewSurface.SHARED_COLLECTION:Y={fullScreenClient:Gt(T),printClient:qt(),urlClient:ei(S),fileSystemClient:Ut(S,r,{allowCopyToDropbox:!0,shareToken:d,encryptionOptions:O,sharePermission:g,authModalKind:k,webSignInTag:K}),navigationClient:Xt(f,w,b,Q),stormcrowClient:Hy(S)};break;case a.SDKPreviewSurface.SHARED_CONTENT_LINK:case a.SDKPreviewSurface.INBAND_SHARE:Y={fileSystemClient:Ut(S,r,{allowCopyToDropbox:!0,shareToken:d,encryptionOptions:O,sharePermission:g,authModalKind:k,webSignInTag:K}),fullScreenClient:Gt(T),printClient:qt(),navigationClient:Yt(q,w,b,o,Q),urlClient:ei(S),preferencesClient:ee,flowsClient:J,stormcrowClient:Hy(S)}}const ie={logTTI:()=>(e=>{const t=a.get_timer(e);t.markTimeToInteractive(),e&&t.end()})(U),log:Ma(i,r),logDuration:Oa,logVideoEvent:(e,n)=>{var o,s;const l=r().file;switch(La(l,i,e,n),e){case t.VideoPreviewEvent.TimeToLoad:a.isAudioPreview(l)?(n.video_duration_seconds&&a.UserSurvey.addAttribute("audioPreviewLength",a.bucketLengthForUserSurvey(n.video_duration_seconds)),a.UserSurvey.addAttribute("audioPreviewType",a.getExtension$1(l)),a.UserSurvey.addAttribute("isAudioPreviewFinished","false")):(n.video_duration_seconds&&a.UserSurvey.addAttribute("videoPreviewLength",a.bucketLengthForUserSurvey(n.video_duration_seconds)),a.UserSurvey.addAttribute("videoPreviewType",a.getExtension$1(l)),a.UserSurvey.addAttribute("isVideoPreviewFinished","false"),a.UserSurvey.addAttribute("videoPreviewResolution","auto"));break;case t.VideoPreviewEvent.ChangeVideoQuality:(null===(o=n.extra)||void 0===o?void 0:o.new_video_quality)&&a.UserSurvey.addAttribute("videoPreviewResolution",n.extra.new_video_quality);break;case t.VideoPreviewEvent.MediaEnded:a.isAudioPreview(l)?(a.UserSurvey.addAttribute("isAudioPreviewFinished","true"),a.UserSurvey.trackEvent("audio_preview_viewed","previews")):(a.UserSurvey.addAttribute("isVideoPreviewFinished","true"),a.UserSurvey.trackEvent("video_preview_viewed","previews"));break;case t.VideoPreviewEvent.VideoPlaybackSmoothness:(null===(s=n.extra)||void 0===s?void 0:s.num_stalls_per_second_playback)&&a.UserSurvey.addAttribute("videoPreviewNumberOfStallsPerSecondPlayback",n.extra.num_stalls_per_second_playback)}},logVideoEventQuantity:ka,logVideoEventDuration:Fa},ae={intl:l.intl,apiV2Client:$,logger:ie,optionalIOClients:Object.assign(Object.assign({},Y),{showAuthModal:o,cloudDocsClient:S?_i(S,r,d,e.google_editor_deprecation_date):void 0,reportExceptionClient:{reportException:(e,t,i)=>h.reportException({err:e,severity:i?"critical":"non-critical",tags:["file-viewer",t],force:!0})}}),callbacks:{onRenderSucceeded:()=>{const t=r().file,n=a.isBrowseFile(t)?a.file_extension(t.fq_path):a.file_extension(t.filename);a.emitPageLoaded(I.CampaignPageName.PREVIEW,{file_extension:n,file_name:a.getFilename(t),file_path:a.isSharedFile(t)?t.href:t.fq_path,file_id:t.file_id,ungatedDropboxAiVariant:a.fileViewerFeatureExperiments.acqSusiUngatedDropboxAiVariant,source_context:G},{disableCampaigns:!!z}),E&&function(e,t,i,a){if(0===e.length)return;const n=[];[1,2,3,4,5,6,-1,-2].forEach((function(i){const a=(t+i+e.length)%e.length;-1===n.indexOf(a)&&n.push(a)})),n.forEach((function(t){if(e.length>t&&t>0){const n=e[t];Vc(i,n,a)}}))}(E,_,e),c.is_supported_mobile_browser()&&(a.UserSurvey.trackEvent("mobile_web_preview_viewed","previews"),i===a.SDKPreviewSurface.SHARED_LINK&&a.UserSurvey.trackEvent("mobile_web_receiver_preview_viewed","previews"))},onPreviewSessionInitialized:e=>{C&&C(e)}},initData:{accountId:S?S.account_id:void 0,deviceType:a.getDeviceType()},featureConfig:e,platformConfig:{osModifierKey:c.mac?"metaKey":"ctrlKey"},fileViewerId:F},ne={authModalKind:k,browseContext:m,browseExceptions:v,canRestoreRevision:N,encryptionOptions:O,featureConfig:e,fileActionsClient:X,getActiveFile:r,previewContentOnly:P,isSendForSignatureEnabled:V,userHasDmtConflict:j,shouldDisableFeaturesIfTeamSuspended:B,onFileChanged:L,onRestoreRevision:y,setIsPdfEditorActive:u,sharePermission:g,shareToken:d,user:S,commentsPluginInitialParams:W,fileName:a.getFilename(Z)};return Object.assign(Object.assign({},ae),{pluginArgs:ne})},HL=(e,t,i,n,r,o,s,l,c,d,u,_,g,f,m,h,v)=>{const S=a.parseTimeRangeFromUrl();let E,w={};if(f||g&&a.isEditModeActive()){const t=f?f.source:s.getQueryStringParameter("source"),i=Bu();if(Mg(e)&&"watermark"===(null==f?void 0:f.source))E=xg;else if(qa(e,c,a.fileViewerFeatureExperiments.signNonPdfInPdfEditorVariant,!0,t))(null==i?void 0:i.initialAction)&&ju(i.initialAction)&&(w={source:"preview_ungated_pdf_editor"}),E=p.PDF_EDITOR_PLUGIN_ID;else if(Ya(e,c))w={initialAction:(null==i?void 0:i.initialAction)||(null==f?void 0:f.initialEditAction)},E=p.PHOTO_EDITOR_PLUGIN_ID;else if(zg({featureConfig:m,file:e,sharePermission:c,user:g})){w={initialEditAction:(null==i?void 0:i.initialAction)||(null==f?void 0:f.initialEditAction)},E=p.VIDEO_EDITOR_PLUGIN_ID}}const b=null==m?void 0:m.sharing_receiver_quick_react;let y;return b&&"desktop"===a.getDeviceType()&&(a.logStormcrowExposure("sharing_receiver_quick_react",b,null==g?void 0:g.id),y="ON"===b?p.COMMENTS_PLUGIN_ID:void 0),d||u||v===p.COMMENTS_PLUGIN_ID?y=p.COMMENTS_PLUGIN_ID:new URL(window.location.href).searchParams.get("ai_blade_start_open")||v===p.AI_PLUGIN_ID?y=p.AI_PLUGIN_ID:v===p.TRANSCRIPT_BLADE_PLUGIN_ID&&(y=p.TRANSCRIPT_BLADE_PLUGIN_ID),{fileInfo:{file_id:e.file_id,ns_id:e.ns_id,sj_id:e.sjid,url:null==l?void 0:l.url},fileMetadata:{file_id:e.file_id,file_name:a.getFilename(e),file_path:a.isBrowseFile(e)?e.fq_path:void 0,file_last_modified_date:e.ts?new Date(1e3*e.ts).toISOString():void 0,file_collection_context:{file_index:i,parent_files_count:n},size:e.bytes,revisionId:e.revision_id,timeRange:S,readOnly:!a.isBrowseFile(e)||!!e.read_only},previewMetadata:e.preview,fileConfig:t,sharedLinkInfo:l&&Object.assign(Object.assign({},l),{hasPublicAudienceOrVisibility:!!l.hasPublicAudienceOrVisibility,isSameTeam:(null==g?void 0:g.team_name)===l.ownerTeamName}),sourceSession:{source_context:r,page_start_ts:performance.timing.navigationStart,was_flipped:o},pluginParams:{shouldFocusComment:d,commentId:u,editActivationParams:Object.assign(Object.assign({},f),w),activeEditPlugin:E},defaultUi:{defaultRightSidebar:y,defaultLeftSidebar:h},brandingInfo:null!=_?_:{},isLoggedIn:!!g}},KL=(e,t,i,n,r)=>{const o=[];if(e){const{canCopyToDropboxRoles:s}=e;if(s.length>0){const s=a.getToDropboxOption(e,t,i,n,void 0,r);o.push({text:s.text,isDisabled:s.isDisabled,role:s.role})}}return o},zL=t=>{const{file:i,sharedLinkInfo:r,sharePermission:s,shareToken:l,brandingInfo:d,user:_,previewSurface:g,encryptionOptions:f,closeFile:m,flipToNextFile:h,flipToPreviousFile:v,previewCollection:S,updateFiles:w,fileIndex:b=0,fileCount:y=1,passSessionId:T,previewContentOnly:I=!1,transparentBackground:C=!1,showCloudDocPreview:A=!0,onPreviewSessionInitialized:M,onRestoreRevision:O,onFullscreenChange:P,canRestoreRevision:x,canShowFileFlippers:D,authModalKind:R,containerId:N,onFileChanged:k,fileViewerId:L,sourceContext:F,ajaxTimerName:U,implicitTOSVariant:V,shouldFocusComment:j,editActivationParams:B,defaultLeftSidebarPluginId:H,defaultRightSidebarPluginId:K}=t,[z,W]=te.default.useState(!1),G=te.default.useCallback((()=>{W(!0)}),[]),q=a.getWebSignInTag(void 0!==_&&g===a.SDKPreviewSurface.INBAND_SHARE,!!(null==s?void 0:s.isSharedFolder)),Q=te.default.useMemo((()=>({file:i,sharedLinkInfo:r,sharePermission:s,shareToken:l,encryptionOptions:f})),[i,r,s,l,f]),Y=te.default.useRef(Q),$=te.default.createRef(),Z=te.default.useCallback((()=>Y.current),[]),X=te.default.useMemo((()=>N&&document.getElementById(N)||void 0),[N]),J=a.useSelector((e=>!!_&&_d(e))),ee=a.useSelector((e=>!!_&&!!pd(e))),ie=a.useSelector((e=>!!_&&gd(e))),[ae,ne]=te.default.useState(!1),{browseContext:re,browseExceptions:oe}=(e=>e.previewSurface===a.SDKPreviewSurface.BROWSE?{browseContext:e.browseContext,browseExceptions:e.browseExceptions}:{})(t),se=te.default.useCallback((e=>bt(Object.assign(Object.assign({},e),{encryptionOptions:f,implicitTOSVariant:V,loggingExtra:Object.assign({signup_source:"file_preview_unlabeled_event"},e.loggingExtra),webSignInTag:q,onCancel:()=>{var t;null===(t=e.onCancel)||void 0===t||t.call(e)}}))),[f,V,q]),le=te.default.useMemo((()=>((e,t,i,n,r)=>{const o=mt();return Object.assign(Object.assign({},o),{annotations:a.DROPBOX_BROWSE_SURFACES.includes(e),file_flipping:t,mobile_web:c.is_supported_mobile_browser(),preview_content_only:i,transparent_background:n,show_cloud_doc_preview:r})})(g,D,I,C,A)),[D,I,g,A,C]),ce=c.is_mobile_or_tablet(),de=ce?"OFF":a.fileViewerFeatureExperiments.vishSurfaceLevelSusiVariant,ue=te.default.useMemo((()=>"true"===sessionStorage.getItem("has_seen_sls")),[]),_e=["V1","V2","V3"].includes(de)&&Boolean(!_&&a.isSharedFile(i)&&r&&l),pe=te.default.useMemo((()=>!_e&&Ry({previewSurface:g,previewContentOnly:I,isMobile:ce,fileViewerFeatureExperiments:a.fileViewerFeatureExperiments,isEditMode:!!t.editActivationParams,logExposure:!0,user:_,sourceContext:F})),[_,i,ce,g,I,t.editActivationParams,F,_e]),ge=a.useTheme().theme,fe=te.default.useMemo((()=>({shouldFocusComment:j,commentId:nn()})),[j]),me=te.default.useMemo((()=>BL(le,g,Z,se,l,ne,b,ge,s,m,re,oe,_,S,h,v,O,P,M,w,0,f,I,C,A,D,x,R,k,L,U,J,ee,ie,(e=>{(e.previewSurface===a.SDKPreviewSurface.SHARED_LINK||e.previewSurface===a.SDKPreviewSurface.SHARED_CONTENT_LINK)&&e.outOfQuota})(t),q,pe,fe,F)),[_,g,k]),he=te.default.useRef(null),ve=te.default.useMemo((()=>{var e;const t=null===(e=Y.current)||void 0===e?void 0:e.file,n=t&&a.isBrowseFile(t)&&a.isBrowseFile(i),o=n&&t.file_id===i.file_id&&a.sameTimeRangeFromHref(t.href,i.href);if(he.current&&(ae||o))return!n||t.fq_path===i.fq_path&&t.href===i.href||(Y.current.file=i),he.current;Y.current={file:i,sharedLinkInfo:r,sharePermission:s,shareToken:l,encryptionOptions:f};const c=((e,t,i,n,r,o,s,l,c)=>{if(a.isSharedFile(t))return{download_button:{enable_download_button:!i,can_download:!!n&&a.isDownloadAllowed(n),copy_targets:KL(n,r,t,o,c)},enable_print:Qt(n),enable_view_on_dropbox_button:!1,canEdit:!1};{const n=!!s&&!s.isCurrentPathWriteable();return{download_button:{enable_download_button:!i,can_download:!0,copy_targets:[]},enable_print:!0,enable_view_on_dropbox_button:!1,canEdit:!(t.read_only||n||e===a.SDKPreviewSurface.VIDEO_SYNTHESIS)}}})(g,i,I,s,l,f,re,0,_);return HL(i,c,b,y,F,!1,me.optionalIOClients.urlClient||ei(_),r,s,j,fe.commentId,d,_,B,me.featureConfig,H,K)}),[i]);he.current=ve;const Se=a.getFilename(i);CT({userId:null==_?void 0:_.id,queryClient:o.queryClient,initializeOpts:ve,featureConfig:me.featureConfig,apiV2Client:me.apiV2Client,filename:Se,bytes:i.bytes,logger:{logDuration:()=>{var e;return Promise.resolve(null===(e=me.logger)||void 0===e?void 0:e.logDuration)},tags:hr(ve)}}),te.default.useEffect((()=>{if(g!==a.SDKPreviewSurface.VERSION_HISTORY)return Array.from(document.querySelectorAll($a)).forEach((e=>{e.style.display&&e.setAttribute(Za,e.style.display),e.style.display="none"})),Xa}),[]),te.default.useEffect((()=>{if(_&&a.shouldShowWelcomeModal(_,F)){const t=t=>n.__awaiter(void 0,void 0,void 0,(function*(){const[{Modal:i},{WelcomeModal:a}]=yield Promise.all([new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.modal_esnext})),new Promise((function(t,i){e(["./c_modals_welcome_modal"],t,i)}))]);i.showInstance(te.default.createElement(a,{user:t}))}));t(_)}}),[_]),te.default.useEffect((()=>{const e=document.title;return()=>{document.title=e}}),[]),te.default.useEffect((()=>{document.title=Se}),[Se]),te.default.useEffect((()=>{const e=a.Snackbar$1.manager;a.Snackbar$1.manager=$.current;const t=E.key.getScope();return E.key.setScope("fvsdk_scope"),a.scroll_lock_document(),()=>{a.scroll_unlock_document(),E.key.setScope(t),a.Snackbar$1.manager=e}}),[]);const Ee=te.default.useRef(null),we=te.default.useCallback((e=>{Ee.current=e;const t=["dragenter","dragover","dragleave","drop"],i=e=>{e.stopPropagation(),e.preventDefault()};for(const a of t)null==e||e.addEventListener(a,i)}),[]),be=te.default.useMemo((()=>({onHide:e})=>te.default.createElement(an,{activePreviewFile:Q,user:_,onHide:e})),[i,_]),ye=g===a.SDKPreviewSurface.SHARED_LINK||g===a.SDKPreviewSurface.SHARED_CONTENT_LINK||g===a.SDKPreviewSurface.SHARED_COLLECTION,Te=a.isEncryptedFile(Q.file),Ie=en(le),Ce=te.default.useMemo((()=>Ie?te.default.createElement(ld,{activePreviewFile:Q,webSignInTag:q,user:_}):te.default.createElement(od,{user:_,isSharedLink:ye,isEncrypted:Te,activePreviewFile:Q,authModalKind:R,browseContext:re,onFileChanged:k,webSignInTag:q})),[_,Q,Ie]),Ae=te.default.useMemo((()=>!Te&&(Ie?te.default.createElement(nd,{activePreviewFile:Q,user:_,webSignInTag:q}):te.default.createElement(id,{user:_,isSharedLink:ye,activePreviewFile:Q,authModalKind:R,webSignInTag:q}))),[_,Q]),Me=te.default.useMemo((()=>Object.assign(Object.assign({},u.DEFAULT_FILE_CONFIG),ve.fileConfig)),[ve.fileConfig]);te.default.useEffect((()=>{!function(t){n.__awaiter(this,void 0,void 0,(function*(){const[{isModalDisplayed:i},{GSIEventManager:n}]=yield Promise.all([new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.modal_controller_esnext})),new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.lib_esnext}))]);!i()&&n.getGSIState().isPromptClosed&&t&&a.logStormcrowExposure("vish_surface_level_susi",de)}))}(Boolean(!_&&a.isSharedFile(i)&&r&&l&&!ue))}),[]);const Oe=te.default.useCallback((({modalPositionValues:e,authTag:t,isEnabled:n})=>{wt(a.isSharedFile(i),_,r,l,n,[{signupTag:t,webSignInTag:t,kind:a.LoginOrRegisterKind.SURFACE_LEVEL_PREVIEW,encryptionOptions:f,implicitTOSVariant:V,sharedLinkUrl:null==r?void 0:r.url,mode:a.AuthMode.REGISTER,modalPositionValues:e}])}),[f,l,i,V,r,_]),Pe=te.default.useMemo((()=>"V1"!==de||z?null:te.default.createElement(a.SignUpBannerFilePreview,{handleSUSIClick:()=>bt({signupTag:a.RegistrationSource.SHARED_FILE_BANNER_REGISTER,webSignInTag:a.RegistrationSource.SHARED_FILE_BANNER_REGISTER,kind:a.LoginOrRegisterKind.SURFACE_LEVEL_PREVIEW,encryptionOptions:f,implicitTOSVariant:V,sharedLinkUrl:null==r?void 0:r.url,mode:a.AuthMode.REGISTER}),sharedLinkInfo:r,shareToken:l,vishSurfaceLevelSusiVariant:de,isFile:!0,onClose:G,isSharedFile:a.isSharedFile(i),user:_,hasAlreadySeenSls:ue})),[i,_,l,r,G,z,V,f]);te.default.useEffect((()=>{Oe({modalPositionValues:{right:"20px",bottom:"20px"},authTag:a.RegistrationSource.SHARED_FILE_SURFACE_LEVEL_PREVIEW,isEnabled:"V2"===de&&!ue})}),[]);const xe=te.default.createElement(a.SurfaceLevelFileAuthDrawer,{onAuthButtonClick:()=>Oe({authTag:a.RegistrationSource.SHARED_FILE_SURFACE_LEVEL_PREVIEW,isEnabled:"V3"===de}),user:_,isSharedFile:a.isSharedFile(i),shareToken:l,sharedLinkInfo:r,surfaceLevelVariant:ue?"OFF":de}),De=te.default.useMemo((()=>{if(_)return e=>te.default.createElement(dd,Object.assign({user:_,apiv2ClientBase:me.apiV2Client},e))}),[_]),Re=Oy({file:i,user:_,shareToken:l,featureConfig:le,sourceContext:F});((e,t,i,a)=>{te.useEffect((()=>{const n={file_views:[{file_info:{file_identifier:t,shared_link_details:i?{url:i.url}:void 0},platform_type:{".tag":"web"}}]};a?Hm(e).rpc("log_file_view",n,{}):Hm(e).rpc("logged_out/log_file_view",n,{})}),[e,t,a,i])})(me.apiV2Client,i.file_id,r,!!_);const Ne=gy({user:_,previewSurface:g,passSessionId:T,pluginArgs:me.pluginArgs,activePreviewFile:Q,showAuthModal:se,fileConfig:Me,hasOpenInActions:Re,previewContentOnly:I,sharedLinkInfo:r,shareToken:l,showTour:pe,skipPreviewTourModal:t.skipPreviewTourModal,userHasDmtConflict:ee,isSendForSignatureEnabled:J,shouldDisableFeaturesIfTeamSuspended:ie,previewTourVariant:t.previewTourVariant}),{previewTour:ke}=Ne,Le=n.__rest(Ne,["previewTour"]),Fe=(({previewSurface:e,passSessionId:t,pluginArgs:i,fileConfig:a,hasOpenInActions:n})=>te.default.useMemo((()=>({previewSurface:e,passSessionId:t,pluginArgs:i,fileConfig:a,hasOpenInActions:n})),[e,t,i,a,n]))({pluginArgs:me.pluginArgs,passSessionId:T,hasOpenInActions:Re,previewSurface:g,fileConfig:Me}),Ue=bT({user:_,file:i,sharePermission:s,featureConfig:me.featureConfig,previewSurface:g,setIsPdfEditorActive:ne,onFileChanged:k,apiV2Client:me.apiV2Client,encryptionOptions:f,sharedLinkInfo:r}),Ve=VL({apiV2Client:me.apiV2Client,previewSurface:g,fileName:a.getFilename(i),commentsPluginInitialParams:fe,user:_}),je=(({user:e,apiv2Client:t,previewSurface:i,file:a,comments:n,sharePermission:r,sharedLinkInfo:o})=>{const s=qA(e,i,a),l=YA(e,a),d=$A(t,i,e,a,r,o),u=ZA(i,a);return te.default.useMemo((()=>c.is_supported_mobile_browser()?void 0:{[p.FILE_ACTIVITY_PLUGIN_ID]:s,[p.INFO_BLADE_PLUGIN_ID]:l,[p.AI_PLUGIN_ID]:d,[p.TRANSCRIPT_BLADE_PLUGIN_ID]:u,[p.COMMENTS_PLUGIN_ID]:n}),[d,n,s,l,u])})({user:_,apiv2Client:me.apiV2Client,previewSurface:g,file:i,sharedLinkInfo:r,sharePermission:s,comments:Ve}),Be=mI({featureConfig:me.featureConfig,file:i,user:_,comments:Ve});return te.default.createElement(Om,{value:Fe},te.default.createElement("div",{ref:we,id:"fvsdk_container",className:a.cx("_fvsdk-container_amzuv_5",{"_fvsdk-embed-viewport_amzuv_16":!!X})},te.default.createElement(a.SnackbarManager,{ref:$,getParentElement:()=>Ee.current}),xe,te.default.createElement(eM,{file:i,user:_}),te.default.createElement(Wc,Object.assign({},me,{id:a.FVSDK_MOUNT_POINT,initializeOpts:ve,editors:Ue,textHighlighters:Be,comments:Ve,components:Object.assign({header:be,mobileFooter:Ae,mobileHeader:Ce,fileSaver:De,banner:!le.preview_content_only&&Pe},Le),sidebars:je})),te.default.createElement(Ja,{file:i,user:_}),ke))};zL.displayName="_FileViewer",zL.displayName="_FileViewer";const WL=()=>{const t=te.default.useContext(GL),i=te.default.useMemo((()=>a.UUID.v4()),[]),r=te.default.useMemo((()=>a.UUID.v4()),[]),[o,s]=te.default.useState(!1),l=jL.includes(t.previewSurface)?t.shareToken:void 0,c=a.useEmitter$2(),d=te.default.useCallback((e=>{a.logInterstitialEventToAmp(e,"file_viewer")}),[]),u=te.default.useCallback((()=>{s(!0),t.onMobileInterstitialDismissed&&t.onMobileInterstitialDismissed()}),[s]),_="open_in_app_data"in t.file&&t.file.open_in_app_data&&!o&&!t.hideOpenInAppInterstitial,p=sessionStorage.getItem("has_seen_interstitial");return te.default.useEffect((()=>{if(!p&&_&&sessionStorage.setItem("has_seen_interstitial","true"),p&&_&&!t.user){(()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{GSIEvent:t,GSIEventManager:i}=yield new Promise((function(t,i){e(["./e_folder_viewer_src_main"],t,i)})).then((function(e){return e.lib_esnext}));i.getGSIState().gsiInitComplete?i.sendGSIEvent(t.SHOW_PROMPT):i.createGSIEventListener(t.GSI_INIT_COMPLETE,(()=>i.sendGSIEvent(t.SHOW_PROMPT)))})))()}}),[_,p,t.user]),"open_in_app_data"in t.file&&_&&"true"!==sessionStorage.getItem("has_seen_interstitial")?te.default.createElement(tn,{file:t.file,filePreviewSessionId:i,fileViewerSessionId:r,onDismiss:u,openInAppData:t.file.open_in_app_data,sharedLinkInfo:t.sharedLinkInfo,fileViewOrigin:t.fileViewOrigin,logUserAction:d,deviceId:t.deviceId,previewShareToken:l,vishMwebInterstitialRedesignVariant:a.fileViewerFeatureExperiments.vishMwebInterstitialRedesignVariant}):(l&&c.select(a.ON_SHARED_FILE_VIEW).emit(null),te.default.createElement(zL,Object.assign({},t,{fileViewerId:r})))};WL.displayName="FileViewerWithInterstitial";const GL=te.default.createContext(null),qL=ne([{path:"*",region:(QL={importer:()=>Promise.resolve({default:WL})},{config:QL,subRegions:YL})}]);var QL,YL;const $L=a.getStoreForFileViewer(),ZL=e=>{a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.SDK_FILE_VIEWER_CODE_START);const t=te.default.useMemo((()=>(By(qL),a.createBrowserRouter(qL))),[true]);return te.default.useEffect((()=>{var t,i,n,r;jL.includes(e.previewSurface)&&(a.Context.defaultValue="share_file_preview",a.Context$1.defaultValue={rlkey:(null===(t=e.shareToken)||void 0===t?void 0:t.rlkey)||null,tkey:(null===(i=e.shareToken)||void 0===i?void 0:i.linkType)===a.SharedLinkType.Shmodel?e.shareToken.linkKey:null,sckey:(null===(n=e.shareToken)||void 0===n?void 0:n.linkType)===a.SharedLinkType.Content?e.shareToken.linkKey:null,subpath:(null===(r=e.shareToken)||void 0===r?void 0:r.subPath)||null})}),[e.shareToken,e.previewSurface]),te.default.createElement(GL.Provider,{value:e},te.default.createElement(a.Provider,{store:$L},te.default.createElement(l.Provider,{value:l.intl},te.default.createElement(o.QueryClientProvider,{client:o.queryClient},te.default.createElement(te.default.Suspense,{fallback:null},te.default.createElement(a.RouterProvider,{router:t}))))))};ZL.displayName="FileViewerWithProvider",ZL.displayName="FileViewerWithProvider";const XL=a.requireCssWithComponent(ZL,["/static/js/file_viewer/index.web-vflVvJL9l.css","/static/js/comments2/index-vflQdvUHu.css","/static/metaserver/static/css/foundation-vflUa3sTx.css","/static/metaserver/static/css/dig-components/index.web-vflzskH5s.css","/static/typescript/component_libraries/dig-experimental/src/index.web-vflMgkV3K.css","/static/metaserver/static/css/dig-illustrations/index.web-vflOTtJG2.css","/static/metaserver/static/css/spectrum/index.web-vfl2Rf6Nf.css","/static/metaserver/static/css/dig/fonts-vflMHuSEC.css","/static/metaserver/static/css/notify-vfl4oJv2S.css"]);XL.displayName="FileViewer";const JL=a.getStoreForFileViewer();function eF(e,t,i){const n=a.getFileRevisionOrHrefId(e);let r=w.find(t,(e=>a.getFileRevisionOrHrefId(e)===n));if(!r){const i=e.file_id;r=w.find(t,(e=>e.file_id===i))}if(!r&&t.length>0&&void 0!==i){let e=i;return i>=t.length&&(e=t.length>1?t.length-1:0),{newFile:t[e],files:t,newIndex:e}}r||(r=e);const o=t.indexOf(r);return-1===o?{newFile:r,files:[r],newIndex:0}:{newFile:r,files:t,newIndex:o}}function tF({file:e,files:t,sharedLinkInfos:i,sharePermissions:a,shareTokens:n,oldIndex:r}){const o=t.filter((e=>!e.is_dir)),{newFile:s,newIndex:l}=eF(e,o,r);return{collection:{file:s,files:o,sharedLinkInfos:i,sharePermissions:a,shareTokens:n},currentIndex:l}}class iF extends te.default.Component{constructor(e){super(e),this.hasFlipped=!1,this.updateFileViewer=()=>{const{file:e}=this.props;this.openFile(e)},this.onFileChanged=(e,t)=>{const i=this.state.collection.files[this.state.currentIndex];if(e.revision_id===i.revision_id&&a.isBrowseFile(i))if(t){const e=a.getUpdatedFile(i,t),n=this.state.collection.files.map(((t,i)=>i===this.state.currentIndex?e:t));this.setState({collection:Object.assign(Object.assign({},this.state.collection),{files:n})})}else{const{newFile:e,newIndex:t}=eF(i,this.state.collection.files,this.state.currentIndex);t<this.state.collection.files.length-1?this.setState({collection:Object.assign(Object.assign({},this.state.collection),{file:e}),currentIndex:t}):this.closeViewer()}},this.handleFlipNext=w.throttle((()=>{const{collection:e,currentIndex:t}=this.state;this.props.onFlipNext&&this.props.onFlipNext();const i=t+1===e.files.length?0:t+1;this.hasFlipped=!0,this.switchFile(i)}),100),this.handleFlipPrevious=w.throttle((()=>{const{collection:e,currentIndex:t}=this.state;this.props.onFlipPrevious&&this.props.onFlipPrevious();const i=0===t?e.files.length-1:t-1;this.hasFlipped=!0,this.switchFile(i)}),100),this.switchFile=e=>{a.PreviewsEventLogger.startLoggingSession();const{collection:t}=this.state,i=t.files[e];this.updatePreviewUrl(i),this.setState({currentIndex:e},(()=>{this.openFile(i)}))},this.closeViewer=()=>{const{onCloseViewer:e}=this.props;e&&e()},this.state=tF(e),a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.COLLECTION_VIEWER_CODE_START),this.setupPreviewUrl(this.props.file),this.updateFileViewer()}componentDidMount(){a.PreviewsEventLogger.mark(a.PreviewsTimingEvents.COLLECTION_VIEWER_MOUNT)}componentDidUpdate(e){if(function(e,t){const{file:i,files:a,sharedLinkInfos:n,sharePermissions:r,shareTokens:o}=e;return i!==t.file||a!==t.files||n!==t.sharedLinkInfos||r!==t.sharePermissions||o!==t.shareTokens}(e,this.props)){const e=this.state.currentIndex,t=this.hasFlipped?this.state.collection.files[e]:this.props.file,i=tF(Object.assign(Object.assign({},this.props),{file:t,oldIndex:e})),a=i.collection.file,n=e!==i.currentIndex,r=t.file_id!==a.file_id,o="fq_path"in t&&"fq_path"in a&&t.fq_path!==a.fq_path;this.setState(i,(()=>{(n||r||o)&&(this.updatePreviewUrl(a),this.openFile(a))}))}}componentWillUnmount(){const{onClose:e}=this.props;e&&e(),this.teardownPreviewUrl()}openFile(e){this.props.openFile(e)}setupPreviewUrl(e){this.props.skipOuterRouting||this.setPreviewUrl(e)}updatePreviewUrl(e){this.props.updatePreviewUrl?this.props.updatePreviewUrl(e):this.setPreviewUrl(e,!1)}teardownPreviewUrl(){this.props.skipOuterRouting||this.setPreviewUrl(null)}setPreviewUrl(e,t=!0){if(this.props.disableRouting)return;const i=r.URI.parse(a.DBHistory.get_url()),n=r.URI.encode_parts(i.getPath());let o=i.removeQuery("select").removeQuery("page");if(null==e)o=o.removeQuery("preview"),o=o.removeQuery("t"),o=o.removeQuery("e");else{const t=a.getFilename(e),i=r.URI.parse(e.href).getQuery();o=o.updateQuery({preview:t,t:null==i?void 0:i.t,e:null==i?void 0:i.e})}const s=o.getQuery();t?a.DBHistory.push_state(n,s,{immediatelyRestoreState:!1}):a.DBHistory.replace_state(n,s)}renderSDKSurface(){var e;const{fileViewOrigin:t,hidePageChrome:i,transparentBackground:n,user:r,browseContext:o,browseExceptions:s,canRestoreRevision:l,onRestoreRevision:c,onFullscreenChange:d,brandingInfo:_,initialPreviewSourceContext:p,shouldFocusComment:g,appDownloadInterstitialDismissed:f,containerId:m,isInsideBackup:h,previewApiDataMap:v,ajaxTimerName:S,updateFiles:E,encryptionOptions:b,editActivationParams:y,skipPreviewTourModal:T,defaultLeftSidebarPluginId:I,defaultRightSidebarPluginId:C}=this.props,{collection:A,currentIndex:M}=this.state,O=w.get(A.sharedLinkInfos,M),P=w.get(A.sharePermissions,M),x=w.get(A.shareTokens,M),D=w.get(A.files,M),R={file_id:D.file_id,ns_id:D.ns_id,sj_id:D.sjid,url:null==O?void 0:O.url};if(D.preview){const e={file_name:a.getFilename(D),size:D.bytes};((e,t,i,a,n)=>{if(!bs(t)){const r=ea(t,n),o=Ji(e,i.file_name,i.size,a);Es(r,o)}})(D.preview,R,e,u.DEFAULT_CONFIG,O)}const N=A.files.map((e=>{var t;const i=a.getFileRevisionId(e);return null===(t=v[i])||void 0===t?void 0:t.data})),k=E?()=>E(A.files,D,!0):void 0;let L=null!==(e=null!=p?p:a.getSourceContext(t))&&void 0!==e?e:a.SourceContext.Unknown;switch(t){case a.FileViewOriginType.BROWSE:case a.FileViewOriginType.VERSION_HISTORY:case a.FileViewOriginType.HOME:case a.FileViewOriginType.HELLOSIGN:case a.FileViewOriginType.PHOTOS:case a.FileViewOriginType.STARRED:case a.FileViewOriginType.RECENTS:case a.FileViewOriginType.SEARCH:case a.FileViewOriginType.VIDEO_SYNTHESIS:case a.FileViewOriginType.VIDEO_HOME:if(!r)throw new Error("User is required to browse files");let e;switch(t){case a.FileViewOriginType.VERSION_HISTORY:e=a.SDKPreviewSurface.VERSION_HISTORY;break;case a.FileViewOriginType.HOME:e=a.SDKPreviewSurface.HOME;break;case a.FileViewOriginType.HELLOSIGN:e=a.SDKPreviewSurface.HELLOSIGN;break;case a.FileViewOriginType.STARRED:e=a.SDKPreviewSurface.STARRED;break;case a.FileViewOriginType.RECENTS:e=a.SDKPreviewSurface.RECENTS;break;case a.FileViewOriginType.SEARCH:e=a.SDKPreviewSurface.SEARCH;break;case a.FileViewOriginType.PHOTOS:e=a.SDKPreviewSurface.PHOTOS;break;case a.FileViewOriginType.VIDEO_SYNTHESIS:e=a.SDKPreviewSurface.VIDEO_SYNTHESIS;break;case a.FileViewOriginType.VIDEO_HOME:e=a.SDKPreviewSurface.VIDEO_HOME;break;default:e=a.SDKPreviewSurface.BROWSE}return(h||a.isBackupBrowse())&&(e=a.SDKPreviewSurface.BACKUP,L=a.SourceContext.Backup),te.default.createElement(te.default.Fragment,null,te.default.createElement(XL,{file:D,fileIndex:M,previewCollection:N,updateFiles:k,fileCount:A.files.length,flipToNextFile:this.handleFlipNext,flipToPreviousFile:this.handleFlipPrevious,sharedLinkInfo:O,sharePermission:P,shareToken:x,brandingInfo:_,user:r,onFileChanged:this.onFileChanged,closeFile:this.closeViewer,previewSurface:e,canRestoreRevision:l,onRestoreRevision:c,onFullscreenChange:d,browseContext:o,browseExceptions:s,previewContentOnly:i,canShowFileFlippers:e===a.SDKPreviewSurface.SEARCH||e===a.SDKPreviewSurface.BROWSE||e===a.SDKPreviewSurface.PHOTOS||e===a.SDKPreviewSurface.VIDEO_SYNTHESIS||e===a.SDKPreviewSurface.VIDEO_HOME,shouldFocusComment:g,hideOpenInAppInterstitial:!!f,fileViewOrigin:t,sourceContext:L,ajaxTimerName:S,encryptionOptions:b,editActivationParams:y,skipPreviewTourModal:T,defaultLeftSidebarPluginId:I,defaultRightSidebarPluginId:C}));case a.FileViewOriginType.SHARED_LINK_PAGE:if(!O||!P||!x)throw new Error("Missing required data to view");return te.default.createElement(te.default.Fragment,null,te.default.createElement(XL,{file:D,fileIndex:M,fileCount:A.files.length,flipToNextFile:this.handleFlipNext,flipToPreviousFile:this.handleFlipPrevious,sharedLinkInfo:O,sharePermission:P,shareToken:x,brandingInfo:_,closeFile:this.closeViewer,previewSurface:a.SDKPreviewSurface.SHARED_LINK,user:r,canShowFileFlippers:p===a.SourceContext.SharedLinkFolder||p===a.SourceContext.SharedLinkCollection,previewContentOnly:i,hideOpenInAppInterstitial:!!f,onFullscreenChange:d,fileViewOrigin:t,sourceContext:L,ajaxTimerName:S,encryptionOptions:b,skipPreviewTourModal:T}));case a.FileViewOriginType.SHARED_CONTENT_LINK_PAGE:if(!O||!P||!x)throw new Error("Missing required data to view");return te.default.createElement(te.default.Fragment,null,te.default.createElement(XL,{file:D,fileIndex:M,fileCount:A.files.length,flipToNextFile:this.handleFlipNext,flipToPreviousFile:this.handleFlipPrevious,sharedLinkInfo:O,sharePermission:P,shareToken:x,brandingInfo:_,closeFile:this.closeViewer,previewSurface:a.SDKPreviewSurface.SHARED_CONTENT_LINK,user:r,canShowFileFlippers:!0,previewContentOnly:i,hideOpenInAppInterstitial:!!f,onFullscreenChange:d,fileViewOrigin:t,sourceContext:L,ajaxTimerName:S,encryptionOptions:b,skipPreviewTourModal:T}));case a.FileViewOriginType.TRANSFER:return te.default.createElement(XL,{file:D,fileIndex:M,fileCount:A.files.length,flipToNextFile:this.handleFlipNext,flipToPreviousFile:this.handleFlipPrevious,sharedLinkInfo:O,sharePermission:P,shareToken:x,brandingInfo:_,closeFile:this.closeViewer,previewSurface:a.SDKPreviewSurface.TRANSFER,user:r,canShowFileFlippers:!1,previewContentOnly:i,transparentBackground:n,hideOpenInAppInterstitial:!!f,containerId:m,onPreviewSessionInitialized:this.props.onPreviewSessionInitialized,onFullscreenChange:d,fileViewOrigin:t,sourceContext:L,ajaxTimerName:S,encryptionOptions:b,skipPreviewTourModal:T});case a.FileViewOriginType.SHARED_COLLECTION:return te.default.createElement(XL,{file:D,fileIndex:M,previewCollection:N,fileCount:A.files.length,flipToNextFile:this.handleFlipNext,flipToPreviousFile:this.handleFlipPrevious,user:r,onFileChanged:this.onFileChanged,closeFile:this.closeViewer,previewSurface:a.SDKPreviewSurface.SHARED_COLLECTION,canRestoreRevision:l,onRestoreRevision:c,onFullscreenChange:d,previewContentOnly:i,canShowFileFlippers:!0,hideOpenInAppInterstitial:!!f,fileViewOrigin:t,sourceContext:L,ajaxTimerName:S,encryptionOptions:b,skipPreviewTourModal:T});default:return a.UDCL$1.track("web_previews/unknown_preview_origin",{detail:{origin:t.toString()}}),te.default.createElement(XL,{file:D,fileIndex:M,fileCount:A.files.length,flipToNextFile:this.handleFlipNext,flipToPreviousFile:this.handleFlipPrevious,sharedLinkInfo:O,sharePermission:P,shareToken:x,brandingInfo:_,user:r,closeFile:this.closeViewer,previewSurface:a.SDKPreviewSurface.UNKNOWN,canRestoreRevision:l,onRestoreRevision:c,onFullscreenChange:d,previewContentOnly:i,canShowFileFlippers:!1,hideOpenInAppInterstitial:!!f,fileViewOrigin:t,sourceContext:L,ajaxTimerName:S,encryptionOptions:b,skipPreviewTourModal:T})}}render(){return te.default.createElement("div",null,this.renderSDKSurface())}}iF.displayName="_FileCollectionViewer";const aF=a.connect(((e,t)=>({previewApiDataMap:a.getApiDataForFiles(e,t.files)})),{openFile:function(e){return(t,i)=>n.__awaiter(this,void 0,void 0,(function*(){const n=a.putFile(e);t(n);!a.previewDataPresentForFile(i(),e)&&!a.previewDataInFlight(i(),e)&&(n.payload.file.preview?t(a.populateFilesPreviewData([n.payload.file])):t(a.fetchPreviewData([n.payload.file],void 0,void 0,"ON"===a.fileViewerFeatureExperiments.previewsExpImgSizeOptimizationVariant)))}))}})(iF);class nF extends te.default.Component{render(){return te.default.createElement(a.Provider,{store:JL},te.default.createElement(aF,Object.assign({},this.props)))}}nF.displayName="FileCollectionViewerWithProvider";var rF=Object.freeze({__proto__:null,FileCollectionViewer:nF,_FileCollectionViewer:iF,getDerivedStateFromProps:tF});t.ACCEPTED_EXTENSIONS=rg,t.ACTION_DISABLED_STRING=ye,t.AI_BLADE_CONSENT_KEY=EA,t.ALL_FILTER_TYPES=AI,t.AUTO_SCROLL_PAUSE_THRESHOLD=1e4,t.AccessibilityAltText=bp,t.AllSortTypes=OO,t.AnnotationFormattingToolbarStrings=fp,t.AnnotationStrings=gp,t.AsyncMagicToolsVideo=ru,t.BACKUP_DELETE_ANCHORS_HEADING=$e,t.BACKUP_DELETE_ANCHORS_SUBHEADING=Ze,t.BACKUP_DELETE_CONTENT_MAC=Qe,t.BACKUP_DELETE_CONTENT_WIN=Ye,t.BACKUP_DELETE_TITLE=qe,t.BACKUP_MULTIPLE_DELETE_ANCHORS_HEADING=Xe,t.BACKUP_MULTIPLE_DELETE_ANCHORS_SUBHEADING=Je,t.CLOSE_LABEL=DT,t.CONTACTS_SEARCH_PREEMPTED_THRESHOLD=300,t.COPIED_BUTTON_DISPLAY_THRESHOLD=3e3,t.COPY_ACTION_STRING=pe,t.COPY_TOOLTIP=MT,t.COPY_TOOLTIP_SUCCESS=OT,t.CROP_TOOLTIP=Cd,t.CancelConfirmationModalStrings=dp,t.ChangeFolderModalStrings=G_,t.CommonStrings=F_,t.ConfirmationModal=Lp,t.Contact=Tv,t.ContactsDataSourceV2=IS,t.ContentInfo=Ch,t.DEFAULT_FILE_SIZE_LIMIT=Wp,t.DEFAULT_VIRTUAL_LIST_HEIGHT=1e3,t.DELETE_ACTION_STRING=_e,t.DISABLED_FOR_THIS_FILE_TOOLTIP_STRING=oe,t.DISLIKE_TRANSLATION_LABEL=xT,t.DOCSEND_PROD_APP_ID="dbaid:AAA6hDRnKKWTEvY7Xb4xVXwWZA8c8Af3GOM",t.DOC_LI_MARGIN=16,t.DOC_PAGE_MARGIN=Ls,t.DOC_PAGE_MARGIN_LEFT=Us,t.DOC_SIDEBAR_WIDTH=Vs,t.DOWNLOAD_ACTION_STRING=re,t.DefaultSortType=PO,t.DeleteAllPagesStrings=lp,t.DeleteConfirmationModalStrings=K_,t.DocumentPreviewText=wp,t.DocumentSidebarStrings=W_,t.DocumentSortType=DO,t.DownloadErrorModalStrings=ip,t.EDIT_PDF_ACTION_STRING=Ie,t.ESTIMATE_SEGMENT_ITEM_HEIGHT=132,t.EditTextStrings=B_,t.ErrorBoundary=Zl,t.ErrorTranslationOverlaySkeleton=_I,t.FILE_ACTIVITY_BLADE_NAMESPACE_KEY=TI,t.FILE_CONVERSION_STRING=we,t.FILE_SIZE_LIMITS=ng,t.FIT_TO_PAGE_ACTION_STRING=Ue,t.FIT_TO_WIDTH_ACTION_STRING=Fe,t.FLIP_HORIZONTAL_LABEL=Od,t.FLIP_VERTICAL_LABEL=Pd,t.FULL_SCREEN_ACTION_STRING=Le,t.FeedbackFormErrorModalStrings=pp,t.FeedbackFormStrings=_p,t.FileSizeModalStrings=op,t.FileSizeTooBigToSignModalStrings=sp,t.FormBuildingStrings=Cp,t.FormBuildingTemplateStrings=Ap,t.GenericErrorModalStrings=X_,t.GetPreviewsAiRoutes=SA,t.HELLOSIGN_PROD_APP_ID="dbaid:AAA8M7BsKD8QVXgtkUl5Rs7oFykwEx3Vm7U",t.HIDE_TOOLS_ACTION_STRING=Ve,t.HeaderStrings=U_,t.HelloSignErrorModalStrings=np,t.IFrameLoadingErrorModalStrings=J_,t.IMAGE_PADDING=Ns,t.INCLUDE_ALL_FILTER={added:!0,viewed:!0,moved:!0,renamed:!0,edited:!0,shared:!0,commented:!0},t.INFO_ACCESSIBILITY_STRING=Me,t.INFO_ACTION_STRING=Ae,t.INTERSECTION_DELTA=Pk,t.INTRO_PAGE_SIMPLE_VARIANT="V1",t.InsertErrorStrings=cp,t.InsertPagesChooserModalStrings=up,t.KeyboardBindingConnector=Do,t.LEARN_MORE=BT,t.LEFT_BORDER_ADJUSTMENT=4,t.LIKE_TRANSLATION_LABEL=PT,t.LanguageSelection=iI,t.LinkModalStrings=Tp,t.Loading=zy,t.LoggedOutChangesLabel=qb,t.Logo=bm,t.MAX_AUDIOVIDEO_LENGTH_S=6300,t.MAX_AUDIOVIDEO_SIZE_GB=10,t.MOVE_ACTION_STRING=de,t.MagicTools=D_,t.NetworkErrorModalStrings=ep,t.OPEN_IN_ACTION_STRING=ce,t.OnboardingStrings=Dp,t.OverQuotaModalStrings=tp,t.PAP_Create_Folder=$i,t.PAP_NavigateTo_Docsend=Oi,t.PAP_Save_EditMode=vi,t.PAP_Select_EditAction=Ui,t.PAP_Select_ReplaceOriginal=Wi,t.PAP_Select_SaveACopy=zi,t.PAP_Start_EditMode=Gi,t.PAP_View_DocsendHubEntryButton=pg,t.PRINT_ACTION_STRING=Ce,t.PassActions=Km,t.PassHelpers=Xh,t.PasswordProtectedModalStrings=$_,t.PreviewControlWrapper=ln,t.ProfileCardWithWrapper=XE,t.READABLE_DOC_ZOOM_TO_FIT_SCALE_MAX=1.75,t.RENAME_ACTION_STRING=ue,t.RESTORE_ACTION_STRING=fe,t.RESUME_AUTO_SCROLL_BUTTON_PLACEHOLDER_HEIGHT=40,t.RIGHT_BORDER_ADJUSTMENT=6,t.ROTATE_LEFT_TOOLTIP=Ad,t.ROTATE_RIGHT_TOOLTIP=Md,t.RenderAtFps=Bw,t.RequestSignaturesStrings=Y_,t.RequestedVisibilityPolicy={policy_name:"requested_visibility",password:"password",public:"public",team_only:"team_only"},t.ResolvedVisibilityPolicy={policy_name:"resolved_visibility",only_you:"only_you",password:"password",public:"public",shared_folder_only:"shared_folder_only",team_and_password:"team_and_password",team_only:"team_only",no_one:"no_one"},t.RightRail=fC,t.RightRailContext=lC,t.SELF_SIGN_ACTION_STRING=Te,t.SEND_FOR_SIGNATURE_ACTION_STRING=be,t.SHARE_ACTION_STRING=ve,t.SIGNATURE_HUB_URL="/signatures",t.SIGN_ENTRY_POINT_SOURCE=Ga,t.STAR_ACTION_STRING=me,t.SaveFormFieldsModal=Mp,t.SaveModalStrings=q_,t.SaveOriginalModalStrings=H_,t.SaveTemplateModalStrings=xp,t.SavedSignaturesStrings=Q_,t.SearchBarStrings=yp,t.SendForSignatureErrorModalStrings=rp,t.SendForSignatureModalStrings=Op,t.SendForSignatureStatusModalStrings=Pp,t.ShareModalActionTypes=yh,t.SharingActions=$h,t.Sign2faOrSamlModalStrings=kp,t.SignUpBannerStrings=Np,t.SignatureModalStrings=mp,t.SignersModalStrings=hp,t.SignersModalTemplateStrings=vp,t.SnackbarStrings=z_,t.StatusModalStrings=Ep,t.TEXT_BATCH_SIZE=Lr,t.TOOLTIP_10_10_TITLE=Jf,t.TOOLTIP_TIMEOUT=1e3,t.TRANLSATION_OVERLAY_DEFAULT_HEIGHT=300,t.TRANSCRIPT_ACTION_HIDE_ACCESSIBILITY_STRING=Ke,t.TRANSCRIPT_ACTION_HIDE_STRING=He,t.TRANSCRIPT_ACTION_SHOW_ACCESSIBILITY_STRING=Be,t.TRANSCRIPT_ACTION_SHOW_STRING=je,t.TRANSCRIPT_ERROR_TESTID="transcript-blade-error",t.TRANSFER_FP_APP_ID=Ww,t.TRANSLATION_AI_DISCLAIMER=jT,t.TRANSLATION_MATCHED_LANGUAGE_MESSAGE=VT,t.TRIM_BAR_HEIGHT_AUDIO=42,t.TRIM_BAR_HEIGHT_VIDEO=60,t.TRIM_BAR_HORIZONTAL_PADDING=26,t.TRIM_BORDER_ADJUSTMENT=4,t.TRIM_TOOLTIP=Id,t.TemplateHeaderStrings=V_,t.TemplateStrings=Sp,t.Text=nE,t.TimeCodedSortType=xO,t.ToolbarAction=Af,t.ToolbarHolder=Vf,t.ToolbarSeparator=vf,t.ToolbarStrings=j_,t.TooltipTourConfig=vm,t.TooltipTypeConfig=hm,t.TranscriptProgressBar=BA,t.TranslatableLanguageCodes=ZT,t.TranslationErrorSection=cI,t.TranslationLoadingSection=sI,t.TranslationOverlaySkeleton=rI,t.UNSTAR_ACTION_STRING=he,t.UnityCheckFileCache=yy,t.UnityHelpers=Iy,t.UploadErrorModalStrings=ap,t.UploadPageStrings=Rp,t.UpsellStrings=Ip,t.UserEducationEffect=Kw,t.VALID_PREVIEW_TYPES=GA,t.VERSION_HISTORY_ACTION_STRING=ge,t.WATERMARKING_PLUGIN_ID=xg,t._createAction=Jy,t._createMiddleware=eT,t.actionBar=Jc,t.actionBarStrings=__,t.actionCompareFn=Sy,t.actions=C_,t.activateThread=kO,t.addCommentAction=WM,t.allowAllFiles=Ld,t.alwaysShow=Fd,t.app="_app_1ythq_175",t.applyHistory=function(e,t){return O.createReducer(e,(i=>{i.addCase(f_,(()=>e)),i.addCase(p_,(e=>{e.history.past.length&&(e.history.current.isCommittable&&e.history.future.push(e.history.current),e.history.current=e.history.past.pop())})),i.addCase(g_,(e=>{e.history.future.length&&(e.history.current.isCommittable&&e.history.past.push(e.history.current),e.history.current=e.history.future.pop())})),i.addDefaultCase(((e,i)=>{const a=O.e(e),n=t(a,i);if(!a||a.history.current===n.history.current)return n;if(!a.history.current.isCommittable)return n;const r=[...a.history.past,a.history.current];return r.length>a.history.maxHistory&&r.shift(),Object.assign(Object.assign({},n),{history:Object.assign(Object.assign({},n.history),{past:r,future:[]})})}))}))},t.applyWatermark=(e,t,i)=>({type:"ApplyWatermark",payload:{fileViewerId:e,file:t,overwrite:i}}),t.archiveSubpathQueryParam=Pc,t.areCommentsEnabled=(e,t)=>{var i;const a=e.permissions[t],n=e.enableCommentStatus[t];return Boolean(null!==(i=null==n?void 0:n.commentsEnabled)&&void 0!==i?i:null==a?void 0:a.can_see_comment_editor)},t.audioVideoEditingActionCondition=Yd,t.audioVideoEditingLoggedOutActionCondition=$d,t.boltSubscribe=function(e){return{type:NO.BoltSubscribe,payload:e}},t.boltUnsubscribe=function(e){return{type:NO.BoltUnsubscribe,payload:e}},t.border="4px",t.button="_button_qv956_11",t.buttonContent="_buttonContent_qv956_39",t.calcDocFitToWidthScale=function(e){const{width:t,dimensions:i,isDocSidebarVisible:a,maxWidth:n}=e;if(0===i.length)return 1;const r=Math.max(0,t-Ls-Us-(a?Vs:0)-30),o=n?Math.min(r,n):r;return i.reduce(((e,[t])=>Math.min(e,o/t)),Number.POSITIVE_INFINITY)},t.calculateDocumentScaleFactor=zs,t.calculateFitBox=kc,t.calculateImageSizerDimensions=function(e,t,i=1){const a=e.width*i,n=e.height*i;let r=0,o=0;return a<t.width&&(r=(t.width-a)/2),n<t.height&&(o=(t.height-n)/2),{width:a,height:n,translateX:r,translateY:o}},t.calculateLeftHandlePosition=(e,t,i,a)=>n.__awaiter(void 0,void 0,void 0,(function*(){const n=yield gu(t);if(null==n)return;if(null==e||0===e)return;const{trackLeftOuterBound:r}=i;return mu(r,e-n,r,a-8-2-8)})),t.calculatePageRange=Fr,t.calculatePlaybackTimeMarkerPosition=(e,t,i,a,r)=>n.__awaiter(void 0,void 0,void 0,(function*(){const n=yield gu(t);if(null==n)return;const{trackLeftOuterBound:o}=i;return mu(o,e.clientX-n,a+4,r-4-2)})),t.calculateRightHandlePosition=(e,t,i,a)=>n.__awaiter(void 0,void 0,void 0,(function*(){const n=yield gu(t);if(null==n)return;if(null==e||0===e)return;const{trackLeftOuterBound:r,trackEnd:o}=i;return mu(r,e-n,a+8+2,o)})),t.calculateTimeFromPosition=(e,t,i)=>t/e*i,t.canConvertFile=cf,t.canPreviewInPreviewDoc=function(e){return!!e&&[a.PreviewType.CloudDoc,a.PreviewType.SsrDoc].includes(null==e?void 0:e.previewType)},t.cancelAnnotating=UO,t.checkFileEditEligibility=wu,t.checkHasAnyChange=(e,t)=>(0!==e.counts.crop||0!==e.counts.flip||0!==e.counts.rotate||0!==e.counts.trim)&&!!(Eu(e.trim,t)||0!==e.rotate||e.crop||e.horizontalFlip),t.checkHasCropCoordChange=(e,t)=>!(Su(e.height,t.height)&&Su(e.width,t.width)&&Su(e.top,t.top)&&Su(e.left,t.left)),t.checkHasTrimChange=Eu,t.checkHasTrimRangeChange=(e,t)=>!Su(e.start,t.start)||!Su(e.end,t.end),t.clamp=fu,t.classes=YT,t.classes$1=JS,t.classes$2=zw,t.closeDocSidebar=vn,t.closeViewer=In,t.collection_viewer_esnext=rF,t.commentsPaneBlade="_comments-pane-blade_1304m_5",t.composeEmail=JE,t.confirmDraftAnnotation=FO,t.container="_container_1ythq_138",t.container$1="_container_pmkgf_14",t.copyToDropbox=function(e){return{type:dn.CopyToDropbox,payload:e}},t.createCommentFileIdentifier=ga,t.createInitialVideoEditState=(e,t)=>{var i,a,n;return{rotate:0,trim:{start:null!==(i=null==t?void 0:t.start)&&void 0!==i?i:0,end:null!==(n=null!==(a=null==t?void 0:t.end)&&void 0!==a?a:e)&&void 0!==n?n:0},crop:void 0,horizontalFlip:!1,counts:{trim:0,crop:0,rotate:0,flip:0},enhanceSpeech:!1}},t.createNormalizedRegion=QT,t.createPreviewMetadataQueryKey=ia,t.createStreamFromFileOrSharedLink=_N,t.createTelemetryClient=Lw,t.cropHandler=iu,t.currentSearchMatch="_currentSearchMatch_poiak_95",t.deactivateAllThreads=LO,t.deleteCommentAction=QM,t.deleteCompleteSnackBar=nt,t.deleteFailedSnackBar=rt,t.deleteSnackBarInProgress=at,t.delete_esnext=it,t.disableCommentingAction=$M,t.disabledAnnotationsShowMore="_disabled-annotations-show-more_1304m_9",t.downloadActiveFile=Ot,t.downloadFile=function(e){return{type:dn.DownloadFile,payload:e}},t.download_utils_esnext=Ft,t.editCommentAction=XM,t.editorDidFocus=function(e){return{type:NO.EditorDidFocus,payload:{fileViewerId:e}}},t.editorSlice=T_,t.enableCommentingAction=eO,t.enterFullScreen=wn,t.exitFullScreen=bn,t.fetchArchiveFiles=(e,t,i,a,r,o)=>n.__awaiter(void 0,void 0,void 0,(function*(){const n={root_file_info:e,subpaths:t,subpath_sizes:o},s=rr(a);return yield s.fetchQuery(r,{apiArg:n,pkgArg:{isLoggedIn:i}})})),t.fileActionCondition=Wd,t.fileCounter="_fileCounter_bcnab_22",t.fileCounterMessage=ey,t.fileName="_fileName_bcnab_33",t.filterAudioVideoFilePreviewUiState=kn,t.filterDocFilePreviewUiState=Nn,t.filterLoggedInUser=Ud,t.filterPreviewTypeIn=Hd,t.filterSurfaceIn=Bd,t.filterZoomableFilePreviewUi=Ln,t.findCommentThread=RO,t.findInDocHighlightPrimary="var(--color__accent__lime)",t.findInDocHighlightSecondary="var(--color__accent__banana)",t.flipHorizontalHandler=eu,t.flipVerticalHandler=tu,t.focusThread=function(e,t){return{type:NO.FocusThread,payload:{fileViewerId:e,threadId:t}}},t.focused="_focused_pmkgf_116",t.footerContainer=Gc,t.formatBytes=xC,t.functionWrapperProvider=ME,t.generateNonceSubdomain=vT,t.getActionArgs=Up,t.getActionCondition=Nd,t.getActionContinuationModalProps=(e,t,i)=>{const a=Hu(e,t,i);return{signup_tag:a.signupTag,onCancel:a.onCancel,googleRegisterProps:a.sharedLinkUrl?{signupContinuationUrl:a.sharedLinkUrl}:void 0,loginContinuationUrl:a.sharedLinkUrl}},t.getActivityStreamAction=vI,t.getAndLogIntroPageVariant=()=>(R.logExposure({feature:"previews_exp_dropbox_ai_intro_page",variant:a.fileViewerFeatureExperiments.previewsExpDropboxAiIntroPage}),a.fileViewerFeatureExperiments.previewsExpDropboxAiIntroPage),t.getAppActionExtras=function(e){return{action_id:e.id,encoded_app_id:e.app_id,action_type:vy(e)?"select_action":"select_connect"}},t.getArchiveEntryAtPath=function(e,t){const i=e[Dn(t)],a=t.length>0?t.slice(0,t.length-1):void 0;return{entry:i,parent:a&&e[Dn(a)]}},t.getArrowKeyTimeDelta=(e,t)=>{if(0===t)return 0;const i=Math.max(.01*t,1),a=.1*i;let n=0;return"ArrowLeft"===e.key?n=e.shiftKey?-a:-i:"ArrowRight"===e.key&&(n=e.shiftKey?a:i),n},t.getBrowserFindBinding=function(e){return{keyboardEventCriteria:{key:"f",osModifierKey:!0},callback:e}},t.getBylines=e=>Yw(e).bylines,t.getCategoryInfos=e=>Yw(e).categoryInfos,t.getClosestSubpath=(e,t)=>{for(let i=t.length;i>=0;i--){const a=t.slice(0,i);if(e[Dn(a)])return a}return[]},t.getCloudDocExitUrl=ul,t.getCommonContextExtra=SE,t.getContainerLeft=gu,t.getContentIdsForContentInfo=e=>{const t=[];return e.isSharedFolder()?t.push(e.sharedFolderId()):(e.extras.fileId&&t.push(e.extras.fileId),e.extras.nsId&&e.extras.nsPath&&t.push(`ns:${e.nsId()}${e.nsPath()}`)),e.displayPath()&&t.push(e.displayPath()),t},t.getConversionLoggingFunctions=function(e){return{logConvert:(t,i=1)=>{k.PapLogger.logInitiateFileConversion(e,i,t)},logConvertRetry:(t,i=1)=>{k.PapLogger.logSelectFileConversionRetryButton(e,i,t)},logConvertClose:(t,i=1)=>{k.PapLogger.logDimissFileConversionSnackbar(e,i,t)},logConvertOpen:t=>{k.PapLogger.logSelectFileConversionOpenButton(e,t)}}},t.getConversionStateFromException=function(e){const t=null==e?void 0:e.error;return function(e){return e&&e[".tag"]&&e[".tag"]in lf}(t)?lf[t[".tag"]]:"failGeneric"},t.getCurrentFilePreviewUI=Wn,t.getCurrentPreviewKey=jn,t.getCurrentWatermarkOptions=rT,t.getDataForContentInfo=$S,t.getDefaultConversionStrings=function(e,t,i,n){const o=l.intl.formatMessage({id:"WthXj+",defaultMessage:"Couldn't save as {fileType}"},{fileType:e}),s=uf(t,((e,o)=>l.intl.formatMessage({id:"jyMgWg",defaultMessage:"<a>{fileName}</a> saved to {dirName} folder"},{fileName:e,dirName:o,a:e=>(null==n?void 0:n.clickableFileName)?te.default.createElement(a.Link,{inverse:!0,href:a.get_browse_root(i)+r.URI.encode_parts(t),onClick:()=>{var e;null===(e=null==n?void 0:n.loggingFunctions)||void 0===e||e.logConvertOpen(null==n?void 0:n.source)}},e):e})),(e=>l.intl.formatMessage({id:"ukwwi2",defaultMessage:"{fileName} saved to your main Dropbox folder"},{fileName:e})));return{saving:l.intl.formatMessage({id:"Bdb4J5",defaultMessage:"Saving {fileType}..."},{fileType:e}),success:s,successAutomatedAdoption:s,failGeneric:o,failRetryable:o,failOverQuota:l.intl.formatMessage({id:"QP2WHb",defaultMessage:"Couldn't save as {fileType} because your Dropbox account is out of space"},{fileType:e}),failTooLarge:l.intl.formatMessage({id:"cmnQAC",defaultMessage:"Couldn't save as {fileType} because the file is too large"},{fileType:e}),failCorrupt:l.intl.formatMessage({id:"INKSmo",defaultMessage:"Couldn't save as {fileType} because the file is damaged"},{fileType:e}),failPassword:l.intl.formatMessage({id:"dnnNdt",defaultMessage:"Couldn't save as {fileType} because the file is password protected"},{fileType:e}),failPasswordLink:l.intl.formatMessage({id:"qzTamN",defaultMessage:"Couldn't save as {fileType} because the file was shared using a password-protected link"},{fileType:e})}},t.getDocsendAdvancedSharingHasConfirmedSplitShareMenu=e=>Yw(e).docsendAdvancedSharingHasConfirmedSplitShareMenu,t.getDocsendAdvancedSharingHasOpenedSharingSettings=e=>Yw(e).docsendAdvancedSharingHasOpenedSharingSettings,t.getDocsendAdvancedSharingHasSeenShareModal=e=>Yw(e).docsendAdvancedSharingHasSeenShareModal,t.getDocsendAdvancedSharingHasShared=e=>Yw(e).docsendAdvancedSharingHasShared,t.getElementLeft=e=>{var t,i;return null==(null===(i=null===(t=null==e?void 0:e.current)||void 0===t?void 0:t.style)||void 0===i?void 0:i.left)?null:parseInt(e.current.style.left,10)},t.getEmptyDragImage=()=>{const e=new Image(0,0);return e.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",e},t.getErrorStrings=xd,t.getEscapeBinding=function(e){return{keyboardEventCriteria:{key:a.Key_enum.Key.Escape},callback:bo(e)}},t.getFeatureFlags=$w,t.getFileExt=Vw,t.getFileIdFromFile=e=>(null==e?void 0:e.fqPath)||(null==e?void 0:e.fileId),t.getFileIdentifier=function(e,t){return a.isBrowseFile(e)||(null==t?void 0:t.linkType)===a.SharedLinkType.Content?{identifier:{file_id:e.file_id,".tag":"file_id"}}:{identifier:{shared_link_url:e.href?e.href:"",".tag":"shared_link_url"}}},t.getFileMetadata=Bn,t.getFilePreviewUi=Kn,t.getFilePreviewUiData=function(e,t,i){var a;return i&&(null===(a=e.filePreviewUi[t])||void 0===a?void 0:a[i.serialized])},t.getFileViewerUi=Gn,t.getFindInDocBinding=function(e){return{keyboardEventCriteria:{key:"f",osModifierKey:!0},callback:bo(e)}},t.getGrantBook=af,t.getHomeEndBindings=function({home:e,end:t}){return[(i=e,{keyboardEventCriteria:{key:a.Key_enum.Key.Home},callback:bo(i)}),Mo(t)];var i},t.getHoverTimestamp=(e,t,i)=>{const{trackLeftInnerBound:a,trackRightInnerBound:n}=i;return vu(a,n-2,e,t)},t.getImageSizeScale=Lc,t.getIsFullScreen=Yn,t.getKeyboardBinding=Oo,t.getLeftPositionFromTimestamp=(e,t,i)=>{const{trackLeftInnerBound:a,trackRightInnerBound:n}=i;return hu(e,t,a,n)-4},t.getLeftTimestamp=(e,t,i)=>{const{trackLeftInnerBound:a,trackRightInnerBound:n}=i;return vu(a,n,e+4,t)},t.getNextFlip=(e,t,i)=>"horizontal"===i?[!e,t]:[!e,(t+180)%360],t.getNextPageRange=function(e){return[e[0]+Lr,e[1]+Lr]},t.getNextRotation=(e,t,i)=>(e+(i!==t?90:270))%360,t.getNonHellosignActionsForFiles=function(e,t,i){return ib(e,t).filter((e=>e.app_id!==i))},t.getOnUngatedAuthSuccess=ht,t.getOpenActionsForFile=ab,t.getOpenOptionsWithLogging=function(e,t){return e.map((e=>Object.assign(Object.assign({},e),{handler:()=>{e.handler(),hy(t,"select_legacy_action",{type:e.type,userAction:e.userAction})}})))},t.getPageUpDownBindings=function({pageUp:e,pageDown:t}){return[(i=e,{keyboardEventCriteria:{key:a.Key_enum.Key.PageUp},callback:bo(i)}),Io(t)];var i},t.getPapPreviewType=gi,t.getPiiSafeExtension=Uw,t.getPlaybackTimeMarkerPositionFromTimestamp=(e,t,i)=>{const{trackLeftInnerBound:a,trackRightInnerBound:n}=i;return hu(e,t,a,n-2)},t.getPlaybackTimestamp=(e,t,i)=>{const{trackLeftInnerBound:a,trackRightInnerBound:n}=i;return vu(a,n-2,e,t)},t.getPluginActivationParams=function(e,t){var i;return null===(i=to(e,t))||void 0===i?void 0:i.editPluginActivationParams},t.getPluginsState=to,t.getPreviewKeyForNestedArchiveFile=xn,t.getRightPositionFromTimestamp=(e,t,i)=>{const{trackLeftInnerBound:a,trackRightInnerBound:n}=i;return hu(e,t,a,n)+4},t.getRightSidebarPluginId=no,t.getRightTimestamp=(e,t,i)=>{const{trackLeftInnerBound:a,trackRightInnerBound:n}=i;return vu(a,n,e-4,t)},t.getRootDocUi=Yy,t.getRootFile=Fn,t.getRootFileMetadata=Hn,t.getRootImageUi=$y,t.getRootPreviewKey=Vn,t.getRootPreviewUI=zn,t.getScaleFactorFromFilePreviewUi=qn,t.getSearchConfigForUser=SS,t.getSelectedEditPluginId=eo,t.getSelfSignActionArgs=Kp,t.getSendAndTrackFileNameTargetingVariantFromString=hg,t.getSendAndTrackPreviewsExpVariantFromString=fg,t.getShareActionsForFiles=ib,t.getSharedLinkInfo=er,t.getSharingServiceInfoAdapter=e=>{const t=ud(e).latestListServicesResult;return t&&a.convertToSharingServiceInfo(t)},t.getSubpath=Dn,t.getSubpaths=ar,t.getSuccessString=uf,t.getTooltipTourFileType=function(e){if("pdf"===e)return t.TooltipTourFileType.pdf;const i=a.ExtensionCategories[e];return i in t.TooltipTourFileType?i:t.TooltipTourFileType.default},t.getTooltipTourFileTypeForNonShare=function(e,i){const n=a.getExtension$1(e);if("pdf"===n&&qa(e,i))return t.TooltipTourFileType.pdf;const r=a.ExtensionCategories[n];return"IMAGE"===r&&Ya(e,i)?t.TooltipTourFileType.IMAGE:"VIDEO"===r&&pu(n)?t.TooltipTourFileType.VIDEO:t.TooltipTourFileType.default},t.getTranscriptPermission=jA,t.getTrimAccuracyThresholdMsec=e=>{const t=Math.round(100*(e.end-e.start));return Math.min(t>0?t:0,500)},t.getUpDownBindings=function({up:e,down:t}){return[(i=e,{keyboardEventCriteria:{key:a.Key_enum.Key.ArrowUp},callback:bo(i)}),Co(t)];var i},t.getVolumeState=function(e){return e.volume},t.getWatermarkScale=lT,t.getWrapperBounds=e=>({trackStart:0,trackEnd:e,trackLeftOuterBound:0,trackRightOuterBound:e,trackLeftInnerBound:4,trackRightInnerBound:e-4}),t.getZoomInOutBindings=function({zoomIn:e,zoomOut:t}){return[...(i=e,[{keyboardEventCriteria:{key:"=",osModifierKey:!0},callback:bo(i)},{keyboardEventCriteria:{key:"+",osModifierKey:!0},callback:bo(i)}]),...Ao(t)];var i},t.handleShowByline=function(e,t){return()=>{hy(t,"show_byline",{extension_id:e})}},t.hoverThread=function(e,t){return{type:NO.HoverThread,payload:{fileViewerId:e,threadId:t}}},t.iCommentContentToUserSubmittedComment=function({annotation:e,content:t,stream:i}){return{annotation_data:e?fN(e):void 0,content:t.text,metadata:MN(t.metadata),revision:PN(i)}},t.imageEditingActionCondition=$u,t.incrementDocPasswordAttempts=function(e){return{type:dn.IncrementDocPasswordAttempts,payload:e}},t.initialAdjustments=v_,t.initialOrientation=h_,t.initialState=S_,t.internalLink="_internalLink_1ythq_50",t.invariant=zo,t.isAIBladeInternalRelease=()=>a.fileViewerFeatureExperiments.previewsExpDropboxAiAssistant===Qg,t.isAIBladeSupportedForFile=Jg,t.isAnnotating=function(e){return"annotating"===e||"annotating-ax"===e},t.isAnnotatingAccessible=function(e){return"annotating-ax"===e},t.isBladeSupportedForFiles=(e,t=!0)=>Boolean(e.length>=1&&e.some((e=>Jg(e.name,t)&&!!e.fileId))),t.isChangingCodecDuringEdit=e=>e&&!Cu.includes(e),t.isDownloadPluginEnabled=Ib,t.isEditMode="_isEditMode_pmkgf_69",t.isEditingAnnotation=Ek,t.isFileAudio=e=>a.AUDIO_EXTS.includes(u.getFileExtension(e)),t.isFileSupported=og,t.isFileVideo=e=>a.ROOT_VIDEO_EXTS.includes(u.getFileExtension(e)),t.isInsideVaultFolder=lt,t.isKeyboardEvent=wo,t.isLinked=vy,t.isLiveFile=st,t.isLoggedOutVideoEditEnabled=Kg,t.isMobileRedesignEnabled=en,t.isNestedArchiveFilePreviewKey=Pn,t.isPluginEditMode=io,t.isPnmSuppressMoveSelected=e=>{var t;return"per_node_metadata"in e&&!!(null===(t=e.per_node_metadata)||void 0===t?void 0:t.suppress_move)},t.isPpt=Hs,t.isPreviewsAIAsyncAPIEnabled=()=>a.fileViewerFeatureExperiments.previewsExpDropboxAiAsyncApi===qg,t.isQuickReactMetadata=EN,t.isSendAndTrackExternalSharingEnabled=function(e){var t,i,n;const r=a.getStateAtNamespace(e,a.DEEP_INTEGRATIONS_NAMESPACE_KEY);return!!(null===(n=null===(i=null===(t=null==r?void 0:r.userSettingsState)||void 0===t?void 0:t.latestUserSettings)||void 0===i?void 0:i.docsend_settings)||void 0===n?void 0:n.is_send_and_track_external_sharing_enabled)},t.isSendForSignatureEnabled=_d,t.isShareAction=nb,t.isSignatureHubEntryPoint=function(e){return e.includes("signature_hub")},t.isSingularlyAnnotating=e=>e.annotationSettings.mode===t.SectionAnnotationMode.single,t.isStarringEnabled=function(e){return st(e)&&!a.isSharedFile(e)&&!lt(e)},t.isStickerMetadata=SN,t.isSupportedFile=Fp,t.isToolbarIconsOnly=tl,t.isUnfocusedInEditMode="_isUnfocusedInEditMode_pmkgf_121",t.isUserSubscribed=(e,t)=>{var i;const a=e.permissions[t],n=e.subscriptionStatus[t];return Boolean(null!==(i=null==n?void 0:n.isSubscribed)&&void 0!==i?i:null==a?void 0:a.is_subscribed)},t.languageLookup=eI,t.linksLayer="_linksLayer_1ythq_40",t.loader="_loader_pmkgf_100",t.logBackgroundEvent=function(e){return{type:jo.LogBackgroundEvent,payload:e}},t.logEvent=hy,t.logIneligibleEditAttempt=(e,t,i,n,r,o)=>{if(!r||!n||"video"!==n[".tag"]&&"audio"!==n[".tag"])return;const s=a.file_extension(o||""),l=n.duration||n.duration_precise;switch(e){case void 0:break;case"tooBig":t(Ko({userAction:a.UserAction.EditVideoFailure,fileViewerId:i,actionContext:a.UserActionContext.TitleBarMain,extra:{reason:"too_large",size:r.toString()}}));break;case"tooLong":t(Ko({userAction:a.UserAction.EditVideoFailure,fileViewerId:i,actionContext:a.UserActionContext.TitleBarMain,extra:{reason:"too_long",duration:l?l.toString():""}}));break;case"tooShort":t(Ko({userAction:a.UserAction.EditVideoFailure,fileViewerId:i,actionContext:a.UserActionContext.TitleBarMain,extra:{reason:"too_short",duration:l?l.toString():""}}));break;case"over4k":if("video"!==n[".tag"])break;const e=n.resolution_width,o=n.resolution_height;t(Ko({userAction:a.UserAction.EditVideoFailure,fileViewerId:i,actionContext:a.UserActionContext.TitleBarMain,extra:{reason:"over_4k",resolution_width:String(e),resolution_height:String(o)}}));break;case"extensionNotSupported":t(Ko({userAction:a.UserAction.EditVideoFailure,fileViewerId:i,actionContext:a.UserActionContext.TitleBarMain,extra:{reason:"unsupported_extension",fileExtension:s}}));break;case"codecNotSupported":t(Ko({userAction:a.UserAction.EditVideoFailure,fileViewerId:i,actionContext:a.UserActionContext.TitleBarMain,extra:{reason:"unsupported_codec",codec:n.codec||""}}))}},t.logPreviewEvent=Ho,t.logSessionEvent=Bo,t.logUserActionEvent=Ko,t.logVideoEvent=function(e){return{type:jo.LogVideoEvent,payload:e}},t.logVideoEventDuration=function(e){return{type:jo.LogVideoEventDuration,payload:e}},t.logVideoEventQuantity=function(e){return{type:jo.LogVideoEventQuantity,payload:e}},t.loggedOutEditButtonText=Lu,t.loggedOutSUSIAndActionContinuationHandler=Ku,t.makeDownloadActions=Pb,t.makeMetaserverFlowsClient=yd,t.manyFilesCounterMessage=ty,t.markThreadReadAction=fO,t.markThreadUnreadAction=hO,t.middleButton="_middleButton_3b0az_33",t.minSegmentHeight="42",t.mobileMeatball="_mobileMeatball_ux84q_21",t.mobileTitleBar=Zc,t.mobileTitleBarLoggedIn="_mobileTitleBarLoggedIn_bcnab_9",t.multiFileWithExtensionSelector=function(e){return t=>!(t.length<1||t.some((e=>e.is_dir)))&&t.every((t=>e.includes(a.getExtension$1(t))))},t.notify=ew,t.onAdjust=d_,t.onClickWrapper=OE,t.onCrop=l_,t.onFlip=c_,t.onRotate=s_,t.open="_open_pmkgf_26",t.openDocSidebar=hn,t.openGdssFileConversionModal=function(){return{type:dn.OpenGdssFileConversionModal,payload:{}}},t.openInActionConditions=Eg,t.openUrl=function(e){return{type:dn.OpenUrl,payload:e}},t.openWebPreview=function(e){return{type:dn.OpenWebPreview,payload:e}},t.overflowMenu="_overflowMenu_bcnab_28",t.page="_page_1ythq_98",t.pageNavigation=pn,t.parentDirName=function(e){const t=e.split("/");return t.length>1?t[t.length-2]:""},t.partitionActions=Ey,t.partitionOptions=function(e){const i=[],a=[];let n,r,o,s,l,c,d;return e.forEach((e=>{const{type:u}=e;u===t.OpenButtonAction.UNITY_FILE||u===t.OpenButtonAction.UNITY_FOLDER?i.push(e):u===t.OpenButtonAction.OPEN_WITH||u===t.OpenButtonAction.OPEN_WITH_CLOUD_DOC?a.push(e):u===t.OpenButtonAction.DOWNLOAD?n=e:u===t.OpenButtonAction.PREVIEW_FILE?r=e:u===t.OpenButtonAction.OPEN_IN_REPLAY?o=e:u===t.OpenButtonAction.OPEN_IN_DESKTOP?s=e:u===t.OpenButtonAction.GO_TO_FOLDER?l=e:u===t.OpenButtonAction.OPEN_IN_NEW_TAB?c=e:u===t.OpenButtonAction.QUICK_VIEW&&(d=e)})),{unityOptions:i,cloudEditorOptions:a,downloadOption:n,previewOption:r,openInReplayOption:o,openInDesktopOption:s,openInNewTabOption:c,goToFolderOption:l,openInQuickViewOption:d}},t.passStore=tv,t.pdfEditActionCondition=bg,t.pdfViewport="_pdfViewport_1ythq_102",t.portableDelete=tt,t.pptSizer="_pptSizer_1ythq_126",t.pptViewport="_pptViewport_1ythq_108",t.prepareArchiveQueryFileInfo=ta,t.prepareFileInfo=ea,t.redirect=function(e){return{payload:e,type:dn.Redirect}},t.removeFragmentFromURL=Ou,t.renameActionConditions=Gd,t.renameCompleteSnackBar=_t,t.renameFailedSnackBar=pt,t.renameSnackBarInProgress=ut,t.resolvePageNavigation=function(e){return{type:dn.ResolvePageNavigation,payload:e}},t.resolveThreadAction=SO,t.resumeAutoScrollButton="_resumeAutoScrollButton_poiak_99",t.rhsHeader="_rhsHeader_1tzd1_10",t.rightButtonsContainer="_rightButtonsContainer_3b0az_37",t.rivieraClient=kr,t.rotateLeftHandler=Xd,t.rotateRightHandler=Jd,t.saveToDropbox=Mt,t.searchContacts=function(e){return{type:aN.SearchContacts,payload:e}},t.selected="_selected_pmkgf_109",t.selfSignActionCondition=jp,t.sendForSignatureActionCondition=Hp,t.setActiveEditPlugin=Cn,t.setArchiveFilesData=(e,t,i)=>{const a=aa(e,i);o.queryClient.setQueryData(a,{apiData:t,pkgData:null})},t.setAreVideoControlsHidden=function(e){return{type:dn.SetAreVideoControlsHidden,payload:e}},t.setCachedUserSeenTour=e=>ky=e,t.setImageWatermarkOptions=(e,t)=>({type:"SetImageWatermarkOptions",payload:{fileViewerId:e,options:t}}),t.setIsClosedCaptionShowing=function(e){return{type:dn.SetIsClosedCaptionShowing,payload:e}},t.setIsDefaultAudioTrackSelected=function(e){return{payload:e,type:dn.SetIsDefaultAudioTrackSelected}},t.setMode=(e,t)=>({type:"SetMode",payload:{fileViewerId:e,mode:t}}),t.setMuted=function(e){return{type:dn.SetMuted,payload:e}},t.setPreviewLoadingAction=On,t.setStatusReady=e=>({type:"SetStatusReady",payload:{fileViewerId:e}}),t.setTextWatermarkOptions=(e,t)=>({type:"SetTextWatermarkOptions",payload:{fileViewerId:e,options:t}}),t.setUiHidden=En,t.setVolume=function(e){return{type:dn.SetVolume,payload:e}},t.setupGetPlayDurationSeconds=function(e){return{type:dn.SetupGetPlayDurationSeconds,payload:e}},t.share=ZS,t.share_helpers_esnext=XS,t.sharingInfoStore=qh,t.shouldAutoSnapHandle=(e,t)=>Math.abs(e-t)<20,t.shouldDisableFeaturesIfTeamSuspended=gd,t.shouldFetchNextBatch=function(e,t){return t[0]+Lr-e<15},t.shouldShowDocSidebar=Ks,t.showAuthModal=bt,t.showSelfSignWarningModal=e=>{a.mountModal(te.default.createElement(Lp,Object.assign({},e)))},t.showSendForSignatureWarningModal=e=>{a.mountModal(te.default.createElement(Lp,Object.assign({},e)))},t.showing="_showing_poiak_108",t.sidebarWidth=ks,t.singleFileWithExtensionAndResolutionSelector=function(e,t){return(i,n,r)=>{if(1!==i.length||i[0].is_dir)return!1;const o=a.getExtension$1(i[0]),s="video"===(null==r?void 0:r[".tag"])?r.resolution_height:void 0,l="video"===(null==r?void 0:r[".tag"])?r.resolution_width:void 0;return!!(e.includes(o)&&t&&s&&l&&t<Math.min(s,l))}},t.singleFileWithExtensionSelector=df,t.snackbars_esnext=ot,t.snackbars_esnext$1=gt,t.sortComments=function(e){return{type:NO.SortComments,payload:{sortType:e}}},t.startAnnotating=function(e,t,i){return{type:NO.StartAnnotating,payload:{fileViewerId:e,accessible:t,annotationType:i}}},t.strictMultiFileWithExtensionSelector=function(e){return t=>!(t.length<=1||t.some((e=>e.is_dir)))&&t.every((t=>e.includes(a.getExtension$1(t))))},t.subscribeAction=wO,t.susiHeader=$c,t.textLayer="_textLayer_1ythq_20",t.textbox="_textbox_1ythq_15",t.throttle=Tk,t.thumbnail="_thumbnail_pmkgf_73",t.thumbnailContainer="_thumbnailContainer_pmkgf_80",t.thumbnailWidth="112px",t.title="_title_bcnab_14",t.title$1="_title_ux84q_5",t.titleBar=Qc,t.transcriptActionConditions=Hg,t.transcriptBladeContentWrapper="_transcriptBladeContentWrapper_poiak_17",t.transcriptCaptionText="_transcriptCaptionText_poiak_91",t.transcriptErrorInfo="_transcriptErrorInfo_poiak_42",t.transcriptSearchHeight="52",t.transcriptSearchMatchFoundText="_transcriptSearchMatchFoundText_poiak_81",t.transcriptSearchNavigatorWrapper="_transcriptSearchNavigatorWrapper_poiak_86",t.transcriptSearchWrapper="_transcriptSearchWrapper_poiak_22",t.transcriptSegmentListContentWrapper="_transcriptSegmentListContentWrapper_poiak_34",t.triggerDynamicRoutingModalCheck=function(){return{type:dn.TriggerDynamicRoutingModalCheck,payload:{}}},t.trimHandler=au,t.unresolveThreadAction=yO,t.unsubscribeAction=IO,t.unzipActionConditions=pf,t.updateAnnotationMode=function(e){return{type:NO.UpdateAnnotationMode,payload:{updatedAnnotationMode:e}}},t.updateArchiveFileCurrentPath=An,t.updateArchiveFileCurrentSubpaths=function(e){return{payload:e,type:dn.UpdateArchiveFileCurrentSubpaths}},t.updateAudioVideoPlaybackState=function(e){return{payload:e,type:dn.UpdateAudioVideoPlaybackState}},t.updateDimensions=function(e){return{type:dn.UpdateDimensions,payload:e}},t.updateDocCurrentPageIndex=_n,t.updateElementVisibility=(e,t)=>{e.current&&(e.current.style.visibility=t?"hidden":"visible")},t.updateFitScaleFactor=function(e){return{type:dn.UpdateFitScaleFactor,payload:e}},t.updateFitToWidthScaleFactor=function(e){return{type:dn.UpdateFitToWidthScaleFactor,payload:e}},t.updatePositionStyle=(e,t)=>{e.current&&(null!=t.left&&(e.current.style.left=`${t.left}px`),null!=t.width&&(e.current.style.width=`${t.width}px`),null!=t.right&&(e.current.style.right=`${t.right}px`),null!=t.top&&(e.current.style.top=`${t.top}px`),null!=t.height&&(e.current.style.height=`${t.height}px`))},t.updatePreviewMetadata=Es,t.updateShowResolvedComments=function(e){return{type:NO.UpdateShowResolvedComments,payload:{showResolvedComments:e}}},t.updateZoomScaleFactor=mn,t.upscaleMaxDimension=x_,t.useAIBladeDispatch=()=>{const e=te.default.useContext(CA);if(void 0===e)throw new Error("useAIBladeDispatch must be used within a AIBladeProvider");return e},t.useAIBladeLogging=()=>{const e=te.default.useContext(OA);if(!e)throw new Error("useAIBladeLogging must be used within a AIBladeLoggingContext");return e},t.useAIBladeState=MA,t.useArchiveSubpath=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=$r(zn,e);return null==t?void 0:t.currentPath},t.useAudioVideoEditDisabledTooltipMsg=Wu,t.useCloseSidebarCallback=ro,t.useCommentAction=e=>{const{isRightSidebarComments:t,handleClick:i}=Yb(a.UserActionContext.ViewMenu);return te.default.useMemo((()=>$b(e,t,i)),[e,t,i])},t.useCurrentPageCount=xs,t.useCurrentPreviewMetadata=_r,t.useDelayCallback=ml,t.useEditLoggingExtras=e=>{var t;const{fileViewerId:i}=u.useFileViewerContext(),a=qr(i),{data:n}=du(a),r=null===(t=null==n?void 0:n.apiData)||void 0===t?void 0:t.metadata;if(!r)return null;const o="video"===r[".tag"]?r:null;if(!o)return null;const{resolution_width:s,resolution_height:l,frame_rate:c,duration:d,codec:_}=o;let p;return s&&l&&c&&d&&(p=s*l*c*d),{resolution_width:s?String(s):"",resolution_height:l?String(l):"",frame_rate:c?String(c):"",codec:_||"",total_size:p?String(p):"",extension:u.getWhitelistedFileExtension(u.getFileExtension(e))}},t.useEditorDispatch=A_,t.useExitEditModeCallback=po,t.useFileActivityAction=kb,t.useFileContentMetadataQuery=du,t.useFileContentMetadataQueryFromPlugins=cu,t.useFileMetadata=Yr,t.useFileViewerSelector=$r,t.useFrameRate=wk,t.useIsEditingVideo=Eo,t.useIsPasswordProtected=(e,t)=>{var i;const a=Vr(e,t),n=null==t?void 0:t.content;if(n&&("ssr_doc"===n[".tag"]||"cloud_doc"===n[".tag"])&&void 0!==n.image_url_tmpl&&(null===(i=a.data)||void 0===i?void 0:i.pages)&&0!==a.data.pages.length)return a.data.pages.some((e=>e.apiData.isPasswordProtected))},t.useIsTranscriptAvailable=Wg,t.useIsUserLoggedIn=tf,t.useLogExposure=Rs,t.useLogExposureCallback=Ds,t.useMaybeGenerateTranscript=Ol,t.useMediaMetadataQuery=Tl,t.useMouseActive=Zs,t.useNavigateToPageCallback=uo,t.useOnce=e=>{const t=Jr(e);return i.useMemo((()=>w.once(t)),[t])},t.useParameterizedSelector=Xr,t.usePluginMigrationContext=Mm,t.usePreparedFileInfo=ll,t.usePreviewControls=cn,t.usePreviewKeySelector=Zr,t.usePreviewState=function(e,t,i){const a=function(e){var t;const i=$r(Vn,e),a=Zr(Bn,i),n=$r(jn,e),r=pr(i),o=n&&Pn(n)?n.subpath:void 0,s=Gr(i,r,o);return s&&a&&s&&!s.isDir?{file_name:s.name,file_collection_context:a.file_collection_context,size:null!==(t=s.size)&&void 0!==t?t:0,revisionId:"",readOnly:!0}:a}(e),n=$r(Wn,e),r=pr(t),o=$r(Gn,e),s=$r(Un,e),l=n&&i(n);if(l&&o)return{fileViewerUiData:o,fileMetadata:a,filePreviewUiData:l,previewMetadata:r,fileInfo:s}},t.usePrintCallback=()=>{const{optionalIOClients:{printClient:e}}=u.useFileViewerContext(),t=function(){var e,t;const i=As();if(!i)return"";const{content:a}=i;return"image"===(null==a?void 0:a[".tag"])?null!==(e=null==a?void 0:a.full_size_src)&&void 0!==e?e:"":"ssr_doc"===(null==a?void 0:a[".tag"])&&null!==(t=null==a?void 0:a.autoprint_url)&&void 0!==t?t:""}(),i=Ms();return te.default.useMemo((()=>()=>{t&&(null==e||e.print(t,i))}),[i,e,t])},t.useRecordPreviewsTimerOnMount=Ss,t.useRenderSucceededWithLogging=(e,t)=>{const[i,n]=te.default.useState(!1);return pl(e,void 0,a.SessionEventType.FilePreviewRenderSucceeded,i),te.default.useCallback((()=>{n(!0),t()}),[t])},t.useReplayActionHandler=(e,t)=>{if(!(e instanceof F.FileSharedWithMe))return My(e,t.sdkConfig)?()=>{(e=>{a.UDCL.logEvent(p.PAP_NavigateTo_Replay({actionElement:"preview_titlebar",actionSurface:"previews",destinationSurface:"replay_preview"}));const t=e?`https://replay.dropbox.com/project/creating/${e.file_id}?creationSource=dropbox_previews_open_in_menu`:"https://replay.dropbox.com/?login=true";window.open(t)})(e)}:void 0},t.useResponsiveSize=Js,t.useRootAudioVideoUi=Xy,t.useRootFile=Os,t.useRootFileInfo=qr,t.useRootFileMetadata=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=$r(Vn,e);return Yr(t)},t.useRootPreviewMetadata=As,t.useRootPreviewMetadata$1=ur,t.useRootPreviewType=Ms,t.useSeekCallback=co,t.useSetActiveEditorCallback=go,t.useSetDeleteFileModalOpenCallback=()=>{const{fileViewerId:e}=u.useFileViewerContext(),t=b.useDispatch();return Jr((i=>t(un({isOpen:i,fileViewerId:e}))))},t.useSetLeftSidebarCallback=oo,t.useSetRightSidebarCallback=so,t.useShouldEnableClosedCaptionsButton=(e,t)=>{var i,a,n,r,o;const{isLoggedIn:s}=u.useFileViewerContext(),l="video"===(null===(i=null==t?void 0:t.content)||void 0===i?void 0:i[".tag"])||"audio"===(null===(a=null==t?void 0:t.content)||void 0===a?void 0:a[".tag"])?t.content.transcript_permission:void 0,c=Ml(e,t),d=Ol(e,t);return!!Wg(c)||!!l&&((!c.isError||c.error.statusCode===u.RivieraStatus.NotFound)&&((!c.isSuccess||0!==(null===(o=null===(r=null===(n=c.data)||void 0===n?void 0:n.apiData)||void 0===r?void 0:r.segments)||void 0===o?void 0:o.length))&&(!d.isError&&!!s)))},t.useShouldGenerateTranscript=Gg,t.useStabilizedCallback=Jr,t.useStickersQuery=e=>{var t,i;const a=TT(e).useQuery({});return te.default.useMemo((()=>{var e,t;const i=null===(t=null===(e=null==a?void 0:a.data)||void 0===e?void 0:e.apiData)||void 0===t?void 0:t.sticker_sets;return null==i?void 0:i.map((e=>({...e,id:e.set_id})))}),[null===(i=null===(t=null==a?void 0:a.data)||void 0===t?void 0:t.apiData)||void 0===i?void 0:i.sticker_sets])},t.useStrings=Rd,t.useToggleRenameStateCallback=_o,t.useTranscriptDataQuery=Ml,t.useUnity=Cy,t.useWaveformDataQuery=Cl,t.userHasDmtConflict=pd,t.utils_esnext=dg,t.v4=cN,t.warmContacts=function(e){return{type:aN.WarmContacts,payload:e}},t.watermarkActionCondition=Pg,t.withActionCondition=kd,t.withDefaults=vE,t.writeTranscriptToClipboard=VA,t.zoomIn=gn,t.zoomOut=fn}));
//# sourceMappingURL=c_file_viewer_collection_viewer.js-vflYZ7UVo.map
