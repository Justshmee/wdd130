define(["exports","metaserver/static/js/modules/constants/viewer","./c_core_uri"],(function(e,s,_){"use strict";class t{constructor(e){this.id=e.id,Object.assign(this,e)}toString(){return String(this.id)}}class i{constructor(e,s){this.active_and_paired_user_ids=s,this.users=e}get_users(){return Object.values(this.users).sort(((e,s)=>+e.linked_user_id-+s.linked_user_id))}is_uid_associated(e){return e in this.users}is_paired(){return this.active_and_paired_user_ids.length>1}has_linked_or_paired_users(){return Object.keys(this.users).length>1}get_unauthed_user_by_uid(e){return this.users[e]}}class r{static get_viewer(){return r._cached_viewer}static get_role_title(e){return this.get_viewer().get_title_with_correct_team_name(e)}static get_root_name(e){return this.get_viewer().get_root_name_with_correct_team_name(e)}static get_is_signed_in(e){return e.is_signed_in}constructor(e={}){this.replace_viewer_data(e)}replace_viewer_data(e={}){this._authed_users={},this._active_and_paired_authed_users={},this._active_and_paired_users={};const s={},_=e._user_data||[],r=_.map((e=>e.id));for(const i of _){const _=new t(i),a=r.includes(_.id);s[_.id]=_,a&&(this._active_and_paired_users[_.id]=_),i._authed&&(this._authed_users[_.id]=_,a&&(this._active_and_paired_authed_users[_.id]=_)),e.active_user_id&&e.active_user_id===_.id&&(this.active_user=_)}this.linked_users_set=new i(s,r),this.display_name=e.display_name,this.team_id=e.team_id,this.auth_role=e.auth_role,this.auth_action_type=e.auth_action_type,this.team_dbtid=e.team_dbtid,this.team_name=e.team_name,this.team_type=e.team_type,this.team_is_limited=e.team_is_limited||!1,this.team_is_locked=e.team_is_locked||!1,this.is_assume_user_session=e.is_assume_user_session||!1,this.is_team_assume_user_session=e.is_team_assume_user_session||!1,this.is_signed_in=_.length>0,this.is_paired=_.length>1,e.deprecated_first_user_in_the_cookie_id&&(this.deprecated_first_user_in_the_cookie=this.get_user_by_id(e.deprecated_first_user_in_the_cookie_id)),this._load_cached_users()}get_user_by_role(e,s){const _=this.get_uid_by_role(e);return null!=_?this.get_user_by_id(_,s):void 0}role_exists(e){return null!=this.get_uid_by_role(e)}get_user_by_id(e,s){_.assert(this.is_uid_associated(e),`User ${e} is not associated with this viewer`);const t=(s?this.linked_users_set.users:this._authed_users)[e];return _.assert(!!t,`User ${e} is not signed in`),t}is_role_signed_in(e){const s=this.get_uid_by_role(e);return null!=s&&s in this._authed_users}is_uid_signed_in(e){return e in this._authed_users}is_user_signed_in(e){return null!=e&&this.is_uid_signed_in(e.id)}is_uid_associated(e){return this.linked_users_set.is_uid_associated(e)}get_users(e){let s=this._active_and_paired_authed_users;e&&(s=this._active_and_paired_users);const _=Object.keys(s).map((e=>s[e]));return _.sort(((e,s)=>"personal"===e.role?-1:1)),_}get_user_ids(e){return this.get_users(e).map((e=>e.id))}get_roles(e){return this.get_users(e).map((e=>e.role))}get_account_ids(e){return this.get_users(e).map((e=>e.account_id))}get_email_by_role(e){const s=this.get_user_by_role(e,!0);return s&&s.email}get_uid_by_role(e){"photos"===e&&(e=this.is_paired||!this.is_signed_in?"personal":this._active_and_paired_users[Object.keys(this._active_and_paired_users)[0]].role);for(const s of Object.values(this._active_and_paired_users))if(s.role===e)return s.id}get_title_by_role(e){return"work"===e?this.team_name:this.is_paired?s.PERSONAL_ROLE_STRING:""}get_root_name_by_role(e){return this.get_title_by_role(e)||s.DEFAULT_ROOT_NAME}get_title_with_correct_team_name(e){return this.get_title_by_role(e.role)}get_root_name_with_correct_team_name(e){return this.get_title_with_correct_team_name(e)||s.DEFAULT_ROOT_NAME}_sign_out_user_by_id(e){delete this._authed_users[e],delete this._active_and_paired_users[e],this._load_cached_users()}sign_in_user_by_id(e){_.assert(this.is_uid_associated(e),`User ${e} is not associated with this viewer`),this._authed_users[e]=this.linked_users_set.users[e],this._active_and_paired_users.hasOwnProperty(e)&&(this._active_and_paired_authed_users[e]=this._active_and_paired_users[e]),this._load_cached_users()}_load_cached_users(){this.personal_user=this._authed_users[this.get_uid_by_role("personal")],this.photos_user=this._authed_users[this.get_uid_by_role("photos")],this.work_user=this._authed_users[this.get_uid_by_role("work")],this.personal_email=this.get_email_by_role("personal"),this.work_email=this.get_email_by_role("work"),this.is_personal_user_signed_in=this.is_role_signed_in("personal"),this.is_photos_user_signed_in=this.is_role_signed_in("photos"),this.is_work_user_signed_in=this.is_role_signed_in("work")}}r._cached_viewer=new r(s._viewer_properties),e.Viewer=r}));
//# sourceMappingURL=c_viewer.js-vflJLxcR0.map
