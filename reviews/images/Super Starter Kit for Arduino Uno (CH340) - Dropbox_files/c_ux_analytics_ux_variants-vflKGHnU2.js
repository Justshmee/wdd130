define(["exports","./e_folder_viewer_src_main"],(function(t,e){"use strict";const n="variants",o=",",s=":";let r=0;const a=(t=!1)=>{const n=(t,e)=>{const n=[],o=document.head.querySelectorAll(`meta[${t}]`);return o?(Array.prototype.forEach.call(o,(o=>{try{const s=o.getAttribute(t);if(!s)return;e?n.push(...JSON.parse(s)):n.push(s)}catch(t){}})),n):[]};if(t&&r>1||!t&&r)return;r++,(()=>{const t=e.getUXVariantsFromDOM();if(!t)return;const n=f(t,"matchers"),o=[];for(const[t,e]of n){const n={feature_name:t,event_name:JSON.parse(e).event_name};o.push(n)}p({variant_tokens:t,matchers:o})})();const s=n("data-uxa-matcher-configs",!0),a=n("data-uxa-variant-tokens",!1);if(!s.length||!a.length)return;p({variant_tokens:a.join(o),matchers:s})},i=(t,e)=>{let n;n=t.startsWith("adobetarget")?"adobe_target_variants":"variants",e[n]?e[n]+=o+t:e[n]=t};const c=(t,e)=>{const n=t=>decodeURIComponent(escape(t)),[o,s,r]=t.split(".").map((t=>atob(t.split("_").join("/").split("-").join("+"))));if(!r)return;if("JWT"!==JSON.parse(n(o)).typ)return;const a=JSON.parse(n(s)),i=a[e];return"https://dropbox.com/ux_analytics"===a.iss?i:void 0},f=(t,e)=>{const n=c(t,e),r=[];for(const t of n.split(o)){const e=t.split(s);2===e.length&&r.push(e.map(decodeURIComponent))}return r},m=t=>t.startsWith("adobetarget:")?(t=>{const e=t.split(o),n=[];for(const t of e)try{const[e,o,r]=t.split(s);n.push([e+s+decodeURIComponent(o),decodeURIComponent(r)])}catch(t){continue}return n})(t):f(t,n);function p(t){if(!t)return;self._DBX_UX_variants_configStore=self._DBX_UX_variants_configStore||{};const e=self._DBX_UX_variants_configStore,{variant_tokens:n,matchers:s}=t;if(n)for(const t of n.split(o)){const n=m(t);if(n)for(const[o,s]of n)e.assignments=e.assignments||{},e.assignments[o]={variant:s,variantToken:t}}if(s)for(const t of s){e.matchers=e.matchers||{};const n=t.event_name;e.matchers[n]=e.matchers[n]||{};const o={feature_name:t.feature_name,event_name:n,is_pre_tti:t.is_pre_tti,like:t.like},s=JSON.stringify(o);e.matchers[n][s]=o}}t.addConfigsFromDOM=a,t.addMatchedVariantsToEvent=function(t){const e=(t,e)=>void 0===t||((t,e)=>{if(void 0===t)return!0;const n=t;for(const t in n)if(String(e[t])!==String(n[t]))return!1;return!0})(t.extra,e.extra);if("undefined"==typeof self||!self)return;let n;a();const o=self._DBX_UX_variants_configStore,s={};if(t&&o&&o.matchers&&t.eventName&&(n=o.matchers[t.eventName]))for(const r in n){if(!o.assignments||!n.hasOwnProperty(r))continue;const a=n[r],c=o.assignments[a.feature_name];c&&(void 0===s[c.variantToken]&&e(a.like,t)&&(t.extra||(t.extra={}),i(c.variantToken,t.extra),s[c.variantToken]=!0))}},t.parseJWTToDict=t=>{const e=c(t,n),r={};for(const t of e.split(o)){const e=t.split(s);2===e.length&&(r[decodeURIComponent(e[0])]=decodeURIComponent(e[1]))}return r}}));
//# sourceMappingURL=c_ux_analytics_ux_variants.js-vflclf-bb.map
