define(["exports","./c_init_data_runtime","./c_core_uri"],(function(e,t,n){"use strict";var r,a,o;function i(e){const t=o[e];return"string"!=typeof t?e.toString():t[0].toLowerCase()+t.substring(1).replace(/[A-Z]/g,(e=>"_"+e.toLowerCase()))}e.MethodKind=void 0,(r=e.MethodKind||(e.MethodKind={}))[r.Unary=0]="Unary",r[r.ServerStreaming=1]="ServerStreaming",r[r.ClientStreaming=2]="ClientStreaming",r[r.BiDiStreaming=3]="BiDiStreaming",function(e){e[e.NoSideEffects=1]="NoSideEffects",e[e.Idempotent=2]="Idempotent"}(a||(a={})),function(e){e[e.Canceled=1]="Canceled",e[e.Unknown=2]="Unknown",e[e.InvalidArgument=3]="InvalidArgument",e[e.DeadlineExceeded=4]="DeadlineExceeded",e[e.NotFound=5]="NotFound",e[e.AlreadyExists=6]="AlreadyExists",e[e.PermissionDenied=7]="PermissionDenied",e[e.ResourceExhausted=8]="ResourceExhausted",e[e.FailedPrecondition=9]="FailedPrecondition",e[e.Aborted=10]="Aborted",e[e.OutOfRange=11]="OutOfRange",e[e.Unimplemented=12]="Unimplemented",e[e.Internal=13]="Internal",e[e.Unavailable=14]="Unavailable",e[e.DataLoss=15]="DataLoss",e[e.Unauthenticated=16]="Unauthenticated"}(o||(o={}));class s extends Error{constructor(e,t=o.Unknown,n,r){var a;super(function(e,t){return e.length?`[${i(t)}] ${e}`:`[${i(t)}]`}(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t;const s=null!==(a=null!=r?r:Array.isArray(n)?void 0:n)&&void 0!==a?a:{};this.metadata=new Headers(s),this.details=[]}}function l(e,t=o.Unknown){return e instanceof s?e:e instanceof Error?"AbortError"==e.name?new s(e.message,o.Canceled):new s(e.message):new s(String(e),t)}function d(t,n){return function(e,t){const n={};for(const[r,a]of Object.entries(e.methods)){const o=t(Object.assign(Object.assign({},a),{localName:r,service:e}));null!=o&&(n[r]=o)}return n}(t,(r=>{switch(r.kind){case e.MethodKind.Unary:return function(e,t,n){return async function(r,a){var o,i;const s=await e.unary(t,n,null==a?void 0:a.signal,null==a?void 0:a.timeoutMs,null==a?void 0:a.headers,r);return null===(o=null==a?void 0:a.onHeader)||void 0===o||o.call(a,s.header),null===(i=null==a?void 0:a.onTrailer)||void 0===i||i.call(a,s.trailer),s.message}}(n,t,r);case e.MethodKind.ServerStreaming:return function(e,t,n){return function(r,a){let o;return{[Symbol.asyncIterator]:()=>({async next(){var i,s;o||(o=await e.serverStream(t,n,null==a?void 0:a.signal,null==a?void 0:a.timeoutMs,null==a?void 0:a.headers,r),null===(i=null==a?void 0:a.onHeader)||void 0===i||i.call(a,o.header));const l=await o.read();return l.done?(null===(s=null==a?void 0:a.onTrailer)||void 0===s||s.call(a,o.trailer),{done:!0,value:void 0}):{done:!1,value:l.value}}})}}}(n,t,r);default:return null}}))}function c(e,t){return t.concat().reverse().reduce(((e,t)=>t(e)),e)}function u(e){let t,n=new Uint8Array(0);function r(e){const t=new Uint8Array(n.length+e.length);t.set(n),t.set(e,n.length),n=t}return new ReadableStream({start(){t=e.getReader()},async pull(e){let a;for(;;){if(void 0===a&&n.byteLength>=5){let e=0;for(let t=1;t<5;t++)e=(e<<8)+n[t];a={flags:n[0],length:e}}if(void 0!==a&&n.byteLength>=a.length+5)break;const e=await t.read();if(e.done)break;r(e.value)}if(void 0===a)return 0==n.byteLength?void e.close():void e.error(new s("premature end of stream",o.DataLoss));const i=n.subarray(5,5+a.length);n=n.subarray(5+a.length),e.enqueue({flags:a.flags,data:i})}})}function g(e,t,n){const r=e.data.length+5,a=new Uint8Array(t,n,r);a[0]=e.flags;for(let t=e.data.length,n=4;n>0;n--)a[n]=t%256,t>>>=8;return a.set(e.data,5),r}class f extends t.Message{constructor(e){super(),this.code=0,this.message="",this.details=[],t.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new f).fromBinary(e,t)}static fromJson(e,t){return(new f).fromJson(e,t)}static fromJsonString(e,t){return(new f).fromJsonString(e,t)}static equals(e,n){return t.proto3.util.equals(f,e,n)}}function h(e){!function(){try{new Headers}catch(e){throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}();const t=e;return{async unary(n,r,a,i,s,d){var g,f,h,p;try{return await(f={stream:!1,service:n,method:r,url:`${e.baseUrl.replace(/\/$/,"")}/${n.typeName}/${r.name}`,init:{method:"POST",credentials:null!==(g=e.credentials)&&void 0!==g?g:"same-origin",redirect:"error",mode:"cors"},header:w(s,i),message:d instanceof r.I?d:new r.I(d),signal:null!=a?a:(new AbortController).signal},h=async n=>{var a,o,i;const s=await fetch(n.url,Object.assign(Object.assign({},n.init),{headers:n.header,signal:n.signal,body:m(n.message,e.binaryOptions)})),l=null!==(i=null!==(o=null!==(a=b(s))&&void 0!==a?a:y(s.headers))&&void 0!==o?o:U(s.headers))&&void 0!==i?i:A(s.headers);if(l)throw l;if(!s.body)throw"missing response body";const d=u(s.body).getReader(),c=await d.read();if(c.done)throw"premature eof";if(c.value.flags===v)throw S(c.value.data),"unexpected trailer";const g=r.O.fromBinary(c.value.data,t.binaryOptions),f=await d.read();if(f.done)throw"missing trailer";if(f.value.flags!==v)throw"missing trailer";const h=S(f.value.data);if(!(await d.read()).done)throw"extraneous data";return{stream:!1,header:s.headers,message:g,trailer:h}},p=t.interceptors,p&&(h=c(h,p)),h(f))}catch(e){throw l(e,o.Internal)}},async serverStream(t,n,r,a,i,d){var g,f,h,p;try{return await(f={stream:!1,service:t,method:n,url:`${e.baseUrl.replace(/\/$/,"")}/${t.typeName}/${n.name}`,init:{method:"POST",credentials:null!==(g=e.credentials)&&void 0!==g?g:"same-origin",redirect:"error",mode:"cors"},header:w(i,a),message:d instanceof n.I?d:new n.I(d),signal:null!=r?r:(new AbortController).signal},h=async r=>{var a,i,d;const c=await fetch(r.url,Object.assign(Object.assign({},r.init),{headers:r.header,signal:r.signal,body:m(r.message,e.binaryOptions)})),g=null!==(d=null!==(i=null!==(a=b(c))&&void 0!==a?a:y(c.headers))&&void 0!==i?i:U(c.headers))&&void 0!==d?d:A(c.headers);if(g)throw g;if(!c.body)throw"missing response body";const f=u(c.body).getReader();let h=!1,p=!1;return{stream:!0,service:t,method:n,header:c.headers,trailer:new Headers,async read(){try{const t=await f.read();if(t.done){if(p&&!h)throw new s("missing trailers",o.Internal);return{done:!0,value:void 0}}return(t.value.flags&v)===v?(h=!0,S(t.value.data).forEach(((e,t)=>this.trailer.append(t,e))),{done:!0,value:void 0}):(p=!0,{done:!1,value:n.O.fromBinary(t.value.data,e.binaryOptions)})}catch(e){throw l(e)}}}},p=e.interceptors,p&&(h=c(h,p)),h(f))}catch(e){throw l(e,o.Internal)}}}}function m(e,t){return function(...e){const t=new ArrayBuffer(e.reduce(((e,t)=>e+t.data.length+5),0));let n=0;for(const r of e)n+=g(r,t,n);return new Uint8Array(t)}({data:e.toBinary(t),flags:p})}f.runtime=t.proto3,f.typeName="grpc.status.v1.Status",f.fields=t.proto3.util.newFieldList((()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:t.Any,repeated:!0}]));const p=0,v=128;function w(e,t){const n=new Headers(null!=e?e:{});return n.set("Content-Type","application/grpc-web+proto"),n.set("X-Grpc-Web","1"),n.set("X-User-Agent","@bufbuild/connect-web"),void 0!==t&&n.set("Grpc-Timeout",`${t}m`),n}function y(e){const t=e.get("Content-Type");switch(null==t?void 0:t.toLowerCase()){case"application/grpc-web":case"application/grpc-web+proto":return;case"application/grpc-web-text":case"application/grpc-web-text+proto":return new s("grpc-web-text is not supported",o.Internal);default:return new s(`unexpected content type: ${String(t)}`,o.Internal)}}function b(e){var t;const n=function(e){switch(e){case 200:return null;case 400:return o.Internal;case 401:return o.Unauthenticated;case 403:return o.PermissionDenied;case 404:return o.Unimplemented;case 429:case 502:case 503:case 504:return o.Unavailable;default:return o.Unknown}}(e.status);if(n)return new s(decodeURIComponent(null!==(t=e.headers.get("grpc-message"))&&void 0!==t?t:""),n)}function A(e){var t;const n=e.get("grpc-status");if(null===n)return;const r=parseInt(n);return 0!==r?r in o?new s(decodeURIComponent(null!==(t=e.get("grpc-message"))&&void 0!==t?t:""),r,void 0,e):new s(`invalid grpc-status: ${n}`,o.Internal,void 0,e):void 0}function U(e){const n=e.get("grpc-status-details-bin");if(null!=n)try{const r=function(e,n,r){try{const a=t.protoBase64.dec(e);return n?n.fromBinary(a,r):a}catch(e){throw new s(e instanceof Error?e.message:String(e),o.DataLoss)}}(n,f);if(0==r.code)return;const a=new s(r.message,r.code,void 0,e);return a.details.push(...r.details),a}catch(t){const n=l(t,o.Internal);return e.forEach(((e,t)=>n.metadata.append(t,e))),n}}function S(e){var t;const n=function(e){const t=new Headers,n=String.fromCharCode(...e).split("\r\n");for(const e of n){if(""===e)continue;const n=e.indexOf(":");if(n>0){const r=e.substring(0,n).trim(),a=e.substring(n+1).trim();t.append(r,a)}}return t}(e),r=null!==(t=U(n))&&void 0!==t?t:A(n);if(r)throw r;return n}const O=e=>!!e&&"0"!==e.toString();const I="/web-grpc/edison";function x(e=""){return"undefined"!=typeof window?window.location.host:n.URI.parse(e).getAuthority()}const E=e=>n=>t.__awaiter(void 0,void 0,void 0,(function*(){const r=t.getRequestOriginalUrl(),a=Object.assign(Object.assign({"Accept-Language":t.getPageLocale(),"X-Edison-Atlasservlet":t.getAtlasservlet(),"X-Edison-Page-Name":t.getPageName(),"X-Edison-Original-Url":r,"X-Edison-Original-Referer":t.getRequestOriginalReferrer()||"","X-Edison-Prompt-Controller":t.getInitData().deprecatedPromptController||"","X-Edison-Prompt-Action":t.getInitData().deprecatedPromptAction||"","X-Dropbox-Browser-Id":t.getDeviceIdHex(),"X-Dropbox-Authority":x(r)},function(e){const t={};return e&&(e.activeUser&&O(e.activeUser.id)&&(t["X-Dropbox-Uid"]=e.activeUser.id.toString()),e.activeTeam&&O(e.activeTeam.id)&&(t["X-Dropbox-Teamid"]=e.activeTeam.id.toString()),(e.authRole||e.authActionType)&&(t["X-Dropbox-Team-Authorization"]=JSON.stringify({auth_role:String(e.authRole),auth_action_type:String(e.authActionType)}))),t}(t.getAuthRequestInfo())),t.getExtraHttpRequestHeaders());return t.getPageName()&&(a["X-Dropbox-Client-Yaps-Attribution"]=`${t.getAtlasservlet()}:${t.getPageName()}`),Object.entries(a).filter((([e,t])=>!!t)).filter((([e,t])=>!(e.toLowerCase().startsWith("x-")&&n.header.has(e)))).forEach((([e,t])=>{t&&!n.header.has(e)&&n.header.set(e,t)})),yield e(n)}));function C(e=I){return h({baseUrl:e,interceptors:[E]})}e.createEdisonGRPCWebPromiseClient=function(e,t=I){return d(e,C(t))},e.createEdisonGrpcWebTransport=C}));
//# sourceMappingURL=c_init_data_edison.js-vflfj_2ai.map
