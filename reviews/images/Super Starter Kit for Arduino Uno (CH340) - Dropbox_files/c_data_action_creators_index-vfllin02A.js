define(["exports","./c_init_data_runtime","./e_folder_viewer_src_main","./c_src_sink_index","./c_files_view_data_store","./c_core_i18n","./c_browse_data_selectors","./c_api_v2_client_base","./c_core_uri","./c_react_query_helpers_helpers","metaserver/static/js/modules/constants/web_experience_constants","./e_core_exception","./c_browse_models","./c_core_notify","react","./c_lodash-es_lodash","./c_bolt_metaserver_clients","./c_tagging_logger","./c_sync_everything_redux_selectors","./c_shared_with_redux_store","./c_structured_tags_redux_selectors","metaserver/static/js/modules/constants/search"],(function(e,t,s,a,r,i,n,o,l,c,d,u,_,p,f,g,m,h,S,T,E,v){"use strict";class y extends t.Message{constructor(e){super(),this.actionSource="",t.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new y).fromBinary(e,t)}static fromJson(e,t){return(new y).fromJson(e,t)}static fromJsonString(e,t){return(new y).fromJsonString(e,t)}static equals(e,s){return t.proto3.util.equals(y,e,s)}}y.runtime=t.proto3,y.typeName="hql_events.WebBrowseSelectRow",y.fields=t.proto3.util.newFieldList((()=>[{no:1,name:"action_source",kind:"scalar",T:9},{no:2,name:"hql_metadata",kind:"message",T:s.HQLMetadata}]));const A="web_file_actions";function F(e){return{class:"folder_modal",action:"create",object:"folder_from_modal",properties:e}}const w=({user:e,name:n,destination:o,checkFsw:l,origin:c,surface:d})=>t.__awaiter(void 0,void 0,void 0,(function*(){const u=a.getMetricsReporter(),_={surface:d},p={latency:u.createTimer({ns:A,name:"create-folder/latency_ms"},_),completed:u.createStats({ns:A,name:"create-folder/completed"},_)};C(c),s.Snackbar$1.sync(i.intl.formatMessage(r.createFolderSnackbarProgress),!1,"browse-action");const f=yield s.createFolder(o,n,e,l);if(f.isError&&"path"===f.error[".tag"]&&"file_system_warnings"===f.error.path[".tag"]){s.Snackbar$1.close("browse-action");return(yield function(e){return t.__awaiter(this,void 0,void 0,(function*(){return new Promise((t=>{r.showFileSystemWarningsModal({fsws:e,onFinalAccept:()=>{t(!0)},onAbortAction:()=>{t(!1)},confirmText:i.intl.formatMessage(r.createFolderFswConfirmText)})}))}))}(f.error.path.details))?yield w({user:e,name:n,destination:o,checkFsw:!1,origin:c,surface:d}):(I(c),{type:"cancel"})}return p.latency.record(),f.isError?("path"===f.error[".tag"]&&"malformed_path"===f.error.path[".tag"]?(s.Snackbar$1.fail(i.intl.formatMessage(r.createFolderErrorMalformedPath),"browse-action"),p.completed.record(1)):(s.Snackbar$1.fail(i.intl.formatMessage(r.createFolderErrorGeneric),"browse-action"),p.completed.record(0)),function(e,t,a){r.logWebUserAction({event_name:s.WebUserActionLogEvent.CREATE_FOLDER_ERROR,extra:{error_summary:e||null,error:t||null,origin:a||null}}),s.UDCL.logEvent(F({eventState:"failed"}))}(f.error_summary,f.error[".tag"],c),{type:"error",summary:f.error_summary,error:f.error[".tag"]}):(s.Snackbar$1.complete(i.intl.formatMessage(r.createFolderSnackbarSuccess),"browse-action",void 0),b(c),p.completed.record(1),{type:"success",folder:f.result.metadata})}));function I(e){r.logWebUserAction({event_name:s.WebUserActionLogEvent.CREATE_FOLDER_CANCEL,extra:{origin:e||null}}),s.UDCL.logEvent(F({eventState:"canceled"}))}function C(e){r.logWebUserAction({event_name:s.WebUserActionLogEvent.CREATE_FOLDER_PENDING,extra:{origin:e||null}}),s.UDCL.logEvent({class:"navigation",action:"select",object:"create_folder_action",properties:{contentAction:"create_folder_pending",actionSurface:"browse_screen"}})}function b(e){const t=s.UUID.v4();r.logWebUserAction({event_name:s.WebUserActionLogEvent.CREATE_FOLDER_SUCCESS,extra:{origin:e||null,validation_trace_id:t}}),s.UserSurvey.trackEvent("create_item","browse"),s.UDCL.logEvent(F({eventState:"success",validationTraceId:t}))}i.intl.formatMessage({id:"A5Lqjf",defaultMessage:"Add a few details about this folder here."}),i.intl.formatMessage({id:"ssdefa",defaultMessage:"Can’t save changes. Paste text elsewhere to save, then click Refresh."}),i.intl.formatMessage({id:"5dt0hu",defaultMessage:"Can’t save changes. Reload the page and try again."}),i.intl.formatMessage({id:"PM6K+P",defaultMessage:"Can’t save changes."}),i.intl.formatMessage({id:"9C/lc5",defaultMessage:"Can’t @mention someone in your Personal Dropbox."}),i.intl.formatMessage({id:"+dhj1b",defaultMessage:"Can’t @mention someone in your member folder."}),i.intl.formatMessage({id:"b7//2e",defaultMessage:"You don’t have permission to share this folder."});const L=s.defineMessage({id:"mjXnuX",defaultMessage:"Pinned to {folderName}"}),O=s.defineMessage({id:"A1Fokf",defaultMessage:"Unpinned from {folderName}"}),N=s.defineMessage({id:"8msMyU",defaultMessage:"Show"});i.intl.formatMessage({id:"HRXOjw",defaultMessage:"opt"}),i.intl.formatMessage({id:"RIxWSs",defaultMessage:"alt"}),i.intl.formatMessage({id:"FL9yea",defaultMessage:"ctrl"}),i.intl.formatMessage({id:"NWv/3R",defaultMessage:"⌘"}),i.intl.formatMessage({id:"Kud10T",defaultMessage:"Everyone in this folder can see notes, tasks, and pinned items"}),i.intl.formatMessage({id:"sl5Fj7",defaultMessage:"I @mentioned you in this folder. Take a look."});const R=s.defineMessage({id:"kh62rs",defaultMessage:"Pin “{name}” to..."}),M=s.defineMessage({id:"oU0z79",defaultMessage:"Pin {num} items to..."}),U=s.defineMessage({id:"BGyZpk",defaultMessage:"You do not have permission to pin to {path}"}),P=s.defineMessage({id:"UD2+LM",defaultMessage:"Can't pin files or folders to a read-only folder"});i.intl.formatMessage({id:"tc/4YZ",defaultMessage:"Your changes weren’t saved because you are editing this description elsewhere."}),i.intl.formatMessage({id:"4aEgv5",defaultMessage:"Please wait until they’re done before making changes."}),i.intl.formatMessage({id:"oYSO1Z",defaultMessage:"Please save your other changes before making them here."}),i.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"});const D=[],k=e=>s.getStateAtNamespace(e,s.FOLDER_OVERVIEW_NAMESPACE_KEY)||r.defaultFolderOverviewState,x=e=>k(e).folderDataCache,V=e=>k(e).fileIdCache,W=(e,t)=>V(e)[r.normalizePath(t.path)],q=e=>e.BROWSE&&e.BROWSE.user||c.mkUser(e.SEARCH.user),B=(e,t)=>(e=>k(e).componentDataCache)(e)[t.componentNamespace],G=(e,t)=>{const s=W(e,t);return x(e)[s]};r.createSelector(G,(e=>e?e.descriptionFormatVersion:void 0));const j=r.createSelector(G,(e=>{if(e&&e.description)try{return JSON.parse(e.description)}catch(e){return}})),$=r.createSelector(G,(e=>{if(void 0!==e&&void 0!==e.contentReferences)return 0===e.contentReferences.length?D:r.convertContentReferencesToSortedFiles(e.contentReferences)}));r.createSelector(j,(e=>{if(!e)return!0;if(0===e.blocks.length)return!0;if(e.blocks.length>1)return!1;if("unstyled"!==e.blocks[0].type)return!1;return 0===e.blocks.map((e=>e.text)).join("\n").replace(/%u200B/g,"").trim().length}));r.createSelector(q,r.convertDbxUserToIUser);r.createSelector(B,(e=>!(!e||0===e.requiredComponents.length)&&0===e.requiredComponents.filter((t=>!e.loadedComponents.includes(t))).length)),r.createSelector(B,(e=>!!e&&e.hasFailedToLoad));const z=r.createSelector(W,(e=>e));r.createSelector(G,(e=>e?e.loggingFileId:void 0)),r.createSelector($,(e=>e));const H=e=>n.browseLoadingState(e)===s.LoadingState.LOADED?n.sortedFiles(e).count():n.getBrowseState(e).paginatedTotalNumFiles;r.createSelector(n.context,H,((e,t)=>e.isInsideVaultFolder&&null!=e.currentNSPath&&s.paths_are_equal(e.currentNSPath,"")&&0===t)),r.createSelector(n.context,H,n.experiments,((e,t,a)=>e.isInFamilySharedFolder&&null!=e.currentNSPath&&s.paths_are_equal(e.currentNSPath,"")&&0===t));const Y=(e,a,i,n,o)=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=r.previewThumbnailsToLoad(a()),l=r.selectViewType(a(),{instanceId:o});try{if(t.length>0){const a=new c.UserApiV2Client,o=yield s.GetPreviewsRoutes(a).rpc("get_preview_data_batch",{files:t},{subjectUserId:i}),u=[];o.results.forEach((e=>{var t;const s=null===(t=e.preview)||void 0===t?void 0:t.content,a=e.file.file_id;a&&s&&(s.hasOwnProperty("thumbnail_url_tmpl")?u.push({file_id:a,preview_url:s.thumbnail_url_tmpl}):s.hasOwnProperty("placeholder_image_url")&&u.push({file_id:a,preview_url:s.placeholder_image_url}))})),u.length>0&&(e((({preview_thumbnails:e})=>({type:r.ActionTypes.PREVIEW_THUMBNAILS_LOADED,payload:{preview_thumbnails:e}}))({preview_thumbnails:u})),d={view_type:l,userId:i,num_files_requested:t.length,num_files_retrieved:u.length,elapsed_ms:Date.now()-n},r.logWebUserAction({user_id:d.userId,event_name:s.WebUserActionLogEvent.PREVIEW_THUMBNAIL_SUCCESS,extra:{view_type:d.view_type,num_files_requested:d.num_files_requested.toString(),num_files_retrieved:d.num_files_retrieved.toString(),elapsed_ms:d.elapsed_ms.toString()}}))}}catch(a){e((({files:e})=>({type:r.ActionTypes.PREVIEW_THUMBNAILS_REMOVED,payload:{files:e}}))({files:t})),(e=>{r.logWebUserAction({user_id:e.userId,event_name:s.WebUserActionLogEvent.PREVIEW_THUMBNAIL_ERROR,extra:{view_type:e.view_type,error_summary:e.error_summary||"unknown"}})})({view_type:l,userId:i,error_summary:String(a)})}var d})),K=g.debounce(((e,t,s,a,r)=>{Y(e,t,s,a,r)}),300),Z=(e,t,s)=>(a,i)=>{const n=r.previewThumbnails(i()),o=e.filter((e=>e.file_id&&!n.hasOwnProperty(e.file_id)));o.length>0&&(a((({files:e})=>({type:r.ActionTypes.PREVIEW_THUMBNAILS_LOADING,payload:{files:e}}))({files:o})),K(a,i,t,Date.now(),s))},J=new c.UserApiV2Client;class Q extends a.EventEmitter{constructor(){super(),this.setUpdateChannelForType=(e,t)=>{this.signedChannelStates[e]=new m.SignedChannelState(t.appId,t.uniqueId,t.revision,t.token),this.boltClient.update_states(g.values(this.signedChannelStates)),this.boltClient.start()},this.handleUpdate=e=>{const t=[];e.forEach((e=>{const s=g.findKey(this.signedChannelStates,{app_id:e.app_id,unique_id:e.unique_id});s&&!t.includes(s)&&(this.emit("update",{type:s}),t.push(s))}))},this.handleRefresh=()=>{this.boltClient.update_states(g.values(this.signedChannelStates))},this.boltClient=new m.MetaserverBoltClient([],this.handleUpdate,this.handleRefresh),this.signedChannelStates={}}stop(){this.boltClient.unsubscribe()}}const X=new Q;new s.HiveLogger;const ee=()=>({}),te=function({user:e,files:t,override:s=!1,onSuccess:a}){return(i,n)=>{0!==t.length&&h.tagsApiClient.getTags(e,t).then((e=>{i((({fileToTags:e,override:t})=>({type:r.ActionTypes$1.SET_FILE_TO_TAGS_MAP,payload:{fileToTags:e,override:t}}))({fileToTags:e,override:s})),null==a||a()}))}};function se(e){return{class:"navigation",action:"select",object:"content_tile",properties:e}}function ae(e){return e.ns("structured_tags")}const re=new class{getStructuredTagTemplates(){var e;return t.__awaiter(this,void 0,void 0,(function*(){const t=new s.DefaultUserApiV2Client(c.mustGetActiveUser());try{const s=yield ae(t).rpc("get_all_structured_tag_templates",{},{});return(null===(e=s.templates)||void 0===e?void 0:e.map((e=>le(e))))||[]}catch(e){return[]}}))}getStructuredTagsForFiles(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=new s.DefaultUserApiV2Client(c.mustGetActiveUser());try{const s=yield ae(t).rpc("get_structured_tags_by_content_ids",{content_ids:e.map(h.createContentIdFromFile)},{});return s.result?ie(s.result):{}}catch(e){return{}}}))}createOrUpdateStructuredTagTemplate(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=new s.DefaultUserApiV2Client(c.mustGetActiveUser());try{const s=yield ae(t).rpc("create_or_update_structured_tag_template",{template:pe(e)},{});return s.template?le(s.template):void 0}catch(e){return}}))}setStructuredTagForFile({file:e,tagData:a}){return t.__awaiter(this,void 0,void 0,(function*(){const t=new s.DefaultUserApiV2Client(c.mustGetActiveUser()),i=h.createContentIdFromFile(e),n={template_id:a.templateId,content_id:i,field_values:a.fieldValues.map((e=>{var t;return"selectionValues"===(null===(t=e.field)||void 0===t?void 0:t.values.case)?{field_id:Number(e.field.id),field_value:{".tag":"selection_id",selection_id:e.selectionValueId}}:{}}))},o=yield ae(t).rpc("set_structured_tag_for_content_id",n,{}),l=r.getFileObjectNsIdAndPathKey({nsId:i.ns_id,nsPath:i.ns_path});return o.result?{[l]:ne([o.result])}:{}}))}},ie=e=>e.reduce(((e,{content_id:t,selected_tags:s})=>Object.assign(Object.assign({},e),{[r.getFileObjectNsIdAndPathKey({nsId:t.ns_id,nsPath:t.ns_path})]:s?ne(s):[]})),{}),ne=e=>e.map((e=>{var t;return new E.SelectedStructuredTagObject({template:le(e.template),fieldValues:null===(t=e.field_values)||void 0===t?void 0:t.map((e=>oe(e)))})})),oe=e=>e.field_value&&"selection_id"===e.field_value[".tag"]&&e.field_value.selection_id&&e.field_id?new E.SelectedStructuredTagField({fieldId:t.protoInt64.parse(e.field_id),fieldValue:{value:{value:t.protoInt64.parse(e.field_value.selection_id),case:"selectionId"}}}):new E.SelectedStructuredTagField,le=e=>new E.StructuredTagsTemplate({id:t.protoInt64.parse(e.id),name:e.name,isActivated:e.is_activated,isDeleted:e.is_deleted,type:ue(e.type),fields:e.fields.map((e=>ce(e))),lastModifiedTime:t.protoInt64.parse(e.last_modified_time)}),ce=e=>{const s=new E.StructuredTagsField({id:t.protoInt64.parse(e.id),name:e.name,isDeleted:e.is_deleted});return e.values&&"selection_values"===e.values[".tag"]&&(s.values={value:new E.StructuredTagsSelectionValues({values:e.values.values.map((e=>de(e)))}),case:"selectionValues"}),s},de=e=>new E.StructuredTagsSelectionValue({id:t.protoInt64.parse(e.id),name:e.name,color:_e(e.color),isDeleted:e.is_deleted,description:e.description}),ue=e=>"manual_classification"===e[".tag"]?E.TemplateType.MANUAL_CLASSIFICATION:E.TemplateType.MANAGED_METADATA,_e=e=>"green"===e[".tag"]?E.StructuredTagColor.GREEN:"blue"===e[".tag"]?E.StructuredTagColor.BLUE:"yellow"===e[".tag"]?E.StructuredTagColor.YELLOW:"red"===e[".tag"]?E.StructuredTagColor.RED:E.StructuredTagColor.GRAY,pe=e=>({id:Number(e.id),name:e.name,is_activated:e.isActivated,is_deleted:e.isDeleted,type:me(e.type),fields:e.fields.map((e=>fe(e))),last_modified_time:Number(e.lastModifiedTime)}),fe=e=>{const t={id:Number(e.id),name:e.name,is_deleted:e.isDeleted};return e.values&&"selectionValues"===e.values.case&&(t.values={".tag":"selection_values",values:e.values.value.values.map((e=>ge(e)))}),t},ge=e=>({id:Number(e.id),name:e.name,is_deleted:e.isDeleted,description:e.description,color:he(e.color)}),me=e=>e===E.TemplateType.MANUAL_CLASSIFICATION?{".tag":"manual_classification"}:{".tag":"managed_metadata"},he=e=>{switch(Number(e)){case E.StructuredTagColor.GREEN:return{".tag":"green"};case E.StructuredTagColor.BLUE:return{".tag":"blue"};case E.StructuredTagColor.YELLOW:return{".tag":"yellow"};case E.StructuredTagColor.RED:return{".tag":"red"};case E.StructuredTagColor.GRAY:return{".tag":"gray"};default:return{".tag":"other"}}},Se=({files:e})=>(s,a)=>t.__awaiter(void 0,void 0,void 0,(function*(){"default"===E.selectStructuredTagStoreStatus(a())&&s(((e,s)=>t.__awaiter(void 0,void 0,void 0,(function*(){e({type:r.ActionTypes$2.SET_STATUS,payload:{status:r.StructuredTagsNamespaceStatus.IS_LOADING}});const t=yield re.getStructuredTagTemplates();e({type:r.ActionTypes$2.SET_TEMPLATES,payload:{structuredTagTemplates:t}})}))));const i=yield re.getStructuredTagsForFiles(e);s({type:r.ActionTypes$2.SET_FILE_TO_STRUCTURED_TAGS_MAP,payload:{fileToTags:i}})}));const Te=T.getStoreForSharedWith(),Ee=({fqPathsToSelect:e})=>({type:r.ActionTypes$3.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:e}}),ve=({filePathsToSelectOnNextUpdate:e})=>({type:r.ActionTypes$3.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:e}}),ye=({newFolderCreationState:e})=>({type:r.ActionTypes$3.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:e}}),Ae=({actionSource:e,skipLogging:t}={})=>(({selection:e,actionSource:t,skipLogging:a})=>(i,o)=>{var l;if(!a){const a=o(),i=n.selection(a),{event:c,itemId:u}=r.makeSelectionEvent(i,e),_=n.selectFileByFullPath(a,{path:u}),p=r.selectViewType(o(),{instanceId:s.BROWSE_FILES_VIEW_ID});if("ON"===d.CONTENT_TILES&&(p===s.ViewType.Grid||p===s.ViewType.LargeGrid)){const o=n.selectFilesByFullPaths(a,{paths:e.selected,excludeNoAccessSharedFolders:!0}),c=(e=r.createSelection(o.map((e=>e.fq_path)),null!==(l=e.anchor)&&void 0!==l?l:"")).selected.filter((e=>!i.selected.contains(e))),d=i.selected.filter((t=>!e.selected.contains(t))),u={actionElement:s.ActionSurfaceLogValue.CONTENT_TILE,actionSource:t};c.size>0&&s.logEvent(se(Object.assign(Object.assign({},u),{selectType:"select"}))),d.size>0&&s.logEvent(se(Object.assign(Object.assign({},u),{selectType:"deselect"})))}if(_){const{num_files_selected:i,num_folders_selected:o}=r.countFilesAndFolders(n.selectFilesForSelection(a,{selection:e}));if(c===s.WebUserActionLogEvent.SELECT_ROW){let e="";p===s.ViewType.Grid||p===s.ViewType.LargeGrid||p===s.ViewType.SmallGrid?e="content_tile":(p===s.ViewType.List||s.ViewType.CondensedList)&&(e="file_row"),s.UDCL.logEvent({class:"browse",action:"select",object:"item",properties:{actionSurface:"browse_screen",actionElement:e,viewType:p}}),s.logEvent$1(new y({actionSource:t}))}r.logBrowseAction({uid:n.user(a).id,action:c,action_source:t,num_files_selected:i,num_folders_selected:o,view_type:p,result:_,extra:{entity_type:_.is_dir?"folder":"file"}})}}i({type:r.ActionTypes$3.SET_SELECTION,payload:{selection:e,actionSource:t}}),Ie(i,o,e)})({actionSource:e,skipLogging:t,selection:r.createSelection()}),Fe=({unsortedFiles:e})=>(a,r)=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=n.user(r());a(we({unsortedFiles:e})),s.initializeStore(t,e.toArray())})),we=({unsortedFiles:e})=>({type:r.ActionTypes$3.SET_UNSORTED_FILES,payload:{unsortedFiles:e}}),Ie=(e,t,a)=>{if(!a||0===a.selected.count())return;const r=n.unsortedFiles(t()),i=null==r?void 0:r.filter((e=>a.selected.has(e.fq_path)&&!e.thumbnail_url_tmpl)),o=[];if(null==i||i.forEach((e=>{o.push({file_id:e.file_id,sj_id:e.sjid,ns_id:e.ns_id})})),o.length>0){const a=n.user(t()).id;e(Z(o,a,s.BROWSE_FILES_VIEW_ID))}};e.FILE_ACTIONS_AMP_NAMESPACE=A,e.PIN_TO_FAILURE_PERMISSION_DENIED=U,e.PIN_TO_MODAL_TITLE_MULTIPLE=M,e.PIN_TO_MODAL_TITLE_SINGLE=R,e.PIN_TO_READ_ONLY_FOLDER=P,e.PIN_TO_SNACKBAR_MESSAGE=L,e.SNACKBAR_SHOW_BUTTON_TEXT=N,e.UNPIN_FROM_SNACKBAR_MESSAGE=O,e.accountCache=e=>k(e).accountCache,e.addContentReferences=(e,t,a)=>s.GetFilesRoutes(J).rpc("add_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:a},{subjectUserId:e}),e.addContentReferencesToPath=(e,t,a)=>s.GetFilesRoutes(J).rpc("add_content_references_to_path",{path:t,return_roots_as_ns_ids:!0,file_ids:a},{subjectUserId:e}),e.appendFiles=({path:e,files:t,currentFolderInfo:a})=>(i,o)=>{if(!s.paths_are_equal(e,n.path(o())))return;if(n.selectedFilter(o())!==r.BrowseFilterType.NONE)return;const l=n.unsortedFiles(o()),c=l.size;let d=c;t.forEach((e=>{l.has(e.fq_path)||d++}));const _=l.merge(s.immutableExports.Map(t.map((e=>[e.fq_path,e]))));Fe({unsortedFiles:_})(i,o,ee),(({unsortedFiles:e})=>(t,a)=>{const r=n.filePathsToSelectOnNextUpdate(a()).toArray().map((e=>e.toLowerCase())),i=e.toArray().filter((e=>r.includes(e.fq_path.toLowerCase()))).map((e=>e.fq_path.toLowerCase())),o=r.filter((e=>!i.includes(e.toLowerCase())));0!==i.length&&(t(Ee({fqPathsToSelect:i})),t(ve({filePathsToSelectOnNextUpdate:s.immutableExports.Set(o)})))})({unsortedFiles:_})(i,o,ee),!v.SEARCH_WEB_MAIN2_KIEV_ENABLED&&n.isFetchTagsOnBrowseEnabled(n.manualTaggingVariant(o()))&&(a=null!=a?a:n.getCurrentFolderInfo(o()),i(te({user:n.user(o()),files:a?[...t,a]:[...t],override:0===c}))),n.user(o()).is_team&&"ON"===n.structuredTaggingVariant(o())&&i(Se({files:a?[...t,a]:[...t]})),Te.dispatch(T.pathLoaded({path:e})),_.size!==d&&u.reportException({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:u.SEVERITY.NONCRITICAL,exc_extra:{previous_unsorted_files_size:c,incoming_files_size:t.length,expected_files_size:d,updated_unsorted_files_size:_.size,is_deleted_files_on:n.shouldShowDeletedFiles(o())}})},e.batchContentType=function(e){return e.every((e=>e.is_dir))?"folders":e.every((e=>!e.is_dir))?"files":"mixed"},e.bucketForBatchSize=function(e){return 1===e?"single":e<=10?"small":e<=100?"medium":e<=1e3?"large":"massive"},e.completeFolderSizes=({fetchFolderSizeState:e})=>({type:r.ActionTypes$3.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:e}}),e.createFolder=w,e.createFolder$1=({pathName:e,folderName:a,user:r,checkFSWs:i,showShareModalOnSuccess:o,redirectOnSuccess:l,redirectOnCancel:c,selectCreatedFolder:d=!0,origin:u})=>(p,f)=>t.__awaiter(void 0,void 0,void 0,(function*(){p(ye({newFolderCreationState:s.NewFolderCreationState.SAVING_INPUT}));const t=yield w({destination:e,name:a,user:r,checkFsw:i,origin:u,surface:"browse"});if("success"===t.type){const e=(g=t.folder,new _.File({file_id:g.id,fq_path:g.path_display||"",icon:g.icon,is_dir:!0,ns_path:""})),a=n.unsortedFiles(f()).set(e.fq_path,e);p(we({unsortedFiles:a})),d&&p(Ee({fqPathsToSelect:[e.fq_path]})),l&&l(e.fq_path),o&&o(e,s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL)}else c&&c();var g;p(ye({newFolderCreationState:s.NewFolderCreationState.CREATE_FOLDER_INACTIVE}))})),e.fetchAllTagsSuggestions=function({user:e,onSuccess:t}){return(s,a)=>{void 0===n.selectAllTagsSuggestions(a())&&h.tagsApiClient.getAllTags(e).then((e=>{s((({tags:e})=>({type:r.ActionTypes$1.SET_ALL_TAGS,payload:{tags:e}}))({tags:e})),null==t||t()}))}},e.fileFromMetadata=(e,t)=>{if("file"===t[".tag"]){const s=t,a=Object.assign(Object.assign({},e),{fq_path:s.path_display||e.fq_path,icon:s.icon+"_32",revision_id:s.rev,file_id:s.id});return new _.File(a)}return"folder"===t[".tag"]?new _.File(Object.assign(Object.assign({},e),{fq_path:t.path_display||e.fq_path})):e},e.fileIdCache=V,e.folderDataCache=x,e.folderOverviewFolderFileId=e=>z(e,{path:n.path(e)}),e.folderOverviewLiveUpdateManager=X,e.getContentReferences=(e,t)=>s.GetFilesRoutes(J).rpc("get_content_references_info",{file_id:t},{subjectUserId:e}),e.getUserAccount=({userId:e,accountId:t})=>s.GetUsersRoutes(J).rpc("get_account",{account_id:t},{subjectUserId:e}),e.loadPreviewThumbnails=Z,e.logCreateFolder=function({uid:e,view_type:t,origin:a,source:i}){r.logWebUserAction({user_id:e,event_name:s.WebUserActionLogEvent.CREATE_FOLDER,view_type:t||null,extra:Object.assign({origin:a},i&&{source:i})})},e.logCreateFolderCancel=I,e.logCreateFolderPending=C,e.logCreateFolderSuccess=b,e.popBoltIgnore=e=>({type:r.ActionTypes$3.POP_BOLT_IGNORE,payload:e}),e.pushBoltIgnore=e=>({type:r.ActionTypes$3.PUSH_BOLT_IGNORE,payload:e}),e.recordPathLookupErrors=function(e,t,s){const r={};e.forEach((e=>{if("path_lookup"===e.failure[".tag"]){const t=e.failure.path_lookup[".tag"];r[t]=(r[t]||0)+1}}));for(const e in r)r.hasOwnProperty(e)&&a.getMetricsReporter().createStats({ns:A,name:"common/failure/path_lookup"},Object.assign(Object.assign({},s),{lookupFailureType:e,operation:t})).record(r[e])},e.removeContentReferences=(e,t,a)=>s.GetFilesRoutes(J).rpc("remove_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:a},{subjectUserId:e}),e.requestFolderSizes=({fqPath:e})=>({type:r.ActionTypes$3.REQUEST_FOLDER_SIZES,payload:{fqPath:e}}),e.selectFilesByFqPath=Ee,e.setCurrentFolderRename=({renameState:e})=>({type:r.ActionTypes$3.SET_CURRENT_FOLDER_RENAME,payload:{renameState:e}}),e.setFilePathsToSelectOnNextUpdate=ve,e.setFileRename=({file:e,renameState:t})=>({type:r.ActionTypes.SET_FILE_RENAME,payload:{file:e,renameState:t}}),e.setFolderSizesPending=({fetchFolderSizesResp:e})=>({type:r.ActionTypes$3.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:e}}),e.setIsCreatingSharedLink=({fileIdOrPath:e,isCreatingSharedLink:t})=>({type:r.ActionTypes$3.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:e,isCreatingSharedLink:t}}),e.setLoadingState=({loadingState:e,path:t})=>({type:r.ActionTypes$3.SET_LOADING_STATE,payload:{loadingState:e,path:t}}),e.setNewFolderCreationState=ye,e.setPaginatedTotalNumFiles=({paginatedTotalNumFiles:e})=>({type:r.ActionTypes$3.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:e}}),e.setUnsortedFiles=Fe,e.setUrl=({path:e="",qargs:t,expandedRightSidebar:a})=>(i,o)=>{var c;s.DBHistory.push_state(n.urlPrefix(o())+l.URI.encode_parts(e),g.omitBy(Object.assign(Object.assign({},g.pick(s.getQueryArgs(),["d"])),t),g.isUndefined)),i(Ae({skipLogging:!0})),a&&i((c=a,(e,t)=>{const s=n.user(t());r.setRightSidebar(s.id,c),e({type:r.ActionTypes$3.SET_RIGHT_SIDEBAR,payload:{sidebar:c}})}))},e.showRewind=()=>({type:r.ActionTypes$3.SHOW_TIMELINE,payload:{timestamp:(new Date).getTime()}}),e.user=q}));
//# sourceMappingURL=c_data_action_creators_index.js-vflVWgPMX.map
