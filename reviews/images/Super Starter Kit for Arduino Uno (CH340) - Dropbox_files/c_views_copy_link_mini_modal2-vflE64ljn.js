define(["require","exports","react","./e_folder_viewer_src_main","./c_apex-metrics_src_types","./c_components_sharing_spinner","./c_core_i18n","metaserver/static/js/modules/constants/sharing","./c_sharing_async_share_modal_util","./c_ui-icon_line_team","./c_esm_misc_util","./c_lodash-es_lodash","./c_shared_with_redux_store","./c_init_data_runtime","./e_core_exception","./c_stormcrow_explicit_exposure_logging","./c_core_uri","./c_react_query_helpers_helpers","./c_api_v2_client_base","./c_src_sink_index"],(function(e,t,i,s,n,o,r,a,l,c,p,d,h,u,_,f,E,g,L,I){"use strict";function m(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var A=m(i);const C="copy-link-mini-modal__header",T="V1"===a.SHARING_EXPERIMENTS.MINI_MODAL_LINK_AUDIENCE_VARIANT||"V2"===a.SHARING_EXPERIMENTS.MINI_MODAL_LINK_AUDIENCE_VARIANT;class k extends A.Component{constructor(){super(...arguments),this._getContentName=e=>{if(e){const t=e.split("/");return t[t.length-1]}}}render(){return A.createElement("div",{className:C},A.createElement("div",{className:`${C}-content`},this.props.stageType===s.ModalStage.PENDING&&this._renderPendingStage(),this.props.stageType===s.ModalStage.COPY&&this._renderCopyStage(),this.props.stageType===s.ModalStage.RESULT&&this._renderResultStage(),this.props.stageType===s.ModalStage.ERROR_CLIENT&&this._renderClientErrorStage(),this.props.stageType===s.ModalStage.ERROR_SERVER&&this._renderServerErrorStage()),this._renderCloseButton())}_renderPendingStage(){return A.createElement(A.Fragment,null,A.createElement(o.SharingSpinner,{ariaValue:"Loading xsmall",textSize:"standard"}),A.createElement(s.Text,{className:`${C}--pending-text`},r.intl.formatMessage({id:"LPF3tp",defaultMessage:"Getting the link..."})))}_renderCopyStage(){return A.createElement(s.Text,null,A.createElement(s.Link,{href:"#",hasNoUnderline:!0,onClick:this.props.actionHandler,isBold:!0},A.createElement(s.UIIcon,{src:s.LinkLine,"aria-label":""}),r.intl.formatMessage({id:"emiHs/",defaultMessage:"Copy Link"})))}_renderResultStage(){const e=r.intl.formatMessage({id:"l+Mf7Y",defaultMessage:"Allows editing."}),t=r.intl.formatMessage({id:"FXqYpV",defaultMessage:"Allows viewing."});let i,n="";void 0!==this.props.linkAccessLevel&&(n="editor"===this.props.linkAccessLevel?e:t),this.props.fileInfo?i=this.props.fileInfo.fq_path:this.props.fileUploadInfo?i=this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name:this.props.browseFileInfo&&(i=this.props.browseFileInfo.fq_path);const o=this._getContentName(i),a=o?A.createElement(s.Truncate,{className:`${C}--content-name`,maxWidth:225,observeParent:!0,location:.5},o):void 0,l=a?r.intl.formatMessage({id:"WbjrkH",defaultMessage:"Link copied to <b>{contentNameInHeader}</b>."},{contentNameInHeader:a,b:e=>A.createElement("b",null,e)}):r.intl.formatMessage({id:"v2yJMn",defaultMessage:"Link copied."});return T?A.createElement(A.Fragment,null,A.createElement(s.UIIcon,{className:`${C}--result-icon`,style:{paddingBottom:"4px"},src:s.LinkLine,size:"standard","aria-label":""}),A.createElement("div",{className:`${C}--result-container`,style:{marginLeft:"0px"}},A.createElement(s.Text,{className:`${C}--result-text`},l," "))):A.createElement(A.Fragment,null,A.createElement(s.UIIcon,{className:`${C}--result-icon`,src:s.CheckmarkCircleLine,size:"standard","aria-label":""}),A.createElement("div",{className:`${C}--result-container`},A.createElement(s.Text,{className:`${C}--result-text`},l," "),A.createElement(s.Text,null,n)))}_renderClientErrorStage(){return A.createElement(A.Fragment,null,A.createElement(s.UIIcon,{className:`${C}--client-error-icon`,src:s.FailLine,"aria-label":""}),A.createElement(s.Text,{className:`${C}--client-error-text`},A.createElement("b",null,r.intl.formatMessage({id:"rp1Lxc",defaultMessage:"Couldn't copy the link."})," "),A.createElement(s.Link,{href:"#",hasNoUnderline:!0,onClick:this.props.actionHandler,isBold:!0},r.intl.formatMessage({id:"wXhxJC",defaultMessage:"Try again"}))))}_renderServerErrorStage(){return A.createElement(A.Fragment,null,A.createElement("div",null,A.createElement(s.UIIcon,{size:"standard",src:s.FailLine,"aria-label":""})),A.createElement(s.Text,{className:`${C}--server-error-text`},this.props.errorMessage))}_renderCloseButton(){return A.createElement(s.IconButton,{"aria-label":"close",onClick:this.props.closeButtonHandler,variant:"transparent",isRounded:!0,size:"small"},A.createElement(s.UIIcon,{src:s.CloseLine,"aria-label":""}))}}k.displayName="CopyLinkMiniModalHeaderComponent";const O=s.requireCssWithComponent(k,["/static/metaserver/static/css/dig-components/index.web-vflzskH5s.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vfldwamKU.css"]);class S extends A.Component{constructor(){super(...arguments),this.handleCopy=()=>{this.props.onCopyToClipboard(s.CopyLinkMethod.MANUAL)}}componentDidMount(){this.props.shouldFocusOnLink&&this.props.focusOnInput()}componentDidUpdate(){this.props.shouldFocusOnLink&&this.props.focusOnInput()}render(){return A.createElement("div",{className:"copy-link-mini-modal__link"},A.createElement(s.TextInput,{onCopy:this.handleCopy,size:"standard","aria-label":r.intl.formatMessage({id:"qx4buj",defaultMessage:"Link for copy link click"}),value:this.props.sharedLink.url,readOnly:!0,onClick:this.props.focusOnInput,ref:this.props.inputRef}))}}S.displayName="CopyLinkMiniModalLinkComponent";const N=s.requireCssWithComponent(S,["/static/metaserver/static/css/dig-components/index.web-vflzskH5s.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vfldwamKU.css"]),v="copy-link-mini-modal__footer";class y extends A.Component{constructor(){super(...arguments),this.handleManageClick=()=>{s.ShareTibEventLogger.log(this.props.user.id,s.TiburonEventName.ClickManageLinkSettings,s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL,Object.assign(Object.assign({},s.buildExtraFromLinkMetadata(this.props.sharedLink)),{fq_path:this.getFqPath()}));let e={origin:s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL};if("V1"===a.SHARING_EXPERIMENTS.MINI_MODAL_LINK_AUDIENCE_VARIANT){const t="editor"===this.props.linkAccessLevel?"edit_link_settings":"view_link_settings";e={origin:s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL,initialScreen:"settings",initialTab:t}}if(this.props.fileInfo)l.asyncShowShareModal(this.props.user,this.props.fileInfo,e);else if(this.props.fileUploadInfo)l.asyncShowShareModal(this.props.user,{fqPath:this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name,isFolder:!1},e);else{if(!this.props.browseFileInfo)return void s.sharingNotificationError(r.intl.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}));l.asyncShowShareModal(this.props.user,this.props.browseFileInfo,e)}this.props.closeButtonHandler()}}render(){return A.createElement("div",{className:v},A.createElement("div",{className:`${v}-content`},this._renderLinkInfo(),this._renderManageButton()))}_renderLinkInfo(){return A.createElement(s.Text,{style:{display:"flex",alignItems:"center"},color:"subtle",size:"small"},this.renderAudienceIcon(),this.formatLinkInfoText())}_renderManageButton(){return A.createElement(s.Button,{variant:"transparent",size:"small",style:{marginLeft:"8px"},onClick:this.handleManageClick},r.intl.formatMessage({id:"6BOuuN",defaultMessage:"Manage"}))}getFqPath(){let e;return this.props.fileInfo?e=this.props.fileInfo.fq_path:this.props.fileUploadInfo?e=this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name:this.props.browseFileInfo&&(e=this.props.browseFileInfo.fq_path),e}formatLinkInfoText(){return this.props.contentType?"public"===this.props.linkAudience?r.intl.formatMessage({id:"8kew9O",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"team"===this.props.linkAudience?r.intl.formatMessage({id:"LlzMnS",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"password"===this.props.linkAudience?r.intl.formatMessage({id:"2yevNp",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"no_one"===this.props.linkAudience?r.intl.formatMessage({id:"iv/o3s",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"":"public"===this.props.linkAudience?r.intl.formatMessage({id:"5n50wF",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"team"===this.props.linkAudience?r.intl.formatMessage({id:"HcnRtr",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"password"===this.props.linkAudience?r.intl.formatMessage({id:"ego60b",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"no_one"===this.props.linkAudience?r.intl.formatMessage({id:"VUeAlW",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):""}renderAudienceIcon(){let e=null;return"public"===this.props.linkAudience?e=c.GlobeLine:"team"===this.props.linkAudience?e=c.TeamLine:"no_one"===this.props.linkAudience?e=p.LockLine:"password"===this.props.linkAudience&&(e=p.PasswordsLine),null===e?null:A.createElement(s.UIIcon,{src:e,size:"small",style:{marginRight:"4px",paddingBottom:"1px"}})}}y.displayName="CopyLinkMiniModalFooterComponent";const R=s.requireCssWithComponent(y,["/static/metaserver/static/css/dig-components/index.web-vflzskH5s.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vfldwamKU.css"]),M="V1"===a.SHARING_EXPERIMENTS.MINI_MODAL_LINK_AUDIENCE_VARIANT||"V2"===a.SHARING_EXPERIMENTS.MINI_MODAL_LINK_AUDIENCE_VARIANT;class b extends A.default.Component{constructor(){super(...arguments),this.onWindowResize=d.throttle((()=>{this.props.anchorRef.current||this.props.closeButtonHandler()}),500),this.handleClick=e=>{e.preventDefault(),e.stopPropagation()}}componentDidMount(){window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}render(){var e;const{anchorRef:t,inputRef:i,stage:n,closeButtonHandler:o,linkAccessLevel:r,sharedLink:a,shouldFocusOnLink:l,focusOnInput:c,actionHandler:p,errorMessage:d,onCopyToClipboard:h,zIndexOverride:u,placement:_,fileInfo:f,fileUploadInfo:E,browseFileInfo:g,linkAudience:L,user:I,isFromFlexibleSharingEntrypoint:m}=this.props,C=A.default.createElement(O,{stageType:n,actionHandler:p,closeButtonHandler:o,sharedLink:a,linkAccessLevel:r,errorMessage:d,fileInfo:f,fileUploadInfo:E,browseFileInfo:g});let T=A.default.createElement(A.default.Fragment,null);a&&c&&i&&(T=A.default.createElement(N,{sharedLink:a,focusOnInput:c,inputRef:i,shouldFocusOnLink:l,onCopyToClipboard:h}));let k=A.default.createElement(A.default.Fragment,null);if((M||m)&&a&&n===s.ModalStage.RESULT){let e;"object"==typeof a&&".tag"in a&&(e=a[".tag"]),e||(e=a.file_type),k=A.default.createElement(R,{linkAccessLevel:r,linkAudience:L,contentType:e,fileInfo:f,fileUploadInfo:E,browseFileInfo:g,user:I,sharedLink:a,closeButtonHandler:o})}return A.default.createElement(s.LayerContext.Provider,{value:{zIndex:u||20}},A.default.createElement(s.ClickOutside,{isActive:!0,onClickOutside:o,shouldPropagateMouseEvents:!1,isBlock:!0,shouldClickOutsideWhenDefaultPrevented:!0},A.default.createElement(s.Overlay,{className:"copy-link-mini-modal__overlay",anchorRef:t,placement:_||"bottom",auto:!0,offsetDistance:null!==(e=this.props.yOffsetDistance)&&void 0!==e?e:4,onClick:this.handleClick},C,T,k)))}}b.displayName="CopyLinkMiniModalOverlayComponent";const w=s.requireCssWithComponent(b,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vfldwamKU.css","/static/metaserver/static/css/dig-components/index.web-vflzskH5s.css"]),P="udcl_web_client_tracing";!function(){var t,i,s,n,o,r;u.__awaiter(this,void 0,void 0,(function*(){try{const{getActiveUserId:a}=yield new Promise((function(t,i){e(["./c_react_query_helpers_helpers"],t,i)})).then((function(e){return e.active_user_esnext})),{getVariantInfos:l,logExposure:c}=yield new Promise((function(t,i){e(["./c_stormcrow_explicit_exposure_logging"],t,i)})),p=yield l([P],a()),d=null==p?void 0:p[0],h="ON"===(null==d?void 0:d.variant),u=null!==(s=null===(i=null===(t=null==d?void 0:d.metadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.population_id)&&void 0!==s?s:"",_=null!==(r=null===(o=null===(n=null==d?void 0:d.metadata)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.identity_gid)&&void 0!==r?r:"",f={stormcrowVariantInfo:{feature:P,variant:null==d?void 0:d.variant,metadata:{metadata:{population_id:u,identity_gid:_}}}};if(h){c(f.stormcrowVariantInfo);const{tracer:t}=yield new Promise((function(t,i){e(["./c_tracing_tracer"],t,i)}));return{default:t}}}catch(e){_.reportException({err:e,severity:_.SEVERITY.NONCRITICAL})}return{default:{}}}))}();class F extends A.default.Component{constructor(e){super(e),this.getPAPLoggerContent=()=>this.props.file?s.getContentFromFile(this.props.file):this.props.browseFile?s.getContentFromFile(this.props.browseFile):this.props.fileUpload?s.getContentFromFileUpload(this.props.fileUpload):void 0,this.appendSenderTrackeyToLinkIfEnabled=()=>{s.isSharedLinkAttributionTrackingEnabled()&&this.sharedLink&&this.sharedLink.url&&(this.sharedLink=s.getNewLinkMetadataWithSenderTrackeyURL(this.sharedLink,this.senderTrackey))},this.handleCopyLinkToClipboard=()=>{this.appendSenderTrackeyToLinkIfEnabled(),s.copyToClipboard(this.sharedLink.url,(()=>{this.handleClipboardSuccess(s.CopyLinkMethod.EXEC_COMMAND)}),this.handleClipboardFailure)},this.handleClipboardSuccess=e=>{e!==s.CopyLinkMethod.MANUAL&&this.setState({stage:s.ModalState.RESULT}),this.logEvent(s.TiburonEventName.CopySharedLink,{created_new_link:this.isLinkNewlyCreated,copy_method:e,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCopyLinkTime),sender_trackey:s.isSharedLinkAttributionTrackingEnabled()?this.senderTrackey:void 0})},this.handleClipboardFailure=()=>{this.copyLinkToClipboardNewAPI()},this.copyLinkToClipboardNewAPI=()=>{if(navigator.clipboard){const e=this.sharedLink.url;navigator.clipboard.writeText(e).then((()=>{this.handleClipboardSuccess(s.CopyLinkMethod.CLIPBOARD_API)}),(()=>{this.handleClipboardFailureNewAPI()}))}else this.handleClipboardFailureNewAPI()},this.handleClipboardFailureNewAPI=()=>{this.exceptionType=s.CopyLinkException.FAILED_COPY_TO_CLIPBOARD,this.failToFetchCopyLinkHelper()},this.getLinkActionTTI=e=>Date.now()-e,this.onClose=()=>{this.props.setIsCreatingSharedLink(!1,this.fileIdOrPath),this.props.userActionSource===s.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!1}),this.props.onActionFlowComplete&&this.props.onActionFlowComplete(),this.setState({isOpen:!1})},this.focusOnInput=()=>{this.inputRef.current&&this.inputRef.current.select()},this.inputRef=A.default.createRef(),this.state={isOpen:!0,stage:s.ModalState.PENDING},this.fileIdOrPath=this.getFileIdOrPath();const{actionSurface:t,actionElement:i,origin:n,contentAction:o}=this.getOriginAndAction();this.actionSurface=t,this.actionElement=i,this.contentAction=o,this.origin=n,this.requestedAccessLevel="default",this.senderTrackey=s.vendSenderTrackey()}componentDidMount(){s.logPAPCreateSharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent()}),f.logExposure({feature:"sharing_mini_modal_link_audience",variant:a.SHARING_EXPERIMENTS.MINI_MODAL_LINK_AUDIENCE_VARIANT}),this.createSharedLink()}createSharedLink(){this.props.setIsCreatingSharedLink(!0,this.fileIdOrPath),this.props.userActionSource===s.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!0}),this.startCreateLinkTime=Date.now();const e=s.getApiClient(this.props.user),t=this.requestedAccessLevel;e.createSharedLinkNonAlpha({fileIdOrPath:this.fileIdOrPath,settings:{access:t}}).then((e=>{this.startCopyLinkTime=Date.now(),this.succeedToFetchLinkHelper(e,!0),this.logEvent(s.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:this.getAccessLevel()})})).catch((e=>{this.startCopyLinkTime=Date.now(),e.error[".tag"]===s.CopyLinkException.SHARED_LINK_ALREADY_EXISTS?this.succeedToFetchLinkHelper(e.error.shared_link_already_exists.metadata,!1,e):e.error[".tag"]===s.CopyLinkException.ACCESS_DENIED?(this.exceptionType=s.CopyLinkException.ACCESS_DENIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===s.CopyLinkException.SETTINGS_ERROR&&e.error.settings_error[".tag"]===s.CopyLinkException.NOT_AUTHORIZED?(this.exceptionType=s.CopyLinkException.NOT_AUTHORIZED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===s.CopyLinkException.PATH&&e.error.path[".tag"]===s.CopyLinkException.NOT_FOUND?(this.exceptionType=s.CopyLinkException.NOT_FOUND,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===s.CopyLinkException.EMAIL_NOT_VERIFIED?(this.exceptionType=s.CopyLinkException.EMAIL_NOT_VERIFIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===s.CopyLinkException.BANNED_MEMBER?(this.exceptionType=s.CopyLinkException.BANNED_MEMBER,this.userMessage=e.message,this.failToFetchCopyLinkHelper(e)):(this.exceptionType=e.error[".tag"]?e.error[".tag"]:s.CopyLinkException.UNDEFINED_ERROR,this.failToFetchCopyLinkHelper(e)),this.logEvent(s.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:t,timing:this.getLinkActionTTI(this.startCopyLinkTime)})}))}succeedToFetchLinkHelper(e,t,i){this.sharedLink=e,this.isLinkNewlyCreated=t;const n=t?200:i&&i.raw&&i.raw.status;this.logEvent(s.TiburonEventName.SucceedCreateSharedLinkWithSettings,{created_new_link:t,http_status_code:n,response_status:"success",is_alpha:!1,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCreateLinkTime)}),t&&this.props.file&&h.getStoreForSharedWith().dispatch(h.sharedLinkDataOutOfDate(this.props.file.fq_path)),s.isBrowserCopyEnabled()?this.handleCopyLinkToClipboard():this.setState({stage:s.ModalState.COPY}),s.logPAPCreateSharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,httpCode:n}),s.publishEvent(s.CampaignEvents.FILE_SHARE_SUCCESS,{context:{file_name:this.props.file?s.getFilename(this.props.file):"",file_extension:this.props.file?s.getExtension$1(this.props.file):"",file_path:this.props.file?this.props.file.fq_path:""}})}failToFetchCopyLinkHelper(e){e&&this.logEvent(s.TiburonEventName.FailCreateSharedLinkWithSettings,{error_message:this.exceptionType,http_status_code:e.raw&&e.raw.status,is_alpha:!1,timing:this.getLinkActionTTI(this.startCreateLinkTime)}),this.setState({stage:s.ModalState.ERROR}),this.logEvent(s.TiburonEventName.CopySharedLinkFailure,{error:this.exceptionType,timing:this.getLinkActionTTI(this.startCopyLinkTime)}),s.logPAPCreateSharedLinkEvent({eventState:s.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e.raw&&e.raw.status,exception:this.exceptionType})}getFileIdOrPath(){var e,t;return(null===(e=this.props.file)||void 0===e?void 0:e.file_id)||(null===(t=this.props.file)||void 0===t?void 0:t.fq_path)||this.props.filePath}getAccessLevel(){const e=this.sharedLink?this.sharedLink.link_permissions.link_access_level:void 0;let t="viewer";return e&&(t=e.hasOwnProperty(".tag")?e[".tag"]:e),t}getLinkVisibilityMapping(e){switch(e){case"public":case"password":case"no_one":return e;case"team_only":return"team";case"team_and_password":return"password";case"shared_folder_only":case"only_you":return"no_one"}}getLinkAudience(){if(!this.sharedLink)return;let e;const t=this.sharedLink.link_permissions;if(t.effective_audience)e=t.effective_audience,"object"==typeof e&&".tag"in e&&(e=e[".tag"]);else{let i;i=t.resolved_visibility,"object"==typeof i&&".tag"in i&&(i=i[".tag"]),e=this.getLinkVisibilityMapping(i)}return e}logEvent(e,t){var i,o;let r=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON;this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.RIGHT_SIDEBAR?(r=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS_BUTTON,t=this.props.rightRailCollapsed?Object.assign(Object.assign({},t),{source:"right_rail_collapsed"}):Object.assign(Object.assign({},t),{source:"right_rail_open"})):this.props.userActionSource===s.ActionSourceValue.OVERFLOW_MENU?r=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU:this.props.userActionSource===s.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?r=s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.PREVIEW_TITLEBAR?r=s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.CONTENT_TILE?r=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.FLEXIBLE_SHARING_ENTRYPOINT&&(r=this.props.origin);const a=n.get_browser_info();s.ShareTibEventLogger.log(this.props.user.id,e,r,Object.assign(Object.assign(Object.assign({},s.buildExtraFromLinkMetadata(this.sharedLink)),{file_id:null===(i=this.props.file)||void 0===i?void 0:i.file_id,fq_path:(null===(o=this.props.file)||void 0===o?void 0:o.fq_path)||this.props.filePath,browser:a.browser,browser_version:a.version}),t)),e===s.TiburonEventName.CopySharedLink&&s.trackUserLeapEvent(s.SharingUserLeapEvent.SHARE_LINK_COPY_SUCCESS,r)}getOriginAndAction(){let e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON,t="browse_screen",i="browse_directory_row";return this.props.isSearchMode?(t="search",i="search_directory_row",this.props.userActionSource===s.ActionSourceValue.OVERFLOW_MENU&&(i="content_overflow_menu")):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.RIGHT_SIDEBAR?(e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,i="action_bar_overflow_menu"):this.props.userActionSource===s.ActionSourceValue.OVERFLOW_MENU?this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.FOLDER_SETTINGS_MENU?(e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,i="context_menu"):(e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU,i="content_overflow_menu"):this.props.userActionSource===s.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?(e=s.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL,i="upload_modal"):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.PREVIEW_TITLEBAR?(e=s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR,t="previews",i="preview_titlebar"):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.FLEXIBLE_SHARING_ENTRYPOINT?(e=s.SHARE_ACTION_ORIGIN_TYPE.FLEXIBLE_SHARING_ENTRYPOINT,t=this.props.actionSurface,i="flexible_sharing_entrypoint"):this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.CONTENT_TILE&&(e=s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON,t="browse_screen",i="content_tile"),{origin:e,actionSurface:t,actionElement:i,contentAction:"copy_link"}}static show(e,t){s.Modal$1.showInstance(A.default.createElement(x,Object.assign({},e)),!0,t)}render(){if(!this.state.isOpen)return null;switch(this.appendSenderTrackeyToLinkIfEnabled(),this.state.stage){case s.ModalState.PENDING:return A.default.createElement(w,{stage:s.ModalStage.PENDING,closeButtonHandler:this.onClose,anchorRef:this.props.anchorRef,zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement});case s.ModalState.COPY:return A.default.createElement(w,{stage:s.ModalStage.COPY,actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,anchorRef:this.props.anchorRef,inputRef:this.inputRef,shouldFocusOnLink:!1,onCopyToClipboard:this.handleClipboardSuccess,zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement});case s.ModalState.ERROR:return this.exceptionType!==s.CopyLinkException.FAILED_COPY_TO_CLIPBOARD?this.exceptionType===s.CopyLinkException.BANNED_MEMBER&&this.userMessage?(this.onClose(),s.failBannerWithHelpCenter(this.userMessage,s.ABUSE_HELP_ARTICLE_LINK),null):A.default.createElement(w,{stage:s.ModalStage.ERROR_SERVER,closeButtonHandler:this.onClose,anchorRef:this.props.anchorRef,errorMessage:s.getServerErrorMessage(this.exceptionType),zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement}):A.default.createElement(w,{stage:s.ModalStage.ERROR_CLIENT,actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,anchorRef:this.props.anchorRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleClipboardSuccess,zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement});case s.ModalState.RESULT:return A.default.createElement(w,{stage:s.ModalStage.RESULT,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,anchorRef:this.props.anchorRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleClipboardSuccess,zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,isFromFlexibleSharingEntrypoint:this.props.userActionSurfaceLogValue===s.ActionSurfaceLogValue.FLEXIBLE_SHARING_ENTRYPOINT})}}}F.displayName="CopyLinkMiniModalComponent";const x=s.requireCssWithComponent(F,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vfldwamKU.css","/static/metaserver/static/css/dig-components/index.web-vflzskH5s.css"]);t.CopyLinkMiniModal=x,t.CopyLinkMiniModalComponent=F}));
//# sourceMappingURL=c_views_copy_link_mini_modal2.js-vflPdY6Zh.map
