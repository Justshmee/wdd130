define(["exports","./c_init_data_runtime","./c_core_uri"],(function(e,t,n){"use strict";var r,a,o;function i(t){const n=e.Code[t];return"string"!=typeof n?t.toString():n[0].toLowerCase()+n.substring(1).replace(/[A-Z]/g,(e=>"_"+e.toLowerCase()))}e.MethodKind=void 0,(r=e.MethodKind||(e.MethodKind={}))[r.Unary=0]="Unary",r[r.ServerStreaming=1]="ServerStreaming",r[r.ClientStreaming=2]="ClientStreaming",r[r.BiDiStreaming=3]="BiDiStreaming",function(e){e[e.NoSideEffects=1]="NoSideEffects",e[e.Idempotent=2]="Idempotent"}(a||(a={})),e.Code=void 0,(o=e.Code||(e.Code={}))[o.Canceled=1]="Canceled",o[o.Unknown=2]="Unknown",o[o.InvalidArgument=3]="InvalidArgument",o[o.DeadlineExceeded=4]="DeadlineExceeded",o[o.NotFound=5]="NotFound",o[o.AlreadyExists=6]="AlreadyExists",o[o.PermissionDenied=7]="PermissionDenied",o[o.ResourceExhausted=8]="ResourceExhausted",o[o.FailedPrecondition=9]="FailedPrecondition",o[o.Aborted=10]="Aborted",o[o.OutOfRange=11]="OutOfRange",o[o.Unimplemented=12]="Unimplemented",o[o.Internal=13]="Internal",o[o.Unavailable=14]="Unavailable",o[o.DataLoss=15]="DataLoss",o[o.Unauthenticated=16]="Unauthenticated";class s extends Error{constructor(t,n=e.Code.Unknown,r,a){var o;super(function(e,t){return e.length?`[${i(t)}] ${e}`:`[${i(t)}]`}(t,n)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=t,this.code=n;const s=null!==(o=null!=a?a:Array.isArray(r)?void 0:r)&&void 0!==o?o:{};this.metadata=new Headers(s),this.details=[]}}function d(t,n=e.Code.Unknown){return t instanceof s?t:t instanceof Error?"AbortError"==t.name?new s(t.message,e.Code.Canceled):new s(t.message):new s(String(t),n)}function l(t,n){return function(e,t){const n={};for(const[r,a]of Object.entries(e.methods)){const o=t(Object.assign(Object.assign({},a),{localName:r,service:e}));null!=o&&(n[r]=o)}return n}(t,(r=>{switch(r.kind){case e.MethodKind.Unary:return function(e,t,n){return async function(r,a){var o,i;const s=await e.unary(t,n,null==a?void 0:a.signal,null==a?void 0:a.timeoutMs,null==a?void 0:a.headers,r);return null===(o=null==a?void 0:a.onHeader)||void 0===o||o.call(a,s.header),null===(i=null==a?void 0:a.onTrailer)||void 0===i||i.call(a,s.trailer),s.message}}(n,t,r);case e.MethodKind.ServerStreaming:return function(e,t,n){return function(r,a){let o;return{[Symbol.asyncIterator]:()=>({async next(){var i,s;o||(o=await e.serverStream(t,n,null==a?void 0:a.signal,null==a?void 0:a.timeoutMs,null==a?void 0:a.headers,r),null===(i=null==a?void 0:a.onHeader)||void 0===i||i.call(a,o.header));const d=await o.read();return d.done?(null===(s=null==a?void 0:a.onTrailer)||void 0===s||s.call(a,o.trailer),{done:!0,value:void 0}):{done:!1,value:d.value}}})}}}(n,t,r);default:return null}}))}function c(e,t){return t.concat().reverse().reduce(((e,t)=>t(e)),e)}function u(t){let n,r=new Uint8Array(0);function a(e){const t=new Uint8Array(r.length+e.length);t.set(r),t.set(e,r.length),r=t}return new ReadableStream({start(){n=t.getReader()},async pull(t){let o;for(;;){if(void 0===o&&r.byteLength>=5){let e=0;for(let t=1;t<5;t++)e=(e<<8)+r[t];o={flags:r[0],length:e}}if(void 0!==o&&r.byteLength>=o.length+5)break;const e=await n.read();if(e.done)break;a(e.value)}if(void 0===o)return 0==r.byteLength?void t.close():void t.error(new s("premature end of stream",e.Code.DataLoss));const i=r.subarray(5,5+o.length);r=r.subarray(5+o.length),t.enqueue({flags:o.flags,data:i})}})}function g(e,t,n){const r=e.data.length+5,a=new Uint8Array(t,n,r);a[0]=e.flags;for(let t=e.data.length,n=4;n>0;n--)a[n]=t%256,t>>>=8;return a.set(e.data,5),r}class f extends t.Message{constructor(e){super(),this.code=0,this.message="",this.details=[],t.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new f).fromBinary(e,t)}static fromJson(e,t){return(new f).fromJson(e,t)}static fromJsonString(e,t){return(new f).fromJsonString(e,t)}static equals(e,n){return t.proto3.util.equals(f,e,n)}}function h(t){!function(){try{new Headers}catch(e){throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}();const n=t;return{async unary(r,a,o,i,s,l){var g,f,h,p;try{return await(f={stream:!1,service:r,method:a,url:`${t.baseUrl.replace(/\/$/,"")}/${r.typeName}/${a.name}`,init:{method:"POST",credentials:null!==(g=t.credentials)&&void 0!==g?g:"same-origin",redirect:"error",mode:"cors"},header:w(s,i),message:l instanceof a.I?l:new a.I(l),signal:null!=o?o:(new AbortController).signal},h=async e=>{var r,o,i;const s=await fetch(e.url,Object.assign(Object.assign({},e.init),{headers:e.header,signal:e.signal,body:m(e.message,t.binaryOptions)})),d=null!==(i=null!==(o=null!==(r=b(s))&&void 0!==r?r:y(s.headers))&&void 0!==o?o:A(s.headers))&&void 0!==i?i:C(s.headers);if(d)throw d;if(!s.body)throw"missing response body";const l=u(s.body).getReader(),c=await l.read();if(c.done)throw"premature eof";if(c.value.flags===v)throw U(c.value.data),"unexpected trailer";const g=a.O.fromBinary(c.value.data,n.binaryOptions),f=await l.read();if(f.done)throw"missing trailer";if(f.value.flags!==v)throw"missing trailer";const h=U(f.value.data);if(!(await l.read()).done)throw"extraneous data";return{stream:!1,header:s.headers,message:g,trailer:h}},p=n.interceptors,p&&(h=c(h,p)),h(f))}catch(t){throw d(t,e.Code.Internal)}},async serverStream(n,r,a,o,i,l){var g,f,h,p;try{return await(f={stream:!1,service:n,method:r,url:`${t.baseUrl.replace(/\/$/,"")}/${n.typeName}/${r.name}`,init:{method:"POST",credentials:null!==(g=t.credentials)&&void 0!==g?g:"same-origin",redirect:"error",mode:"cors"},header:w(i,o),message:l instanceof r.I?l:new r.I(l),signal:null!=a?a:(new AbortController).signal},h=async a=>{var o,i,l;const c=await fetch(a.url,Object.assign(Object.assign({},a.init),{headers:a.header,signal:a.signal,body:m(a.message,t.binaryOptions)})),g=null!==(l=null!==(i=null!==(o=b(c))&&void 0!==o?o:y(c.headers))&&void 0!==i?i:A(c.headers))&&void 0!==l?l:C(c.headers);if(g)throw g;if(!c.body)throw"missing response body";const f=u(c.body).getReader();let h=!1,p=!1;return{stream:!0,service:n,method:r,header:c.headers,trailer:new Headers,async read(){try{const n=await f.read();if(n.done){if(p&&!h)throw new s("missing trailers",e.Code.Internal);return{done:!0,value:void 0}}return(n.value.flags&v)===v?(h=!0,U(n.value.data).forEach(((e,t)=>this.trailer.append(t,e))),{done:!0,value:void 0}):(p=!0,{done:!1,value:r.O.fromBinary(n.value.data,t.binaryOptions)})}catch(e){throw d(e)}}}},p=t.interceptors,p&&(h=c(h,p)),h(f))}catch(t){throw d(t,e.Code.Internal)}}}}function m(e,t){return function(...e){const t=new ArrayBuffer(e.reduce(((e,t)=>e+t.data.length+5),0));let n=0;for(const r of e)n+=g(r,t,n);return new Uint8Array(t)}({data:e.toBinary(t),flags:p})}f.runtime=t.proto3,f.typeName="grpc.status.v1.Status",f.fields=t.proto3.util.newFieldList((()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:t.Any,repeated:!0}]));const p=0,v=128;function w(e,t){const n=new Headers(null!=e?e:{});return n.set("Content-Type","application/grpc-web+proto"),n.set("X-Grpc-Web","1"),n.set("X-User-Agent","@bufbuild/connect-web"),void 0!==t&&n.set("Grpc-Timeout",`${t}m`),n}function y(t){const n=t.get("Content-Type");switch(null==n?void 0:n.toLowerCase()){case"application/grpc-web":case"application/grpc-web+proto":return;case"application/grpc-web-text":case"application/grpc-web-text+proto":return new s("grpc-web-text is not supported",e.Code.Internal);default:return new s(`unexpected content type: ${String(n)}`,e.Code.Internal)}}function b(t){var n;const r=function(t){switch(t){case 200:return null;case 400:return e.Code.Internal;case 401:return e.Code.Unauthenticated;case 403:return e.Code.PermissionDenied;case 404:return e.Code.Unimplemented;case 429:case 502:case 503:case 504:return e.Code.Unavailable;default:return e.Code.Unknown}}(t.status);if(r)return new s(decodeURIComponent(null!==(n=t.headers.get("grpc-message"))&&void 0!==n?n:""),r)}function C(t){var n;const r=t.get("grpc-status");if(null===r)return;const a=parseInt(r);return 0!==a?a in e.Code?new s(decodeURIComponent(null!==(n=t.get("grpc-message"))&&void 0!==n?n:""),a,void 0,t):new s(`invalid grpc-status: ${r}`,e.Code.Internal,void 0,t):void 0}function A(n){const r=n.get("grpc-status-details-bin");if(null!=r)try{const a=function(n,r,a){try{const e=t.protoBase64.dec(n);return r?r.fromBinary(e,a):e}catch(t){throw new s(t instanceof Error?t.message:String(t),e.Code.DataLoss)}}(r,f);if(0==a.code)return;const o=new s(a.message,a.code,void 0,n);return o.details.push(...a.details),o}catch(t){const r=d(t,e.Code.Internal);return n.forEach(((e,t)=>r.metadata.append(t,e))),r}}function U(e){var t;const n=function(e){const t=new Headers,n=String.fromCharCode(...e).split("\r\n");for(const e of n){if(""===e)continue;const n=e.indexOf(":");if(n>0){const r=e.substring(0,n).trim(),a=e.substring(n+1).trim();t.append(r,a)}}return t}(e),r=null!==(t=A(n))&&void 0!==t?t:C(n);if(r)throw r;return n}const S=e=>!!e&&"0"!==e.toString();const O="/web-grpc/edison";function I(e=""){return"undefined"!=typeof window?window.location.host:n.URI.parse(e).getAuthority()}const E=e=>n=>t.__awaiter(void 0,void 0,void 0,(function*(){const r=t.getRequestOriginalUrl(),a=Object.assign(Object.assign({"Accept-Language":t.getPageLocale(),"X-Edison-Atlasservlet":t.getAtlasservlet(),"X-Edison-Page-Name":t.getPageName(),"X-Edison-Original-Url":r,"X-Edison-Original-Referer":t.getRequestOriginalReferrer()||"","X-Edison-Prompt-Controller":t.getInitData().deprecatedPromptController||"","X-Edison-Prompt-Action":t.getInitData().deprecatedPromptAction||"","X-Dropbox-Browser-Id":t.getDeviceIdHex(),"X-Dropbox-Authority":I(r)},function(e){const t={};return e&&(e.activeUser&&S(e.activeUser.id)&&(t["X-Dropbox-Uid"]=e.activeUser.id.toString()),e.activeTeam&&S(e.activeTeam.id)&&(t["X-Dropbox-Teamid"]=e.activeTeam.id.toString()),(e.authRole||e.authActionType)&&(t["X-Dropbox-Team-Authorization"]=JSON.stringify({auth_role:String(e.authRole),auth_action_type:String(e.authActionType)}))),t}(t.getAuthRequestInfo())),t.getExtraHttpRequestHeaders());return t.getPageName()&&(a["X-Dropbox-Client-Yaps-Attribution"]=`${t.getAtlasservlet()}:${t.getPageName()}`),Object.entries(a).filter((([e,t])=>!!t)).filter((([e,t])=>!(e.toLowerCase().startsWith("x-")&&n.header.has(e)))).forEach((([e,t])=>{t&&!n.header.has(e)&&n.header.set(e,t)})),yield e(n)}));function x(e=O){return h({baseUrl:e,interceptors:[E]})}e.ConnectError=s,e.createEdisonGRPCWebPromiseClient=function(e,t=O){return l(e,x(t))},e.createEdisonGrpcWebTransport=x}));
//# sourceMappingURL=c_init_data_edison.js-vfl-QhF4d.map
