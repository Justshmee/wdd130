define(["exports","./e_folder_viewer_src_main","./c_browse_data_selectors","./c_files_view_data_store","./c_pap-events_navigation_navigate_to_replay","./c_file_viewer_collection_viewer","react","./c_init_data_runtime","./c_lodash-es_lodash","./c_react_query_helpers_helpers","./c_api_v2_client_base","./c_core_uri","./c_core_attribution_header","./c_csrf","metaserver/static/js/modules/constants/viewer","./e_edison","./c_apex-metrics_src_types","./c_init_data_edison","./c_src_sink_index","./e_core_exception","./c_core_xhr","./c_api_v2_noauth_client","./c_core_i18n","metaserver/static/js/langpack","./c_core_notify","react-dom","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/constants/fingerprintjs_constants","./c_security_crypto","./c_browse_models","./c_base64","./c_sync_everything_redux_selectors","./c_flux_store_listener","./c_hooks_use_stabilized_callback","./c_stormcrow_gating_factory","./c_stormcrow_types_log_exposure","metaserver/static/js/modules/constants/pdf_editing","./c_ui-icon_line_restore","./c_growth_ui_teams_web_actions_logger_events","metaserver/static/js/modules/constants/search","./c_toolkit_dist_redux-toolkit","./c_home_store","./c_plugin_utils_getImageDefaultSizes","metaserver/static/js/modules/constants/unity","./c_growth_ui_api","./c_esm_misc_util","./c_referrer_cleansing_redirect","./c_cloud_docs_types","./c_keymaster","./c_es_hooks_useDispatch","./c_core_utils_browser_detection","./c_ui-icon_line_zoom-out","./c_campaigns_campaign_enums","./c_bolt_metaserver_clients","./c_skeleton_index","./c_ui-icon_line_team","./c_ui-icon_line_zip","./c_stormcrow_explicit_exposure_logging","./c_flows_logging_flows_loggers","./c_spectrum_util_raf_throttle","./c_flux_base_store","./c_cloud_docs_constants","./c_chips_index","./c_chip_index","metaserver/static/js/modules/constants/contacts","./c_spectrum_colorized_icon","./c_spectrum_svg_icon_bundle","./c_spectrum_positioned_portal","./c_user_centric_perf_metrics_component_visually_complete_component_visually_complete_calculator","./c_plugin_utils_drawWatermarkOnCanvas","./c_resize-observer-polyfill_dist_ResizeObserver","./c_badges_index","./c_badge_index","./c_react-error-boundary"],(function(e,t,i,s,o,_,r,c,n,a,l,d,u,p,v,m,g,f,w,S,E,h,b,A,x,D,y,F,k,I,O,N,P,j,W,R,T,U,K,B,C,L,z,H,V,q,M,$,G,Q,Z,J,X,Y,ee,te,ie,se,oe,_e,re,ce,ne,ae,le,de,ue,pe,ve,me,ge,fe,we,Se,Ee,he,be,Ae,xe,De){"use strict";const ye=[t.SDKPreviewSurface.BROWSE,t.SDKPreviewSurface.SEARCH,t.SDKPreviewSurface.STANDALONE_PREVIEW],Fe=(e,i)=>{i&&ye.includes(i)&&t.UserSurvey.trackEvent("download_item","previews"),t.isVideoPreview(e)&&t.UserSurvey.trackEvent("video_preview_download","previews")},ke=[t.SDKPreviewSurface.BROWSE,t.SDKPreviewSurface.SHARED_LINK,t.SDKPreviewSurface.STANDALONE_PREVIEW],Ie=e=>{const{getActiveFile:_,context:r,previewSurface:c,user:n}=e,{file:a}=_();Fe(a,c),c&&ke.includes(c)&&!t.isEncryptedFile(a)&&t.publishEvent(t.CampaignEvents.DOWNLOAD_BUTTON_CLICKED,{context:{file_name:t.getFilename(a),file_extension:t.getExtension$1(a),is_video_editing_eligible:!0===e.videoEditEligible?"true":"false"}});const l={onAttempt:()=>r.logUserAction(t.UserAction.DownloadStart),onSuccess:()=>{r.logUserAction(t.UserAction.DownloadSuccess,"title_bar_open_split_button")},onError:()=>r.logUserAction(t.UserAction.DownloadFailed)},{rootNSID:d,blockHash:u}=i.getBrowseState(s.getStoreForBrowse().getState()).context;n&&d&&t.isUnmountedBackupBrowse(n,d)?u&&t.isBrowseFile(a)&&o.downloadSingleFileAsZip({fqPath:a.fq_path,rootNsId:d,source:"PREVIEWS",blockHash:u,user:n},l):o.downloadSingleFile({href:a.href,source:"PREVIEWS",isFswm:t.isSharedFile(a),user:n,fileEncryptionInfo:t.getFileEncryptionInfo(a)},l)},Oe=e=>{const{getActiveFile:i,context:s,previewSurface:o,user:r,shareToken:c,sharePermission:n,encryptionOptions:a,authModalKind:l,videoEditEligible:d}=e,{file:u}=i();Fe(u,o),o&&ke.includes(o)&&!t.isEncryptedFile(u)&&t.publishEvent(t.CampaignEvents.DOWNLOAD_BUTTON_CLICKED,{context:{file_name:t.getFilename(u),file_extension:t.getExtension$1(u),is_video_editing_eligible:!0===d?"true":"false"}}),_.downloadActiveFile(u,r,a,l,s.logUserAction,c,t.getWebSignInTag(void 0!==r&&o===t.SDKPreviewSurface.INBAND_SHARE,!!(null==n?void 0:n.isSharedFolder)))};e.downloadActionWrapper=e=>{const{getActiveFile:i,fileContentMetadata:s}=e,{file:o}=i();return e.videoEditEligible=!s||void 0===_.checkFileEditEligibility(s,null==o?void 0:o.bytes,e.fileName),t.isSharedFile(o)?Oe(e):Ie(e)},e.nonSharedDownloadActionWrapper=Ie,e.sharedCopyActionWrapper=e=>{const{getActiveFile:i,context:s,previewSurface:o,user:r,shareToken:c,sharePermission:n,encryptionOptions:a,outOfQuota:l}=e,{file:d}=i();_.saveToDropbox(d,(e=>s.logUserAction(e,"title_bar_download_split_button")),r,c,a,t.RegistrationSource.SHMODEL_SAVE_TO_REGISTER,l,t.getWebSignInTag(void 0!==r&&o===t.SDKPreviewSurface.INBAND_SHARE,!!(null==n?void 0:n.isSharedFolder)),i().sharedLinkInfo)},e.sharedDownloadActionWrapper=Oe}));
//# sourceMappingURL=c_action_plugins_download_action_action.js-vfl5lPj-U.map
